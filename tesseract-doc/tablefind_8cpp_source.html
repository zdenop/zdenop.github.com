<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/textord/tablefind.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('tablefind_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/textord/tablefind.cpp</div>  </div>
</div>
<div class="contents">
<a href="tablefind_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">// File:        tablefind.cpp</span>
<a name="l00003"></a>00003 <span class="comment">// Description: Helper classes to find tables from ColPartitions.</span>
<a name="l00004"></a>00004 <span class="comment">// Author:      Faisal Shafait (faisal.shafait@dfki.de)</span>
<a name="l00005"></a>00005 <span class="comment">// Created:     Tue Jan 06 11:13:01 PST 2009</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// (C) Copyright 2009, Google Inc.</span>
<a name="l00008"></a>00008 <span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00009"></a>00009 <span class="comment">// you may not use this file except in compliance with the License.</span>
<a name="l00010"></a>00010 <span class="comment">// You may obtain a copy of the License at</span>
<a name="l00011"></a>00011 <span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00012"></a>00012 <span class="comment">// Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00014"></a>00014 <span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment">// See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment">// limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#pragma warning(disable:4244)  // Conversion warnings</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="tablefind_8h.html">tablefind.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="config__auto_8h.html">config_auto.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#endif</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;allheaders.h&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="colpartitionset_8h.html">colpartitionset.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="tablerecog_8h.html">tablerecog.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">namespace </span>tesseract {
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// These numbers are used to calculate the global median stats.</span>
<a name="l00038"></a>00038 <span class="comment">// They just set an upper bound on the stats objects.</span>
<a name="l00039"></a>00039 <span class="comment">// Maximum vertical spacing between neighbor partitions.</span>
<a name="l00040"></a><a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">00040</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a> = 500;
<a name="l00041"></a>00041 <span class="comment">// Maximum width of a blob in a partition.</span>
<a name="l00042"></a><a class="code" href="namespacetesseract.html#a83ac44e5e0c7348fd8591b3cba175dff">00042</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#a83ac44e5e0c7348fd8591b3cba175dff">kMaxBlobWidth</a> = 500;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">// Minimum whitespace size to split a partition (measured as a multiple</span>
<a name="l00045"></a>00045 <span class="comment">// of a partition&#39;s median width).</span>
<a name="l00046"></a><a class="code" href="namespacetesseract.html#aeecbc7f84d79acc5731cfdcccc164bde">00046</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#aeecbc7f84d79acc5731cfdcccc164bde">kSplitPartitionSize</a> = 2.0;
<a name="l00047"></a>00047 <span class="comment">// To insert text, the partition must satisfy these size constraints</span>
<a name="l00048"></a>00048 <span class="comment">// in AllowTextPartition(). The idea is to filter noise partitions</span>
<a name="l00049"></a>00049 <span class="comment">// determined by the size compared to the global medians.</span>
<a name="l00050"></a>00050 <span class="comment">// TODO(nbeato): Need to find good numbers again.</span>
<a name="l00051"></a><a class="code" href="namespacetesseract.html#a9b013c09ae4bd53f0b147f3945ae9c8c">00051</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a9b013c09ae4bd53f0b147f3945ae9c8c">kAllowTextHeight</a> = 0.5;
<a name="l00052"></a><a class="code" href="namespacetesseract.html#a92f436872c90049797ee7b1356f50133">00052</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a92f436872c90049797ee7b1356f50133">kAllowTextWidth</a> = 0.6;
<a name="l00053"></a><a class="code" href="namespacetesseract.html#a744c12bd96933e697e5afff35c492dc0">00053</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a744c12bd96933e697e5afff35c492dc0">kAllowTextArea</a> = 0.8;
<a name="l00054"></a>00054 <span class="comment">// The same thing applies to blobs (to filter noise).</span>
<a name="l00055"></a>00055 <span class="comment">// TODO(nbeato): These numbers are a shot in the dark...</span>
<a name="l00056"></a>00056 <span class="comment">// height and width are 0.5 * gridsize() in colfind.cpp</span>
<a name="l00057"></a>00057 <span class="comment">// area is a rough guess for the size of a period.</span>
<a name="l00058"></a><a class="code" href="namespacetesseract.html#a0de56cf05a1e8a1aee7e6bcd81e34742">00058</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a0de56cf05a1e8a1aee7e6bcd81e34742">kAllowBlobHeight</a> = 0.3;
<a name="l00059"></a><a class="code" href="namespacetesseract.html#aa86b1f68578cb7c0b834b2a137376ed7">00059</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#aa86b1f68578cb7c0b834b2a137376ed7">kAllowBlobWidth</a> = 0.4;
<a name="l00060"></a><a class="code" href="namespacetesseract.html#a714f54e357a15f2578470c0430a9ec5f">00060</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a714f54e357a15f2578470c0430a9ec5f">kAllowBlobArea</a> = 0.05;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="comment">// Minimum number of components in a text partition. A partition having fewer</span>
<a name="l00063"></a>00063 <span class="comment">// components than that is more likely a data partition and is a candidate</span>
<a name="l00064"></a>00064 <span class="comment">// table cell.</span>
<a name="l00065"></a><a class="code" href="namespacetesseract.html#a3fe030812946d2ca16b873bde30d5431">00065</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#a3fe030812946d2ca16b873bde30d5431">kMinBoxesInTextPartition</a> = 10;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">// Maximum number of components that a data partition can have</span>
<a name="l00068"></a><a class="code" href="namespacetesseract.html#ac2d16b5be5214a804964b939c8111bc7">00068</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#ac2d16b5be5214a804964b939c8111bc7">kMaxBoxesInDataPartition</a> = 20;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">// Maximum allowed gap in a text partitions as a multiple of its median size.</span>
<a name="l00071"></a><a class="code" href="namespacetesseract.html#a632cb2dd79696389be8feb970de28e3e">00071</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a632cb2dd79696389be8feb970de28e3e">kMaxGapInTextPartition</a> = 4.0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">// Minimum value that the maximum gap in a text partition should have as a</span>
<a name="l00074"></a>00074 <span class="comment">// factor of its median size.</span>
<a name="l00075"></a><a class="code" href="namespacetesseract.html#a25dab2777976176c8de47ef2fb5b74a5">00075</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a25dab2777976176c8de47ef2fb5b74a5">kMinMaxGapInTextPartition</a> = 0.5;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">// The amount of overlap that is &quot;normal&quot; for adjacent blobs in a text</span>
<a name="l00078"></a>00078 <span class="comment">// partition. This is used to calculate gap between overlapping blobs.</span>
<a name="l00079"></a><a class="code" href="namespacetesseract.html#af7577bf68e7e1466e0d58eb91ad999c6">00079</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#af7577bf68e7e1466e0d58eb91ad999c6">kMaxBlobOverlapFactor</a> = 4.0;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">// Maximum x-height a table partition can have as a multiple of global</span>
<a name="l00082"></a>00082 <span class="comment">// median x-height</span>
<a name="l00083"></a><a class="code" href="namespacetesseract.html#a12f077d41b2f5c668c1b25912b9b6244">00083</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a12f077d41b2f5c668c1b25912b9b6244">kMaxTableCellXheight</a> = 2.0;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">// Maximum line spacing between a table column header and column contents</span>
<a name="l00086"></a>00086 <span class="comment">// for merging the two (as a multiple of the partition&#39;s median_size).</span>
<a name="l00087"></a><a class="code" href="namespacetesseract.html#aae5eb999d710e50055ba3096b2f54c38">00087</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#aae5eb999d710e50055ba3096b2f54c38">kMaxColumnHeaderDistance</a> = 4;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">// Minimum ratio of num_table_partitions to num_text_partitions in a column</span>
<a name="l00090"></a>00090 <span class="comment">// block to be called it a table column</span>
<a name="l00091"></a><a class="code" href="namespacetesseract.html#a6a040ffaa830485299daa5c344ebe039">00091</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a6a040ffaa830485299daa5c344ebe039">kTableColumnThreshold</a> = 3.0;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">// Search for horizontal ruling lines within the vertical margin as a</span>
<a name="l00094"></a>00094 <span class="comment">// multiple of grid size</span>
<a name="l00095"></a><a class="code" href="namespacetesseract.html#ac42d5746b048036811177c1bd95e7691">00095</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#ac42d5746b048036811177c1bd95e7691">kRulingVerticalMargin</a> = 3;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">// Minimum overlap that a colpartition must have with a table region</span>
<a name="l00098"></a>00098 <span class="comment">// to become part of that table</span>
<a name="l00099"></a><a class="code" href="namespacetesseract.html#a0f2ae212b6b475efca7981fd1dc51e29">00099</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a0f2ae212b6b475efca7981fd1dc51e29">kMinOverlapWithTable</a> = 0.6;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment">// Maximum side space (distance from column boundary) that a typical</span>
<a name="l00102"></a>00102 <span class="comment">// text-line in flowing text should have as a multiple of its x-height</span>
<a name="l00103"></a>00103 <span class="comment">// (Median size).</span>
<a name="l00104"></a><a class="code" href="namespacetesseract.html#aee32ef58150f63a980c7b4f736c4a22a">00104</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#aee32ef58150f63a980c7b4f736c4a22a">kSideSpaceMargin</a> = 10;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">// Fraction of the peak of x-projection of a table region to set the</span>
<a name="l00107"></a>00107 <span class="comment">// threshold for the x-projection histogram</span>
<a name="l00108"></a><a class="code" href="namespacetesseract.html#ae12e73878098046ae28b0d54408359f7">00108</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#ae12e73878098046ae28b0d54408359f7">kSmallTableProjectionThreshold</a> = 0.35;
<a name="l00109"></a><a class="code" href="namespacetesseract.html#a39b11305adc922233ab775b31d94b6bb">00109</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a39b11305adc922233ab775b31d94b6bb">kLargeTableProjectionThreshold</a> = 0.45;
<a name="l00110"></a>00110 <span class="comment">// Minimum number of rows required to look for more rows in the projection.</span>
<a name="l00111"></a><a class="code" href="namespacetesseract.html#adf7c67274b1cdc63e4afeb2500796de7">00111</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#adf7c67274b1cdc63e4afeb2500796de7">kLargeTableRowCount</a> = 6;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="comment">// Minimum number of rows in a table</span>
<a name="l00114"></a><a class="code" href="namespacetesseract.html#a4947294f7e711f5f1713df9de000b1b8">00114</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#a4947294f7e711f5f1713df9de000b1b8">kMinRowsInTable</a> = 3;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">// The number of &quot;whitespace blobs&quot; that should appear between the</span>
<a name="l00117"></a>00117 <span class="comment">// ColPartition&#39;s bounding box and the column tab stops to the left/right</span>
<a name="l00118"></a>00118 <span class="comment">// when looking for center justified tab stops.</span>
<a name="l00119"></a><a class="code" href="namespacetesseract.html#a1daab9134060be235b5cc1ee94aceeaf">00119</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a1daab9134060be235b5cc1ee94aceeaf">kRequiredFullJustifiedSpacing</a> = 4.0;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">// The amount of padding (multiplied by global_median_xheight_ during use)</span>
<a name="l00122"></a>00122 <span class="comment">// that is vertically added to the search adjacent leader search during</span>
<a name="l00123"></a>00123 <span class="comment">// ColPartition marking.</span>
<a name="l00124"></a><a class="code" href="namespacetesseract.html#a7c23a9af9374381d1a961227ce653ea6">00124</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetesseract.html#a7c23a9af9374381d1a961227ce653ea6">kAdjacentLeaderSearchPadding</a> = 2;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">// Used when filtering false positives. When finding the last line</span>
<a name="l00127"></a>00127 <span class="comment">// of a paragraph (typically left-aligned), the previous line should have</span>
<a name="l00128"></a>00128 <span class="comment">// its center to the right of the last line by this scaled amount.</span>
<a name="l00129"></a><a class="code" href="namespacetesseract.html#ac6a1849ed370a22bb4a2b4a94ca1634c">00129</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#ac6a1849ed370a22bb4a2b4a94ca1634c">kParagraphEndingPreviousLineRatio</a> = 1.3;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment">// The maximum amount of whitespace allowed left of a paragraph ending.</span>
<a name="l00132"></a>00132 <span class="comment">// Do not filter a ColPartition with more than this space left of it.</span>
<a name="l00133"></a><a class="code" href="namespacetesseract.html#a1b76b5479d00c222f8a17e22d317b770">00133</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a1b76b5479d00c222f8a17e22d317b770">kMaxParagraphEndingLeftSpaceMultiple</a> = 3.0;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">// Used when filtering false positives. The last line of a paragraph</span>
<a name="l00136"></a>00136 <span class="comment">// should be preceded by a line that is predominantly text. This is the</span>
<a name="l00137"></a>00137 <span class="comment">// ratio of text to whitespace (to the right of the text) that is required</span>
<a name="l00138"></a>00138 <span class="comment">// for the previous line to be a text.</span>
<a name="l00139"></a><a class="code" href="namespacetesseract.html#a59fff4582ea32f8a8661fbc20a3ab947">00139</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a59fff4582ea32f8a8661fbc20a3ab947">kMinParagraphEndingTextToWhitespaceRatio</a> = 3.0;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">// When counting table columns, this is the required gap between two columns</span>
<a name="l00142"></a>00142 <span class="comment">// (it is multiplied by global_median_xheight_).</span>
<a name="l00143"></a><a class="code" href="namespacetesseract.html#af950654bba3a03e1ba3f1df8177cdd73">00143</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#af950654bba3a03e1ba3f1df8177cdd73">kMaxXProjectionGapFactor</a> = 2.0;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">// Used for similarity in partitions using stroke width. Values copied</span>
<a name="l00146"></a>00146 <span class="comment">// from ColFind.cpp in Ray&#39;s CL.</span>
<a name="l00147"></a><a class="code" href="namespacetesseract.html#a477fb9ba9844da49a285692762b117d9">00147</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a477fb9ba9844da49a285692762b117d9">kStrokeWidthFractionalTolerance</a> = 0.25;
<a name="l00148"></a>00148 <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacetesseract.html#a7dc74940f73222c81918e8701c301516">kStrokeWidthConstantTolerance</a> = 2.0;
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="namespacetesseract.html#a0706071af2ebaf3922f717646c41bc16">00150</a> <a class="code" href="params_8h.html#a442e7f541a050acf5ebda026db177877">BOOL_VAR</a>(<a class="code" href="namespacetesseract.html#a0706071af2ebaf3922f717646c41bc16">textord_dump_table_images</a>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Paint table detection output&quot;</span>);
<a name="l00151"></a><a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">00151</a> <a class="code" href="params_8h.html#a442e7f541a050acf5ebda026db177877">BOOL_VAR</a>(<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>, <span class="keyword">false</span>, <span class="stringliteral">&quot;Show table regions&quot;</span>);
<a name="l00152"></a>00152 <a class="code" href="params_8h.html#a442e7f541a050acf5ebda026db177877">BOOL_VAR</a>(<a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">textord_tablefind_show_mark</a>, <span class="keyword">false</span>,
<a name="l00153"></a><a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">00153</a>          <span class="stringliteral">&quot;Debug table marking steps in detail&quot;</span>);
<a name="l00154"></a>00154 <a class="code" href="params_8h.html#a442e7f541a050acf5ebda026db177877">BOOL_VAR</a>(<a class="code" href="namespacetesseract.html#a1b028e05393678b0316a80361e18c9a4">textord_tablefind_show_stats</a>, <span class="keyword">false</span>,
<a name="l00155"></a><a class="code" href="namespacetesseract.html#a1b028e05393678b0316a80361e18c9a4">00155</a>          <span class="stringliteral">&quot;Show page stats used in table finding&quot;</span>);
<a name="l00156"></a>00156 <a class="code" href="params_8h.html#a442e7f541a050acf5ebda026db177877">BOOL_VAR</a>(<a class="code" href="namespacetesseract.html#afbb5c3604dee9b42d1490616dd0bdd77">textord_tablefind_recognize_tables</a>, <span class="keyword">false</span>,
<a name="l00157"></a><a class="code" href="namespacetesseract.html#afbb5c3604dee9b42d1490616dd0bdd77">00157</a>          <span class="stringliteral">&quot;Enables the table recognizer for table layout and filtering.&quot;</span>);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <a class="code" href="namespacetesseract.html#a7c9c6594de104bda28d30b82eb3f65a9">ELISTIZE</a>(<a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>)
<a name="l00160"></a>00160 <a class="code" href="clst_8h.html#a721c1e0acc4a882f9ea934613aee64be">CLISTIZE</a>(<a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>)
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">// Templated helper function used to create destructor callbacks for the</span>
<a name="l00163"></a>00163 <span class="comment">// BBGrid::ClearGridData() method.</span>
<a name="l00164"></a><a class="code" href="namespacetesseract.html#a67d9dc6d03fb77b0f23aafd42bb3c835">00164</a> template &lt;typename T&gt; <span class="keywordtype">void</span> <a class="code" href="namespacetesseract.html#a67d9dc6d03fb77b0f23aafd42bb3c835">DeleteObject</a>(T *<span class="keywordtype">object</span>) {
<a name="l00165"></a>00165   <span class="keyword">delete</span> object;
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="classtesseract_1_1_table_finder.html#a4df3eb2b591c4b8777339e2a300316cf">00168</a> <a class="code" href="classtesseract_1_1_table_finder.html#a4df3eb2b591c4b8777339e2a300316cf">TableFinder::TableFinder</a>()
<a name="l00169"></a>00169     : resolution_(0),
<a name="l00170"></a>00170       global_median_xheight_(0),
<a name="l00171"></a>00171       global_median_blob_width_(0),
<a name="l00172"></a>00172       global_median_ledding_(0),
<a name="l00173"></a>00173       left_to_right_language_(true) {
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="classtesseract_1_1_table_finder.html#af785f06b1353645cece6b8873a6b78af">00176</a> <a class="code" href="classtesseract_1_1_table_finder.html#af785f06b1353645cece6b8873a6b78af">TableFinder::~TableFinder</a>() {
<a name="l00177"></a>00177   <span class="comment">// ColPartitions and ColSegments created by this class for storage in grids</span>
<a name="l00178"></a>00178   <span class="comment">// need to be deleted explicitly.</span>
<a name="l00179"></a>00179   <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#aa3f84b8f684c71394335a5a4f17c90be">ClearGridData</a>(&amp;DeleteObject&lt;ColPartition&gt;);
<a name="l00180"></a>00180   <a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#aa3f84b8f684c71394335a5a4f17c90be">ClearGridData</a>(&amp;DeleteObject&lt;ColPartition&gt;);
<a name="l00181"></a>00181   <a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#aa3f84b8f684c71394335a5a4f17c90be">ClearGridData</a>(&amp;DeleteObject&lt;ColPartition&gt;);
<a name="l00182"></a>00182   <a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#aa3f84b8f684c71394335a5a4f17c90be">ClearGridData</a>(&amp;DeleteObject&lt;ColSegment&gt;);
<a name="l00183"></a>00183   <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#aa3f84b8f684c71394335a5a4f17c90be">ClearGridData</a>(&amp;DeleteObject&lt;ColSegment&gt;);
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="classtesseract_1_1_table_finder.html#aacc9d09ee5545c6ba681a73ddfff139b">00186</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aacc9d09ee5545c6ba681a73ddfff139b">TableFinder::set_left_to_right_language</a>(<span class="keywordtype">bool</span> order) {
<a name="l00187"></a>00187   <a class="code" href="classtesseract_1_1_table_finder.html#a528595d792a34a2a361670aced196165">left_to_right_language_</a> = order;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="classtesseract_1_1_table_finder.html#a2addcdf6528f3a69fa25c94940cdc428">00190</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a2addcdf6528f3a69fa25c94940cdc428">TableFinder::Init</a>(<span class="keywordtype">int</span> grid_size, <span class="keyword">const</span> <a class="code" href="class_i_c_o_o_r_d.html" title="integer coordinate">ICOORD</a>&amp; bottom_left,
<a name="l00191"></a>00191                        <span class="keyword">const</span> <a class="code" href="class_i_c_o_o_r_d.html" title="integer coordinate">ICOORD</a>&amp; top_right) {
<a name="l00192"></a>00192   <span class="comment">// Initialize clean partitions list and grid</span>
<a name="l00193"></a>00193   <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a1d2990adf323d7910fbf87b6fc3a7415">Init</a>(grid_size, bottom_left, top_right);
<a name="l00194"></a>00194   <a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a1d2990adf323d7910fbf87b6fc3a7415">Init</a>(grid_size, bottom_left, top_right);
<a name="l00195"></a>00195   <a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a1d2990adf323d7910fbf87b6fc3a7415">Init</a>(grid_size, bottom_left, top_right);
<a name="l00196"></a>00196   <a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a1d2990adf323d7910fbf87b6fc3a7415">Init</a>(grid_size, bottom_left, top_right);
<a name="l00197"></a>00197   <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a1d2990adf323d7910fbf87b6fc3a7415">Init</a>(grid_size, bottom_left, top_right);
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">// Copy cleaned partitions from part_grid_ to clean_part_grid_ and</span>
<a name="l00201"></a>00201 <span class="comment">// insert leaders and rulers into the leader_and_ruling_grid_</span>
<a name="l00202"></a><a class="code" href="classtesseract_1_1_table_finder.html#a9f4115ada3be71a1106527aa59f31b43">00202</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a9f4115ada3be71a1106527aa59f31b43">TableFinder::InsertCleanPartitions</a>(<a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l00203"></a>00203                                         <a class="code" href="class_t_o___b_l_o_c_k.html">TO_BLOCK</a>* block) {
<a name="l00204"></a>00204   <span class="comment">// Calculate stats. This lets us filter partitions in AllowTextPartition()</span>
<a name="l00205"></a>00205   <span class="comment">// and filter blobs in AllowBlob().</span>
<a name="l00206"></a>00206   <a class="code" href="classtesseract_1_1_table_finder.html#a51c670936d76fcdf3ed1a0e2730a54c4">SetGlobalSpacings</a>(grid);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l00209"></a>00209   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(grid);
<a name="l00210"></a>00210   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a3c44b7c8272584600153d8249a841e73">SetUniqueMode</a>(<span class="keyword">true</span>);
<a name="l00211"></a>00211   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l00212"></a>00212   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00213"></a>00213   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00214"></a>00214     <span class="comment">// Reject partitions with nothing useful inside of them.</span>
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a644ec0c0a7bf20b9aca71b8413b2a87e">blob_type</a>() == <a class="code" href="blobbox_8h.html#aebfaf711760a99b60c297d1d619df575ae09c6f7e99c3a3885c3469d52d0292d2">BRT_NOISE</a> || part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a46fca3df91dc271b30b69531e9d8178a">area</a>() &lt;= 0)
<a name="l00216"></a>00216       <span class="keywordflow">continue</span>;
<a name="l00217"></a>00217     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* clean_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a70116af39898d43ca19ecb189faccfa1">ShallowCopy</a>();
<a name="l00218"></a>00218     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* leader_part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00219"></a>00219     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#acf97b6bd6c867bb71f5cd639f19b9994">IsLineType</a>()) {
<a name="l00220"></a>00220       <a class="code" href="classtesseract_1_1_table_finder.html#aa7a21d1842c6592372eb69b49b2010a2">InsertRulingPartition</a>(clean_part);
<a name="l00221"></a>00221       <span class="keywordflow">continue</span>;
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="comment">// Insert all non-text partitions to clean_parts</span>
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>()) {
<a name="l00225"></a>00225       <a class="code" href="classtesseract_1_1_table_finder.html#af310b33b86e951125b49e4ac1df2bb68">InsertImagePartition</a>(clean_part);
<a name="l00226"></a>00226       <span class="keywordflow">continue</span>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     <span class="comment">// Insert text colpartitions after removing noisy components from them</span>
<a name="l00229"></a>00229     <span class="comment">// The leaders are split into a separate grid.</span>
<a name="l00230"></a>00230     BLOBNBOX_CLIST* part_boxes = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3fc2dd797ede7a62546b2565811e9ce0">boxes</a>();
<a name="l00231"></a>00231     BLOBNBOX_C_IT pit(part_boxes);
<a name="l00232"></a>00232     <span class="keywordflow">for</span> (pit.mark_cycle_pt(); !pit.cycled_list(); pit.forward()) {
<a name="l00233"></a>00233       <a class="code" href="class_b_l_o_b_n_b_o_x.html">BLOBNBOX</a> *pblob = pit.data();
<a name="l00234"></a>00234       <span class="comment">// Bad blobs... happens in UNLV set.</span>
<a name="l00235"></a>00235       <span class="comment">// news.3G1, page 17 (around x=6)</span>
<a name="l00236"></a>00236       <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_table_finder.html#aec9b60ffceb19f3f82186b60c29b7f51">AllowBlob</a>(*pblob))
<a name="l00237"></a>00237         <span class="keywordflow">continue</span>;
<a name="l00238"></a>00238       <span class="keywordflow">if</span> (pblob-&gt;<a class="code" href="class_b_l_o_b_n_b_o_x.html#afafe7113396a8cc27b882d622db46f05">flow</a>() == <a class="code" href="blobbox_8h.html#aa72f1499398e9694bf46752e1cc895e1a64e3e70c4fac4d4e3facdb4638307d7f">BTFT_LEADER</a>) {
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (leader_part == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00240"></a>00240           leader_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a70116af39898d43ca19ecb189faccfa1">ShallowCopy</a>();
<a name="l00241"></a>00241           leader_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aff449be10b9bb6e480b65cd1042e38e4">set_flow</a>(<a class="code" href="blobbox_8h.html#aa72f1499398e9694bf46752e1cc895e1a64e3e70c4fac4d4e3facdb4638307d7f">BTFT_LEADER</a>);
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243         leader_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a636e7965ba55518f4e54a75a4a6ee1fd">AddBox</a>(pblob);
<a name="l00244"></a>00244       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pblob-&gt;<a class="code" href="class_b_l_o_b_n_b_o_x.html#a9e7100e6d08c78cca5f9c0453e11565d">region_type</a>() != <a class="code" href="blobbox_8h.html#aebfaf711760a99b60c297d1d619df575ae09c6f7e99c3a3885c3469d52d0292d2">BRT_NOISE</a>) {
<a name="l00245"></a>00245         clean_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a636e7965ba55518f4e54a75a4a6ee1fd">AddBox</a>(pblob);
<a name="l00246"></a>00246       }
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248     clean_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a18f2c4bd514ea700d7d4f6d0a6541d17">ComputeLimits</a>();
<a name="l00249"></a>00249     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* fragmented = clean_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3077eb7392f7d2ab1de2f93579fda55d">CopyButDontOwnBlobs</a>();
<a name="l00250"></a>00250     <a class="code" href="classtesseract_1_1_table_finder.html#ad312e62064f4964ac0eb6010d002b9cd">InsertTextPartition</a>(clean_part);
<a name="l00251"></a>00251     <a class="code" href="classtesseract_1_1_table_finder.html#a34950c2f035a25bb75f29a5ab51fe191">SplitAndInsertFragmentedTextPartition</a>(fragmented);
<a name="l00252"></a>00252     <span class="keywordflow">if</span> (leader_part != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00253"></a>00253       <span class="comment">// TODO(nbeato): Note that ComputeLimits does not update the column</span>
<a name="l00254"></a>00254       <span class="comment">// information. So the leader may appear to span more columns than it</span>
<a name="l00255"></a>00255       <span class="comment">// really does later on when IsInSameColumnAs gets called to test</span>
<a name="l00256"></a>00256       <span class="comment">// for adjacent leaders.</span>
<a name="l00257"></a>00257       leader_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a18f2c4bd514ea700d7d4f6d0a6541d17">ComputeLimits</a>();
<a name="l00258"></a>00258       <a class="code" href="classtesseract_1_1_table_finder.html#a818a95d0b0bdb619e0170dac27426942">InsertLeaderPartition</a>(leader_part);
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="comment">// Make the partition partners better for upper and lower neighbors.</span>
<a name="l00263"></a>00263   <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_col_partition_grid.html#a7ed32c7b4717fc000dd55796f6bf86d7">FindPartitionPartners</a>();
<a name="l00264"></a>00264   <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_col_partition_grid.html#a4781167f958ee8cc47549d8b39b9f1b5">RefinePartitionPartners</a>(<span class="keyword">false</span>);
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="comment">// High level function to perform table detection</span>
<a name="l00268"></a><a class="code" href="classtesseract_1_1_table_finder.html#a31d3976698617bc729409e1e0ff0c4ca">00268</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a31d3976698617bc729409e1e0ff0c4ca">TableFinder::LocateTables</a>(<a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l00269"></a>00269                                <a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>** all_columns,
<a name="l00270"></a>00270                                <a class="code" href="class_tess_result_callback1.html">WidthCallback</a>* width_cb,
<a name="l00271"></a>00271                                <span class="keyword">const</span> <a class="code" href="class_f_c_o_o_r_d.html">FCOORD</a>&amp; reskew) {
<a name="l00272"></a>00272   <span class="comment">// initialize spacing, neighbors, and columns</span>
<a name="l00273"></a>00273   <a class="code" href="classtesseract_1_1_table_finder.html#a5dfc53ecb81ee804476fd04f32434e6c">InitializePartitions</a>(all_columns);
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l00275"></a>00275     <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(0, 300, <span class="stringliteral">&quot;Column Partitions &amp; Neighbors&quot;</span>);
<a name="l00276"></a>00276     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00277"></a>00277     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>,
<a name="l00278"></a>00278                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0ae903faf0b9c434a6cff979e51620f8">ScrollView::AQUAMARINE</a>);
<a name="l00279"></a>00279     <a class="code" href="classtesseract_1_1_table_finder.html#ae38774700a97b1690f1530d77432a762">DisplayColPartitionConnections</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>,
<a name="l00280"></a>00280                                    <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0691e22f5da865103a497f9503269a61">ScrollView::ORANGE</a>);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(100, 300, <span class="stringliteral">&quot;Fragmented Text&quot;</span>);
<a name="l00283"></a>00283     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285   <span class="comment">// mark, filter, and smooth candidate table partitions</span>
<a name="l00286"></a>00286   <a class="code" href="classtesseract_1_1_table_finder.html#a7f29dd0a40d57b00d4868ff1c656dd6a">MarkTablePartitions</a>();
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <span class="comment">// Make single-column blocks from good_columns_ partitions. col_segments are</span>
<a name="l00289"></a>00289   <span class="comment">// moved to a grid later which takes the ownership</span>
<a name="l00290"></a>00290   ColSegment_LIST column_blocks;
<a name="l00291"></a>00291   <a class="code" href="classtesseract_1_1_table_finder.html#a7869fe256b237ad13171f13c8a6cc449">GetColumnBlocks</a>(all_columns, &amp;column_blocks);
<a name="l00292"></a>00292   <span class="comment">// Set the ratio of candidate table partitions in each column</span>
<a name="l00293"></a>00293   <a class="code" href="classtesseract_1_1_table_finder.html#ac3e8a6d03fcaf027677919f284af6500">SetColumnsType</a>(&amp;column_blocks);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <span class="comment">// Move column segments to col_seg_grid_</span>
<a name="l00296"></a>00296   <a class="code" href="classtesseract_1_1_table_finder.html#a81003bea37eced8d746035bd565b9c56">MoveColSegmentsToGrid</a>(&amp;column_blocks, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="comment">// Detect split in column layout that might have occurred due to the</span>
<a name="l00299"></a>00299   <span class="comment">// presence of a table. In such a case, merge the corresponding columns.</span>
<a name="l00300"></a>00300   <a class="code" href="classtesseract_1_1_table_finder.html#a7a3319f9a1eab06ef83a6e3f2df7e8d2">GridMergeColumnBlocks</a>();
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="comment">// Group horizontally overlapping table partitions into table columns.</span>
<a name="l00303"></a>00303   <span class="comment">// table_columns created here get deleted at the end of this method.</span>
<a name="l00304"></a>00304   ColSegment_LIST table_columns;
<a name="l00305"></a>00305   <a class="code" href="classtesseract_1_1_table_finder.html#a30f071829b47f7bd9afdd4ef819f582d">GetTableColumns</a>(&amp;table_columns);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="comment">// Within each column, mark the range table regions occupy based on the</span>
<a name="l00308"></a>00308   <span class="comment">// table columns detected. table_regions are moved to a grid later which</span>
<a name="l00309"></a>00309   <span class="comment">// takes the ownership</span>
<a name="l00310"></a>00310   ColSegment_LIST table_regions;
<a name="l00311"></a>00311   <a class="code" href="classtesseract_1_1_table_finder.html#a581a66fbdfdd0da5c3679a31f8d7944e">GetTableRegions</a>(&amp;table_columns, &amp;table_regions);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">textord_tablefind_show_mark</a>) {
<a name="l00314"></a>00314     <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(1200, 300, <span class="stringliteral">&quot;Table Columns and Regions&quot;</span>);
<a name="l00315"></a>00315     <a class="code" href="classtesseract_1_1_table_finder.html#a0778d0e3d6bc52330704d1143a73f90a">DisplayColSegments</a>(table_win, &amp;table_columns, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a46dc68c065ac8c61e1213f2449479f8c">ScrollView::DARK_TURQUOISE</a>);
<a name="l00316"></a>00316     <a class="code" href="classtesseract_1_1_table_finder.html#a0778d0e3d6bc52330704d1143a73f90a">DisplayColSegments</a>(table_win, &amp;table_regions, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a61dec9bc0aaf1d527a731b2a6ce055c8">ScrollView::YELLOW</a>);
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">// Merge table regions across columns for tables spanning multiple</span>
<a name="l00320"></a>00320   <span class="comment">// columns</span>
<a name="l00321"></a>00321   <a class="code" href="classtesseract_1_1_table_finder.html#a81003bea37eced8d746035bd565b9c56">MoveColSegmentsToGrid</a>(&amp;table_regions, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l00322"></a>00322   <a class="code" href="classtesseract_1_1_table_finder.html#a9298cd74b3e81315195a547a890752e0">GridMergeTableRegions</a>();
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <span class="comment">// Adjust table boundaries by including nearby horizontal lines and left</span>
<a name="l00325"></a>00325   <span class="comment">// out column headers</span>
<a name="l00326"></a>00326   <a class="code" href="classtesseract_1_1_table_finder.html#a2af79bdd1c4edbf03f4d2a15ee203be8">AdjustTableBoundaries</a>();
<a name="l00327"></a>00327   <a class="code" href="classtesseract_1_1_table_finder.html#a9298cd74b3e81315195a547a890752e0">GridMergeTableRegions</a>();
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#afbb5c3604dee9b42d1490616dd0bdd77">textord_tablefind_recognize_tables</a>) {
<a name="l00330"></a>00330     <span class="comment">// Remove false alarms consiting of a single column</span>
<a name="l00331"></a>00331     <a class="code" href="classtesseract_1_1_table_finder.html#ad1d77425898bfe8808255b9a472663ab">DeleteSingleColumnTables</a>();
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l00334"></a>00334       <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(1200, 300, <span class="stringliteral">&quot;Detected Table Locations&quot;</span>);
<a name="l00335"></a>00335       <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00336"></a>00336       <a class="code" href="classtesseract_1_1_table_finder.html#a0778d0e3d6bc52330704d1143a73f90a">DisplayColSegments</a>(table_win, &amp;table_columns, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8afcf7a70cd729b6f0a668f762ec8a5820">ScrollView::KHAKI</a>);
<a name="l00337"></a>00337       <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a01e56b692125ef3220a23695e2c4821f">DisplayBoxes</a>(table_win);
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="comment">// Find table grid structure and reject tables that are malformed.</span>
<a name="l00341"></a>00341     <a class="code" href="classtesseract_1_1_table_finder.html#a647fe056ae6bb33cc8989f08aac5172f">RecognizeTables</a>();
<a name="l00342"></a>00342     <a class="code" href="classtesseract_1_1_table_finder.html#a9298cd74b3e81315195a547a890752e0">GridMergeTableRegions</a>();
<a name="l00343"></a>00343     <a class="code" href="classtesseract_1_1_table_finder.html#a647fe056ae6bb33cc8989f08aac5172f">RecognizeTables</a>();
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l00346"></a>00346       <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(1400, 600, <span class="stringliteral">&quot;Recognized Tables&quot;</span>);
<a name="l00347"></a>00347       <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>,
<a name="l00348"></a>00348                            <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00349"></a>00349       <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a01e56b692125ef3220a23695e2c4821f">DisplayBoxes</a>(table_win);
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351   } <span class="keywordflow">else</span> {
<a name="l00352"></a>00352     <span class="comment">// Remove false alarms consiting of a single column</span>
<a name="l00353"></a>00353     <span class="comment">// TODO(nbeato): verify this is a NOP after structured table rejection.</span>
<a name="l00354"></a>00354     <span class="comment">// Right now it isn&#39;t. If the recognize function is doing what it is</span>
<a name="l00355"></a>00355     <span class="comment">// supposed to do, this function is obsolete.</span>
<a name="l00356"></a>00356     <a class="code" href="classtesseract_1_1_table_finder.html#ad1d77425898bfe8808255b9a472663ab">DeleteSingleColumnTables</a>();
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l00359"></a>00359       <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(1500, 300, <span class="stringliteral">&quot;Detected Tables&quot;</span>);
<a name="l00360"></a>00360       <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>,
<a name="l00361"></a>00361                            <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00362"></a>00362       <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a01e56b692125ef3220a23695e2c4821f">DisplayBoxes</a>(table_win);
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a0706071af2ebaf3922f717646c41bc16">textord_dump_table_images</a>)
<a name="l00367"></a>00367     <a class="code" href="classtesseract_1_1_table_finder.html#abbd932c16cdfa0cf35f9ef93e2e87f49">WriteToPix</a>(reskew);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <span class="comment">// Merge all colpartitions in table regions to make them a single</span>
<a name="l00370"></a>00370   <span class="comment">// colpartition and revert types of isolated table cells not</span>
<a name="l00371"></a>00371   <span class="comment">// assigned to any table to their original types.</span>
<a name="l00372"></a>00372   <a class="code" href="classtesseract_1_1_table_finder.html#a1856836a1386196d5784244b4a1aa2d0">MakeTableBlocks</a>(grid, all_columns, width_cb);
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 <span class="comment">// All grids have the same dimensions. The clean_part_grid_ sizes are set from</span>
<a name="l00375"></a>00375 <span class="comment">// the part_grid_ that is passed to InsertCleanPartitions, which was the same as</span>
<a name="l00376"></a>00376 <span class="comment">// the grid that is the base of ColumnFinder. Just return the clean_part_grid_</span>
<a name="l00377"></a>00377 <span class="comment">// dimensions instead of duplicated memory.</span>
<a name="l00378"></a><a class="code" href="classtesseract_1_1_table_finder.html#aecbfe718794e99b2f15a43a7f7350848">00378</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_table_finder.html#aecbfe718794e99b2f15a43a7f7350848">TableFinder::gridsize</a>()<span class="keyword"> const </span>{
<a name="l00379"></a>00379   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_grid_base.html#afff2cee730084711205977b5fcb4901e">gridsize</a>();
<a name="l00380"></a>00380 }
<a name="l00381"></a><a class="code" href="classtesseract_1_1_table_finder.html#a9234ae10ef078a56d67d6ceb91050b2e">00381</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_table_finder.html#a9234ae10ef078a56d67d6ceb91050b2e">TableFinder::gridwidth</a>()<span class="keyword"> const </span>{
<a name="l00382"></a>00382   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_grid_base.html#a0a38ea995b9d65f8b67d66d5501a5b80">gridwidth</a>();
<a name="l00383"></a>00383 }
<a name="l00384"></a><a class="code" href="classtesseract_1_1_table_finder.html#a704fbe9cb0edeaa969bb0cc2bd1f9dbd">00384</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_table_finder.html#a704fbe9cb0edeaa969bb0cc2bd1f9dbd">TableFinder::gridheight</a>()<span class="keyword"> const </span>{
<a name="l00385"></a>00385   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_grid_base.html#a07e6b230c150180d009ef1f317e642f2">gridheight</a>();
<a name="l00386"></a>00386 }
<a name="l00387"></a><a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">00387</a> <span class="keyword">const</span> <a class="code" href="class_i_c_o_o_r_d.html" title="integer coordinate">ICOORD</a>&amp; <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">TableFinder::bleft</a>()<span class="keyword"> const </span>{
<a name="l00388"></a>00388   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_grid_base.html#ad20b2cb8eb2bf52871d5260c04949cce">bleft</a>();
<a name="l00389"></a>00389 }
<a name="l00390"></a><a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">00390</a> <span class="keyword">const</span> <a class="code" href="class_i_c_o_o_r_d.html" title="integer coordinate">ICOORD</a>&amp; <a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">TableFinder::tright</a>()<span class="keyword"> const </span>{
<a name="l00391"></a>00391   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_grid_base.html#aa94e147841b6a4fae0b28e7e872685a5">tright</a>();
<a name="l00392"></a>00392 }
<a name="l00393"></a>00393 
<a name="l00394"></a><a class="code" href="classtesseract_1_1_table_finder.html#ad312e62064f4964ac0eb6010d002b9cd">00394</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ad312e62064f4964ac0eb6010d002b9cd">TableFinder::InsertTextPartition</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00395"></a>00395   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(part != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00396"></a>00396   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a534bca2a3fa57718c0bdf18b6af69af6">AllowTextPartition</a>(*part)) {
<a name="l00397"></a>00397     <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, part);
<a name="l00398"></a>00398   } <span class="keywordflow">else</span> {
<a name="l00399"></a>00399     <span class="keyword">delete</span> part;
<a name="l00400"></a>00400   }
<a name="l00401"></a>00401 }
<a name="l00402"></a><a class="code" href="classtesseract_1_1_table_finder.html#a216c040efc8dff584076cc324240c524">00402</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a216c040efc8dff584076cc324240c524">TableFinder::InsertFragmentedTextPartition</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00403"></a>00403   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(part != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a534bca2a3fa57718c0bdf18b6af69af6">AllowTextPartition</a>(*part)) {
<a name="l00405"></a>00405     <a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, part);
<a name="l00406"></a>00406   } <span class="keywordflow">else</span> {
<a name="l00407"></a>00407     <span class="keyword">delete</span> part;
<a name="l00408"></a>00408   }
<a name="l00409"></a>00409 }
<a name="l00410"></a><a class="code" href="classtesseract_1_1_table_finder.html#a818a95d0b0bdb619e0170dac27426942">00410</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a818a95d0b0bdb619e0170dac27426942">TableFinder::InsertLeaderPartition</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00411"></a>00411   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(part != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aa1c839940b58f4e6c3dbfa71294fff47">IsEmpty</a>() &amp;&amp; part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a46fca3df91dc271b30b69531e9d8178a">area</a>() &gt; 0) {
<a name="l00413"></a>00413     <a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, part);
<a name="l00414"></a>00414   } <span class="keywordflow">else</span> {
<a name="l00415"></a>00415     <span class="keyword">delete</span> part;
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417 }
<a name="l00418"></a><a class="code" href="classtesseract_1_1_table_finder.html#aa7a21d1842c6592372eb69b49b2010a2">00418</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aa7a21d1842c6592372eb69b49b2010a2">TableFinder::InsertRulingPartition</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00419"></a>00419   <a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, part);
<a name="l00420"></a>00420 }
<a name="l00421"></a><a class="code" href="classtesseract_1_1_table_finder.html#af310b33b86e951125b49e4ac1df2bb68">00421</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#af310b33b86e951125b49e4ac1df2bb68">TableFinder::InsertImagePartition</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00422"></a>00422   <span class="comment">// NOTE: If images are placed into a different grid in the future,</span>
<a name="l00423"></a>00423   <span class="comment">// the function SetPartitionSpacings needs to be updated. It should</span>
<a name="l00424"></a>00424   <span class="comment">// be the only thing that cares about image partitions.</span>
<a name="l00425"></a>00425   <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, part);
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="comment">// Splits a partition into its &quot;words&quot;. The splits happen</span>
<a name="l00429"></a>00429 <span class="comment">// at locations with wide inter-blob spacing. This is useful</span>
<a name="l00430"></a>00430 <span class="comment">// because it allows the table recognize to &quot;cut through&quot; the</span>
<a name="l00431"></a>00431 <span class="comment">// text lines on the page. The assumption is that a table</span>
<a name="l00432"></a>00432 <span class="comment">// will have several lines with similar overlapping whitespace</span>
<a name="l00433"></a>00433 <span class="comment">// whereas text will not have this type of property.</span>
<a name="l00434"></a>00434 <span class="comment">// Note: The code Assumes that blobs are sorted by the left side x!</span>
<a name="l00435"></a>00435 <span class="comment">// This will not work (as well) if the blobs are sorted by center/right.</span>
<a name="l00436"></a><a class="code" href="classtesseract_1_1_table_finder.html#a34950c2f035a25bb75f29a5ab51fe191">00436</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a34950c2f035a25bb75f29a5ab51fe191">TableFinder::SplitAndInsertFragmentedTextPartition</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00437"></a>00437   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(part != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00438"></a>00438   <span class="comment">// Bye bye empty partitions!</span>
<a name="l00439"></a>00439   <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3fc2dd797ede7a62546b2565811e9ce0">boxes</a>()-&gt;empty()) {
<a name="l00440"></a>00440     <span class="keyword">delete</span> part;
<a name="l00441"></a>00441     <span class="keywordflow">return</span>;
<a name="l00442"></a>00442   }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="comment">// The AllowBlob function prevents this.</span>
<a name="l00445"></a>00445   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#ae6dbcc0f37246998a114bbe2432d1969">median_width</a>() &gt; 0);
<a name="l00446"></a>00446   <span class="keyword">const</span> <span class="keywordtype">double</span> kThreshold = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#ae6dbcc0f37246998a114bbe2432d1969">median_width</a>() * <a class="code" href="namespacetesseract.html#aeecbc7f84d79acc5731cfdcccc164bde">kSplitPartitionSize</a>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* right_part = part;
<a name="l00449"></a>00449   <span class="keywordtype">bool</span> found_split = <span class="keyword">true</span>;
<a name="l00450"></a>00450   <span class="keywordflow">while</span> (found_split) {
<a name="l00451"></a>00451     found_split = <span class="keyword">false</span>;
<a name="l00452"></a>00452     BLOBNBOX_C_IT box_it(right_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3fc2dd797ede7a62546b2565811e9ce0">boxes</a>());
<a name="l00453"></a>00453     <span class="comment">// Blobs are sorted left side first. If blobs overlap,</span>
<a name="l00454"></a>00454     <span class="comment">// the previous blob may have a &quot;more right&quot; right side.</span>
<a name="l00455"></a>00455     <span class="comment">// Account for this by always keeping the largest &quot;right&quot;</span>
<a name="l00456"></a>00456     <span class="comment">// so far.</span>
<a name="l00457"></a>00457     <span class="keywordtype">int</span> previous_right = <a class="code" href="host_8h.html#ae6f88d5bb15e97510f484289f2fc89fd">MIN_INT32</a>;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="comment">// Look for the next split in the partition.</span>
<a name="l00460"></a>00460     <span class="keywordflow">for</span> (box_it.mark_cycle_pt(); !box_it.cycled_list(); box_it.forward()) {
<a name="l00461"></a>00461       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = box_it.data()-&gt;bounding_box();
<a name="l00462"></a>00462       <span class="keywordflow">if</span> (previous_right != <a class="code" href="host_8h.html#ae6f88d5bb15e97510f484289f2fc89fd">MIN_INT32</a> &amp;&amp;
<a name="l00463"></a>00463           box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() - previous_right &gt; kThreshold) {
<a name="l00464"></a>00464         <span class="comment">// We have a split position. Split the partition in two pieces.</span>
<a name="l00465"></a>00465         <span class="comment">// Insert the left piece in the grid and keep processing the right.</span>
<a name="l00466"></a>00466         <span class="keywordtype">int</span> mid_x = (box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() + previous_right) / 2;
<a name="l00467"></a>00467         <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* left_part = right_part;
<a name="l00468"></a>00468         right_part = left_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a33427fb9a563253c69e0806115fb2a4b">SplitAt</a>(mid_x);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         <a class="code" href="classtesseract_1_1_table_finder.html#a216c040efc8dff584076cc324240c524">InsertFragmentedTextPartition</a>(left_part);
<a name="l00471"></a>00471         found_split = <span class="keyword">true</span>;
<a name="l00472"></a>00472         <span class="keywordflow">break</span>;
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475       <span class="comment">// The right side of the previous blobs.</span>
<a name="l00476"></a>00476       previous_right = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(previous_right, box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>());
<a name="l00477"></a>00477     }
<a name="l00478"></a>00478   }
<a name="l00479"></a>00479   <span class="comment">// When a split is not found, the right part is minimized</span>
<a name="l00480"></a>00480   <span class="comment">// as much as possible, so process it.</span>
<a name="l00481"></a>00481   <a class="code" href="classtesseract_1_1_table_finder.html#a216c040efc8dff584076cc324240c524">InsertFragmentedTextPartition</a>(right_part);
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="comment">// Some simple criteria to filter out now. We want to make sure the</span>
<a name="l00485"></a>00485 <span class="comment">// average blob size in the partition is consistent with the</span>
<a name="l00486"></a>00486 <span class="comment">// global page stats.</span>
<a name="l00487"></a>00487 <span class="comment">// The area metric will almost always pass for multi-blob partitions.</span>
<a name="l00488"></a>00488 <span class="comment">// It is useful when filtering out noise caused by an isolated blob.</span>
<a name="l00489"></a><a class="code" href="classtesseract_1_1_table_finder.html#a534bca2a3fa57718c0bdf18b6af69af6">00489</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a534bca2a3fa57718c0bdf18b6af69af6">TableFinder::AllowTextPartition</a>(<span class="keyword">const</span> <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>&amp; part)<span class="keyword"> const </span>{
<a name="l00490"></a>00490   <span class="keyword">const</span> <span class="keywordtype">double</span> kHeightRequired = <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a> * <a class="code" href="namespacetesseract.html#a9b013c09ae4bd53f0b147f3945ae9c8c">kAllowTextHeight</a>;
<a name="l00491"></a>00491   <span class="keyword">const</span> <span class="keywordtype">double</span> kWidthRequired = <a class="code" href="classtesseract_1_1_table_finder.html#a761fd57460670c531131bd2a77227911">global_median_blob_width_</a> * <a class="code" href="namespacetesseract.html#a92f436872c90049797ee7b1356f50133">kAllowTextWidth</a>;
<a name="l00492"></a>00492   <span class="keyword">const</span> <span class="keywordtype">int</span> median_area = <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a> * <a class="code" href="classtesseract_1_1_table_finder.html#a761fd57460670c531131bd2a77227911">global_median_blob_width_</a>;
<a name="l00493"></a>00493   <span class="keyword">const</span> <span class="keywordtype">double</span> kAreaPerBlobRequired = median_area * <a class="code" href="namespacetesseract.html#a744c12bd96933e697e5afff35c492dc0">kAllowTextArea</a>;
<a name="l00494"></a>00494   <span class="comment">// Keep comparisons strictly greater to disallow 0!</span>
<a name="l00495"></a>00495   <span class="keywordflow">return</span> part.<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>() &gt; kHeightRequired &amp;&amp;
<a name="l00496"></a>00496          part.<a class="code" href="classtesseract_1_1_col_partition.html#ae6dbcc0f37246998a114bbe2432d1969">median_width</a>() &gt; kWidthRequired &amp;&amp;
<a name="l00497"></a>00497          part.<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a46fca3df91dc271b30b69531e9d8178a">area</a>() &gt; kAreaPerBlobRequired * part.<a class="code" href="classtesseract_1_1_col_partition.html#a5632ec24bcc7483eb943a325a73c47dc">boxes_count</a>();
<a name="l00498"></a>00498 }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 <span class="comment">// Same as above, applied to blobs. Keep in mind that</span>
<a name="l00501"></a>00501 <span class="comment">// leaders, commas, and periods are important in tables.</span>
<a name="l00502"></a><a class="code" href="classtesseract_1_1_table_finder.html#aec9b60ffceb19f3f82186b60c29b7f51">00502</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec9b60ffceb19f3f82186b60c29b7f51">TableFinder::AllowBlob</a>(<span class="keyword">const</span> <a class="code" href="class_b_l_o_b_n_b_o_x.html">BLOBNBOX</a>&amp; blob)<span class="keyword"> const </span>{
<a name="l00503"></a>00503   <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = blob.<a class="code" href="class_b_l_o_b_n_b_o_x.html#a7b97b8bc16b1473a28f9c44011522f4e">bounding_box</a>();
<a name="l00504"></a>00504   <span class="keyword">const</span> <span class="keywordtype">double</span> kHeightRequired = <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a> * <a class="code" href="namespacetesseract.html#a0de56cf05a1e8a1aee7e6bcd81e34742">kAllowBlobHeight</a>;
<a name="l00505"></a>00505   <span class="keyword">const</span> <span class="keywordtype">double</span> kWidthRequired = <a class="code" href="classtesseract_1_1_table_finder.html#a761fd57460670c531131bd2a77227911">global_median_blob_width_</a> * <a class="code" href="namespacetesseract.html#aa86b1f68578cb7c0b834b2a137376ed7">kAllowBlobWidth</a>;
<a name="l00506"></a>00506   <span class="keyword">const</span> <span class="keywordtype">int</span> median_area = <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a> * <a class="code" href="classtesseract_1_1_table_finder.html#a761fd57460670c531131bd2a77227911">global_median_blob_width_</a>;
<a name="l00507"></a>00507   <span class="keyword">const</span> <span class="keywordtype">double</span> kAreaRequired = median_area * <a class="code" href="namespacetesseract.html#a714f54e357a15f2578470c0430a9ec5f">kAllowBlobArea</a>;
<a name="l00508"></a>00508   <span class="comment">// Keep comparisons strictly greater to disallow 0!</span>
<a name="l00509"></a>00509   <span class="keywordflow">return</span> box.<a class="code" href="class_t_b_o_x.html#a8379d4bbc72bdbb1f069fc14790e632d">height</a>() &gt; kHeightRequired &amp;&amp;
<a name="l00510"></a>00510          box.<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>() &gt; kWidthRequired &amp;&amp;
<a name="l00511"></a>00511          box.<a class="code" href="class_t_b_o_x.html#a46fca3df91dc271b30b69531e9d8178a">area</a>() &gt; kAreaRequired;
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 <span class="comment">// TODO(nbeato): The grid that makes the window doesn&#39;t seem to matter.</span>
<a name="l00515"></a>00515 <span class="comment">// The only downside is that window messages will be caught by</span>
<a name="l00516"></a>00516 <span class="comment">// clean_part_grid_ instead of a useful object. This is a temporary solution</span>
<a name="l00517"></a>00517 <span class="comment">// for the debug windows created by the TableFinder.</span>
<a name="l00518"></a><a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">00518</a> <a class="code" href="class_scroll_view.html">ScrollView</a>* <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">TableFinder::MakeWindow</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <span class="keywordtype">char</span>* window_name) {
<a name="l00519"></a>00519   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#aa716f76c7f04f7112abfc10a3f8c63e0">MakeWindow</a>(x, y, window_name);
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="comment">// Make single-column blocks from good_columns_ partitions.</span>
<a name="l00523"></a><a class="code" href="classtesseract_1_1_table_finder.html#a7869fe256b237ad13171f13c8a6cc449">00523</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a7869fe256b237ad13171f13c8a6cc449">TableFinder::GetColumnBlocks</a>(<a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>** all_columns,
<a name="l00524"></a>00524                                   ColSegment_LIST* column_blocks) {
<a name="l00525"></a>00525   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classtesseract_1_1_table_finder.html#a704fbe9cb0edeaa969bb0cc2bd1f9dbd">gridheight</a>(); ++i) {
<a name="l00526"></a>00526     <a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>* columns = all_columns[i];
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (columns != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00528"></a>00528       ColSegment_LIST new_blocks;
<a name="l00529"></a>00529       <span class="comment">// Get boxes from the current vertical position on the grid</span>
<a name="l00530"></a>00530       columns-&gt;<a class="code" href="classtesseract_1_1_col_partition_set.html#ae48258575cffe3725081778e493cfa04">GetColumnBoxes</a>(i * <a class="code" href="classtesseract_1_1_table_finder.html#aecbfe718794e99b2f15a43a7f7350848">gridsize</a>(), (i+1) * <a class="code" href="classtesseract_1_1_table_finder.html#aecbfe718794e99b2f15a43a7f7350848">gridsize</a>(), &amp;new_blocks);
<a name="l00531"></a>00531       <span class="comment">// Merge the new_blocks boxes into column_blocks if they are well-aligned</span>
<a name="l00532"></a>00532       <a class="code" href="classtesseract_1_1_table_finder.html#a41bef91f2096c4a3bbe486b4d304bddb">GroupColumnBlocks</a>(&amp;new_blocks, column_blocks);
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="comment">// Merge column segments into the current list if they are well aligned.</span>
<a name="l00538"></a><a class="code" href="classtesseract_1_1_table_finder.html#a41bef91f2096c4a3bbe486b4d304bddb">00538</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a41bef91f2096c4a3bbe486b4d304bddb">TableFinder::GroupColumnBlocks</a>(ColSegment_LIST* new_blocks,
<a name="l00539"></a>00539                                     ColSegment_LIST* column_blocks) {
<a name="l00540"></a>00540   ColSegment_IT src_it(new_blocks);
<a name="l00541"></a>00541   ColSegment_IT dest_it(column_blocks);
<a name="l00542"></a>00542   <span class="comment">// iterate through the source list</span>
<a name="l00543"></a>00543   <span class="keywordflow">for</span> (src_it.mark_cycle_pt(); !src_it.cycled_list(); src_it.forward()) {
<a name="l00544"></a>00544     <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* src_seg = src_it.data();
<a name="l00545"></a>00545     <a class="code" href="class_t_b_o_x.html">TBOX</a> src_box = src_seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l00546"></a>00546     <span class="keywordtype">bool</span> match_found = <span class="keyword">false</span>;
<a name="l00547"></a>00547     <span class="comment">// iterate through the destination list to find a matching column block</span>
<a name="l00548"></a>00548     <span class="keywordflow">for</span> (dest_it.mark_cycle_pt(); !dest_it.cycled_list(); dest_it.forward()) {
<a name="l00549"></a>00549       <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* dest_seg = dest_it.data();
<a name="l00550"></a>00550       <a class="code" href="class_t_b_o_x.html">TBOX</a> dest_box = dest_seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l00551"></a>00551       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a4caabd9ca4346514d60c7dce8400a909">ConsecutiveBoxes</a>(src_box, dest_box)) {
<a name="l00552"></a>00552         <span class="comment">// If matching block is found, insert the current block into it</span>
<a name="l00553"></a>00553         <span class="comment">// and delete the soure block</span>
<a name="l00554"></a>00554         dest_seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(src_box);
<a name="l00555"></a>00555         match_found = <span class="keyword">true</span>;
<a name="l00556"></a>00556         <span class="keyword">delete</span> src_it.extract();
<a name="l00557"></a>00557         <span class="keywordflow">break</span>;
<a name="l00558"></a>00558       }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560     <span class="comment">// If no match is found, just append the source block to column_blocks</span>
<a name="l00561"></a>00561     <span class="keywordflow">if</span> (!match_found) {
<a name="l00562"></a>00562       dest_it.add_after_then_move(src_it.extract());
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564   }
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="comment">// are the two boxes immediate neighbors along the vertical direction</span>
<a name="l00568"></a><a class="code" href="classtesseract_1_1_table_finder.html#a4caabd9ca4346514d60c7dce8400a909">00568</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a4caabd9ca4346514d60c7dce8400a909">TableFinder::ConsecutiveBoxes</a>(<span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;b1, <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;b2) {
<a name="l00569"></a>00569   <span class="keywordtype">int</span> x_margin = 20;
<a name="l00570"></a>00570   <span class="keywordtype">int</span> y_margin = 5;
<a name="l00571"></a>00571   <span class="keywordflow">return</span> (abs(b1.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() - b2.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>()) &lt; x_margin) &amp;&amp;
<a name="l00572"></a>00572       (abs(b1.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>() - b2.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>()) &lt; x_margin) &amp;&amp;
<a name="l00573"></a>00573       (abs(b1.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>()-b2.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>()) &lt; y_margin ||
<a name="l00574"></a>00574        abs(b2.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>()-b1.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>()) &lt; y_margin);
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="comment">// Set up info for clean_part_grid_ partitions to be valid during detection</span>
<a name="l00578"></a>00578 <span class="comment">// code.</span>
<a name="l00579"></a><a class="code" href="classtesseract_1_1_table_finder.html#a5dfc53ecb81ee804476fd04f32434e6c">00579</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a5dfc53ecb81ee804476fd04f32434e6c">TableFinder::InitializePartitions</a>(<a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>** all_columns) {
<a name="l00580"></a>00580   <a class="code" href="classtesseract_1_1_table_finder.html#acfb82ae105ee34d1360dd0c5dc8487ff">FindNeighbors</a>();
<a name="l00581"></a>00581   <a class="code" href="classtesseract_1_1_table_finder.html#aa4b52f48d63d4881da34b7d84932e84d">SetPartitionSpacings</a>(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, all_columns);
<a name="l00582"></a>00582   <a class="code" href="classtesseract_1_1_table_finder.html#a51c670936d76fcdf3ed1a0e2730a54c4">SetGlobalSpacings</a>(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 <span class="comment">// Set left, right and top, bottom spacings of each colpartition.</span>
<a name="l00586"></a><a class="code" href="classtesseract_1_1_table_finder.html#aa4b52f48d63d4881da34b7d84932e84d">00586</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aa4b52f48d63d4881da34b7d84932e84d">TableFinder::SetPartitionSpacings</a>(<a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l00587"></a>00587                                        <a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>** all_columns) {
<a name="l00588"></a>00588   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l00589"></a>00589   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(grid);
<a name="l00590"></a>00590   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l00591"></a>00591   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00592"></a>00592   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00593"></a>00593     <a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>* columns = all_columns[gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#abb4fccc7685ba0e893b8b638a11b5cde">GridY</a>()];
<a name="l00594"></a>00594     <a class="code" href="class_t_b_o_x.html">TBOX</a> box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l00595"></a>00595     <span class="keywordtype">int</span> y = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#acfb9938222780d3957049698e2bde9e6">MidY</a>();
<a name="l00596"></a>00596     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* left_column = columns-&gt;<a class="code" href="classtesseract_1_1_col_partition_set.html#a9a65bec02d946f263f18aa86a186c91c">ColumnContaining</a>(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), y);
<a name="l00597"></a>00597     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* right_column = columns-&gt;<a class="code" href="classtesseract_1_1_col_partition_set.html#a9a65bec02d946f263f18aa86a186c91c">ColumnContaining</a>(box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), y);
<a name="l00598"></a>00598     <span class="comment">// set distance from left column as space to the left</span>
<a name="l00599"></a>00599     <span class="keywordflow">if</span> (left_column) {
<a name="l00600"></a>00600       <span class="keywordtype">int</span> left_space = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(0, box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() - left_column-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#ab71e3aebabe8a0a9e3cde26f84ec4f46">LeftAtY</a>(y));
<a name="l00601"></a>00601       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0de8ea9569a2b819639e3c69654fbe1d">set_space_to_left</a>(left_space);
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603     <span class="comment">// set distance from right column as space to the right</span>
<a name="l00604"></a>00604     <span class="keywordflow">if</span> (right_column) {
<a name="l00605"></a>00605       <span class="keywordtype">int</span> right_space = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(0, right_column-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3731935e70135384e25904d65c0ca8f7">RightAtY</a>(y) - box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>());
<a name="l00606"></a>00606       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aa6bbfdc1a1f7c0384225c8691e27613a">set_space_to_right</a>(right_space);
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <span class="comment">// Look for images that may be closer.</span>
<a name="l00610"></a>00610     <span class="comment">// NOTE: used to be part_grid_, might cause issues now</span>
<a name="l00611"></a>00611     <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> hsearch(grid);
<a name="l00612"></a>00612     hsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab4eb5b4d43442c26b598b45672713fab">StartSideSearch</a>(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(), box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>());
<a name="l00613"></a>00613     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00614"></a>00614     <span class="keywordflow">while</span> ((neighbor = hsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a7515ca407e452687f762349f1c3113ff">NextSideSearch</a>(<span class="keyword">true</span>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00615"></a>00615       <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a88dcd7f4800095eb2f18b8a9bd521001">PT_PULLOUT_IMAGE</a> ||
<a name="l00616"></a>00616           neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60ae4dd1e076e7d8354de8123bbdfb9e6b0">PT_FLOWING_IMAGE</a> ||
<a name="l00617"></a>00617           neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a919711bca6bed2e6a9846e4dc91f3900">PT_HEADING_IMAGE</a>) {
<a name="l00618"></a>00618         <span class="keywordtype">int</span> right = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l00619"></a>00619         <span class="keywordflow">if</span> (right &lt; box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>()) {
<a name="l00620"></a>00620           <span class="keywordtype">int</span> space = <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() - right, part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4c55a12d96d51a9710edc292c1946ca1">space_to_left</a>());
<a name="l00621"></a>00621           part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0de8ea9569a2b819639e3c69654fbe1d">set_space_to_left</a>(space);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623       }
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625     hsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab4eb5b4d43442c26b598b45672713fab">StartSideSearch</a>(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(), box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>());
<a name="l00626"></a>00626     neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00627"></a>00627     <span class="keywordflow">while</span> ((neighbor = hsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a7515ca407e452687f762349f1c3113ff">NextSideSearch</a>(<span class="keyword">false</span>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00628"></a>00628       <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a88dcd7f4800095eb2f18b8a9bd521001">PT_PULLOUT_IMAGE</a> ||
<a name="l00629"></a>00629           neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60ae4dd1e076e7d8354de8123bbdfb9e6b0">PT_FLOWING_IMAGE</a> ||
<a name="l00630"></a>00630           neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a919711bca6bed2e6a9846e4dc91f3900">PT_HEADING_IMAGE</a>) {
<a name="l00631"></a>00631         <span class="keywordtype">int</span> left = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l00632"></a>00632         <span class="keywordflow">if</span> (left &gt; box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>()) {
<a name="l00633"></a>00633           <span class="keywordtype">int</span> space = <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(left - box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2e061b11b010ed6ee0382300f423735c">space_to_right</a>());
<a name="l00634"></a>00634           part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aa6bbfdc1a1f7c0384225c8691e27613a">set_space_to_right</a>(space);
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636       }
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* upper_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abb824820c4ebf82ee1dfc9c2a30c17ce">SingletonPartner</a>(<span class="keyword">true</span>);
<a name="l00640"></a>00640     <span class="keywordflow">if</span> (upper_part) {
<a name="l00641"></a>00641       <span class="keywordtype">int</span> space = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(0, upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() -
<a name="l00642"></a>00642                          part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l00643"></a>00643       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a83c96bfabcdbf1d17a676a614a43337f">set_space_above</a>(space);
<a name="l00644"></a>00644     } <span class="keywordflow">else</span> {
<a name="l00645"></a>00645       <span class="comment">// TODO(nbeato): What constitutes a good value?</span>
<a name="l00646"></a>00646       <span class="comment">// 0 is the default value when not set, explicitly noting it needs to</span>
<a name="l00647"></a>00647       <span class="comment">// be something else.</span>
<a name="l00648"></a>00648       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a83c96bfabcdbf1d17a676a614a43337f">set_space_above</a>(<a class="code" href="host_8h.html#aac62d87844689a18b6f5339a89ed6e7f">MAX_INT32</a>);
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* lower_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abb824820c4ebf82ee1dfc9c2a30c17ce">SingletonPartner</a>(<span class="keyword">false</span>);
<a name="l00652"></a>00652     <span class="keywordflow">if</span> (lower_part) {
<a name="l00653"></a>00653       <span class="keywordtype">int</span> space = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(0, part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() -
<a name="l00654"></a>00654                          lower_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l00655"></a>00655       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#ad2083c18299f4e6850ca4d5d6ba9c83d">set_space_below</a>(space);
<a name="l00656"></a>00656     } <span class="keywordflow">else</span> {
<a name="l00657"></a>00657       <span class="comment">// TODO(nbeato): What constitutes a good value?</span>
<a name="l00658"></a>00658       <span class="comment">// 0 is the default value when not set, explicitly noting it needs to</span>
<a name="l00659"></a>00659       <span class="comment">// be something else.</span>
<a name="l00660"></a>00660       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#ad2083c18299f4e6850ca4d5d6ba9c83d">set_space_below</a>(<a class="code" href="host_8h.html#aac62d87844689a18b6f5339a89ed6e7f">MAX_INT32</a>);
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662   }
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="comment">// Set spacing and closest neighbors above and below a given colpartition.</span>
<a name="l00666"></a><a class="code" href="classtesseract_1_1_table_finder.html#ad6c2c9a0fdec2c14ef0ddc63a5d0217d">00666</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ad6c2c9a0fdec2c14ef0ddc63a5d0217d">TableFinder::SetVerticalSpacing</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part) {
<a name="l00667"></a>00667   <a class="code" href="class_t_b_o_x.html">TBOX</a> box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l00668"></a>00668   <span class="keywordtype">int</span> top_range = <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() + <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a>, <a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">tright</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>());
<a name="l00669"></a>00669   <span class="keywordtype">int</span> bottom_range = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() - <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a>, <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>());
<a name="l00670"></a>00670   box.<a class="code" href="class_t_b_o_x.html#a7f40dfd290a907200bdc98c196f63f45">set_top</a>(top_range);
<a name="l00671"></a>00671   box.<a class="code" href="class_t_b_o_x.html#a6f803b24b046883cb0f3882dc3d92302">set_bottom</a>(bottom_range);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   <a class="code" href="class_t_b_o_x.html">TBOX</a> part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l00674"></a>00674   <span class="comment">// Start a rect search</span>
<a name="l00675"></a>00675   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l00676"></a>00676       rectsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l00677"></a>00677   rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(box);
<a name="l00678"></a>00678   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* neighbor;
<a name="l00679"></a>00679   <span class="keywordtype">int</span> min_space_above = <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a>;
<a name="l00680"></a>00680   <span class="keywordtype">int</span> min_space_below = <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a>;
<a name="l00681"></a>00681   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* above_neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00682"></a>00682   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* below_neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00683"></a>00683   <span class="keywordflow">while</span> ((neighbor = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (neighbor == part)
<a name="l00685"></a>00685       <span class="keywordflow">continue</span>;
<a name="l00686"></a>00686     <a class="code" href="class_t_b_o_x.html">TBOX</a> neighbor_box = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l00687"></a>00687     <span class="keywordflow">if</span> (neighbor_box.<a class="code" href="class_t_b_o_x.html#a9f7e4e20bdfeee0d82db2f8d24aa72dc">major_x_overlap</a>(part_box)) {
<a name="l00688"></a>00688       <span class="keywordtype">int</span> gap = abs(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a9f0978c738e29da8c7474beb0024a62f">median_bottom</a>() - neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a9f0978c738e29da8c7474beb0024a62f">median_bottom</a>());
<a name="l00689"></a>00689       <span class="comment">// If neighbor is below current partition</span>
<a name="l00690"></a>00690       <span class="keywordflow">if</span> (neighbor_box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() &lt; part_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() &amp;&amp;
<a name="l00691"></a>00691           gap &lt; min_space_below) {
<a name="l00692"></a>00692         min_space_below = gap;
<a name="l00693"></a>00693         below_neighbor = neighbor;
<a name="l00694"></a>00694       }  <span class="comment">// If neighbor is above current partition</span>
<a name="l00695"></a>00695       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (part_box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() &lt; neighbor_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() &amp;&amp;
<a name="l00696"></a>00696                gap &lt; min_space_above) {
<a name="l00697"></a>00697         min_space_above = gap;
<a name="l00698"></a>00698         above_neighbor = neighbor;
<a name="l00699"></a>00699        }
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702   part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a83c96bfabcdbf1d17a676a614a43337f">set_space_above</a>(min_space_above);
<a name="l00703"></a>00703   part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#ad2083c18299f4e6850ca4d5d6ba9c83d">set_space_below</a>(min_space_below);
<a name="l00704"></a>00704   part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a5b00935a33d05ca217802b4d7591b1a2">set_nearest_neighbor_above</a>(above_neighbor);
<a name="l00705"></a>00705   part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a6bb36d2ee748af0b77c8b2742ef5741a">set_nearest_neighbor_below</a>(below_neighbor);
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 <span class="comment">// Set global spacing and x-height estimates</span>
<a name="l00709"></a><a class="code" href="classtesseract_1_1_table_finder.html#a51c670936d76fcdf3ed1a0e2730a54c4">00709</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a51c670936d76fcdf3ed1a0e2730a54c4">TableFinder::SetGlobalSpacings</a>(<a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid) {
<a name="l00710"></a>00710   <a class="code" href="class_s_t_a_t_s.html">STATS</a> xheight_stats(0, <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a> + 1);
<a name="l00711"></a>00711   <a class="code" href="class_s_t_a_t_s.html">STATS</a> width_stats(0, <a class="code" href="namespacetesseract.html#a83ac44e5e0c7348fd8591b3cba175dff">kMaxBlobWidth</a> + 1);
<a name="l00712"></a>00712   <a class="code" href="class_s_t_a_t_s.html">STATS</a> ledding_stats(0, <a class="code" href="namespacetesseract.html#a00d83d0f6a701860dcf421bbbe283fef">kMaxVerticalSpacing</a> + 1);
<a name="l00713"></a>00713   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l00714"></a>00714   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(grid);
<a name="l00715"></a>00715   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a3c44b7c8272584600153d8249a841e73">SetUniqueMode</a>(<span class="keyword">true</span>);
<a name="l00716"></a>00716   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l00717"></a>00717   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00718"></a>00718   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00719"></a>00719     <span class="comment">// TODO(nbeato): HACK HACK HACK! medians are equal to partition length.</span>
<a name="l00720"></a>00720     <span class="comment">// ComputeLimits needs to get called somewhere outside of TableFinder</span>
<a name="l00721"></a>00721     <span class="comment">// to make sure the partitions are properly initialized.</span>
<a name="l00722"></a>00722     <span class="comment">// When this is called, SmoothPartitionPartners dies in an assert after</span>
<a name="l00723"></a>00723     <span class="comment">// table find runs. Alternative solution.</span>
<a name="l00724"></a>00724     <span class="comment">// part-&gt;ComputeLimits();</span>
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>()) {
<a name="l00726"></a>00726       <span class="comment">// xheight_stats.add(part-&gt;median_size(), part-&gt;boxes_count());</span>
<a name="l00727"></a>00727       <span class="comment">// width_stats.add(part-&gt;median_width(), part-&gt;boxes_count());</span>
<a name="l00728"></a>00728 
<a name="l00729"></a>00729       <span class="comment">// This loop can be removed when above issues are fixed.</span>
<a name="l00730"></a>00730       <span class="comment">// Replace it with the 2 lines commented out above.</span>
<a name="l00731"></a>00731       BLOBNBOX_C_IT it(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3fc2dd797ede7a62546b2565811e9ce0">boxes</a>());
<a name="l00732"></a>00732       <span class="keywordflow">for</span> (it.mark_cycle_pt(); !it.cycled_list(); it.forward()) {
<a name="l00733"></a>00733         xheight_stats.<a class="code" href="class_s_t_a_t_s.html#ab8cacba14df28eed1bffc4cea0b2f87f">add</a>(it.data()-&gt;bounding_box().height(), 1);
<a name="l00734"></a>00734         width_stats.<a class="code" href="class_s_t_a_t_s.html#ab8cacba14df28eed1bffc4cea0b2f87f">add</a>(it.data()-&gt;bounding_box().width(), 1);
<a name="l00735"></a>00735       }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737       ledding_stats.<a class="code" href="class_s_t_a_t_s.html#ab8cacba14df28eed1bffc4cea0b2f87f">add</a>(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0ec12f1a3ec7b885749c16a798b3c794">space_above</a>(), 1);
<a name="l00738"></a>00738       ledding_stats.<a class="code" href="class_s_t_a_t_s.html#ab8cacba14df28eed1bffc4cea0b2f87f">add</a>(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a46abe5ef4b5224d671c50d1de5ac985b">space_below</a>(), 1);
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741   <span class="comment">// Set estimates based on median of statistics obtained</span>
<a name="l00742"></a>00742   <a class="code" href="classtesseract_1_1_table_finder.html#a8be2bff4c272c65c0c4e896037620381">set_global_median_xheight</a>(static_cast&lt;int&gt;(xheight_stats.<a class="code" href="class_s_t_a_t_s.html#a3ce7095c6a55592a610085b0fad7d955">median</a>() + 0.5));
<a name="l00743"></a>00743   <a class="code" href="classtesseract_1_1_table_finder.html#a793bbaf0945bb838b9c934899c4de87a">set_global_median_blob_width</a>(static_cast&lt;int&gt;(width_stats.<a class="code" href="class_s_t_a_t_s.html#a3ce7095c6a55592a610085b0fad7d955">median</a>() + 0.5));
<a name="l00744"></a>00744   <a class="code" href="classtesseract_1_1_table_finder.html#aa5644866b8727722deec53b73c4d7831">set_global_median_ledding</a>(static_cast&lt;int&gt;(ledding_stats.<a class="code" href="class_s_t_a_t_s.html#a3ce7095c6a55592a610085b0fad7d955">median</a>() + 0.5));
<a name="l00745"></a>00745 <span class="preprocessor">  #ifndef GRAPHICS_DISABLED</span>
<a name="l00746"></a>00746 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a1b028e05393678b0316a80361e18c9a4">textord_tablefind_show_stats</a>) {
<a name="l00747"></a>00747     <span class="keyword">const</span> <span class="keywordtype">char</span>* kWindowName = <span class="stringliteral">&quot;X-height (R), X-width (G), and ledding (B)&quot;</span>;
<a name="l00748"></a>00748     <a class="code" href="class_scroll_view.html">ScrollView</a>* stats_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(500, 10, kWindowName);
<a name="l00749"></a>00749     xheight_stats.<a class="code" href="class_s_t_a_t_s.html#a6f39b8d4dcae1a2a33e2db066a82a7dd">plot</a>(stats_win, 10, 200, 2, 15, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0959f7470b08ae1a38aa7e38fba29402">ScrollView::RED</a>);
<a name="l00750"></a>00750     width_stats.<a class="code" href="class_s_t_a_t_s.html#a6f39b8d4dcae1a2a33e2db066a82a7dd">plot</a>(stats_win, 10, 200, 2, 15, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a9d8c87be486dead41d198d6b97a22174">ScrollView::GREEN</a>);
<a name="l00751"></a>00751     ledding_stats.<a class="code" href="class_s_t_a_t_s.html#a6f39b8d4dcae1a2a33e2db066a82a7dd">plot</a>(stats_win, 10, 200, 2, 15, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00752"></a>00752   }
<a name="l00753"></a>00753 <span class="preprocessor">  #endif  // GRAPHICS_DISABLED</span>
<a name="l00754"></a>00754 <span class="preprocessor"></span>}
<a name="l00755"></a>00755 
<a name="l00756"></a><a class="code" href="classtesseract_1_1_table_finder.html#a8be2bff4c272c65c0c4e896037620381">00756</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a8be2bff4c272c65c0c4e896037620381">TableFinder::set_global_median_xheight</a>(<span class="keywordtype">int</span> xheight) {
<a name="l00757"></a>00757   <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a> = xheight;
<a name="l00758"></a>00758 }
<a name="l00759"></a><a class="code" href="classtesseract_1_1_table_finder.html#a793bbaf0945bb838b9c934899c4de87a">00759</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a793bbaf0945bb838b9c934899c4de87a">TableFinder::set_global_median_blob_width</a>(<span class="keywordtype">int</span> width) {
<a name="l00760"></a>00760   <a class="code" href="classtesseract_1_1_table_finder.html#a761fd57460670c531131bd2a77227911">global_median_blob_width_</a> = width;
<a name="l00761"></a>00761 }
<a name="l00762"></a><a class="code" href="classtesseract_1_1_table_finder.html#aa5644866b8727722deec53b73c4d7831">00762</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aa5644866b8727722deec53b73c4d7831">TableFinder::set_global_median_ledding</a>(<span class="keywordtype">int</span> ledding) {
<a name="l00763"></a>00763   <a class="code" href="classtesseract_1_1_table_finder.html#a1d5828695e17f10f2d4140476c9f34fd">global_median_ledding_</a> = ledding;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="classtesseract_1_1_table_finder.html#acfb82ae105ee34d1360dd0c5dc8487ff">00766</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#acfb82ae105ee34d1360dd0c5dc8487ff">TableFinder::FindNeighbors</a>() {
<a name="l00767"></a>00767   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l00768"></a>00768   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l00769"></a>00769   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00770"></a>00770   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00771"></a>00771     <span class="comment">// TODO(nbeato): Rename this function, meaning is different now.</span>
<a name="l00772"></a>00772     <span class="comment">// IT is finding nearest neighbors its own way</span>
<a name="l00773"></a>00773     <span class="comment">//SetVerticalSpacing(part);</span>
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* upper = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abb824820c4ebf82ee1dfc9c2a30c17ce">SingletonPartner</a>(<span class="keyword">true</span>);
<a name="l00776"></a>00776     <span class="keywordflow">if</span> (upper)
<a name="l00777"></a>00777       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a5b00935a33d05ca217802b4d7591b1a2">set_nearest_neighbor_above</a>(upper);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* lower = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abb824820c4ebf82ee1dfc9c2a30c17ce">SingletonPartner</a>(<span class="keyword">false</span>);
<a name="l00780"></a>00780     <span class="keywordflow">if</span> (lower)
<a name="l00781"></a>00781       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a6bb36d2ee748af0b77c8b2742ef5741a">set_nearest_neighbor_below</a>(lower);
<a name="l00782"></a>00782   }
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 <span class="comment">// High level interface. Input is an unmarked ColPartitionGrid</span>
<a name="l00786"></a>00786 <span class="comment">// (namely, clean_part_grid_). Partitions are identified using local</span>
<a name="l00787"></a>00787 <span class="comment">// information and filter/smoothed. The function exit should contain</span>
<a name="l00788"></a>00788 <span class="comment">// a good sampling of the table partitions.</span>
<a name="l00789"></a><a class="code" href="classtesseract_1_1_table_finder.html#a7f29dd0a40d57b00d4868ff1c656dd6a">00789</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a7f29dd0a40d57b00d4868ff1c656dd6a">TableFinder::MarkTablePartitions</a>() {
<a name="l00790"></a>00790   <a class="code" href="classtesseract_1_1_table_finder.html#aeb0fc1badeb2def5cf69aca53392c89c">MarkPartitionsUsingLocalInformation</a>();
<a name="l00791"></a>00791   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">textord_tablefind_show_mark</a>) {
<a name="l00792"></a>00792     <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(300, 300, <span class="stringliteral">&quot;Initial Table Partitions&quot;</span>);
<a name="l00793"></a>00793     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00794"></a>00794     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>,
<a name="l00795"></a>00795                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0ae903faf0b9c434a6cff979e51620f8">ScrollView::AQUAMARINE</a>);
<a name="l00796"></a>00796   }
<a name="l00797"></a>00797   <a class="code" href="classtesseract_1_1_table_finder.html#a34734ff8fb23f8bfb88dc60e06cb2c17">FilterFalseAlarms</a>();
<a name="l00798"></a>00798   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">textord_tablefind_show_mark</a>) {
<a name="l00799"></a>00799     <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(600, 300, <span class="stringliteral">&quot;Filtered Table Partitions&quot;</span>);
<a name="l00800"></a>00800     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00801"></a>00801     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>,
<a name="l00802"></a>00802                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0ae903faf0b9c434a6cff979e51620f8">ScrollView::AQUAMARINE</a>);
<a name="l00803"></a>00803   }
<a name="l00804"></a>00804   <a class="code" href="classtesseract_1_1_table_finder.html#ae3d5e2e4c894d4514717d0593792226d">SmoothTablePartitionRuns</a>();
<a name="l00805"></a>00805   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">textord_tablefind_show_mark</a>) {
<a name="l00806"></a>00806     <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(900, 300, <span class="stringliteral">&quot;Smoothed Table Partitions&quot;</span>);
<a name="l00807"></a>00807     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00808"></a>00808     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>,
<a name="l00809"></a>00809                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0ae903faf0b9c434a6cff979e51620f8">ScrollView::AQUAMARINE</a>);
<a name="l00810"></a>00810   }
<a name="l00811"></a>00811   <a class="code" href="classtesseract_1_1_table_finder.html#a34734ff8fb23f8bfb88dc60e06cb2c17">FilterFalseAlarms</a>();
<a name="l00812"></a>00812   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a56bba6e7e00fb6404cc2036638e8b588">textord_tablefind_show_mark</a> || <a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l00813"></a>00813     <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(900, 300, <span class="stringliteral">&quot;Final Table Partitions&quot;</span>);
<a name="l00814"></a>00814     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>);
<a name="l00815"></a>00815     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>,
<a name="l00816"></a>00816                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a0ae903faf0b9c434a6cff979e51620f8">ScrollView::AQUAMARINE</a>);
<a name="l00817"></a>00817   }
<a name="l00818"></a>00818 }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 <span class="comment">// These types of partitions are marked as table partitions:</span>
<a name="l00821"></a>00821 <span class="comment">//  1- Partitions that have at lease one large gap between words</span>
<a name="l00822"></a>00822 <span class="comment">//  2- Partitions that consist of only one word (no significant gap</span>
<a name="l00823"></a>00823 <span class="comment">//     between components)</span>
<a name="l00824"></a>00824 <span class="comment">//  3- Partitions that vertically overlap with other partitions within the</span>
<a name="l00825"></a>00825 <span class="comment">//     same column.</span>
<a name="l00826"></a>00826 <span class="comment">//  4- Partitions with leaders before/after them.</span>
<a name="l00827"></a><a class="code" href="classtesseract_1_1_table_finder.html#aeb0fc1badeb2def5cf69aca53392c89c">00827</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aeb0fc1badeb2def5cf69aca53392c89c">TableFinder::MarkPartitionsUsingLocalInformation</a>() {
<a name="l00828"></a>00828   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l00829"></a>00829   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l00830"></a>00830     gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l00831"></a>00831   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l00832"></a>00832   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00833"></a>00833   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00834"></a>00834     <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>())  <span class="comment">// Only consider text partitions</span>
<a name="l00835"></a>00835       <span class="keywordflow">continue</span>;
<a name="l00836"></a>00836     <span class="comment">// Only consider partitions in dominant font size or smaller</span>
<a name="l00837"></a>00837     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>() &gt; <a class="code" href="namespacetesseract.html#a12f077d41b2f5c668c1b25912b9b6244">kMaxTableCellXheight</a> * <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a>)
<a name="l00838"></a>00838       <span class="keywordflow">continue</span>;
<a name="l00839"></a>00839     <span class="comment">// Mark partitions with a large gap, or no significant gap as</span>
<a name="l00840"></a>00840     <span class="comment">// table partitions.</span>
<a name="l00841"></a>00841     <span class="comment">// Comments: It produces several false alarms at:</span>
<a name="l00842"></a>00842     <span class="comment">//  - last line of a paragraph (fixed)</span>
<a name="l00843"></a>00843     <span class="comment">//  - single word section headings</span>
<a name="l00844"></a>00844     <span class="comment">//  - page headers and footers</span>
<a name="l00845"></a>00845     <span class="comment">//  - numbered equations</span>
<a name="l00846"></a>00846     <span class="comment">//  - line drawing regions</span>
<a name="l00847"></a>00847     <span class="comment">// TODO(faisal): detect and fix above-mentioned cases</span>
<a name="l00848"></a>00848     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a298f9f253a3fd3109133e6ea40842bc0">HasWideOrNoInterWordGap</a>(part) ||
<a name="l00849"></a>00849         <a class="code" href="classtesseract_1_1_table_finder.html#a6436ad4194a19a38669a89b603c27801">HasLeaderAdjacent</a>(*part)) {
<a name="l00850"></a>00850       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abc55e0535959583318b4ce0271c85da2">set_table_type</a>();
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852   }
<a name="l00853"></a>00853 }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855 <span class="comment">// Check if the partition has at least one large gap between words or no</span>
<a name="l00856"></a>00856 <span class="comment">// significant gap at all</span>
<a name="l00857"></a><a class="code" href="classtesseract_1_1_table_finder.html#a298f9f253a3fd3109133e6ea40842bc0">00857</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a298f9f253a3fd3109133e6ea40842bc0">TableFinder::HasWideOrNoInterWordGap</a>(<a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part)<span class="keyword"> const </span>{
<a name="l00858"></a>00858   <span class="comment">// Should only get text partitions.</span>
<a name="l00859"></a>00859   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>());
<a name="l00860"></a>00860   <span class="comment">// Blob access</span>
<a name="l00861"></a>00861   BLOBNBOX_CLIST* part_boxes = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3fc2dd797ede7a62546b2565811e9ce0">boxes</a>();
<a name="l00862"></a>00862   BLOBNBOX_C_IT it(part_boxes);
<a name="l00863"></a>00863   <span class="comment">// Check if this is a relatively small partition (such as a single word)</span>
<a name="l00864"></a>00864   <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>() &lt;
<a name="l00865"></a>00865       <a class="code" href="namespacetesseract.html#a3fe030812946d2ca16b873bde30d5431">kMinBoxesInTextPartition</a> * part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>() &amp;&amp;
<a name="l00866"></a>00866       part_boxes-&gt;length() &lt; <a class="code" href="namespacetesseract.html#a3fe030812946d2ca16b873bde30d5431">kMinBoxesInTextPartition</a>)
<a name="l00867"></a>00867     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869   <span class="comment">// Variables used to compute inter-blob spacing.</span>
<a name="l00870"></a>00870   <span class="keywordtype">int</span> current_x0 = -1;
<a name="l00871"></a>00871   <span class="keywordtype">int</span> current_x1 = -1;
<a name="l00872"></a>00872   <span class="keywordtype">int</span> previous_x1 = -1;
<a name="l00873"></a>00873   <span class="comment">// Stores the maximum gap detected.</span>
<a name="l00874"></a>00874   <span class="keywordtype">int</span> largest_partition_gap_found = -1;
<a name="l00875"></a>00875   <span class="comment">// Text partition gap limits. If this is text (and not a table),</span>
<a name="l00876"></a>00876   <span class="comment">// there should be at least one gap larger than min_gap and no gap</span>
<a name="l00877"></a>00877   <span class="comment">// larger than max_gap.</span>
<a name="l00878"></a>00878   <span class="keyword">const</span> <span class="keywordtype">double</span> max_gap = <a class="code" href="namespacetesseract.html#a632cb2dd79696389be8feb970de28e3e">kMaxGapInTextPartition</a> * part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>();
<a name="l00879"></a>00879   <span class="keyword">const</span> <span class="keywordtype">double</span> min_gap = <a class="code" href="namespacetesseract.html#a25dab2777976176c8de47ef2fb5b74a5">kMinMaxGapInTextPartition</a> * part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>();
<a name="l00880"></a>00880 
<a name="l00881"></a>00881   <span class="keywordflow">for</span> (it.mark_cycle_pt(); !it.cycled_list(); it.forward()) {
<a name="l00882"></a>00882     <a class="code" href="class_b_l_o_b_n_b_o_x.html">BLOBNBOX</a>* blob = it.data();
<a name="l00883"></a>00883     current_x0 = blob-&gt;<a class="code" href="class_b_l_o_b_n_b_o_x.html#a7b97b8bc16b1473a28f9c44011522f4e">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l00884"></a>00884     current_x1 = blob-&gt;<a class="code" href="class_b_l_o_b_n_b_o_x.html#a7b97b8bc16b1473a28f9c44011522f4e">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l00885"></a>00885     <span class="keywordflow">if</span> (previous_x1 != -1) {
<a name="l00886"></a>00886       <span class="keywordtype">int</span> gap = current_x0 - previous_x1;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888       <span class="comment">// TODO(nbeato): Boxes may overlap? Huh?</span>
<a name="l00889"></a>00889       <span class="comment">// For example, mag.3B 8003_033.3B.tif in UNLV data. The titles/authors</span>
<a name="l00890"></a>00890       <span class="comment">// on the top right of the page are filtered out with this line.</span>
<a name="l00891"></a>00891       <span class="comment">// Note 2: Iterating over blobs in a partition, so we are looking for</span>
<a name="l00892"></a>00892       <span class="comment">// spacing between the words.</span>
<a name="l00893"></a>00893       <span class="keywordflow">if</span> (gap &lt; 0) {
<a name="l00894"></a>00894         <span class="comment">// More likely case, the blobs slightly overlap. This can happen</span>
<a name="l00895"></a>00895         <span class="comment">// with diacritics (accents) or broken alphabet symbols (characters).</span>
<a name="l00896"></a>00896         <span class="comment">// Merge boxes together by taking max of right sides.</span>
<a name="l00897"></a>00897         <span class="keywordflow">if</span> (-gap &lt; part-&gt;median_size() * <a class="code" href="namespacetesseract.html#af7577bf68e7e1466e0d58eb91ad999c6">kMaxBlobOverlapFactor</a>) {
<a name="l00898"></a>00898           previous_x1 = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(previous_x1, current_x1);
<a name="l00899"></a>00899           <span class="keywordflow">continue</span>;
<a name="l00900"></a>00900         }
<a name="l00901"></a>00901         <span class="comment">// Extreme case, blobs overlap significantly in the same partition...</span>
<a name="l00902"></a>00902         <span class="comment">// This should not happen often (if at all), but it does.</span>
<a name="l00903"></a>00903         <span class="comment">// TODO(nbeato): investigate cases when this happens.</span>
<a name="l00904"></a>00904         <span class="keywordflow">else</span> {
<a name="l00905"></a>00905           <span class="comment">// The behavior before was to completely ignore this case.</span>
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907       }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909       <span class="comment">// If a large enough gap is found, mark it as a table cell (return true)</span>
<a name="l00910"></a>00910       <span class="keywordflow">if</span> (gap &gt; max_gap)
<a name="l00911"></a>00911         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00912"></a>00912       <span class="keywordflow">if</span> (gap &gt; largest_partition_gap_found)
<a name="l00913"></a>00913         largest_partition_gap_found = gap;
<a name="l00914"></a>00914     }
<a name="l00915"></a>00915     previous_x1 = current_x1;
<a name="l00916"></a>00916   }
<a name="l00917"></a>00917   <span class="comment">// Since no large gap was found, return false if the partition is too</span>
<a name="l00918"></a>00918   <span class="comment">// long to be a data cell</span>
<a name="l00919"></a>00919   <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>() &gt;
<a name="l00920"></a>00920       <a class="code" href="namespacetesseract.html#ac2d16b5be5214a804964b939c8111bc7">kMaxBoxesInDataPartition</a> * part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>() ||
<a name="l00921"></a>00921       part_boxes-&gt;length() &gt; <a class="code" href="namespacetesseract.html#ac2d16b5be5214a804964b939c8111bc7">kMaxBoxesInDataPartition</a>)
<a name="l00922"></a>00922     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924   <span class="comment">// A partition may be a single blob. In this case, it&#39;s an isolated symbol</span>
<a name="l00925"></a>00925   <span class="comment">// or non-text (such as a ruling or image).</span>
<a name="l00926"></a>00926   <span class="comment">// Detect these as table partitions? Shouldn&#39;t this be case by case?</span>
<a name="l00927"></a>00927   <span class="comment">// The behavior before was to ignore this, making max_partition_gap &lt; 0</span>
<a name="l00928"></a>00928   <span class="comment">// and implicitly return true. Just making it explicit.</span>
<a name="l00929"></a>00929   <span class="keywordflow">if</span> (largest_partition_gap_found == -1)
<a name="l00930"></a>00930     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00931"></a>00931 
<a name="l00932"></a>00932   <span class="comment">// return true if the maximum gap found is smaller than the minimum allowed</span>
<a name="l00933"></a>00933   <span class="comment">// max_gap in a text partition. This indicates that there is no signficant</span>
<a name="l00934"></a>00934   <span class="comment">// space in the partition, hence it is likely a single word.</span>
<a name="l00935"></a>00935   <span class="keywordflow">return</span> largest_partition_gap_found &lt; min_gap;
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">// A criteria for possible tables is that a table may have leaders</span>
<a name="l00939"></a>00939 <span class="comment">// between data cells. An aggressive solution to find such tables is to</span>
<a name="l00940"></a>00940 <span class="comment">// explicitly mark partitions that have adjacent leaders.</span>
<a name="l00941"></a>00941 <span class="comment">// Note that this includes overlapping leaders. However, it does not</span>
<a name="l00942"></a>00942 <span class="comment">// include leaders in different columns on the page.</span>
<a name="l00943"></a>00943 <span class="comment">// Possible false-positive will include lists, such as a table of contents.</span>
<a name="l00944"></a>00944 <span class="comment">// As these arise, the agressive nature of this search may need to be</span>
<a name="l00945"></a>00945 <span class="comment">// trimmed down.</span>
<a name="l00946"></a><a class="code" href="classtesseract_1_1_table_finder.html#a6436ad4194a19a38669a89b603c27801">00946</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a6436ad4194a19a38669a89b603c27801">TableFinder::HasLeaderAdjacent</a>(<span class="keyword">const</span> <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>&amp; part) {
<a name="l00947"></a>00947   <span class="keywordflow">if</span> (part.<a class="code" href="classtesseract_1_1_col_partition.html#a811bd892dfa5eeba0b17b77794d79754">flow</a>() == <a class="code" href="blobbox_8h.html#aa72f1499398e9694bf46752e1cc895e1a64e3e70c4fac4d4e3facdb4638307d7f">BTFT_LEADER</a>)
<a name="l00948"></a>00948     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00949"></a>00949   <span class="comment">// Search range is left and right bounded by an offset of the</span>
<a name="l00950"></a>00950   <span class="comment">// median xheight. This offset is to allow some tolerance to the</span>
<a name="l00951"></a>00951   <span class="comment">// the leaders on the page in the event that the alignment is still</span>
<a name="l00952"></a>00952   <span class="comment">// a bit off.</span>
<a name="l00953"></a>00953   <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = part.<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l00954"></a>00954   <span class="keyword">const</span> <span class="keywordtype">int</span> search_size = <a class="code" href="namespacetesseract.html#a7c23a9af9374381d1a961227ce653ea6">kAdjacentLeaderSearchPadding</a> * <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a>;
<a name="l00955"></a>00955   <span class="keyword">const</span> <span class="keywordtype">int</span> top = box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() + search_size;
<a name="l00956"></a>00956   <span class="keyword">const</span> <span class="keywordtype">int</span> bottom = box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() - search_size;
<a name="l00957"></a>00957   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> hsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>);
<a name="l00958"></a>00958   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="vecfuncs_8cpp.html#a57d4a186a22b01e2110793bc22a5d8f0">direction</a> = 0; <a class="code" href="vecfuncs_8cpp.html#a57d4a186a22b01e2110793bc22a5d8f0">direction</a> &lt; 2; ++<a class="code" href="vecfuncs_8cpp.html#a57d4a186a22b01e2110793bc22a5d8f0">direction</a>) {
<a name="l00959"></a>00959     <span class="keywordtype">bool</span> right_to_left = (<a class="code" href="vecfuncs_8cpp.html#a57d4a186a22b01e2110793bc22a5d8f0">direction</a> == 0);
<a name="l00960"></a>00960     <span class="keywordtype">int</span> x = right_to_left ? box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>() : box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l00961"></a>00961     hsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab4eb5b4d43442c26b598b45672713fab">StartSideSearch</a>(x, bottom, top);
<a name="l00962"></a>00962     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* leader = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00963"></a>00963     <span class="keywordflow">while</span> ((leader = hsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a7515ca407e452687f762349f1c3113ff">NextSideSearch</a>(right_to_left)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00964"></a>00964       <span class="comment">// This should not happen, they are in different grids.</span>
<a name="l00965"></a>00965       <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(&amp;part != leader);
<a name="l00966"></a>00966       <span class="comment">// The leader could be a horizontal ruling in the grid.</span>
<a name="l00967"></a>00967       <span class="comment">// Make sure it is actually a leader.</span>
<a name="l00968"></a>00968       <span class="keywordflow">if</span> (leader-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a811bd892dfa5eeba0b17b77794d79754">flow</a>() != <a class="code" href="blobbox_8h.html#aa72f1499398e9694bf46752e1cc895e1a64e3e70c4fac4d4e3facdb4638307d7f">BTFT_LEADER</a>)
<a name="l00969"></a>00969         <span class="keywordflow">continue</span>;
<a name="l00970"></a>00970       <span class="comment">// Make sure the leader shares a page column with the partition,</span>
<a name="l00971"></a>00971       <span class="comment">// otherwise we are spreading across columns.</span>
<a name="l00972"></a>00972       <span class="keywordflow">if</span> (!part.<a class="code" href="classtesseract_1_1_col_partition.html#aa05fd8e272964b349436a729acf3fc64">IsInSameColumnAs</a>(*leader))
<a name="l00973"></a>00973         <span class="keywordflow">break</span>;
<a name="l00974"></a>00974       <span class="comment">// There should be a significant vertical overlap</span>
<a name="l00975"></a>00975       <span class="keywordflow">if</span> (!leader-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aa1eda3b89ee0c745279bbb8911db00b6">VSignificantCoreOverlap</a>(part))
<a name="l00976"></a>00976         <span class="keywordflow">continue</span>;
<a name="l00977"></a>00977       <span class="comment">// Leader passed all tests, so it is adjacent.</span>
<a name="l00978"></a>00978       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00979"></a>00979     }
<a name="l00980"></a>00980   }
<a name="l00981"></a>00981   <span class="comment">// No leaders are adjacent to the given partition.</span>
<a name="l00982"></a>00982   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 <span class="comment">// Filter individual text partitions marked as table partitions</span>
<a name="l00986"></a>00986 <span class="comment">// consisting of paragraph endings, small section headings, and</span>
<a name="l00987"></a>00987 <span class="comment">// headers and footers.</span>
<a name="l00988"></a><a class="code" href="classtesseract_1_1_table_finder.html#a34734ff8fb23f8bfb88dc60e06cb2c17">00988</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a34734ff8fb23f8bfb88dc60e06cb2c17">TableFinder::FilterFalseAlarms</a>() {
<a name="l00989"></a>00989   <a class="code" href="classtesseract_1_1_table_finder.html#a5c5163764f1df032be42c7cf953c2ade">FilterParagraphEndings</a>();
<a name="l00990"></a>00990   <a class="code" href="classtesseract_1_1_table_finder.html#a28ab83ed3531ee5fd7c5608c2ec22de4">FilterHeaderAndFooter</a>();
<a name="l00991"></a>00991   <span class="comment">// TODO(nbeato): Fully justified text as non-table?</span>
<a name="l00992"></a>00992 }
<a name="l00993"></a>00993 
<a name="l00994"></a><a class="code" href="classtesseract_1_1_table_finder.html#a5c5163764f1df032be42c7cf953c2ade">00994</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a5c5163764f1df032be42c7cf953c2ade">TableFinder::FilterParagraphEndings</a>() {
<a name="l00995"></a>00995   <span class="comment">// Detect last line of paragraph</span>
<a name="l00996"></a>00996   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l00997"></a>00997   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l00998"></a>00998   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l00999"></a>00999   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01000"></a>01000   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01001"></a>01001     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l01002"></a>01002       <span class="keywordflow">continue</span>;  <span class="comment">// Consider only table partitions</span>
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="comment">// Paragraph ending should have flowing text above it.</span>
<a name="l01005"></a>01005     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* upper_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4df588400a880c9ac54eea8d1d7c28fb">nearest_neighbor_above</a>();
<a name="l01006"></a>01006     <span class="keywordflow">if</span> (!upper_part)
<a name="l01007"></a>01007       <span class="keywordflow">continue</span>;
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60aaa63d8d8a99ddc2b3957f8e8787b4eca">PT_FLOWING_TEXT</a>)
<a name="l01009"></a>01009       <span class="keywordflow">continue</span>;
<a name="l01010"></a>01010     <span class="keywordflow">if</span> (upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>() &lt;
<a name="l01011"></a>01011         2 * part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>())
<a name="l01012"></a>01012       <span class="keywordflow">continue</span>;
<a name="l01013"></a>01013     <span class="comment">// Check if its the last line of a paragraph.</span>
<a name="l01014"></a>01014     <span class="comment">// In most cases, a paragraph ending should be left-aligned to text line</span>
<a name="l01015"></a>01015     <span class="comment">// above it. Sometimes, it could be a 2 line paragraph, in which case</span>
<a name="l01016"></a>01016     <span class="comment">// the line above it is indented.</span>
<a name="l01017"></a>01017     <span class="comment">// To account for that, check if the partition center is to</span>
<a name="l01018"></a>01018     <span class="comment">// the left of the one above it.</span>
<a name="l01019"></a>01019     <span class="keywordtype">int</span> mid = (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() + part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>()) / 2;
<a name="l01020"></a>01020     <span class="keywordtype">int</span> upper_mid = (upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() +
<a name="l01021"></a>01021                      upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>()) / 2;
<a name="l01022"></a>01022     <span class="keywordtype">int</span> current_spacing = 0;  <span class="comment">// spacing of the current line to margin</span>
<a name="l01023"></a>01023     <span class="keywordtype">int</span> upper_spacing = 0;    <span class="comment">// spacing of the previous line to the margin</span>
<a name="l01024"></a>01024     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a528595d792a34a2a361670aced196165">left_to_right_language_</a>) {
<a name="l01025"></a>01025       <span class="comment">// Left to right languages, use mid - left to figure out the distance</span>
<a name="l01026"></a>01026       <span class="comment">// the middle is from the left margin.</span>
<a name="l01027"></a>01027       <span class="keywordtype">int</span> left = <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(),
<a name="l01028"></a>01028                      upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>());
<a name="l01029"></a>01029       current_spacing = mid - left;
<a name="l01030"></a>01030       upper_spacing = upper_mid - left;
<a name="l01031"></a>01031     } <span class="keywordflow">else</span> {
<a name="l01032"></a>01032       <span class="comment">// Right to left languages, use right - mid to figure out the distance</span>
<a name="l01033"></a>01033       <span class="comment">// the middle is from the right margin.</span>
<a name="l01034"></a>01034       <span class="keywordtype">int</span> right = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(),
<a name="l01035"></a>01035                       upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>());
<a name="l01036"></a>01036       current_spacing = right - mid;
<a name="l01037"></a>01037       upper_spacing = right - upper_mid;
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039     <span class="keywordflow">if</span> (current_spacing * <a class="code" href="namespacetesseract.html#ac6a1849ed370a22bb4a2b4a94ca1634c">kParagraphEndingPreviousLineRatio</a> &gt; upper_spacing)
<a name="l01040"></a>01040       <span class="keywordflow">continue</span>;
<a name="l01041"></a>01041 
<a name="l01042"></a>01042     <span class="comment">// Paragraphs should have similar fonts.</span>
<a name="l01043"></a>01043     <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a5da7ad2aed53f88b06f60f044796d426">MatchingSizes</a>(*upper_part) ||
<a name="l01044"></a>01044         !part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a254db121f880ac20406f454045dc9780">MatchingStrokeWidth</a>(*upper_part, <a class="code" href="namespacetesseract.html#a477fb9ba9844da49a285692762b117d9">kStrokeWidthFractionalTolerance</a>,
<a name="l01045"></a>01045                                    <a class="code" href="namespacetesseract.html#a7dc74940f73222c81918e8701c301516">kStrokeWidthConstantTolerance</a>)) {
<a name="l01046"></a>01046       <span class="keywordflow">continue</span>;
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049     <span class="comment">// The last line of a paragraph should be left aligned.</span>
<a name="l01050"></a>01050     <span class="comment">// TODO(nbeato): This would be untrue if the text was right aligned.</span>
<a name="l01051"></a>01051     <span class="comment">// How often is that?</span>
<a name="l01052"></a>01052     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4c55a12d96d51a9710edc292c1946ca1">space_to_left</a>() &gt;
<a name="l01053"></a>01053         <a class="code" href="namespacetesseract.html#a1b76b5479d00c222f8a17e22d317b770">kMaxParagraphEndingLeftSpaceMultiple</a> * part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>())
<a name="l01054"></a>01054       <span class="keywordflow">continue</span>;
<a name="l01055"></a>01055     <span class="comment">// The line above it should be right aligned (assuming justified format).</span>
<a name="l01056"></a>01056     <span class="comment">// Since we can&#39;t assume justified text, we compare whitespace to text.</span>
<a name="l01057"></a>01057     <span class="comment">// The above line should have majority spanning text (or the current</span>
<a name="l01058"></a>01058     <span class="comment">// line could have fit on the previous line). So compare</span>
<a name="l01059"></a>01059     <span class="comment">// whitespace to text.</span>
<a name="l01060"></a>01060     <span class="keywordflow">if</span> (upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>() &lt;
<a name="l01061"></a>01061         <a class="code" href="namespacetesseract.html#a59fff4582ea32f8a8661fbc20a3ab947">kMinParagraphEndingTextToWhitespaceRatio</a> * upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2e061b11b010ed6ee0382300f423735c">space_to_right</a>())
<a name="l01062"></a>01062       <span class="keywordflow">continue</span>;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="comment">// Ledding above the line should be less than ledding below</span>
<a name="l01065"></a>01065     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0ec12f1a3ec7b885749c16a798b3c794">space_above</a>() &gt;= part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a46abe5ef4b5224d671c50d1de5ac985b">space_below</a>() ||
<a name="l01066"></a>01066         part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0ec12f1a3ec7b885749c16a798b3c794">space_above</a>() &gt; 2 * <a class="code" href="classtesseract_1_1_table_finder.html#a1d5828695e17f10f2d4140476c9f34fd">global_median_ledding_</a>)
<a name="l01067"></a>01067       <span class="keywordflow">continue</span>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     <span class="comment">// If all checks failed, it is probably text.</span>
<a name="l01070"></a>01070     part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a548b8797ceca6d820370cabe0711c808">clear_table_type</a>();
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072 }
<a name="l01073"></a>01073 
<a name="l01074"></a><a class="code" href="classtesseract_1_1_table_finder.html#a28ab83ed3531ee5fd7c5608c2ec22de4">01074</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a28ab83ed3531ee5fd7c5608c2ec22de4">TableFinder::FilterHeaderAndFooter</a>() {
<a name="l01075"></a>01075   <span class="comment">// Consider top-most text colpartition as header and bottom most as footer</span>
<a name="l01076"></a>01076   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* header = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01077"></a>01077   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* footer = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01078"></a>01078   <span class="keywordtype">int</span> max_top = <a class="code" href="host_8h.html#ae6f88d5bb15e97510f484289f2fc89fd">MIN_INT32</a>;
<a name="l01079"></a>01079   <span class="keywordtype">int</span> min_bottom = <a class="code" href="host_8h.html#aac62d87844689a18b6f5339a89ed6e7f">MAX_INT32</a>;
<a name="l01080"></a>01080   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01081"></a>01081   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01082"></a>01082   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01083"></a>01083   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>())
<a name="l01085"></a>01085       <span class="keywordflow">continue</span>;  <span class="comment">// Consider only text partitions</span>
<a name="l01086"></a>01086     <span class="keywordtype">int</span> top = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01087"></a>01087     <span class="keywordtype">int</span> bottom = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01088"></a>01088     <span class="keywordflow">if</span> (top &gt; max_top) {
<a name="l01089"></a>01089       max_top = top;
<a name="l01090"></a>01090       header = part;
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092     <span class="keywordflow">if</span> (bottom &lt; min_bottom) {
<a name="l01093"></a>01093       min_bottom = bottom;
<a name="l01094"></a>01094       footer = part;
<a name="l01095"></a>01095     }
<a name="l01096"></a>01096   }
<a name="l01097"></a>01097   <span class="keywordflow">if</span> (header)
<a name="l01098"></a>01098     header-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a548b8797ceca6d820370cabe0711c808">clear_table_type</a>();
<a name="l01099"></a>01099   <span class="keywordflow">if</span> (footer)
<a name="l01100"></a>01100     footer-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a548b8797ceca6d820370cabe0711c808">clear_table_type</a>();
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">// Mark all ColPartitions as table cells that have a table cell above</span>
<a name="l01104"></a>01104 <span class="comment">// and below them</span>
<a name="l01105"></a>01105 <span class="comment">// TODO(faisal): This is too aggressive at the moment. The method needs to</span>
<a name="l01106"></a>01106 <span class="comment">// consider spacing and alignment as well. Detection of false alarm table cells</span>
<a name="l01107"></a>01107 <span class="comment">// should also be done as part of it.</span>
<a name="l01108"></a><a class="code" href="classtesseract_1_1_table_finder.html#ae3d5e2e4c894d4514717d0593792226d">01108</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ae3d5e2e4c894d4514717d0593792226d">TableFinder::SmoothTablePartitionRuns</a>() {
<a name="l01109"></a>01109   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l01110"></a>01110   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01111"></a>01111   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01112"></a>01112   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01113"></a>01113   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01114"></a>01114     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() &gt;= <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a> || part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60ac0b3cd1b4592e1a3c609ff4273fb505b">PT_UNKNOWN</a>)
<a name="l01115"></a>01115       <span class="keywordflow">continue</span>;  <span class="comment">// Consider only text partitions</span>
<a name="l01116"></a>01116     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* upper_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4df588400a880c9ac54eea8d1d7c28fb">nearest_neighbor_above</a>();
<a name="l01117"></a>01117     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* lower_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4eac60eb833ebb548ff2409c5999753f">nearest_neighbor_below</a>();
<a name="l01118"></a>01118     <span class="keywordflow">if</span> (!upper_part || !lower_part)
<a name="l01119"></a>01119       <span class="keywordflow">continue</span>;
<a name="l01120"></a>01120     <span class="keywordflow">if</span> (upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a> &amp;&amp; lower_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l01121"></a>01121       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abc55e0535959583318b4ce0271c85da2">set_table_type</a>();
<a name="l01122"></a>01122   }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124   <span class="comment">// Pass 2, do the opposite. If both the upper and lower neighbors</span>
<a name="l01125"></a>01125   <span class="comment">// exist and are not tables, this probably shouldn&#39;t be a table.</span>
<a name="l01126"></a>01126   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01127"></a>01127   part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01128"></a>01128   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l01130"></a>01130       <span class="keywordflow">continue</span>;  <span class="comment">// Consider only text partitions</span>
<a name="l01131"></a>01131     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* upper_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4df588400a880c9ac54eea8d1d7c28fb">nearest_neighbor_above</a>();
<a name="l01132"></a>01132     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* lower_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4eac60eb833ebb548ff2409c5999753f">nearest_neighbor_below</a>();
<a name="l01133"></a>01133 
<a name="l01134"></a>01134     <span class="comment">// table can&#39;t be by itself</span>
<a name="l01135"></a>01135     <span class="keywordflow">if</span> ((upper_part &amp;&amp; upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>) &amp;&amp;
<a name="l01136"></a>01136         (lower_part &amp;&amp; lower_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)) {
<a name="l01137"></a>01137       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a548b8797ceca6d820370cabe0711c808">clear_table_type</a>();
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139   }
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 <span class="comment">// Set the type of a column segment based on the ratio of table to text cells</span>
<a name="l01143"></a><a class="code" href="classtesseract_1_1_table_finder.html#ac3e8a6d03fcaf027677919f284af6500">01143</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ac3e8a6d03fcaf027677919f284af6500">TableFinder::SetColumnsType</a>(ColSegment_LIST* column_blocks) {
<a name="l01144"></a>01144   ColSegment_IT it(column_blocks);
<a name="l01145"></a>01145   <span class="keywordflow">for</span> (it.mark_cycle_pt(); !it.cycled_list(); it.forward()) {
<a name="l01146"></a>01146     <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg = it.data();
<a name="l01147"></a>01147     <a class="code" href="class_t_b_o_x.html">TBOX</a> box = seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01148"></a>01148     <span class="keywordtype">int</span> num_table_cells = 0;
<a name="l01149"></a>01149     <span class="keywordtype">int</span> num_text_cells = 0;
<a name="l01150"></a>01150     <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01151"></a>01151         rsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01152"></a>01152     rsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a3c44b7c8272584600153d8249a841e73">SetUniqueMode</a>(<span class="keyword">true</span>);
<a name="l01153"></a>01153     rsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(box);
<a name="l01154"></a>01154     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01155"></a>01155     <span class="keywordflow">while</span> ((part = rsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01156"></a>01156       <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>) {
<a name="l01157"></a>01157         num_table_cells++;
<a name="l01158"></a>01158       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60aaa63d8d8a99ddc2b3957f8e8787b4eca">PT_FLOWING_TEXT</a>) {
<a name="l01159"></a>01159         num_text_cells++;
<a name="l01160"></a>01160       }
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162     <span class="comment">// If a column block has no text or table partition in it, it is not needed</span>
<a name="l01163"></a>01163     <span class="comment">// for table detection.</span>
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (!num_table_cells &amp;&amp; !num_text_cells) {
<a name="l01165"></a>01165       <span class="keyword">delete</span> it.extract();
<a name="l01166"></a>01166     } <span class="keywordflow">else</span> {
<a name="l01167"></a>01167       seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a54b273e51bc8df1c995c403fb05f6723">set_num_table_cells</a>(num_table_cells);
<a name="l01168"></a>01168       seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a570528471500732df47c1c4027f3e0ed">set_num_text_cells</a>(num_text_cells);
<a name="l01169"></a>01169       <span class="comment">// set column type based on the ratio of table to text cells</span>
<a name="l01170"></a>01170       seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a789e1edd90789444e3b420291969b196">set_type</a>();
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172   }
<a name="l01173"></a>01173 }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 <span class="comment">// Move column blocks to grid</span>
<a name="l01176"></a><a class="code" href="classtesseract_1_1_table_finder.html#a81003bea37eced8d746035bd565b9c56">01176</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a81003bea37eced8d746035bd565b9c56">TableFinder::MoveColSegmentsToGrid</a>(ColSegment_LIST *segments,
<a name="l01177"></a>01177                                          <a class="code" href="classtesseract_1_1_b_b_grid.html">ColSegmentGrid</a> *col_seg_grid) {
<a name="l01178"></a>01178   ColSegment_IT it(segments);
<a name="l01179"></a>01179   <span class="keywordflow">for</span> (it.mark_cycle_pt(); !it.cycled_list(); it.forward()) {
<a name="l01180"></a>01180     <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg = it.extract();
<a name="l01181"></a>01181     col_seg_grid-&gt;<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, seg);
<a name="l01182"></a>01182   }
<a name="l01183"></a>01183 }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185 <span class="comment">// Merge column blocks if a split is detected due to the presence of a</span>
<a name="l01186"></a>01186 <span class="comment">// table. A text block is considered split if it has multiple</span>
<a name="l01187"></a>01187 <span class="comment">// neighboring blocks above/below it, and at least one of the</span>
<a name="l01188"></a>01188 <span class="comment">// neighboring blocks is of table type (has a high density of table</span>
<a name="l01189"></a>01189 <span class="comment">// partitions). In this case neighboring blocks in the direction</span>
<a name="l01190"></a>01190 <span class="comment">// (above/below) of the table block are merged with the text block.</span>
<a name="l01191"></a>01191 
<a name="l01192"></a>01192 <span class="comment">// Comment: This method does not handle split due to a full page table</span>
<a name="l01193"></a>01193 <span class="comment">// since table columns in this case do not have a text column on which</span>
<a name="l01194"></a>01194 <span class="comment">// split decision can be based.</span>
<a name="l01195"></a><a class="code" href="classtesseract_1_1_table_finder.html#a7a3319f9a1eab06ef83a6e3f2df7e8d2">01195</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a7a3319f9a1eab06ef83a6e3f2df7e8d2">TableFinder::GridMergeColumnBlocks</a>() {
<a name="l01196"></a>01196   <span class="keywordtype">int</span> margin = <a class="code" href="classtesseract_1_1_table_finder.html#aecbfe718794e99b2f15a43a7f7350848">gridsize</a>();
<a name="l01197"></a>01197 
<a name="l01198"></a>01198   <span class="comment">// Iterate the Column Blocks in the grid.</span>
<a name="l01199"></a>01199   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01200"></a>01200     gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>);
<a name="l01201"></a>01201   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01202"></a>01202   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg;
<a name="l01203"></a>01203   <span class="keywordflow">while</span> ((seg = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01204"></a>01204     <span class="keywordflow">if</span> (seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#ad10da5c5a6144425167a0c438c0bd421">type</a>() != <a class="code" href="namespacetesseract.html#a25254b3df45454565d58a62480d3a6cba05d5fe5bf814b3e82827a3a321d5b2ec">COL_TEXT</a>)
<a name="l01205"></a>01205       <span class="keywordflow">continue</span>;  <span class="comment">// only consider text blocks for split detection</span>
<a name="l01206"></a>01206     <span class="keywordtype">bool</span> neighbor_found = <span class="keyword">false</span>;
<a name="l01207"></a>01207     <span class="keywordtype">bool</span> modified = <span class="keyword">false</span>;  <span class="comment">// Modified at least once</span>
<a name="l01208"></a>01208     <span class="comment">// keep expanding current box as long as neighboring table columns</span>
<a name="l01209"></a>01209     <span class="comment">// are found above or below it.</span>
<a name="l01210"></a>01210     <span class="keywordflow">do</span> {
<a name="l01211"></a>01211       <a class="code" href="class_t_b_o_x.html">TBOX</a> box = seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01212"></a>01212       <span class="comment">// slightly expand the search region vertically</span>
<a name="l01213"></a>01213       <span class="keywordtype">int</span> top_range = <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() + margin, <a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">tright</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>());
<a name="l01214"></a>01214       <span class="keywordtype">int</span> bottom_range = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() - margin, <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>());
<a name="l01215"></a>01215       box.<a class="code" href="class_t_b_o_x.html#a7f40dfd290a907200bdc98c196f63f45">set_top</a>(top_range);
<a name="l01216"></a>01216       box.<a class="code" href="class_t_b_o_x.html#a6f803b24b046883cb0f3882dc3d92302">set_bottom</a>(bottom_range);
<a name="l01217"></a>01217       neighbor_found = <span class="keyword">false</span>;
<a name="l01218"></a>01218       <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01219"></a>01219           rectsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>);
<a name="l01220"></a>01220       rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(box);
<a name="l01221"></a>01221       <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01222"></a>01222       <span class="keywordflow">while</span> ((neighbor = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01223"></a>01223         <span class="keywordflow">if</span> (neighbor == seg)
<a name="l01224"></a>01224           <span class="keywordflow">continue</span>;
<a name="l01225"></a>01225         <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; neighbor_box = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01226"></a>01226         <span class="comment">// If the neighbor box significantly overlaps with the current</span>
<a name="l01227"></a>01227         <span class="comment">// box (due to the expansion of the current box in the</span>
<a name="l01228"></a>01228         <span class="comment">// previous iteration of this loop), remove the neighbor box</span>
<a name="l01229"></a>01229         <span class="comment">// and expand the current box to include it.</span>
<a name="l01230"></a>01230         <span class="keywordflow">if</span> (neighbor_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(box) &gt;= 0.9) {
<a name="l01231"></a>01231           seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(neighbor_box);
<a name="l01232"></a>01232           modified = <span class="keyword">true</span>;
<a name="l01233"></a>01233           rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01234"></a>01234           gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae43afa517cd9b682f10ca1d54dad4ab0">RepositionIterator</a>();
<a name="l01235"></a>01235           <span class="keyword">delete</span> neighbor;
<a name="l01236"></a>01236           <span class="keywordflow">continue</span>;
<a name="l01237"></a>01237         }
<a name="l01238"></a>01238         <span class="comment">// Only expand if the neighbor box is of table type</span>
<a name="l01239"></a>01239         <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#ad10da5c5a6144425167a0c438c0bd421">type</a>() != <a class="code" href="namespacetesseract.html#a25254b3df45454565d58a62480d3a6cba8943a61e53229e72f0f896ec8e415316">COL_TABLE</a>)
<a name="l01240"></a>01240           <span class="keywordflow">continue</span>;
<a name="l01241"></a>01241         <span class="comment">// Insert the neighbor box into the current column block</span>
<a name="l01242"></a>01242         <span class="keywordflow">if</span> (neighbor_box.<a class="code" href="class_t_b_o_x.html#a9f7e4e20bdfeee0d82db2f8d24aa72dc">major_x_overlap</a>(box) &amp;&amp;
<a name="l01243"></a>01243             !box.<a class="code" href="class_t_b_o_x.html#a5d4e2c5f91b791e94d4c94e513180632">contains</a>(neighbor_box)) {
<a name="l01244"></a>01244           seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(neighbor_box);
<a name="l01245"></a>01245           neighbor_found = <span class="keyword">true</span>;
<a name="l01246"></a>01246           modified = <span class="keyword">true</span>;
<a name="l01247"></a>01247           rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01248"></a>01248           gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae43afa517cd9b682f10ca1d54dad4ab0">RepositionIterator</a>();
<a name="l01249"></a>01249           <span class="keyword">delete</span> neighbor;
<a name="l01250"></a>01250         }
<a name="l01251"></a>01251       }
<a name="l01252"></a>01252     } <span class="keywordflow">while</span> (neighbor_found);
<a name="l01253"></a>01253     <span class="keywordflow">if</span> (modified) {
<a name="l01254"></a>01254       <span class="comment">// Because the box has changed, it has to be removed first.</span>
<a name="l01255"></a>01255       gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01256"></a>01256       <a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, seg);
<a name="l01257"></a>01257       gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae43afa517cd9b682f10ca1d54dad4ab0">RepositionIterator</a>();
<a name="l01258"></a>01258     }
<a name="l01259"></a>01259   }
<a name="l01260"></a>01260 }
<a name="l01261"></a>01261 
<a name="l01262"></a>01262 <span class="comment">// Group horizontally overlapping table partitions into table columns.</span>
<a name="l01263"></a>01263 <span class="comment">// TODO(faisal): This is too aggressive at the moment. The method should</span>
<a name="l01264"></a>01264 <span class="comment">// consider more attributes to group table partitions together. Some common</span>
<a name="l01265"></a>01265 <span class="comment">// errors are:</span>
<a name="l01266"></a>01266 <span class="comment">//  1- page number is merged with a table column above it even</span>
<a name="l01267"></a>01267 <span class="comment">//      if there is a large vertical gap between them.</span>
<a name="l01268"></a>01268 <span class="comment">//  2- column headers go on to catch one of the columns arbitrarily</span>
<a name="l01269"></a>01269 <span class="comment">//  3- an isolated noise blob near page top or bottom merges with the table</span>
<a name="l01270"></a>01270 <span class="comment">//     column below/above it</span>
<a name="l01271"></a>01271 <span class="comment">//  4- cells from two vertically adjacent tables merge together to make a</span>
<a name="l01272"></a>01272 <span class="comment">//     single column resulting in merging of the two tables</span>
<a name="l01273"></a><a class="code" href="classtesseract_1_1_table_finder.html#a30f071829b47f7bd9afdd4ef819f582d">01273</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a30f071829b47f7bd9afdd4ef819f582d">TableFinder::GetTableColumns</a>(ColSegment_LIST *table_columns) {
<a name="l01274"></a>01274   ColSegment_IT it(table_columns);
<a name="l01275"></a>01275   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l01276"></a>01276   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01277"></a>01277     gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01278"></a>01278   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01279"></a>01279   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part;
<a name="l01280"></a>01280   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01281"></a>01281     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a40132dd64a9e916ca809b9494e1a5cdd">inside_table_column</a>() || part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l01282"></a>01282       <span class="keywordflow">continue</span>;  <span class="comment">// prevent a partition to be assigned to multiple columns</span>
<a name="l01283"></a>01283     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01284"></a>01284     <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* col = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>();
<a name="l01285"></a>01285     col-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(box);
<a name="l01286"></a>01286     part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a99763d5dc4eee42bb6142ffc2ddae1de">set_inside_table_column</a>(<span class="keyword">true</span>);
<a name="l01287"></a>01287     <span class="comment">// Start a search below the current cell to find bottom neighbours</span>
<a name="l01288"></a>01288     <span class="comment">// Note: a full search will always process things above it first, so</span>
<a name="l01289"></a>01289     <span class="comment">// this should be starting at the highest cell and working its way down.</span>
<a name="l01290"></a>01290     <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01291"></a>01291         vsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01292"></a>01292     vsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a071abe1128e59e6ccf1f98a8c6002744">StartVerticalSearch</a>(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l01293"></a>01293     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01294"></a>01294     <span class="keywordtype">bool</span> found_neighbours = <span class="keyword">false</span>;
<a name="l01295"></a>01295     <span class="keywordflow">while</span> ((neighbor = vsearch.<a class="code" href="classtesseract_1_1_grid_search.html#adfe2bf527306cdd264be5bdcdd5ac351">NextVerticalSearch</a>(<span class="keyword">true</span>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01296"></a>01296       <span class="comment">// only consider neighbors not assigned to any column yet</span>
<a name="l01297"></a>01297       <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a40132dd64a9e916ca809b9494e1a5cdd">inside_table_column</a>())
<a name="l01298"></a>01298         <span class="keywordflow">continue</span>;
<a name="l01299"></a>01299       <span class="comment">// Horizontal lines should not break the flow</span>
<a name="l01300"></a>01300       <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a052bafacd4995721da746930d2df0dd2">IsHorizontalLine</a>())
<a name="l01301"></a>01301         <span class="keywordflow">continue</span>;
<a name="l01302"></a>01302       <span class="comment">// presence of a non-table neighbor marks the end of current</span>
<a name="l01303"></a>01303       <span class="comment">// table column</span>
<a name="l01304"></a>01304       <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() != <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l01305"></a>01305         <span class="keywordflow">break</span>;
<a name="l01306"></a>01306       <span class="comment">// add the neighbor partition to the table column</span>
<a name="l01307"></a>01307       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; neighbor_box = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01308"></a>01308       col-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(neighbor_box);
<a name="l01309"></a>01309       neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a99763d5dc4eee42bb6142ffc2ddae1de">set_inside_table_column</a>(<span class="keyword">true</span>);
<a name="l01310"></a>01310       found_neighbours = <span class="keyword">true</span>;
<a name="l01311"></a>01311     }
<a name="l01312"></a>01312     <span class="keywordflow">if</span> (found_neighbours) {
<a name="l01313"></a>01313       it.add_after_then_move(col);
<a name="l01314"></a>01314     } <span class="keywordflow">else</span> {
<a name="l01315"></a>01315       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a99763d5dc4eee42bb6142ffc2ddae1de">set_inside_table_column</a>(<span class="keyword">false</span>);
<a name="l01316"></a>01316       <span class="keyword">delete</span> col;
<a name="l01317"></a>01317     }
<a name="l01318"></a>01318   }
<a name="l01319"></a>01319 }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 <span class="comment">// Mark regions in a column that are x-bounded by the column boundaries and</span>
<a name="l01322"></a>01322 <span class="comment">// y-bounded by the table columns&#39; projection on the y-axis as table regions</span>
<a name="l01323"></a><a class="code" href="classtesseract_1_1_table_finder.html#a581a66fbdfdd0da5c3679a31f8d7944e">01323</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a581a66fbdfdd0da5c3679a31f8d7944e">TableFinder::GetTableRegions</a>(ColSegment_LIST* table_columns,
<a name="l01324"></a>01324                                   ColSegment_LIST* table_regions) {
<a name="l01325"></a>01325   ColSegment_IT cit(table_columns);
<a name="l01326"></a>01326   ColSegment_IT rit(table_regions);
<a name="l01327"></a>01327   <span class="comment">// Iterate through column blocks</span>
<a name="l01328"></a>01328   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01329"></a>01329       gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#a94f0570afcc478097685ccdb59928903">col_seg_grid_</a>);
<a name="l01330"></a>01330   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01331"></a>01331   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* part;
<a name="l01332"></a>01332   <span class="keywordtype">int</span> page_height = <a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">tright</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>() - <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>();
<a name="l01333"></a>01333   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(page_height &gt; 0);
<a name="l01334"></a>01334   <span class="comment">// create a bool array to hold projection on y-axis</span>
<a name="l01335"></a>01335   <span class="keywordtype">bool</span>* table_region = <span class="keyword">new</span> <span class="keywordtype">bool</span>[page_height];
<a name="l01336"></a>01336   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01337"></a>01337     <a class="code" href="class_t_b_o_x.html">TBOX</a> part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01338"></a>01338     <span class="comment">// reset the projection array</span>
<a name="l01339"></a>01339     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; page_height; i++) {
<a name="l01340"></a>01340       table_region[i] = <span class="keyword">false</span>;
<a name="l01341"></a>01341     }
<a name="l01342"></a>01342     <span class="comment">// iterate through all table columns to find regions in the current</span>
<a name="l01343"></a>01343     <span class="comment">// page column block</span>
<a name="l01344"></a>01344     cit.move_to_first();
<a name="l01345"></a>01345     <span class="keywordflow">for</span> (cit.mark_cycle_pt(); !cit.cycled_list(); cit.forward()) {
<a name="l01346"></a>01346       <a class="code" href="class_t_b_o_x.html">TBOX</a> col_box = cit.data()-&gt;bounding_box();
<a name="l01347"></a>01347       <span class="comment">// find intersection region of table column and page column</span>
<a name="l01348"></a>01348       <a class="code" href="class_t_b_o_x.html">TBOX</a> intersection_box = col_box.<a class="code" href="class_t_b_o_x.html#a33e45c7389737cdf1a908bca0af315c4">intersection</a>(part_box);
<a name="l01349"></a>01349       <span class="comment">// project table column on the y-axis</span>
<a name="l01350"></a>01350       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = intersection_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(); i &lt; intersection_box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(); i++) {
<a name="l01351"></a>01351         table_region[i - <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().<a class="code" href="class_i_c_o_o_r_d.html#a66bba6ff8a5f060775e1c2ca511f7f29" title="access_function">y</a>()] = <span class="keyword">true</span>;
<a name="l01352"></a>01352       }
<a name="l01353"></a>01353     }
<a name="l01354"></a>01354     <span class="comment">// set x-limits of table regions to page column width</span>
<a name="l01355"></a>01355     <a class="code" href="class_t_b_o_x.html">TBOX</a> current_table_box;
<a name="l01356"></a>01356     current_table_box.<a class="code" href="class_t_b_o_x.html#ae6151cd794841e100d8a346a0c4a46e6">set_left</a>(part_box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>());
<a name="l01357"></a>01357     current_table_box.<a class="code" href="class_t_b_o_x.html#a2246293d3667b28c52a52353a2d5caea">set_right</a>(part_box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>());
<a name="l01358"></a>01358     <span class="comment">// go through the y-axis projection to find runs of table</span>
<a name="l01359"></a>01359     <span class="comment">// regions. Each run makes one table region.</span>
<a name="l01360"></a>01360     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; page_height; i++) {
<a name="l01361"></a>01361       <span class="comment">// detect start of a table region</span>
<a name="l01362"></a>01362       <span class="keywordflow">if</span> (!table_region[i - 1] &amp;&amp; table_region[i]) {
<a name="l01363"></a>01363         current_table_box.<a class="code" href="class_t_b_o_x.html#a6f803b24b046883cb0f3882dc3d92302">set_bottom</a>(i + <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().y());
<a name="l01364"></a>01364       }
<a name="l01365"></a>01365       <span class="comment">// TODO(nbeato): Is it guaranteed that the last row is not a table region?</span>
<a name="l01366"></a>01366       <span class="comment">// detect end of a table region</span>
<a name="l01367"></a>01367       <span class="keywordflow">if</span> (table_region[i - 1] &amp;&amp; !table_region[i]) {
<a name="l01368"></a>01368         current_table_box.<a class="code" href="class_t_b_o_x.html#a7f40dfd290a907200bdc98c196f63f45">set_top</a>(i + <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().y());
<a name="l01369"></a>01369         <span class="keywordflow">if</span> (!current_table_box.<a class="code" href="class_t_b_o_x.html#a7c6996aea1eb6be07b1d6634bf36cfd6">null_box</a>()) {
<a name="l01370"></a>01370           <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>();
<a name="l01371"></a>01371           seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(current_table_box);
<a name="l01372"></a>01372           rit.add_after_then_move(seg);
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374       }
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376   }
<a name="l01377"></a>01377   <span class="keyword">delete</span>[] table_region;
<a name="l01378"></a>01378 }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380 <span class="comment">// Merge table regions corresponding to tables spanning multiple columns if</span>
<a name="l01381"></a>01381 <span class="comment">// there is a colpartition (horizontal ruling line or normal text) that</span>
<a name="l01382"></a>01382 <span class="comment">// touches both regions.</span>
<a name="l01383"></a>01383 <span class="comment">// TODO(faisal): A rare error occurs if there are two horizontally adjacent</span>
<a name="l01384"></a>01384 <span class="comment">// tables with aligned ruling lines. In this case, line finder returns a</span>
<a name="l01385"></a>01385 <span class="comment">// single line and hence the tables get merged together</span>
<a name="l01386"></a><a class="code" href="classtesseract_1_1_table_finder.html#a9298cd74b3e81315195a547a890752e0">01386</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a9298cd74b3e81315195a547a890752e0">TableFinder::GridMergeTableRegions</a>() {
<a name="l01387"></a>01387   <span class="comment">// Iterate the table regions in the grid.</span>
<a name="l01388"></a>01388   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01389"></a>01389       gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l01390"></a>01390   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01391"></a>01391   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01392"></a>01392   <span class="keywordflow">while</span> ((seg = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01393"></a>01393     <span class="keywordtype">bool</span> neighbor_found = <span class="keyword">false</span>;
<a name="l01394"></a>01394     <span class="keywordtype">bool</span> modified = <span class="keyword">false</span>;  <span class="comment">// Modified at least once</span>
<a name="l01395"></a>01395     <span class="keywordflow">do</span> {
<a name="l01396"></a>01396       <span class="comment">// Start a rectangle search x-bounded by the image and y by the table</span>
<a name="l01397"></a>01397       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01398"></a>01398       <a class="code" href="class_t_b_o_x.html">TBOX</a> search_region(box);
<a name="l01399"></a>01399       search_region.<a class="code" href="class_t_b_o_x.html#ae6151cd794841e100d8a346a0c4a46e6">set_left</a>(<a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().x());
<a name="l01400"></a>01400       search_region.<a class="code" href="class_t_b_o_x.html#a2246293d3667b28c52a52353a2d5caea">set_right</a>(<a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">tright</a>().x());
<a name="l01401"></a>01401       neighbor_found = <span class="keyword">false</span>;
<a name="l01402"></a>01402       <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01403"></a>01403           rectsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l01404"></a>01404       rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(search_region);
<a name="l01405"></a>01405       <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01406"></a>01406       <span class="keywordflow">while</span> ((neighbor = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01407"></a>01407         <span class="keywordflow">if</span> (neighbor == seg)
<a name="l01408"></a>01408           <span class="keywordflow">continue</span>;
<a name="l01409"></a>01409         <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; neighbor_box = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01410"></a>01410         <span class="comment">// Check if a neighbor box has a large overlap with the table</span>
<a name="l01411"></a>01411         <span class="comment">// region.  This may happen as a result of merging two table</span>
<a name="l01412"></a>01412         <span class="comment">// regions in the previous iteration.</span>
<a name="l01413"></a>01413         <span class="keywordflow">if</span> (neighbor_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(box) &gt;= 0.9) {
<a name="l01414"></a>01414           seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(neighbor_box);
<a name="l01415"></a>01415           rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01416"></a>01416           gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae43afa517cd9b682f10ca1d54dad4ab0">RepositionIterator</a>();
<a name="l01417"></a>01417           <span class="keyword">delete</span> neighbor;
<a name="l01418"></a>01418           modified = <span class="keyword">true</span>;
<a name="l01419"></a>01419           <span class="keywordflow">continue</span>;
<a name="l01420"></a>01420         }
<a name="l01421"></a>01421         <span class="comment">// Check if two table regions belong together based on a common</span>
<a name="l01422"></a>01422         <span class="comment">// horizontal ruling line</span>
<a name="l01423"></a>01423         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a0fdb92fd4cf6c71db61a8bf17f793226">BelongToOneTable</a>(box, neighbor_box)) {
<a name="l01424"></a>01424           seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(neighbor_box);
<a name="l01425"></a>01425           neighbor_found = <span class="keyword">true</span>;
<a name="l01426"></a>01426           modified = <span class="keyword">true</span>;
<a name="l01427"></a>01427           rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01428"></a>01428           gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae43afa517cd9b682f10ca1d54dad4ab0">RepositionIterator</a>();
<a name="l01429"></a>01429           <span class="keyword">delete</span> neighbor;
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431       }
<a name="l01432"></a>01432     } <span class="keywordflow">while</span> (neighbor_found);
<a name="l01433"></a>01433     <span class="keywordflow">if</span> (modified) {
<a name="l01434"></a>01434       <span class="comment">// Because the box has changed, it has to be removed first.</span>
<a name="l01435"></a>01435       gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01436"></a>01436       <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, seg);
<a name="l01437"></a>01437       gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae43afa517cd9b682f10ca1d54dad4ab0">RepositionIterator</a>();
<a name="l01438"></a>01438     }
<a name="l01439"></a>01439   }
<a name="l01440"></a>01440 }
<a name="l01441"></a>01441 
<a name="l01442"></a>01442 <span class="comment">// Decide if two table regions belong to one table based on a common</span>
<a name="l01443"></a>01443 <span class="comment">// horizontal ruling line or another colpartition</span>
<a name="l01444"></a><a class="code" href="classtesseract_1_1_table_finder.html#a0fdb92fd4cf6c71db61a8bf17f793226">01444</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a0fdb92fd4cf6c71db61a8bf17f793226">TableFinder::BelongToOneTable</a>(<span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;box1, <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;box2) {
<a name="l01445"></a>01445   <span class="comment">// Check the obvious case. Most likely not true because overlapping boxes</span>
<a name="l01446"></a>01446   <span class="comment">// should already be merged, but seems like a good thing to do in case things</span>
<a name="l01447"></a>01447   <span class="comment">// change.</span>
<a name="l01448"></a>01448   <span class="keywordflow">if</span> (box1.<a class="code" href="class_t_b_o_x.html#adcc7d2858ccb61cd715dbcff32bd5582">overlap</a>(box2))
<a name="l01449"></a>01449     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01450"></a>01450   <span class="comment">// Check for ColPartitions spanning both table regions</span>
<a name="l01451"></a>01451   <a class="code" href="class_t_b_o_x.html">TBOX</a> bbox = box1.<a class="code" href="class_t_b_o_x.html#ab8ae7b66782fa1802f78ff034da16089">bounding_union</a>(box2);
<a name="l01452"></a>01452   <span class="comment">// Start a rect search on bbox</span>
<a name="l01453"></a>01453   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01454"></a>01454       rectsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01455"></a>01455   rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(bbox);
<a name="l01456"></a>01456   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01457"></a>01457   <span class="keywordflow">while</span> ((part = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01458"></a>01458     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01459"></a>01459     <span class="comment">// return true if a colpartition spanning both table regions is found</span>
<a name="l01460"></a>01460     <span class="keywordflow">if</span> (part_box.<a class="code" href="class_t_b_o_x.html#adcc7d2858ccb61cd715dbcff32bd5582">overlap</a>(box1) &amp;&amp; part_box.<a class="code" href="class_t_b_o_x.html#adcc7d2858ccb61cd715dbcff32bd5582">overlap</a>(box2))
<a name="l01461"></a>01461       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01462"></a>01462   }
<a name="l01463"></a>01463   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01464"></a>01464 }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466 <span class="comment">// Adjust table boundaries by:</span>
<a name="l01467"></a>01467 <span class="comment">//  - building a tight bounding box around all ColPartitions contained in it.</span>
<a name="l01468"></a>01468 <span class="comment">//  - expanding table boundaries to include all colpartitions that overlap the</span>
<a name="l01469"></a>01469 <span class="comment">//    table by more than half of their area</span>
<a name="l01470"></a>01470 <span class="comment">//  - expanding table boundaries to include nearby horizontal rule lines</span>
<a name="l01471"></a>01471 <span class="comment">//  - expanding table vertically to include left out column headers</span>
<a name="l01472"></a>01472 <span class="comment">// TODO(faisal): Expansion of table boundaries is quite aggressive. It usually</span>
<a name="l01473"></a>01473 <span class="comment">//               makes following errors:</span>
<a name="l01474"></a>01474 <span class="comment">//  1- horizontal lines consisting of underlines are included in the table if</span>
<a name="l01475"></a>01475 <span class="comment">//     they are close enough</span>
<a name="l01476"></a>01476 <span class="comment">//  2- horizontal lines originating from noise tend to get merged with a table</span>
<a name="l01477"></a>01477 <span class="comment">//     near the top of the page</span>
<a name="l01478"></a>01478 <span class="comment">//  3- the criteria for including horizontal lines is very generous. Many times</span>
<a name="l01479"></a>01479 <span class="comment">//     horizontal lines separating headers and footers get merged with a</span>
<a name="l01480"></a>01480 <span class="comment">//     single-column table in a multi-column page thereby including text</span>
<a name="l01481"></a>01481 <span class="comment">//     from the neighboring column inside the table</span>
<a name="l01482"></a>01482 <span class="comment">//  4- the criteria for including left out column headers also tends to</span>
<a name="l01483"></a>01483 <span class="comment">//     occasionally include text-lines above the tables, typically from</span>
<a name="l01484"></a>01484 <span class="comment">//     table caption</span>
<a name="l01485"></a><a class="code" href="classtesseract_1_1_table_finder.html#a2af79bdd1c4edbf03f4d2a15ee203be8">01485</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a2af79bdd1c4edbf03f4d2a15ee203be8">TableFinder::AdjustTableBoundaries</a>() {
<a name="l01486"></a>01486   <span class="comment">// Iterate the table regions in the grid</span>
<a name="l01487"></a>01487   ColSegment_CLIST adjusted_tables;
<a name="l01488"></a>01488   ColSegment_C_IT it(&amp;adjusted_tables);
<a name="l01489"></a>01489   <a class="code" href="classtesseract_1_1_grid_search.html">ColSegmentGridSearch</a> gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l01490"></a>01490   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01491"></a>01491   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* table = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01492"></a>01492   <span class="keywordflow">while</span> ((table = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01493"></a>01493     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; table_box = table-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01494"></a>01494     <a class="code" href="class_t_b_o_x.html">TBOX</a> grown_box = table_box;
<a name="l01495"></a>01495     <a class="code" href="classtesseract_1_1_table_finder.html#a11d07831ff21f641f54e51b42a446a26">GrowTableBox</a>(table_box, &amp;grown_box);
<a name="l01496"></a>01496     <span class="comment">// To prevent a table from expanding again, do not insert the</span>
<a name="l01497"></a>01497     <span class="comment">// modified box back to the grid. Instead move it to a list and</span>
<a name="l01498"></a>01498     <span class="comment">// and remove it from the grid. The list is moved later back to the grid.</span>
<a name="l01499"></a>01499     <span class="keywordflow">if</span> (!grown_box.<a class="code" href="class_t_b_o_x.html#a7c6996aea1eb6be07b1d6634bf36cfd6">null_box</a>()) {
<a name="l01500"></a>01500       <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* col = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>();
<a name="l01501"></a>01501       col-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">InsertBox</a>(grown_box);
<a name="l01502"></a>01502       it.add_after_then_move(col);
<a name="l01503"></a>01503     }
<a name="l01504"></a>01504     gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01505"></a>01505     <span class="keyword">delete</span> table;
<a name="l01506"></a>01506   }
<a name="l01507"></a>01507   <span class="comment">// clear table grid to move final tables in it</span>
<a name="l01508"></a>01508   <span class="comment">// TODO(nbeato): table_grid_ should already be empty. The above loop</span>
<a name="l01509"></a>01509   <span class="comment">// removed everything. Maybe just assert it is empty?</span>
<a name="l01510"></a>01510   <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a0b373075bdfda41719d6fb9a64bcfee0">Clear</a>();
<a name="l01511"></a>01511   it.move_to_first();
<a name="l01512"></a>01512   <span class="comment">// move back final tables to table_grid_</span>
<a name="l01513"></a>01513   <span class="keywordflow">for</span> (it.mark_cycle_pt(); !it.cycled_list(); it.forward()) {
<a name="l01514"></a>01514     <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg = it.extract();
<a name="l01515"></a>01515     <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, seg);
<a name="l01516"></a>01516   }
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 
<a name="l01519"></a><a class="code" href="classtesseract_1_1_table_finder.html#a11d07831ff21f641f54e51b42a446a26">01519</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a11d07831ff21f641f54e51b42a446a26">TableFinder::GrowTableBox</a>(<span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; table_box, <a class="code" href="class_t_b_o_x.html">TBOX</a>* result_box) {
<a name="l01520"></a>01520   <span class="comment">// TODO(nbeato): The growing code is a bit excessive right now.</span>
<a name="l01521"></a>01521   <span class="comment">// By removing these lines, the partitions considered need</span>
<a name="l01522"></a>01522   <span class="comment">// to have some overlap or be special cases. These lines could</span>
<a name="l01523"></a>01523   <span class="comment">// be added again once a check is put in place to make sure that</span>
<a name="l01524"></a>01524   <span class="comment">// growing tables don&#39;t stomp on a lot of non-table partitions.</span>
<a name="l01525"></a>01525 
<a name="l01526"></a>01526   <span class="comment">// search for horizontal ruling lines within the vertical margin</span>
<a name="l01527"></a>01527   <span class="comment">// int vertical_margin = kRulingVerticalMargin * gridsize();</span>
<a name="l01528"></a>01528   <a class="code" href="class_t_b_o_x.html">TBOX</a> search_box = table_box;
<a name="l01529"></a>01529   <span class="comment">// int top = MIN(search_box.top() + vertical_margin, tright().y());</span>
<a name="l01530"></a>01530   <span class="comment">// int bottom = MAX(search_box.bottom() - vertical_margin, bleft().y());</span>
<a name="l01531"></a>01531   <span class="comment">// search_box.set_top(top);</span>
<a name="l01532"></a>01532   <span class="comment">// search_box.set_bottom(bottom);</span>
<a name="l01533"></a>01533 
<a name="l01534"></a>01534   <a class="code" href="classtesseract_1_1_table_finder.html#ac694dfdfaa119c35c337dd342073debf">GrowTableToIncludePartials</a>(table_box, search_box, result_box);
<a name="l01535"></a>01535   <a class="code" href="classtesseract_1_1_table_finder.html#a2f2d85d386d90f680f518bf9e6496411">GrowTableToIncludeLines</a>(table_box, search_box, result_box);
<a name="l01536"></a>01536   <a class="code" href="classtesseract_1_1_table_finder.html#a265d046f7651f73362a3aa5f3c9453fd">IncludeLeftOutColumnHeaders</a>(result_box);
<a name="l01537"></a>01537 }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539 <span class="comment">// Grow a table by increasing the size of the box to include</span>
<a name="l01540"></a>01540 <span class="comment">// partitions with significant overlap with the table.</span>
<a name="l01541"></a><a class="code" href="classtesseract_1_1_table_finder.html#ac694dfdfaa119c35c337dd342073debf">01541</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ac694dfdfaa119c35c337dd342073debf">TableFinder::GrowTableToIncludePartials</a>(<span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; table_box,
<a name="l01542"></a>01542                                              <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; search_range,
<a name="l01543"></a>01543                                              <a class="code" href="class_t_b_o_x.html">TBOX</a>* result_box) {
<a name="l01544"></a>01544   <span class="comment">// Rulings are in a different grid, so search 2 grids for rulings, text,</span>
<a name="l01545"></a>01545   <span class="comment">// and table partitions that are not entirely within the new box.</span>
<a name="l01546"></a>01546   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {
<a name="l01547"></a>01547     <a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid = (i == 0) ? &amp;<a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a> :
<a name="l01548"></a>01548                                         &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>;
<a name="l01549"></a>01549     <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> rectsearch(grid);
<a name="l01550"></a>01550     rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(search_range);
<a name="l01551"></a>01551     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01552"></a>01552     <span class="keywordflow">while</span> ((part = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01553"></a>01553      <span class="comment">// Only include text and table types.</span>
<a name="l01554"></a>01554       <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0ae19652d302dcc8bfd9cab1bed18770">IsImageType</a>())
<a name="l01555"></a>01555         <span class="keywordflow">continue</span>;
<a name="l01556"></a>01556       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01557"></a>01557       <span class="comment">// Include partition in the table if more than half of it</span>
<a name="l01558"></a>01558       <span class="comment">// is covered by the table</span>
<a name="l01559"></a>01559       <span class="keywordflow">if</span> (part_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(table_box) &gt; <a class="code" href="namespacetesseract.html#a0f2ae212b6b475efca7981fd1dc51e29">kMinOverlapWithTable</a>) {
<a name="l01560"></a>01560         *result_box = result_box-&gt;<a class="code" href="class_t_b_o_x.html#ab8ae7b66782fa1802f78ff034da16089">bounding_union</a>(part_box);
<a name="l01561"></a>01561         <span class="keywordflow">continue</span>;
<a name="l01562"></a>01562       }
<a name="l01563"></a>01563     }
<a name="l01564"></a>01564   }
<a name="l01565"></a>01565 }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567 <span class="comment">// Grow a table by expanding to the extents of significantly</span>
<a name="l01568"></a>01568 <span class="comment">// overlapping lines.</span>
<a name="l01569"></a><a class="code" href="classtesseract_1_1_table_finder.html#a2f2d85d386d90f680f518bf9e6496411">01569</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a2f2d85d386d90f680f518bf9e6496411">TableFinder::GrowTableToIncludeLines</a>(<span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; table_box,
<a name="l01570"></a>01570                                           <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; search_range,
<a name="l01571"></a>01571                                           <a class="code" href="class_t_b_o_x.html">TBOX</a>* result_box) {
<a name="l01572"></a>01572   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> rsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>);
<a name="l01573"></a>01573   rsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a3c44b7c8272584600153d8249a841e73">SetUniqueMode</a>(<span class="keyword">true</span>);
<a name="l01574"></a>01574   rsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(search_range);
<a name="l01575"></a>01575   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01576"></a>01576   <span class="keywordflow">while</span> ((part = rsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01577"></a>01577     <span class="comment">// TODO(nbeato) This should also do vertical, but column</span>
<a name="l01578"></a>01578     <span class="comment">// boundaries are breaking things. This function needs to be</span>
<a name="l01579"></a>01579     <span class="comment">// updated to allow vertical lines as well.</span>
<a name="l01580"></a>01580     <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#acf97b6bd6c867bb71f5cd639f19b9994">IsLineType</a>())
<a name="l01581"></a>01581       <span class="keywordflow">continue</span>;
<a name="l01582"></a>01582     <span class="comment">// Avoid the following function call if the result of the</span>
<a name="l01583"></a>01583     <span class="comment">// function is irrelevant.</span>
<a name="l01584"></a>01584     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01585"></a>01585     <span class="keywordflow">if</span> (result_box-&gt;<a class="code" href="class_t_b_o_x.html#a5d4e2c5f91b791e94d4c94e513180632">contains</a>(part_box))
<a name="l01586"></a>01586       <span class="keywordflow">continue</span>;
<a name="l01587"></a>01587     <span class="comment">// Include a partially overlapping horizontal line only if the</span>
<a name="l01588"></a>01588     <span class="comment">// extra ColPartitions that will be included due to expansion</span>
<a name="l01589"></a>01589     <span class="comment">// have large side spacing w.r.t. columns containing them.</span>
<a name="l01590"></a>01590     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_table_finder.html#a6fcf84582f86676bf93e6e49d08dc64a">HLineBelongsToTable</a>(*part, table_box))
<a name="l01591"></a>01591       *result_box = result_box-&gt;<a class="code" href="class_t_b_o_x.html#ab8ae7b66782fa1802f78ff034da16089">bounding_union</a>(part_box);
<a name="l01592"></a>01592     <span class="comment">// TODO(nbeato): Vertical</span>
<a name="l01593"></a>01593   }
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 
<a name="l01596"></a>01596 <span class="comment">// Checks whether the horizontal line belong to the table by looking at the</span>
<a name="l01597"></a>01597 <span class="comment">// side spacing of extra ColParitions that will be included in the table</span>
<a name="l01598"></a>01598 <span class="comment">// due to expansion</span>
<a name="l01599"></a><a class="code" href="classtesseract_1_1_table_finder.html#a6fcf84582f86676bf93e6e49d08dc64a">01599</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a6fcf84582f86676bf93e6e49d08dc64a">TableFinder::HLineBelongsToTable</a>(<span class="keyword">const</span> <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>&amp; part,
<a name="l01600"></a>01600                                       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; table_box) {
<a name="l01601"></a>01601   <span class="keywordflow">if</span> (!part.<a class="code" href="classtesseract_1_1_col_partition.html#a052bafacd4995721da746930d2df0dd2">IsHorizontalLine</a>())
<a name="l01602"></a>01602     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01603"></a>01603   <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; part_box = part.<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01604"></a>01604   <span class="keywordflow">if</span> (!part_box.<a class="code" href="class_t_b_o_x.html#a9f7e4e20bdfeee0d82db2f8d24aa72dc">major_x_overlap</a>(table_box))
<a name="l01605"></a>01605     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01606"></a>01606   <span class="comment">// Do not consider top-most horizontal line since it usually</span>
<a name="l01607"></a>01607   <span class="comment">// originates from noise.</span>
<a name="l01608"></a>01608   <span class="comment">// TODO(nbeato): I had to comment this out because the ruling grid doesn&#39;t</span>
<a name="l01609"></a>01609   <span class="comment">// have neighbors solved.</span>
<a name="l01610"></a>01610   <span class="comment">// if (!part.nearest_neighbor_above())</span>
<a name="l01611"></a>01611   <span class="comment">//   return false;</span>
<a name="l01612"></a>01612   <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> bbox = part_box.<a class="code" href="class_t_b_o_x.html#ab8ae7b66782fa1802f78ff034da16089">bounding_union</a>(table_box);
<a name="l01613"></a>01613   <span class="comment">// In the &quot;unioned table&quot; box (the table extents expanded by the line),</span>
<a name="l01614"></a>01614   <span class="comment">// keep track of how many partitions have significant padding to the left</span>
<a name="l01615"></a>01615   <span class="comment">// and right. If more than half of the partitions covered by the new table</span>
<a name="l01616"></a>01616   <span class="comment">// have significant spacing, the line belongs to the table and the table</span>
<a name="l01617"></a>01617   <span class="comment">// grows to include all of the partitions.</span>
<a name="l01618"></a>01618   <span class="keywordtype">int</span> num_extra_partitions = 0;
<a name="l01619"></a>01619   <span class="keywordtype">int</span> extra_space_to_right = 0;
<a name="l01620"></a>01620   <span class="keywordtype">int</span> extra_space_to_left = 0;
<a name="l01621"></a>01621   <span class="comment">// Rulings are in a different grid, so search 2 grids for rulings, text,</span>
<a name="l01622"></a>01622   <span class="comment">// and table partitions that are introduced by the new box.</span>
<a name="l01623"></a>01623   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {
<a name="l01624"></a>01624     <a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid = (i == 0) ? &amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a> :
<a name="l01625"></a>01625                                         &amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>;
<a name="l01626"></a>01626     <span class="comment">// Start a rect search on bbox</span>
<a name="l01627"></a>01627     <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> rectsearch(grid);
<a name="l01628"></a>01628     rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a3c44b7c8272584600153d8249a841e73">SetUniqueMode</a>(<span class="keyword">true</span>);
<a name="l01629"></a>01629     rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(bbox);
<a name="l01630"></a>01630     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* extra_part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01631"></a>01631     <span class="keywordflow">while</span> ((extra_part = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01632"></a>01632       <span class="comment">// ColPartition already in table</span>
<a name="l01633"></a>01633       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; extra_part_box = extra_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01634"></a>01634       <span class="keywordflow">if</span> (extra_part_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(table_box) &gt; <a class="code" href="namespacetesseract.html#a0f2ae212b6b475efca7981fd1dc51e29">kMinOverlapWithTable</a>)
<a name="l01635"></a>01635         <span class="keywordflow">continue</span>;
<a name="l01636"></a>01636       <span class="comment">// Non-text ColPartitions do not contribute</span>
<a name="l01637"></a>01637       <span class="keywordflow">if</span> (extra_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a0ae19652d302dcc8bfd9cab1bed18770">IsImageType</a>())
<a name="l01638"></a>01638         <span class="keywordflow">continue</span>;
<a name="l01639"></a>01639       <span class="comment">// Consider this partition.</span>
<a name="l01640"></a>01640       num_extra_partitions++;
<a name="l01641"></a>01641       <span class="comment">// presence of a table cell is a strong hint, so just increment the scores</span>
<a name="l01642"></a>01642       <span class="comment">// without looking at the spacing.</span>
<a name="l01643"></a>01643       <span class="keywordflow">if</span> (extra_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a> || extra_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#acf97b6bd6c867bb71f5cd639f19b9994">IsLineType</a>()) {
<a name="l01644"></a>01644         extra_space_to_right++;
<a name="l01645"></a>01645         extra_space_to_left++;
<a name="l01646"></a>01646         <span class="keywordflow">continue</span>;
<a name="l01647"></a>01647       }
<a name="l01648"></a>01648       <span class="keywordtype">int</span> space_threshold = <a class="code" href="namespacetesseract.html#aee32ef58150f63a980c7b4f736c4a22a">kSideSpaceMargin</a> * part.<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>();
<a name="l01649"></a>01649       <span class="keywordflow">if</span> (extra_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2e061b11b010ed6ee0382300f423735c">space_to_right</a>() &gt; space_threshold)
<a name="l01650"></a>01650         extra_space_to_right++;
<a name="l01651"></a>01651       <span class="keywordflow">if</span> (extra_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4c55a12d96d51a9710edc292c1946ca1">space_to_left</a>() &gt; space_threshold)
<a name="l01652"></a>01652         extra_space_to_left++;
<a name="l01653"></a>01653     }
<a name="l01654"></a>01654   }
<a name="l01655"></a>01655   <span class="comment">// tprintf(&quot;%d %d %d\n&quot;,</span>
<a name="l01656"></a>01656   <span class="comment">// num_extra_partitions,extra_space_to_right,extra_space_to_left);</span>
<a name="l01657"></a>01657   <span class="keywordflow">return</span> (extra_space_to_right &gt; num_extra_partitions / 2) ||
<a name="l01658"></a>01658       (extra_space_to_left &gt; num_extra_partitions / 2);
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01661"></a>01661 <span class="comment">// Look for isolated column headers above the given table box and</span>
<a name="l01662"></a>01662 <span class="comment">// include them in the table</span>
<a name="l01663"></a><a class="code" href="classtesseract_1_1_table_finder.html#a265d046f7651f73362a3aa5f3c9453fd">01663</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a265d046f7651f73362a3aa5f3c9453fd">TableFinder::IncludeLeftOutColumnHeaders</a>(<a class="code" href="class_t_b_o_x.html">TBOX</a>* table_box) {
<a name="l01664"></a>01664   <span class="comment">// Start a search above the current table to look for column headers</span>
<a name="l01665"></a>01665   <a class="code" href="classtesseract_1_1_grid_search.html">ColPartitionGridSearch</a> vsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01666"></a>01666   vsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a071abe1128e59e6ccf1f98a8c6002744">StartVerticalSearch</a>(table_box-&gt;<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), table_box-&gt;<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(),
<a name="l01667"></a>01667                               table_box-&gt;<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>());
<a name="l01668"></a>01668   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01669"></a>01669   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* previous_neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01670"></a>01670   <span class="keywordflow">while</span> ((neighbor = vsearch.<a class="code" href="classtesseract_1_1_grid_search.html#adfe2bf527306cdd264be5bdcdd5ac351">NextVerticalSearch</a>(<span class="keyword">false</span>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01671"></a>01671     <span class="comment">// Max distance to find a table heading.</span>
<a name="l01672"></a>01672     <span class="keyword">const</span> <span class="keywordtype">int</span> max_distance = <a class="code" href="namespacetesseract.html#aae5eb999d710e50055ba3096b2f54c38">kMaxColumnHeaderDistance</a> *
<a name="l01673"></a>01673                              neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a2ede8f204ed66939a0c4352657da6c94">median_size</a>();
<a name="l01674"></a>01674     <span class="keywordtype">int</span> table_top = table_box-&gt;<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01675"></a>01675     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01676"></a>01676     <span class="comment">// Do not continue if the next box is way above</span>
<a name="l01677"></a>01677     <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>() - table_top &gt; max_distance)
<a name="l01678"></a>01678       <span class="keywordflow">break</span>;
<a name="l01679"></a>01679     <span class="comment">// Unconditionally include partitions of type TABLE or LINE</span>
<a name="l01680"></a>01680     <span class="comment">// TODO(faisal): add some reasonable conditions here</span>
<a name="l01681"></a>01681     <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a> || neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#acf97b6bd6c867bb71f5cd639f19b9994">IsLineType</a>()) {
<a name="l01682"></a>01682       table_box-&gt;<a class="code" href="class_t_b_o_x.html#a7f40dfd290a907200bdc98c196f63f45">set_top</a>(box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>());
<a name="l01683"></a>01683       previous_neighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01684"></a>01684       <span class="keywordflow">continue</span>;
<a name="l01685"></a>01685     }
<a name="l01686"></a>01686     <span class="comment">// If there are two text partitions, one above the other, without a table</span>
<a name="l01687"></a>01687     <span class="comment">// cell on their left or right side, consider them a barrier and quit</span>
<a name="l01688"></a>01688     <span class="keywordflow">if</span> (previous_neighbor == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01689"></a>01689       previous_neighbor = neighbor;
<a name="l01690"></a>01690     } <span class="keywordflow">else</span> {
<a name="l01691"></a>01691       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; previous_box = previous_neighbor-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01692"></a>01692       <span class="keywordflow">if</span> (!box.<a class="code" href="class_t_b_o_x.html#a6b8b3bf99ea363303e11c26866335f23">major_y_overlap</a>(previous_box))
<a name="l01693"></a>01693         <span class="keywordflow">break</span>;
<a name="l01694"></a>01694     }
<a name="l01695"></a>01695   }
<a name="l01696"></a>01696 }
<a name="l01697"></a>01697 
<a name="l01698"></a>01698 <span class="comment">// Remove false alarms consiting of a single column based on their</span>
<a name="l01699"></a>01699 <span class="comment">// projection on the x-axis. Projection of a real table on the x-axis</span>
<a name="l01700"></a>01700 <span class="comment">// should have at least one zero-valley larger than the global median</span>
<a name="l01701"></a>01701 <span class="comment">// x-height of the page.</span>
<a name="l01702"></a><a class="code" href="classtesseract_1_1_table_finder.html#ad1d77425898bfe8808255b9a472663ab">01702</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ad1d77425898bfe8808255b9a472663ab">TableFinder::DeleteSingleColumnTables</a>() {
<a name="l01703"></a>01703   <span class="keywordtype">int</span> page_width = <a class="code" href="classtesseract_1_1_table_finder.html#af994bc64825f51944fa63a0fc61b4e13">tright</a>().<a class="code" href="class_i_c_o_o_r_d.html#a59722a47c540007c58a539f0e35b3f33" title="access function">x</a>() - <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().<a class="code" href="class_i_c_o_o_r_d.html#a59722a47c540007c58a539f0e35b3f33" title="access function">x</a>();
<a name="l01704"></a>01704   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(page_width &gt; 0);
<a name="l01705"></a>01705   <span class="comment">// create an integer array to hold projection on x-axis</span>
<a name="l01706"></a>01706   <span class="keywordtype">int</span>* table_xprojection = <span class="keyword">new</span> <span class="keywordtype">int</span>[page_width];
<a name="l01707"></a>01707   <span class="comment">// Iterate through all tables in the table grid</span>
<a name="l01708"></a>01708   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01709"></a>01709       table_search(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l01710"></a>01710   table_search.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01711"></a>01711   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* table;
<a name="l01712"></a>01712   <span class="keywordflow">while</span> ((table = table_search.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01713"></a>01713     <a class="code" href="class_t_b_o_x.html">TBOX</a> table_box = table-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01714"></a>01714     <span class="comment">// reset the projection array</span>
<a name="l01715"></a>01715     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; page_width; i++) {
<a name="l01716"></a>01716       table_xprojection[i] = 0;
<a name="l01717"></a>01717     }
<a name="l01718"></a>01718     <span class="comment">// Start a rect search on table_box</span>
<a name="l01719"></a>01719     <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01720"></a>01720         rectsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l01721"></a>01721     rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#a3c44b7c8272584600153d8249a841e73">SetUniqueMode</a>(<span class="keyword">true</span>);
<a name="l01722"></a>01722     rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(table_box);
<a name="l01723"></a>01723     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part;
<a name="l01724"></a>01724     <span class="keywordflow">while</span> ((part = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01725"></a>01725       <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>())
<a name="l01726"></a>01726         <span class="keywordflow">continue</span>;  <span class="comment">// Do not consider non-text partitions</span>
<a name="l01727"></a>01727       <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a811bd892dfa5eeba0b17b77794d79754">flow</a>() == <a class="code" href="blobbox_8h.html#aa72f1499398e9694bf46752e1cc895e1a64e3e70c4fac4d4e3facdb4638307d7f">BTFT_LEADER</a>)
<a name="l01728"></a>01728         <span class="keywordflow">continue</span>;  <span class="comment">// Assume leaders are in tables</span>
<a name="l01729"></a>01729       <a class="code" href="class_t_b_o_x.html">TBOX</a> part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01730"></a>01730       <span class="comment">// Do not consider partitions partially covered by the table</span>
<a name="l01731"></a>01731       <span class="keywordflow">if</span> (part_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(table_box) &lt; <a class="code" href="namespacetesseract.html#a0f2ae212b6b475efca7981fd1dc51e29">kMinOverlapWithTable</a>)
<a name="l01732"></a>01732         <span class="keywordflow">continue</span>;
<a name="l01733"></a>01733       BLOBNBOX_CLIST* part_boxes = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a3fc2dd797ede7a62546b2565811e9ce0">boxes</a>();
<a name="l01734"></a>01734       BLOBNBOX_C_IT pit(part_boxes);
<a name="l01735"></a>01735 
<a name="l01736"></a>01736       <span class="comment">// Make sure overlapping blobs don&#39;t artificially inflate the number</span>
<a name="l01737"></a>01737       <span class="comment">// of rows in the table. This happens frequently with things such as</span>
<a name="l01738"></a>01738       <span class="comment">// decimals and split characters. Do this by assuming the column</span>
<a name="l01739"></a>01739       <span class="comment">// partition is sorted mostly left to right and just clip</span>
<a name="l01740"></a>01740       <span class="comment">// bounding boxes by the previous box&#39;s extent.</span>
<a name="l01741"></a>01741       <span class="keywordtype">int</span> next_position_to_write = 0;
<a name="l01742"></a>01742 
<a name="l01743"></a>01743       <span class="keywordflow">for</span> (pit.mark_cycle_pt(); !pit.cycled_list(); pit.forward()) {
<a name="l01744"></a>01744         <a class="code" href="class_b_l_o_b_n_b_o_x.html">BLOBNBOX</a> *pblob = pit.data();
<a name="l01745"></a>01745         <span class="comment">// ignore blob height for the purpose of projection since we</span>
<a name="l01746"></a>01746         <span class="comment">// are only interested in finding valleys</span>
<a name="l01747"></a>01747         <span class="keywordtype">int</span> xstart = pblob-&gt;<a class="code" href="class_b_l_o_b_n_b_o_x.html#a7b97b8bc16b1473a28f9c44011522f4e">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l01748"></a>01748         <span class="keywordtype">int</span> xend = pblob-&gt;<a class="code" href="class_b_l_o_b_n_b_o_x.html#a7b97b8bc16b1473a28f9c44011522f4e">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l01749"></a>01749 
<a name="l01750"></a>01750         xstart = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(xstart, next_position_to_write);
<a name="l01751"></a>01751         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = xstart; i &lt; xend; i++)
<a name="l01752"></a>01752           table_xprojection[i - <a class="code" href="classtesseract_1_1_table_finder.html#afaa3f28f4a9e645ded90e9f74016b217">bleft</a>().<a class="code" href="class_i_c_o_o_r_d.html#a59722a47c540007c58a539f0e35b3f33" title="access function">x</a>()]++;
<a name="l01753"></a>01753         next_position_to_write = xend;
<a name="l01754"></a>01754       }
<a name="l01755"></a>01755     }
<a name="l01756"></a>01756     <span class="comment">// Find largest valley between two reasonable peaks in the table</span>
<a name="l01757"></a>01757     <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_table_finder.html#a89d4134c1260f74cd0b0f6cbecfc2545">GapInXProjection</a>(table_xprojection, page_width)) {
<a name="l01758"></a>01758       table_search.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01759"></a>01759       <span class="keyword">delete</span> table;
<a name="l01760"></a>01760     }
<a name="l01761"></a>01761   }
<a name="l01762"></a>01762   <span class="keyword">delete</span>[] table_xprojection;
<a name="l01763"></a>01763 }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765 <span class="comment">// Return true if at least one gap larger than the global x-height</span>
<a name="l01766"></a>01766 <span class="comment">// exists in the horizontal projection</span>
<a name="l01767"></a><a class="code" href="classtesseract_1_1_table_finder.html#a89d4134c1260f74cd0b0f6cbecfc2545">01767</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_table_finder.html#a89d4134c1260f74cd0b0f6cbecfc2545">TableFinder::GapInXProjection</a>(<span class="keywordtype">int</span>* xprojection, <span class="keywordtype">int</span> length) {
<a name="l01768"></a>01768   <span class="comment">// Find peak value of the histogram</span>
<a name="l01769"></a>01769   <span class="keywordtype">int</span> peak_value = 0;
<a name="l01770"></a>01770   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; length; i++) {
<a name="l01771"></a>01771     <span class="keywordflow">if</span> (xprojection[i] &gt; peak_value) {
<a name="l01772"></a>01772       peak_value = xprojection[i];
<a name="l01773"></a>01773     }
<a name="l01774"></a>01774   }
<a name="l01775"></a>01775   <span class="comment">// Peak value represents the maximum number of horizontally</span>
<a name="l01776"></a>01776   <span class="comment">// overlapping colpartitions, so this can be considered as the</span>
<a name="l01777"></a>01777   <span class="comment">// number of rows in the table</span>
<a name="l01778"></a>01778   <span class="keywordflow">if</span> (peak_value &lt; <a class="code" href="namespacetesseract.html#a4947294f7e711f5f1713df9de000b1b8">kMinRowsInTable</a>)
<a name="l01779"></a>01779     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01780"></a>01780   <span class="keywordtype">double</span> projection_threshold = <a class="code" href="namespacetesseract.html#ae12e73878098046ae28b0d54408359f7">kSmallTableProjectionThreshold</a> * peak_value;
<a name="l01781"></a>01781   <span class="keywordflow">if</span> (peak_value &gt;= <a class="code" href="namespacetesseract.html#adf7c67274b1cdc63e4afeb2500796de7">kLargeTableRowCount</a>)
<a name="l01782"></a>01782     projection_threshold = <a class="code" href="namespacetesseract.html#a39b11305adc922233ab775b31d94b6bb">kLargeTableProjectionThreshold</a> * peak_value;
<a name="l01783"></a>01783   <span class="comment">// Threshold the histogram</span>
<a name="l01784"></a>01784   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; length; i++) {
<a name="l01785"></a>01785     xprojection[i] = (xprojection[i] &gt;= projection_threshold) ? 1 : 0;
<a name="l01786"></a>01786   }
<a name="l01787"></a>01787   <span class="comment">// Find the largest run of zeros between two ones</span>
<a name="l01788"></a>01788   <span class="keywordtype">int</span> largest_gap = 0;
<a name="l01789"></a>01789   <span class="keywordtype">int</span> run_start = -1;
<a name="l01790"></a>01790   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; length; i++) {
<a name="l01791"></a>01791     <span class="comment">// detect start of a run of zeros</span>
<a name="l01792"></a>01792     <span class="keywordflow">if</span> (xprojection[i - 1] &amp;&amp; !xprojection[i]) {
<a name="l01793"></a>01793       run_start = i;
<a name="l01794"></a>01794     }
<a name="l01795"></a>01795     <span class="comment">// detect end of a run of zeros and update the value of largest gap</span>
<a name="l01796"></a>01796     <span class="keywordflow">if</span> (run_start != -1 &amp;&amp; !xprojection[i - 1] &amp;&amp; xprojection[i]) {
<a name="l01797"></a>01797       <span class="keywordtype">int</span> gap = i - run_start;
<a name="l01798"></a>01798       <span class="keywordflow">if</span> (gap &gt; largest_gap)
<a name="l01799"></a>01799         largest_gap = gap;
<a name="l01800"></a>01800       run_start = -1;
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802   }
<a name="l01803"></a>01803   <span class="keywordflow">return</span> largest_gap &gt; <a class="code" href="namespacetesseract.html#af950654bba3a03e1ba3f1df8177cdd73">kMaxXProjectionGapFactor</a> * <a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a>;
<a name="l01804"></a>01804 }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806 <span class="comment">// Given the location of a table &quot;guess&quot;, try to overlay a cellular</span>
<a name="l01807"></a>01807 <span class="comment">// grid in the location, adjusting the boundaries.</span>
<a name="l01808"></a>01808 <span class="comment">// TODO(nbeato): Falsely introduces:</span>
<a name="l01809"></a>01809 <span class="comment">//   -headers/footers (not any worse, too much overlap destroys cells)</span>
<a name="l01810"></a>01810 <span class="comment">//   -page numbers (not worse, included because maximize margins)</span>
<a name="l01811"></a>01811 <span class="comment">//   -equations (nicely fit into a celluar grid, but more sparsely)</span>
<a name="l01812"></a>01812 <span class="comment">//   -figures (random text box, also sparse)</span>
<a name="l01813"></a>01813 <span class="comment">//   -small left-aligned text areas with overlapping positioned whitespace</span>
<a name="l01814"></a>01814 <span class="comment">//       (rejected before)</span>
<a name="l01815"></a>01815 <span class="comment">// Overall, this just needs some more work.</span>
<a name="l01816"></a><a class="code" href="classtesseract_1_1_table_finder.html#a647fe056ae6bb33cc8989f08aac5172f">01816</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a647fe056ae6bb33cc8989f08aac5172f">TableFinder::RecognizeTables</a>() {
<a name="l01817"></a>01817   <a class="code" href="class_scroll_view.html">ScrollView</a>* table_win = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01818"></a>01818   <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l01819"></a>01819     table_win = <a class="code" href="classtesseract_1_1_table_finder.html#a1d45a058db096f6040af24af402b2042">MakeWindow</a>(0, 0, <span class="stringliteral">&quot;Table Structure&quot;</span>);
<a name="l01820"></a>01820     <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(table_win, &amp;<a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a>,
<a name="l01821"></a>01821                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a93aaf384b4a674f176e3dd1655c1ad95">ScrollView::LIGHT_BLUE</a>);
<a name="l01822"></a>01822     <span class="comment">// table_grid_.DisplayBoxes(table_win);</span>
<a name="l01823"></a>01823   }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825 
<a name="l01826"></a>01826   <a class="code" href="classtesseract_1_1_table_recognizer.html">TableRecognizer</a> recognizer;
<a name="l01827"></a>01827   recognizer.<a class="code" href="classtesseract_1_1_table_recognizer.html#aca159b4dcd53ac99591aff44ce50a015">Init</a>();
<a name="l01828"></a>01828   recognizer.<a class="code" href="classtesseract_1_1_table_recognizer.html#a969a85b74ae52c0fc72da54e66ed93a6">set_line_grid</a>(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#a7fddea88c90c15d996f36963481b81cf">leader_and_ruling_grid_</a>);
<a name="l01829"></a>01829   recognizer.<a class="code" href="classtesseract_1_1_table_recognizer.html#abdb2fec4ac7970b190ceaaf4bfb4368f">set_text_grid</a>(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#ad2da282ac5f2a2d4efbc463d80c7113c">fragmented_text_grid_</a>);
<a name="l01830"></a>01830   recognizer.<a class="code" href="classtesseract_1_1_table_recognizer.html#a5c4fca3ea6f9452c7ec5a76f2e085a0c">set_max_text_height</a>(<a class="code" href="classtesseract_1_1_table_finder.html#ab66e5e7382edbd8bc260fd5bca4f2914">global_median_xheight_</a> * 2.0);
<a name="l01831"></a>01831   recognizer.<a class="code" href="classtesseract_1_1_table_recognizer.html#ad24b027f3a4261cf7cb25f03646e58de">set_min_height</a>(1.5 * <a class="code" href="classtesseract_1_1_table_finder.html#a704fbe9cb0edeaa969bb0cc2bd1f9dbd">gridheight</a>());
<a name="l01832"></a>01832   <span class="comment">// Loop over all of the tables and try to fit them.</span>
<a name="l01833"></a>01833   <span class="comment">// Store the good tables here.</span>
<a name="l01834"></a>01834   ColSegment_CLIST good_tables;
<a name="l01835"></a>01835   ColSegment_C_IT good_it(&amp;good_tables);
<a name="l01836"></a>01836 
<a name="l01837"></a>01837   <a class="code" href="classtesseract_1_1_grid_search.html">ColSegmentGridSearch</a> gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l01838"></a>01838   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01839"></a>01839   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* found_table = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01840"></a>01840   <span class="keywordflow">while</span> ((found_table = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01841"></a>01841     gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l01842"></a>01842 
<a name="l01843"></a>01843     <span class="comment">// The goal is to make the tables persistent in a list.</span>
<a name="l01844"></a>01844     <span class="comment">// When that happens, this will move into the search loop.</span>
<a name="l01845"></a>01845     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; found_box = found_table-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01846"></a>01846     <a class="code" href="classtesseract_1_1_structured_table.html">StructuredTable</a>* table_structure = recognizer.<a class="code" href="classtesseract_1_1_table_recognizer.html#adc08877ea279ece9d88e2e69cd00b2b4">RecognizeTable</a>(found_box);
<a name="l01847"></a>01847 
<a name="l01848"></a>01848     <span class="comment">// Process a table. Good tables are inserted into the grid again later on</span>
<a name="l01849"></a>01849     <span class="comment">// We can&#39;t change boxes in the grid while it is running a search.</span>
<a name="l01850"></a>01850     <span class="keywordflow">if</span> (table_structure != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01851"></a>01851       <span class="keywordflow">if</span> (<a class="code" href="namespacetesseract.html#a313a803eb9c9c5adc55aa666d7967c20">textord_show_tables</a>) {
<a name="l01852"></a>01852         table_structure-&gt;<a class="code" href="classtesseract_1_1_structured_table.html#a963787fcfcc5343b74b5e873723752a0">Display</a>(table_win, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a3312de9754e4e61d9a699f23528a059a">ScrollView::LIME_GREEN</a>);
<a name="l01853"></a>01853       }
<a name="l01854"></a>01854       found_table-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a39031c0f0997a85c4bf8398b47dd0c60">set_bounding_box</a>(table_structure-&gt;<a class="code" href="classtesseract_1_1_structured_table.html#a3c7bee910fbd573f3999c58db9539c02">bounding_box</a>());
<a name="l01855"></a>01855       <span class="keyword">delete</span> table_structure;
<a name="l01856"></a>01856       good_it.add_after_then_move(found_table);
<a name="l01857"></a>01857     } <span class="keywordflow">else</span> {
<a name="l01858"></a>01858       <span class="keyword">delete</span> found_table;
<a name="l01859"></a>01859     }
<a name="l01860"></a>01860   }
<a name="l01861"></a>01861   <span class="comment">// TODO(nbeato): MERGE!! There is awesome info now available for merging.</span>
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   <span class="comment">// At this point, the grid is empty. We can safely insert the good tables</span>
<a name="l01864"></a>01864   <span class="comment">// back into grid.</span>
<a name="l01865"></a>01865   <span class="keywordflow">for</span> (good_it.mark_cycle_pt(); !good_it.cycled_list(); good_it.forward())
<a name="l01866"></a>01866     <a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>.<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, good_it.extract());
<a name="l01867"></a>01867 }
<a name="l01868"></a>01868 
<a name="l01869"></a>01869 <span class="comment">// Displays the column segments in some window.</span>
<a name="l01870"></a><a class="code" href="classtesseract_1_1_table_finder.html#a0778d0e3d6bc52330704d1143a73f90a">01870</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a0778d0e3d6bc52330704d1143a73f90a">TableFinder::DisplayColSegments</a>(<a class="code" href="class_scroll_view.html">ScrollView</a>* win,
<a name="l01871"></a>01871                                      ColSegment_LIST *segments,
<a name="l01872"></a>01872                                      <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> color) {
<a name="l01873"></a>01873 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01874"></a>01874 <span class="preprocessor"></span>  win-&gt;<a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">Pen</a>(color);
<a name="l01875"></a>01875   win-&gt;<a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">Brush</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a77673d8f27617bcfe50a6ebdd81e8c79">ScrollView::NONE</a>);
<a name="l01876"></a>01876   ColSegment_IT it(segments);
<a name="l01877"></a>01877   <span class="keywordflow">for</span> (it.mark_cycle_pt(); !it.cycled_list(); it.forward()) {
<a name="l01878"></a>01878     <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* col = it.data();
<a name="l01879"></a>01879     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = col-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01880"></a>01880     <span class="keywordtype">int</span> left_x = box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l01881"></a>01881     <span class="keywordtype">int</span> right_x = box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l01882"></a>01882     <span class="keywordtype">int</span> top_y = box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01883"></a>01883     <span class="keywordtype">int</span> bottom_y = box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01884"></a>01884     win-&gt;<a class="code" href="class_scroll_view.html#ac2a8fdf5d37967ea4a298dc092b6ed0e">Rectangle</a>(left_x, bottom_y, right_x, top_y);
<a name="l01885"></a>01885   }
<a name="l01886"></a>01886   win-&gt;<a class="code" href="class_scroll_view.html#a609e2f95d6421deb558244f5d45cf25a">UpdateWindow</a>();
<a name="l01887"></a>01887 <span class="preprocessor">#endif</span>
<a name="l01888"></a>01888 <span class="preprocessor"></span>}
<a name="l01889"></a>01889 
<a name="l01890"></a><a class="code" href="classtesseract_1_1_table_finder.html#a7a179e84686323b5fd0d93cbb159bb6d">01890</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a7a179e84686323b5fd0d93cbb159bb6d">TableFinder::DisplayColSegmentGrid</a>(<a class="code" href="class_scroll_view.html">ScrollView</a>* win, <a class="code" href="classtesseract_1_1_b_b_grid.html">ColSegmentGrid</a>* grid,
<a name="l01891"></a>01891                                          <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> color) {
<a name="l01892"></a>01892 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01893"></a>01893 <span class="preprocessor"></span>  <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l01894"></a>01894   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l01895"></a>01895     gsearch(grid);
<a name="l01896"></a>01896   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01897"></a>01897   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* seg = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01898"></a>01898   <span class="keywordflow">while</span> ((seg = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01899"></a>01899     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = seg-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l01900"></a>01900     <span class="keywordtype">int</span> left_x = box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l01901"></a>01901     <span class="keywordtype">int</span> right_x = box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l01902"></a>01902     <span class="keywordtype">int</span> top_y = box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01903"></a>01903     <span class="keywordtype">int</span> bottom_y = box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01904"></a>01904     win-&gt;<a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">Brush</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a77673d8f27617bcfe50a6ebdd81e8c79">ScrollView::NONE</a>);
<a name="l01905"></a>01905     win-&gt;<a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">Pen</a>(color);
<a name="l01906"></a>01906     win-&gt;<a class="code" href="class_scroll_view.html#ac2a8fdf5d37967ea4a298dc092b6ed0e">Rectangle</a>(left_x, bottom_y, right_x, top_y);
<a name="l01907"></a>01907   }
<a name="l01908"></a>01908   win-&gt;<a class="code" href="class_scroll_view.html#a609e2f95d6421deb558244f5d45cf25a">UpdateWindow</a>();
<a name="l01909"></a>01909 <span class="preprocessor">#endif</span>
<a name="l01910"></a>01910 <span class="preprocessor"></span>}
<a name="l01911"></a>01911 
<a name="l01912"></a>01912 <span class="comment">// Displays the colpartitions using a new coloring on an existing window.</span>
<a name="l01913"></a>01913 <span class="comment">// Note: This method is only for debug purpose during development and</span>
<a name="l01914"></a>01914 <span class="comment">// would not be part of checked in code</span>
<a name="l01915"></a><a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">01915</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">TableFinder::DisplayColPartitions</a>(<a class="code" href="class_scroll_view.html">ScrollView</a>* win,
<a name="l01916"></a>01916                                        <a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l01917"></a>01917                                        <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> default_color,
<a name="l01918"></a>01918                                        <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> table_color) {
<a name="l01919"></a>01919 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01920"></a>01920 <span class="preprocessor"></span>  <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> color = default_color;
<a name="l01921"></a>01921   <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l01922"></a>01922   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01923"></a>01923     gsearch(grid);
<a name="l01924"></a>01924   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01925"></a>01925   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01926"></a>01926   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01927"></a>01927     color = default_color;
<a name="l01928"></a>01928     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l01929"></a>01929       color = table_color;
<a name="l01930"></a>01930 
<a name="l01931"></a>01931     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01932"></a>01932     <span class="keywordtype">int</span> left_x = box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l01933"></a>01933     <span class="keywordtype">int</span> right_x = box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l01934"></a>01934     <span class="keywordtype">int</span> top_y = box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01935"></a>01935     <span class="keywordtype">int</span> bottom_y = box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01936"></a>01936     win-&gt;<a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">Brush</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a77673d8f27617bcfe50a6ebdd81e8c79">ScrollView::NONE</a>);
<a name="l01937"></a>01937     win-&gt;<a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">Pen</a>(color);
<a name="l01938"></a>01938     win-&gt;<a class="code" href="class_scroll_view.html#ac2a8fdf5d37967ea4a298dc092b6ed0e">Rectangle</a>(left_x, bottom_y, right_x, top_y);
<a name="l01939"></a>01939   }
<a name="l01940"></a>01940   win-&gt;<a class="code" href="class_scroll_view.html#a609e2f95d6421deb558244f5d45cf25a">UpdateWindow</a>();
<a name="l01941"></a>01941 <span class="preprocessor">#endif</span>
<a name="l01942"></a>01942 <span class="preprocessor"></span>}
<a name="l01943"></a><a class="code" href="classtesseract_1_1_table_finder.html#a5bed5a7f636ee305aacc4818933cf3da">01943</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">TableFinder::DisplayColPartitions</a>(<a class="code" href="class_scroll_view.html">ScrollView</a>* win,
<a name="l01944"></a>01944                                        <a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l01945"></a>01945                                        <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> default_color) {
<a name="l01946"></a>01946   <a class="code" href="classtesseract_1_1_table_finder.html#aea205753ca3f6e11043801843025e59e">DisplayColPartitions</a>(win, grid, default_color, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a61dec9bc0aaf1d527a731b2a6ce055c8">ScrollView::YELLOW</a>);
<a name="l01947"></a>01947 }
<a name="l01948"></a>01948 
<a name="l01949"></a><a class="code" href="classtesseract_1_1_table_finder.html#ae38774700a97b1690f1530d77432a762">01949</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#ae38774700a97b1690f1530d77432a762">TableFinder::DisplayColPartitionConnections</a>(
<a name="l01950"></a>01950                      <a class="code" href="class_scroll_view.html">ScrollView</a>* win,
<a name="l01951"></a>01951                      <a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l01952"></a>01952                      <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> color) {
<a name="l01953"></a>01953 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01954"></a>01954 <span class="preprocessor"></span>  <span class="comment">// Iterate the ColPartitions in the grid.</span>
<a name="l01955"></a>01955   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l01956"></a>01956     gsearch(grid);
<a name="l01957"></a>01957   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l01958"></a>01958   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01959"></a>01959   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01960"></a>01960     <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01961"></a>01961     <span class="keywordtype">int</span> left_x = box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l01962"></a>01962     <span class="keywordtype">int</span> right_x = box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l01963"></a>01963     <span class="keywordtype">int</span> top_y = box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01964"></a>01964     <span class="keywordtype">int</span> bottom_y = box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01965"></a>01965 
<a name="l01966"></a>01966     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* upper_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4df588400a880c9ac54eea8d1d7c28fb">nearest_neighbor_above</a>();
<a name="l01967"></a>01967     <span class="keywordflow">if</span> (upper_part) {
<a name="l01968"></a>01968       <a class="code" href="class_t_b_o_x.html">TBOX</a> upper_box = upper_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01969"></a>01969       <span class="keywordtype">int</span> mid_x = (left_x + right_x) / 2;
<a name="l01970"></a>01970       <span class="keywordtype">int</span> mid_y = (top_y + bottom_y) / 2;
<a name="l01971"></a>01971       <span class="keywordtype">int</span> other_x = (upper_box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() + upper_box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>()) / 2;
<a name="l01972"></a>01972       <span class="keywordtype">int</span> other_y = (upper_box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() + upper_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>()) / 2;
<a name="l01973"></a>01973       win-&gt;<a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">Brush</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a77673d8f27617bcfe50a6ebdd81e8c79">ScrollView::NONE</a>);
<a name="l01974"></a>01974       win-&gt;<a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">Pen</a>(color);
<a name="l01975"></a>01975       win-&gt;<a class="code" href="class_scroll_view.html#a2ba16f17fc401bb28be1a08160207e45">Line</a>(mid_x, mid_y, other_x, other_y);
<a name="l01976"></a>01976     }
<a name="l01977"></a>01977     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* lower_part = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a4eac60eb833ebb548ff2409c5999753f">nearest_neighbor_below</a>();
<a name="l01978"></a>01978     <span class="keywordflow">if</span> (lower_part) {
<a name="l01979"></a>01979       <a class="code" href="class_t_b_o_x.html">TBOX</a> lower_box = lower_part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l01980"></a>01980       <span class="keywordtype">int</span> mid_x = (left_x + right_x) / 2;
<a name="l01981"></a>01981       <span class="keywordtype">int</span> mid_y = (top_y + bottom_y) / 2;
<a name="l01982"></a>01982       <span class="keywordtype">int</span> other_x = (lower_box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>() + lower_box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>()) / 2;
<a name="l01983"></a>01983       <span class="keywordtype">int</span> other_y = (lower_box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() + lower_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>()) / 2;
<a name="l01984"></a>01984       win-&gt;<a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">Brush</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a77673d8f27617bcfe50a6ebdd81e8c79">ScrollView::NONE</a>);
<a name="l01985"></a>01985       win-&gt;<a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">Pen</a>(color);
<a name="l01986"></a>01986       win-&gt;<a class="code" href="class_scroll_view.html#a2ba16f17fc401bb28be1a08160207e45">Line</a>(mid_x, mid_y, other_x, other_y);
<a name="l01987"></a>01987     }
<a name="l01988"></a>01988   }
<a name="l01989"></a>01989   win-&gt;<a class="code" href="class_scroll_view.html#a609e2f95d6421deb558244f5d45cf25a">UpdateWindow</a>();
<a name="l01990"></a>01990 <span class="preprocessor">#endif</span>
<a name="l01991"></a>01991 <span class="preprocessor"></span>}
<a name="l01992"></a>01992 
<a name="l01993"></a>01993 
<a name="l01994"></a>01994 <span class="comment">// Write debug image and text file.</span>
<a name="l01995"></a>01995 <span class="comment">// Note: This method is only for debug purpose during development and</span>
<a name="l01996"></a>01996 <span class="comment">// would not be part of checked in code</span>
<a name="l01997"></a><a class="code" href="classtesseract_1_1_table_finder.html#abbd932c16cdfa0cf35f9ef93e2e87f49">01997</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#abbd932c16cdfa0cf35f9ef93e2e87f49">TableFinder::WriteToPix</a>(<span class="keyword">const</span> <a class="code" href="class_f_c_o_o_r_d.html">FCOORD</a>&amp; reskew) {
<a name="l01998"></a>01998   <span class="comment">// Input file must be named test1.tif</span>
<a name="l01999"></a>01999   PIX* pix = pixRead(<span class="stringliteral">&quot;test1.tif&quot;</span>);
<a name="l02000"></a>02000   <span class="keywordflow">if</span> (!pix) {
<a name="l02001"></a>02001     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Input file test1.tif not found.\n&quot;</span>);
<a name="l02002"></a>02002     <span class="keywordflow">return</span>;
<a name="l02003"></a>02003   }
<a name="l02004"></a>02004   <span class="keywordtype">int</span> img_height = pixGetHeight(pix);
<a name="l02005"></a>02005   <span class="keywordtype">int</span> img_width = pixGetWidth(pix);
<a name="l02006"></a>02006   <span class="comment">// Maximum number of text or table partitions</span>
<a name="l02007"></a>02007   <span class="keywordtype">int</span> num_boxes = 10;
<a name="l02008"></a>02008   BOXA* text_box_array = boxaCreate(num_boxes);
<a name="l02009"></a>02009   BOXA* table_box_array = boxaCreate(num_boxes);
<a name="l02010"></a>02010   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l02011"></a>02011     gsearch(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aec2f605cdeff11cb17d4cb9aba585b1b">clean_part_grid_</a>);
<a name="l02012"></a>02012   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l02013"></a>02013   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part;
<a name="l02014"></a>02014   <span class="comment">// load colpartitions into text_box_array and table_box_array</span>
<a name="l02015"></a>02015   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02016"></a>02016     <a class="code" href="class_t_b_o_x.html">TBOX</a> box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l02017"></a>02017     box.<a class="code" href="class_t_b_o_x.html#a56b4e1cc91e8abcb9f97622da7468e98">rotate_large</a>(reskew);
<a name="l02018"></a>02018     BOX* lept_box = boxCreate(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), img_height - box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(),
<a name="l02019"></a>02019                               box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>() - box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(),
<a name="l02020"></a>02020                               box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() - box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l02021"></a>02021     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>)
<a name="l02022"></a>02022       boxaAddBox(table_box_array, lept_box, L_INSERT);
<a name="l02023"></a>02023     <span class="keywordflow">else</span>
<a name="l02024"></a>02024       boxaAddBox(text_box_array, lept_box, L_INSERT);
<a name="l02025"></a>02025   }
<a name="l02026"></a>02026   <span class="comment">// draw colpartitions on the output image</span>
<a name="l02027"></a>02027   PIX* out = pixDrawBoxa(pix, text_box_array, 3, 0xff000000);
<a name="l02028"></a>02028   out = pixDrawBoxa(out, table_box_array, 3, 0x0000ff00);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   BOXA* table_array = boxaCreate(num_boxes);
<a name="l02031"></a>02031   <span class="comment">// text file containing detected table bounding boxes</span>
<a name="l02032"></a>02032   FILE* fptr = fopen(<span class="stringliteral">&quot;tess-table.txt&quot;</span>, <span class="stringliteral">&quot;wb&quot;</span>);
<a name="l02033"></a>02033   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l02034"></a>02034       table_search(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l02035"></a>02035   table_search.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l02036"></a>02036   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* table;
<a name="l02037"></a>02037   <span class="comment">// load table boxes to table_array and write them to text file as well</span>
<a name="l02038"></a>02038   <span class="keywordflow">while</span> ((table = table_search.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02039"></a>02039     <a class="code" href="class_t_b_o_x.html">TBOX</a> box = table-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l02040"></a>02040     box.<a class="code" href="class_t_b_o_x.html#a56b4e1cc91e8abcb9f97622da7468e98">rotate_large</a>(reskew);
<a name="l02041"></a>02041     <span class="comment">// Since deskewing introduces negative coordinates, reskewing</span>
<a name="l02042"></a>02042     <span class="comment">// might not completely recover from that since both steps enlarge</span>
<a name="l02043"></a>02043     <span class="comment">// the actual box. Hence a box that undergoes deskewing/reskewing</span>
<a name="l02044"></a>02044     <span class="comment">// may go out of image boundaries. Crop a table box if needed to</span>
<a name="l02045"></a>02045     <span class="comment">// contain it inside the image dimensions.</span>
<a name="l02046"></a>02046     box = box.<a class="code" href="class_t_b_o_x.html#a33e45c7389737cdf1a908bca0af315c4">intersection</a>(<a class="code" href="class_t_b_o_x.html">TBOX</a>(0, 0, img_width - 1, img_height - 1));
<a name="l02047"></a>02047     BOX* lept_box = boxCreate(box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), img_height - box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(),
<a name="l02048"></a>02048                               box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>() - box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(),
<a name="l02049"></a>02049                               box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>() - box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l02050"></a>02050     boxaAddBox(table_array, lept_box, L_INSERT);
<a name="l02051"></a>02051     fprintf(fptr, <span class="stringliteral">&quot;%d %d %d %d TABLE\n&quot;</span>, box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(),
<a name="l02052"></a>02052             img_height - box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(), box.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), img_height - box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l02053"></a>02053   }
<a name="l02054"></a>02054   fclose(fptr);
<a name="l02055"></a>02055   <span class="comment">// paint table boxes on the debug image</span>
<a name="l02056"></a>02056   out = pixDrawBoxa(out, table_array, 5, 0x7fff0000);
<a name="l02057"></a>02057 
<a name="l02058"></a>02058   pixWrite(<span class="stringliteral">&quot;out.png&quot;</span>, out, IFF_PNG);
<a name="l02059"></a>02059   <span class="comment">// memory cleanup</span>
<a name="l02060"></a>02060   boxaDestroy(&amp;text_box_array);
<a name="l02061"></a>02061   boxaDestroy(&amp;table_box_array);
<a name="l02062"></a>02062   boxaDestroy(&amp;table_array);
<a name="l02063"></a>02063   pixDestroy(&amp;pix);
<a name="l02064"></a>02064   pixDestroy(&amp;out);
<a name="l02065"></a>02065 }
<a name="l02066"></a>02066 
<a name="l02067"></a>02067 <span class="comment">// Merge all colpartitions in table regions to make them a single</span>
<a name="l02068"></a>02068 <span class="comment">// colpartition and revert types of isolated table cells not</span>
<a name="l02069"></a>02069 <span class="comment">// assigned to any table to their original types.</span>
<a name="l02070"></a><a class="code" href="classtesseract_1_1_table_finder.html#a1856836a1386196d5784244b4a1aa2d0">02070</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_table_finder.html#a1856836a1386196d5784244b4a1aa2d0">TableFinder::MakeTableBlocks</a>(<a class="code" href="classtesseract_1_1_col_partition_grid.html">ColPartitionGrid</a>* grid,
<a name="l02071"></a>02071                                   <a class="code" href="classtesseract_1_1_col_partition_set.html">ColPartitionSet</a>** all_columns,
<a name="l02072"></a>02072                                   <a class="code" href="class_tess_result_callback1.html">WidthCallback</a>* width_cb) {
<a name="l02073"></a>02073   <span class="comment">// Since we have table blocks already, remove table tags from all</span>
<a name="l02074"></a>02074   <span class="comment">// colpartitions</span>
<a name="l02075"></a>02075   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l02076"></a>02076     gsearch(grid);
<a name="l02077"></a>02077   gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l02078"></a>02078   <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02079"></a>02079 
<a name="l02080"></a>02080   <span class="keywordflow">while</span> ((part = gsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02081"></a>02081     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a32e3f08af42cf1e5ad99118b6fd66df2">type</a>() == <a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a5f41d3730899e22bf30c977bef2bcfa3">PT_TABLE</a>) {
<a name="l02082"></a>02082       part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a548b8797ceca6d820370cabe0711c808">clear_table_type</a>();
<a name="l02083"></a>02083     }
<a name="l02084"></a>02084   }
<a name="l02085"></a>02085   <span class="comment">// Now make a single colpartition out of each table block and remove</span>
<a name="l02086"></a>02086   <span class="comment">// all colpartitions contained within a table</span>
<a name="l02087"></a>02087   <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColSegment, ColSegment_CLIST, ColSegment_C_IT&gt;</a>
<a name="l02088"></a>02088       table_search(&amp;<a class="code" href="classtesseract_1_1_table_finder.html#aba8f5765a3c7bbe13bee05b94308fec1">table_grid_</a>);
<a name="l02089"></a>02089   table_search.<a class="code" href="classtesseract_1_1_grid_search.html#ad7f7e99bcda5e0daeb682b772e445f60">StartFullSearch</a>();
<a name="l02090"></a>02090   <a class="code" href="classtesseract_1_1_col_segment.html">ColSegment</a>* table;
<a name="l02091"></a>02091   <span class="keywordflow">while</span> ((table = table_search.<a class="code" href="classtesseract_1_1_grid_search.html#ae9cd15b1815e744caf0650320aecfc2c">NextFullSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02092"></a>02092     <a class="code" href="class_t_b_o_x.html">TBOX</a> table_box = table-&gt;<a class="code" href="classtesseract_1_1_col_segment.html#a56879c95501a7c25defc6628cdca872c">bounding_box</a>();
<a name="l02093"></a>02093     <span class="comment">// Start a rect search on table_box</span>
<a name="l02094"></a>02094     <a class="code" href="classtesseract_1_1_grid_search.html">GridSearch&lt;ColPartition, ColPartition_CLIST, ColPartition_C_IT&gt;</a>
<a name="l02095"></a>02095         rectsearch(grid);
<a name="l02096"></a>02096     rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ae9661d7b80a279a93a4bdd5ecb347871">StartRectSearch</a>(table_box);
<a name="l02097"></a>02097     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* part;
<a name="l02098"></a>02098     <a class="code" href="classtesseract_1_1_col_partition.html">ColPartition</a>* table_partition = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02099"></a>02099     <span class="keywordflow">while</span> ((part = rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#ab2699cb16c4514663963d2e2aa1dadc3">NextRectSearch</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02100"></a>02100      <span class="comment">// Do not consider image partitions</span>
<a name="l02101"></a>02101       <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aaeb1d34b6b937a9d028f06562c985bd5">IsTextType</a>())
<a name="l02102"></a>02102         <span class="keywordflow">continue</span>;
<a name="l02103"></a>02103       <a class="code" href="class_t_b_o_x.html">TBOX</a> part_box = part-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l02104"></a>02104       <span class="comment">// Include partition in the table if more than half of it</span>
<a name="l02105"></a>02105       <span class="comment">// is covered by the table</span>
<a name="l02106"></a>02106       <span class="keywordflow">if</span> (part_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(table_box) &gt; <a class="code" href="namespacetesseract.html#a0f2ae212b6b475efca7981fd1dc51e29">kMinOverlapWithTable</a>) {
<a name="l02107"></a>02107         rectsearch.<a class="code" href="classtesseract_1_1_grid_search.html#aa6a2166899235a22f58e607786ffd25e">RemoveBBox</a>();
<a name="l02108"></a>02108         <span class="keywordflow">if</span> (table_partition) {
<a name="l02109"></a>02109           table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aedb906fb73709c79d702f0f95a85b300">Absorb</a>(part, width_cb);
<a name="l02110"></a>02110         } <span class="keywordflow">else</span> {
<a name="l02111"></a>02111           table_partition = part;
<a name="l02112"></a>02112         }
<a name="l02113"></a>02113       }
<a name="l02114"></a>02114     }
<a name="l02115"></a>02115     <span class="comment">// Insert table colpartition back to part_grid_</span>
<a name="l02116"></a>02116     <span class="keywordflow">if</span> (table_partition) {
<a name="l02117"></a>02117       <span class="comment">// To match the columns used when transforming to blocks, the new table</span>
<a name="l02118"></a>02118       <span class="comment">// partition must have its first and last column set at the grid y that</span>
<a name="l02119"></a>02119       <span class="comment">// corresponds to its bottom.</span>
<a name="l02120"></a>02120       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; table_box = table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aeb52b4505d6766abfd0a2a3ce92a6596">bounding_box</a>();
<a name="l02121"></a>02121       <span class="keywordtype">int</span> grid_x, grid_y;
<a name="l02122"></a>02122       grid-&gt;<a class="code" href="classtesseract_1_1_grid_base.html#a9cb158bba184d657c51257b98eea9f8f">GridCoords</a>(table_box.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), table_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(), &amp;grid_x, &amp;grid_y);
<a name="l02123"></a>02123       table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#acf8233abc2eb9a0b9cc6f258ddd1d04d">SetPartitionType</a>(<a class="code" href="classtesseract_1_1_table_finder.html#a945f735c68a1f3fe672e759828f36f71">resolution_</a>, all_columns[grid_y]);
<a name="l02124"></a>02124       table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abc55e0535959583318b4ce0271c85da2">set_table_type</a>();
<a name="l02125"></a>02125       table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#a67554d4553f198980b504091557442c7">set_blob_type</a>(<a class="code" href="blobbox_8h.html#aebfaf711760a99b60c297d1d619df575a4f0b1431532d0e838187df32f2e822d7">BRT_TEXT</a>);
<a name="l02126"></a>02126       table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#aff449be10b9bb6e480b65cd1042e38e4">set_flow</a>(<a class="code" href="blobbox_8h.html#aa72f1499398e9694bf46752e1cc895e1a8fa903eb3c633ef681659563769a8007">BTFT_CHAIN</a>);
<a name="l02127"></a>02127       table_partition-&gt;<a class="code" href="classtesseract_1_1_col_partition.html#abfa13ecb273fa29166a663daf82a2254">SetBlobTypes</a>();
<a name="l02128"></a>02128       grid-&gt;<a class="code" href="classtesseract_1_1_b_b_grid.html#a7b379525e3d60c68e583352ae4b8a750">InsertBBox</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, table_partition);
<a name="l02129"></a>02129     }
<a name="l02130"></a>02130   }
<a name="l02131"></a>02131 }
<a name="l02132"></a>02132 
<a name="l02135"></a><a class="code" href="classtesseract_1_1_col_segment.html#a874cf2f3d78f2feb57b0527b3edb9f82">02135</a> <a class="code" href="classtesseract_1_1_col_segment.html#a874cf2f3d78f2feb57b0527b3edb9f82">ColSegment::ColSegment</a>()
<a name="l02136"></a>02136     : <a class="code" href="class_e_l_i_s_t___l_i_n_k.html">ELIST_LINK</a>(),
<a name="l02137"></a>02137       num_table_cells_(0),
<a name="l02138"></a>02138       num_text_cells_(0),
<a name="l02139"></a>02139       type_(<a class="code" href="namespacetesseract.html#a25254b3df45454565d58a62480d3a6cbaee1976dbb59fbd65d366f0424759c729">COL_UNKNOWN</a>) {
<a name="l02140"></a>02140 }
<a name="l02141"></a><a class="code" href="classtesseract_1_1_col_segment.html#a69ec7d6f06f5a6794817f000d778bfb3">02141</a> <a class="code" href="classtesseract_1_1_col_segment.html#a69ec7d6f06f5a6794817f000d778bfb3">ColSegment::~ColSegment</a>() {
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02144"></a>02144 <span class="comment">// Provides a color for BBGrid to draw the rectangle.</span>
<a name="l02145"></a><a class="code" href="classtesseract_1_1_col_segment.html#ac93fb3f8a7db9ad2364fc5850fd959e8">02145</a> <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a>  <a class="code" href="classtesseract_1_1_col_segment.html#ac93fb3f8a7db9ad2364fc5850fd959e8">ColSegment::BoxColor</a>()<span class="keyword"> const </span>{
<a name="l02146"></a>02146   <span class="keyword">const</span> <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">ScrollView::Color</a> kBoxColors[<a class="code" href="publictypes_8h.html#a03566528a98c079dafeebf00502f2b60a1cfce41c30bf1aefe403aaa66d271da1">PT_COUNT</a>] = {
<a name="l02147"></a>02147     <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a61dec9bc0aaf1d527a731b2a6ce055c8">ScrollView::YELLOW</a>,
<a name="l02148"></a>02148     <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>,
<a name="l02149"></a>02149     <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a61dec9bc0aaf1d527a731b2a6ce055c8">ScrollView::YELLOW</a>,
<a name="l02150"></a>02150     <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8aebeaaeee353c6f04b4498b1fef94bbb3">ScrollView::MAGENTA</a>,
<a name="l02151"></a>02151   };
<a name="l02152"></a>02152   <span class="keywordflow">return</span> kBoxColors[type_];
<a name="l02153"></a>02153 }
<a name="l02154"></a>02154 
<a name="l02155"></a>02155 <span class="comment">// Insert a box into this column segment</span>
<a name="l02156"></a><a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">02156</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_col_segment.html#a2d9a6fbd449a9201bdda5b9ffc5a5cb9">ColSegment::InsertBox</a>(<span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; other) {
<a name="l02157"></a>02157   bounding_box_ = bounding_box_.<a class="code" href="class_t_b_o_x.html#ab8ae7b66782fa1802f78ff034da16089">bounding_union</a>(other);
<a name="l02158"></a>02158 }
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 <span class="comment">// Set column segment type based on the ratio of text and table partitions</span>
<a name="l02161"></a>02161 <span class="comment">// in it.</span>
<a name="l02162"></a><a class="code" href="classtesseract_1_1_col_segment.html#a789e1edd90789444e3b420291969b196">02162</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_col_segment.html#a789e1edd90789444e3b420291969b196">ColSegment::set_type</a>() {
<a name="l02163"></a>02163   <span class="keywordflow">if</span> (num_table_cells_ &gt; <a class="code" href="namespacetesseract.html#a6a040ffaa830485299daa5c344ebe039">kTableColumnThreshold</a> * num_text_cells_)
<a name="l02164"></a>02164     type_ = <a class="code" href="namespacetesseract.html#a25254b3df45454565d58a62480d3a6cba8943a61e53229e72f0f896ec8e415316">COL_TABLE</a>;
<a name="l02165"></a>02165   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num_text_cells_ &gt; num_table_cells_)
<a name="l02166"></a>02166     type_ = <a class="code" href="namespacetesseract.html#a25254b3df45454565d58a62480d3a6cba05d5fe5bf814b3e82827a3a321d5b2ec">COL_TEXT</a>;
<a name="l02167"></a>02167   <span class="keywordflow">else</span>
<a name="l02168"></a>02168     type_ = <a class="code" href="namespacetesseract.html#a25254b3df45454565d58a62480d3a6cba794ff16294744099e9bab9ecf2cabc11">COL_MIXED</a>;
<a name="l02169"></a>02169 }
<a name="l02170"></a>02170 
<a name="l02171"></a>02171 }  <span class="comment">// namespace tesseract.</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="tablefind_8cpp.html">tablefind.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Fri Mar 30 2012 17:39:15 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
