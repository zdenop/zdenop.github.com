<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/ccmain/docqual.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('docqual_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/ccmain/docqual.cpp</div>  </div>
</div>
<div class="contents">
<a href="docqual_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * File:        docqual.cpp  (Formerly docqual.c)</span>
<a name="l00003"></a>00003 <span class="comment"> * Description: Document Quality Metrics</span>
<a name="l00004"></a>00004 <span class="comment"> * Author:              Phil Cheatle</span>
<a name="l00005"></a>00005 <span class="comment"> * Created:             Mon May  9 11:27:28 BST 1994</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * (C) Copyright 1994, Hewlett-Packard Ltd.</span>
<a name="l00008"></a>00008 <span class="comment"> ** Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00009"></a>00009 <span class="comment"> ** you may not use this file except in compliance with the License.</span>
<a name="l00010"></a>00010 <span class="comment"> ** You may obtain a copy of the License at</span>
<a name="l00011"></a>00011 <span class="comment"> ** http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00012"></a>00012 <span class="comment"> ** Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment"> ** distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00014"></a>00014 <span class="comment"> ** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment"> ** See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment"> ** limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> **********************************************************************/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#pragma warning(disable:4244)  // Conversion warnings</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="mfcpch_8h.html">mfcpch.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include          &lt;ctype.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include          &quot;<a class="code" href="docqual_8h.html">docqual.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include          &quot;<a class="code" href="tfacep_8h.html">tfacep.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include          &quot;<a class="code" href="reject_8h.html">reject.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include          &quot;<a class="code" href="tesscallback_8h.html">tesscallback.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include          &quot;<a class="code" href="tessvars_8h.html">tessvars.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include          &quot;<a class="code" href="secname_8h.html">secname.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include          &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include          &quot;<a class="code" href="tesseractclass_8h.html">tesseractclass.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">namespace </span>tesseract{
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// A little class to provide the callbacks as we have no pre-bound args.</span>
<a name="l00038"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html">00038</a> <span class="keyword">struct </span><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html">DocQualCallbacks</a> {
<a name="l00039"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#afcbe06fefeeaee8eb7f00b8e90a2d769">00039</a>   <span class="keyword">explicit</span> <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#afcbe06fefeeaee8eb7f00b8e90a2d769">DocQualCallbacks</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a>* word0)
<a name="l00040"></a>00040     : <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a06e04c42b1ff2e5ffa24923e9f34e84e">word</a>(word0), <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">match_count</a>(0), <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#af534b546b519077d8dba7b375e6f8f59">accepted_match_count</a>(0) {}
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a5f143209a4192b1872e2e2430d78e29a">00042</a>   <span class="keywordtype">void</span> <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a5f143209a4192b1872e2e2430d78e29a">CountMatchingBlobs</a>(<span class="keywordtype">int</span> index) {
<a name="l00043"></a>00043     ++<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">match_count</a>;
<a name="l00044"></a>00044   }
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a7fb05da0218e4e94705cab1d751c7762">00046</a>   <span class="keywordtype">void</span> <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a7fb05da0218e4e94705cab1d751c7762">CountAcceptedBlobs</a>(<span class="keywordtype">int</span> index) {
<a name="l00047"></a>00047     <span class="keywordflow">if</span> (<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a06e04c42b1ff2e5ffa24923e9f34e84e">word</a>-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[index].accepted())
<a name="l00048"></a>00048       ++<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#af534b546b519077d8dba7b375e6f8f59">accepted_match_count</a>;
<a name="l00049"></a>00049     ++<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">match_count</a>;
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a4b494c625c5aa534c6fa265fb7fe828f">00052</a>   <span class="keywordtype">void</span> <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a4b494c625c5aa534c6fa265fb7fe828f">AcceptIfGoodQuality</a>(<span class="keywordtype">int</span> index) {
<a name="l00053"></a>00053     <span class="keywordflow">if</span> (<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a06e04c42b1ff2e5ffa24923e9f34e84e">word</a>-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[index].accept_if_good_quality())
<a name="l00054"></a>00054       <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a06e04c42b1ff2e5ffa24923e9f34e84e">word</a>-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[index].setrej_quality_accept();
<a name="l00055"></a>00055   }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a06e04c42b1ff2e5ffa24923e9f34e84e">00057</a>   <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a>* <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a06e04c42b1ff2e5ffa24923e9f34e84e">word</a>;
<a name="l00058"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">00058</a>   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">match_count</a>;
<a name="l00059"></a><a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#af534b546b519077d8dba7b375e6f8f59">00059</a>   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#af534b546b519077d8dba7b375e6f8f59">accepted_match_count</a>;
<a name="l00060"></a>00060 };
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="comment">/*************************************************************************</span>
<a name="l00063"></a>00063 <span class="comment"> * word_blob_quality()</span>
<a name="l00064"></a>00064 <span class="comment"> * How many blobs in the box_word are identical to those of the inword?</span>
<a name="l00065"></a>00065 <span class="comment"> * ASSUME blobs in both initial word and box_word are in ascending order of</span>
<a name="l00066"></a>00066 <span class="comment"> * left hand blob edge.</span>
<a name="l00067"></a>00067 <span class="comment"> *************************************************************************/</span>
<a name="l00068"></a><a class="code" href="classtesseract_1_1_tesseract.html#a70d6e0fcde6ff6f76443e8a206f08783">00068</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="classtesseract_1_1_tesseract.html#a70d6e0fcde6ff6f76443e8a206f08783">Tesseract::word_blob_quality</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word, <a class="code" href="class_r_o_w.html">ROW</a> *row) {
<a name="l00069"></a>00069   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af171e37da16ed628bf4516e9f934dc08">bln_boxes</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l00070"></a>00070       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00071"></a>00071     <span class="keywordflow">return</span> 0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073   <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html">DocQualCallbacks</a> cb(word);
<a name="l00074"></a>00074   word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af171e37da16ed628bf4516e9f934dc08">bln_boxes</a>-&gt;<a class="code" href="classtesseract_1_1_box_word.html#aabd2c8e3b6f8dda66725754fa034cc8e">ProcessMatchedBlobs</a>(
<a name="l00075"></a>00075       *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>,
<a name="l00076"></a>00076       <a class="code" href="tesscallback_8h.html#ad000c6729bae0f97075ca10a0b5bf7d6">NewPermanentTessCallback</a>(&amp;cb, &amp;<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a5f143209a4192b1872e2e2430d78e29a">DocQualCallbacks::CountMatchingBlobs</a>));
<a name="l00077"></a>00077   <span class="keywordflow">return</span> cb.<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">match_count</a>;
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="classtesseract_1_1_tesseract.html#ace8e2b02f0270dbfe4b7dc05638bfc0d">00080</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="classtesseract_1_1_tesseract.html#ace8e2b02f0270dbfe4b7dc05638bfc0d">Tesseract::word_outline_errs</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word) {
<a name="l00081"></a>00081   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> i = 0;
<a name="l00082"></a>00082   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> err_count = 0;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00085"></a>00085     <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* blob = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00086"></a>00086     <span class="keywordflow">for</span> (; blob != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>) {
<a name="l00087"></a>00087       err_count += <a class="code" href="classtesseract_1_1_tesseract.html#a27dc89a077e5074d22c3c0f9cccb5047">count_outline_errs</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>()[i],
<a name="l00088"></a>00088                                       blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a7cc7be71e17444d728e9c68204bca007">NumOutlines</a>());
<a name="l00089"></a>00089       i++;
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091   }
<a name="l00092"></a>00092   <span class="keywordflow">return</span> err_count;
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/*************************************************************************</span>
<a name="l00096"></a>00096 <span class="comment"> * word_char_quality()</span>
<a name="l00097"></a>00097 <span class="comment"> * Combination of blob quality and outline quality - how many good chars are</span>
<a name="l00098"></a>00098 <span class="comment"> * there? - I.e chars which pass the blob AND outline tests.</span>
<a name="l00099"></a>00099 <span class="comment"> *************************************************************************/</span>
<a name="l00100"></a><a class="code" href="classtesseract_1_1_tesseract.html#a348314a50f786908e27bbaa3733d14d4">00100</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#a348314a50f786908e27bbaa3733d14d4">Tesseract::word_char_quality</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word,
<a name="l00101"></a>00101                                   <a class="code" href="class_r_o_w.html">ROW</a> *row,
<a name="l00102"></a>00102                                   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> *match_count,
<a name="l00103"></a>00103                                   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> *accepted_match_count) {
<a name="l00104"></a>00104   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af171e37da16ed628bf4516e9f934dc08">bln_boxes</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l00105"></a>00105       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00106"></a>00106     <span class="keywordflow">return</span>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html">DocQualCallbacks</a> cb(word);
<a name="l00109"></a>00109   word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af171e37da16ed628bf4516e9f934dc08">bln_boxes</a>-&gt;<a class="code" href="classtesseract_1_1_box_word.html#aabd2c8e3b6f8dda66725754fa034cc8e">ProcessMatchedBlobs</a>(
<a name="l00110"></a>00110       *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>,
<a name="l00111"></a>00111       <a class="code" href="tesscallback_8h.html#ad000c6729bae0f97075ca10a0b5bf7d6">NewPermanentTessCallback</a>(&amp;cb, &amp;<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a7fb05da0218e4e94705cab1d751c7762">DocQualCallbacks::CountAcceptedBlobs</a>));
<a name="l00112"></a>00112   *match_count = cb.<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a0bc1e44f1672adeace51f83874c0d0e2">match_count</a>;
<a name="l00113"></a>00113   *accepted_match_count = cb.<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#af534b546b519077d8dba7b375e6f8f59">accepted_match_count</a>;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">/*************************************************************************</span>
<a name="l00117"></a>00117 <span class="comment"> * unrej_good_chs()</span>
<a name="l00118"></a>00118 <span class="comment"> * Unreject POTENTIAL rejects if the blob passes the blob and outline checks</span>
<a name="l00119"></a>00119 <span class="comment"> *************************************************************************/</span>
<a name="l00120"></a><a class="code" href="classtesseract_1_1_tesseract.html#ab156ed65c76c10dadacfc1121624ebc2">00120</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#ab156ed65c76c10dadacfc1121624ebc2">Tesseract::unrej_good_chs</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word, <a class="code" href="class_r_o_w.html">ROW</a> *row) {
<a name="l00121"></a>00121   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af171e37da16ed628bf4516e9f934dc08">bln_boxes</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l00122"></a>00122       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00123"></a>00123     <span class="keywordflow">return</span>;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <a class="code" href="structtesseract_1_1_doc_qual_callbacks.html">DocQualCallbacks</a> cb(word);
<a name="l00126"></a>00126   word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af171e37da16ed628bf4516e9f934dc08">bln_boxes</a>-&gt;<a class="code" href="classtesseract_1_1_box_word.html#aabd2c8e3b6f8dda66725754fa034cc8e">ProcessMatchedBlobs</a>(
<a name="l00127"></a>00127       *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>,
<a name="l00128"></a>00128       <a class="code" href="tesscallback_8h.html#ad000c6729bae0f97075ca10a0b5bf7d6">NewPermanentTessCallback</a>(&amp;cb, &amp;<a class="code" href="structtesseract_1_1_doc_qual_callbacks.html#a4b494c625c5aa534c6fa265fb7fe828f">DocQualCallbacks::AcceptIfGoodQuality</a>));
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="classtesseract_1_1_tesseract.html#a27dc89a077e5074d22c3c0f9cccb5047">00131</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="classtesseract_1_1_tesseract.html#a27dc89a077e5074d22c3c0f9cccb5047">Tesseract::count_outline_errs</a>(<span class="keywordtype">char</span> c, <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> outline_count) {
<a name="l00132"></a>00132   <span class="keywordtype">int</span> expected_outline_count;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="keywordflow">if</span> (<a class="code" href="class_s_t_r_i_n_g.html">STRING</a> (<a class="code" href="classtesseract_1_1_tesseract.html#a6c17b9a72b83394d218773f9a297b77a">outlines_odd</a>).contains (c))
<a name="l00135"></a>00135     <span class="keywordflow">return</span> 0;                    <span class="comment">//Dont use this char</span>
<a name="l00136"></a>00136   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_s_t_r_i_n_g.html">STRING</a> (<a class="code" href="classtesseract_1_1_tesseract.html#acb4b01dca8f419468e5ccf97c451e7cf">outlines_2</a>).contains (c))
<a name="l00137"></a>00137     expected_outline_count = 2;
<a name="l00138"></a>00138   <span class="keywordflow">else</span>
<a name="l00139"></a>00139     expected_outline_count = 1;
<a name="l00140"></a>00140   <span class="keywordflow">return</span> abs (outline_count - expected_outline_count);
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="classtesseract_1_1_tesseract.html#a04a98a9da10e23072f55bc39ec88a12c">00143</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#a04a98a9da10e23072f55bc39ec88a12c">Tesseract::quality_based_rejection</a>(<a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> &amp;page_res_it,
<a name="l00144"></a>00144                                         <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> good_quality_doc) {
<a name="l00145"></a>00145   <span class="keywordflow">if</span> ((<a class="code" href="classtesseract_1_1_tesseract.html#ab72bc025f4efb212ec99ee21091d7f10">tessedit_good_quality_unrej</a> &amp;&amp; good_quality_doc))
<a name="l00146"></a>00146     <a class="code" href="classtesseract_1_1_tesseract.html#af247aff07d2cc55480e36f278c5a76a8">unrej_good_quality_words</a>(page_res_it);
<a name="l00147"></a>00147   <a class="code" href="classtesseract_1_1_tesseract.html#a72b538b58cc5af58b35a390c50086ab5">doc_and_block_rejection</a>(page_res_it, good_quality_doc);
<a name="l00148"></a>00148   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a8a848e8a83e73f182d0ef7324afc741f">unlv_tilde_crunching</a>) {
<a name="l00149"></a>00149     <a class="code" href="classtesseract_1_1_tesseract.html#a2c77d5d94321d7fc717b5376bcb02b79">tilde_crunch</a>(page_res_it);
<a name="l00150"></a>00150     <a class="code" href="classtesseract_1_1_tesseract.html#a06a8ab9064d4c6da290c82e7adf53a8c">tilde_delete</a>(page_res_it);
<a name="l00151"></a>00151   }
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">/*************************************************************************</span>
<a name="l00156"></a>00156 <span class="comment"> * unrej_good_quality_words()</span>
<a name="l00157"></a>00157 <span class="comment"> * Accept potential rejects in words which pass the following checks:</span>
<a name="l00158"></a>00158 <span class="comment"> *    - Contains a potential reject</span>
<a name="l00159"></a>00159 <span class="comment"> *    - Word looks like a sensible alpha word.</span>
<a name="l00160"></a>00160 <span class="comment"> *    - Word segmentation is the same as the original image</span>
<a name="l00161"></a>00161 <span class="comment"> *              - All characters have the expected number of outlines</span>
<a name="l00162"></a>00162 <span class="comment"> * NOTE - the rejection counts are recalculated after unrejection</span>
<a name="l00163"></a>00163 <span class="comment"> *      - CANT do it in a single pass without a bit of fiddling</span>
<a name="l00164"></a>00164 <span class="comment"> *              - keep it simple but inefficient</span>
<a name="l00165"></a>00165 <span class="comment"> *************************************************************************/</span>
<a name="l00166"></a><a class="code" href="classtesseract_1_1_tesseract.html#af247aff07d2cc55480e36f278c5a76a8">00166</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#af247aff07d2cc55480e36f278c5a76a8">Tesseract::unrej_good_quality_words</a>(  <span class="comment">//unreject potential</span>
<a name="l00167"></a>00167                                          <a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> &amp;page_res_it) {
<a name="l00168"></a>00168   <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word;
<a name="l00169"></a>00169   <a class="code" href="class_r_o_w___r_e_s.html">ROW_RES</a> *current_row;
<a name="l00170"></a>00170   <a class="code" href="class_b_l_o_c_k___r_e_s.html">BLOCK_RES</a> *current_block;
<a name="l00171"></a>00171   <span class="keywordtype">int</span> i;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a15febd45d0904bb3c5f7d506368177f0">restart_page</a> ();
<a name="l00174"></a>00174   <span class="keywordflow">while</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> () != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00175"></a>00175     <a class="code" href="classtesseract_1_1_tesseract.html#a0751722a5b26971d680f2d23c6e65b95">check_debug_pt</a> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> (), 100);
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a40dee9aa1298b5edcd042b9ec45aeb59">bland_unrej</a>) {
<a name="l00177"></a>00177       word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> ();
<a name="l00178"></a>00178       <span class="keywordflow">for</span> (i = 0; i &lt; word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a> (); i++) {
<a name="l00179"></a>00179         <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[i].accept_if_good_quality ())
<a name="l00180"></a>00180           word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[i].setrej_quality_accept ();
<a name="l00181"></a>00181       }
<a name="l00182"></a>00182       page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ()-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a> &gt; 0) &amp;&amp;
<a name="l00185"></a>00185       ((page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ()-&gt;<a class="code" href="class_r_o_w___r_e_s.html#afe7c692eeef6f934ef1c3bd208dd115c">rej_count</a> /
<a name="l00186"></a>00186       (float) page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ()-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a>) &lt;=
<a name="l00187"></a>00187     <a class="code" href="classtesseract_1_1_tesseract.html#a4a2be7907ac8c08a04d704b316b2ee1c">quality_rowrej_pc</a>)) {
<a name="l00188"></a>00188       word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> ();
<a name="l00189"></a>00189       <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#aabdc95245f033b2e393eccf79d4641e5">quality_recoverable_rejects</a>() &amp;&amp;
<a name="l00190"></a>00190           (<a class="code" href="classtesseract_1_1_tesseract.html#aec01ad16a705e92500c6dc8f209ab9f8">tessedit_unrej_any_wd</a> ||
<a name="l00191"></a>00191            <a class="code" href="classtesseract_1_1_tesseract.html#a51f2ad8b2d849d90bbcfbfca3067c0f1">acceptable_word_string</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>,
<a name="l00192"></a>00192                                   word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(),
<a name="l00193"></a>00193                                   word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a93ab94b6fa6d5c0469fb52d66c62968c">unichar_lengths</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>())
<a name="l00194"></a>00194                != <a class="code" href="control_8h.html#af9ff5a7d7a1b9eeea7ce4106bffa7eeeaab0741a5a5ff9757ca343af255353ba0" title="Unacceptable word.">AC_UNACCEPTABLE</a>)) {
<a name="l00195"></a>00195         <a class="code" href="classtesseract_1_1_tesseract.html#ab156ed65c76c10dadacfc1121624ebc2">unrej_good_chs</a>(word, page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ()-&gt;<a class="code" href="class_r_o_w___r_e_s.html#ad3a856f3e9217c47b8f2f54cd3908721">row</a>);
<a name="l00196"></a>00196       }
<a name="l00197"></a>00197       page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199     <span class="keywordflow">else</span> {
<a name="l00200"></a>00200       <span class="comment">/* Skip to end of dodgy row */</span>
<a name="l00201"></a>00201       current_row = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ();
<a name="l00202"></a>00202       <span class="keywordflow">while</span> ((page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> () != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;
<a name="l00203"></a>00203         (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> () == current_row))
<a name="l00204"></a>00204         page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206     <a class="code" href="classtesseract_1_1_tesseract.html#a0751722a5b26971d680f2d23c6e65b95">check_debug_pt</a> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> (), 110);
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a15febd45d0904bb3c5f7d506368177f0">restart_page</a> ();
<a name="l00209"></a>00209   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a489c2f236ddd8271ce74950abb2d0881">char_count</a> = 0;
<a name="l00210"></a>00210   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a173220902fa987fe73708fae5f2c9560">rej_count</a> = 0;
<a name="l00211"></a>00211   current_block = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00212"></a>00212   current_row = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00213"></a>00213   <span class="keywordflow">while</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> () != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (current_block != page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a> ()) {
<a name="l00215"></a>00215       current_block = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a> ();
<a name="l00216"></a>00216       current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a9b394a8aa95834346c8bc02f0493933b">char_count</a> = 0;
<a name="l00217"></a>00217       current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a508dffc62c4a514859372e0a9a6530ca">rej_count</a> = 0;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     <span class="keywordflow">if</span> (current_row != page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ()) {
<a name="l00220"></a>00220       current_row = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> ();
<a name="l00221"></a>00221       current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a> = 0;
<a name="l00222"></a>00222       current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#afe7c692eeef6f934ef1c3bd208dd115c">rej_count</a> = 0;
<a name="l00223"></a>00223       current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aee04e075058db382613b9fd2d6302d1a">whole_word_rej_count</a> = 0;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a1d1af03a63da4b7f551770e07ca86414">rej_stat_word</a> ();
<a name="l00226"></a>00226     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00227"></a>00227   }
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">/*************************************************************************</span>
<a name="l00232"></a>00232 <span class="comment"> * doc_and_block_rejection()</span>
<a name="l00233"></a>00233 <span class="comment"> *</span>
<a name="l00234"></a>00234 <span class="comment"> * If the page has too many rejects - reject all of it.</span>
<a name="l00235"></a>00235 <span class="comment"> * If any block has too many rejects - reject all words in the block</span>
<a name="l00236"></a>00236 <span class="comment"> *************************************************************************/</span>
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="classtesseract_1_1_tesseract.html#a72b538b58cc5af58b35a390c50086ab5">00238</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#a72b538b58cc5af58b35a390c50086ab5">Tesseract::doc_and_block_rejection</a>(  <span class="comment">//reject big chunks</span>
<a name="l00239"></a>00239                                         <a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> &amp;page_res_it,
<a name="l00240"></a>00240                                         <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> good_quality_doc) {
<a name="l00241"></a>00241   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> block_no = 0;
<a name="l00242"></a>00242   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> row_no = 0;
<a name="l00243"></a>00243   <a class="code" href="class_b_l_o_c_k___r_e_s.html">BLOCK_RES</a> *current_block;
<a name="l00244"></a>00244   <a class="code" href="class_r_o_w___r_e_s.html">ROW_RES</a> *current_row;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> rej_word;
<a name="l00247"></a>00247   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> prev_word_rejected;
<a name="l00248"></a>00248   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> char_quality = 0;
<a name="l00249"></a>00249   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> accepted_char_quality;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="keywordflow">if</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a173220902fa987fe73708fae5f2c9560">rej_count</a> * 100.0 /
<a name="l00252"></a>00252       page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a489c2f236ddd8271ce74950abb2d0881">char_count</a> &gt; <a class="code" href="classtesseract_1_1_tesseract.html#a0c689f16fb64963ca30f7b0fddbea414">tessedit_reject_doc_percent</a>) {
<a name="l00253"></a>00253     <a class="code" href="docqual_8cpp.html#a1b9934928e2b953ee5e91abb58cf043f">reject_whole_page</a>(page_res_it);
<a name="l00254"></a>00254     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a9771a56b87e31325c043fa195d6885ec">tessedit_debug_doc_rejection</a>) {
<a name="l00255"></a>00255       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;REJECT ALL #chars: %d #Rejects: %d; \n&quot;</span>,
<a name="l00256"></a>00256               page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a489c2f236ddd8271ce74950abb2d0881">char_count</a>,
<a name="l00257"></a>00257               page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a173220902fa987fe73708fae5f2c9560">rej_count</a>);
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259   } <span class="keywordflow">else</span> {
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a9771a56b87e31325c043fa195d6885ec">tessedit_debug_doc_rejection</a>) {
<a name="l00261"></a>00261       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;NO PAGE REJECTION #chars: %d  # Rejects: %d; \n&quot;</span>,
<a name="l00262"></a>00262               page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a489c2f236ddd8271ce74950abb2d0881">char_count</a>,
<a name="l00263"></a>00263               page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a173220902fa987fe73708fae5f2c9560">rej_count</a>);
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">/* Walk blocks testing for block rejection */</span>
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a15febd45d0904bb3c5f7d506368177f0">restart_page</a>();
<a name="l00269"></a>00269     <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a>* word;
<a name="l00270"></a>00270     <span class="keywordflow">while</span> ((word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00271"></a>00271       current_block = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a>();
<a name="l00272"></a>00272       block_no = current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#ae7c240d4878247ebdfe78433446751bf">block</a>-&gt;<a class="code" href="class_p_d_b_l_k.html#acc3cf97b51fa93a659312c966df4a756">index</a>();
<a name="l00273"></a>00273       <span class="keywordflow">if</span> (current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a9b394a8aa95834346c8bc02f0493933b">char_count</a> &gt; 0 &amp;&amp;
<a name="l00274"></a>00274           (current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a508dffc62c4a514859372e0a9a6530ca">rej_count</a> * 100.0 / current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a9b394a8aa95834346c8bc02f0493933b">char_count</a>) &gt;
<a name="l00275"></a>00275            <a class="code" href="classtesseract_1_1_tesseract.html#ae1f650e4873b5842f2ae57a3055868c9">tessedit_reject_block_percent</a>) {
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#afe2ceb83896ec93f0add94703dee79ce">tessedit_debug_block_rejection</a>) {
<a name="l00277"></a>00277           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;REJECTING BLOCK %d  #chars: %d;  #Rejects: %d\n&quot;</span>,
<a name="l00278"></a>00278                   block_no, current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a9b394a8aa95834346c8bc02f0493933b">char_count</a>,
<a name="l00279"></a>00279                   current_block-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a508dffc62c4a514859372e0a9a6530ca">rej_count</a>);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         prev_word_rejected = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00282"></a>00282         <span class="keywordflow">while</span> ((word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00283"></a>00283                (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a>() == current_block)) {
<a name="l00284"></a>00284           <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#acf0428aa8b6b2390e5ba2c5f185b7f49">tessedit_preserve_blk_rej_perfect_wds</a>) {
<a name="l00285"></a>00285             rej_word = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ac8e3f1806f06dfb616d76f68f1b96bc6">reject_count</a>() &gt; 0 ||
<a name="l00286"></a>00286                 word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a> () &lt; <a class="code" href="classtesseract_1_1_tesseract.html#a98362ec97923314723dbeb56fd2528fd">tessedit_preserve_min_wd_len</a>;
<a name="l00287"></a>00287             <span class="keywordflow">if</span> (rej_word &amp;&amp; <a class="code" href="classtesseract_1_1_tesseract.html#a00cc24fc46a2c217ff7e614f4ac0db39">tessedit_dont_blkrej_good_wds</a> &amp;&amp;
<a name="l00288"></a>00288                 word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>() &gt;= <a class="code" href="classtesseract_1_1_tesseract.html#a98362ec97923314723dbeb56fd2528fd">tessedit_preserve_min_wd_len</a> &amp;&amp;
<a name="l00289"></a>00289                 <a class="code" href="classtesseract_1_1_tesseract.html#a51f2ad8b2d849d90bbcfbfca3067c0f1">acceptable_word_string</a>(
<a name="l00290"></a>00290                     *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>,
<a name="l00291"></a>00291                     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(),
<a name="l00292"></a>00292                     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a93ab94b6fa6d5c0469fb52d66c62968c">unichar_lengths</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>()) !=
<a name="l00293"></a>00293                 <a class="code" href="control_8h.html#af9ff5a7d7a1b9eeea7ce4106bffa7eeeaab0741a5a5ff9757ca343af255353ba0" title="Unacceptable word.">AC_UNACCEPTABLE</a>) {
<a name="l00294"></a>00294               <a class="code" href="classtesseract_1_1_tesseract.html#a348314a50f786908e27bbaa3733d14d4">word_char_quality</a>(word, page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a>()-&gt;<a class="code" href="class_r_o_w___r_e_s.html#ad3a856f3e9217c47b8f2f54cd3908721">row</a>,
<a name="l00295"></a>00295                                 &amp;char_quality,
<a name="l00296"></a>00296                                 &amp;accepted_char_quality);
<a name="l00297"></a>00297               rej_word = char_quality !=  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>();
<a name="l00298"></a>00298             }
<a name="l00299"></a>00299           } <span class="keywordflow">else</span> {
<a name="l00300"></a>00300             rej_word = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00301"></a>00301           }
<a name="l00302"></a>00302           <span class="keywordflow">if</span> (rej_word) {
<a name="l00303"></a>00303             <span class="comment">/*</span>
<a name="l00304"></a>00304 <span class="comment">              Reject spacing if both current and prev words are rejected.</span>
<a name="l00305"></a>00305 <span class="comment">              NOTE - this is NOT restricted to FUZZY spaces. - When tried this</span>
<a name="l00306"></a>00306 <span class="comment">              generated more space errors.</span>
<a name="l00307"></a>00307 <span class="comment">            */</span>
<a name="l00308"></a>00308             <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#aad38132f39f060b3bf998f316abb4d76">tessedit_use_reject_spaces</a> &amp;&amp;
<a name="l00309"></a>00309                 prev_word_rejected &amp;&amp;
<a name="l00310"></a>00310                 page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a67bcb98908ab79b0a00e1d0823208a23">prev_row</a>() == page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a>() &amp;&amp;
<a name="l00311"></a>00311                 word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#afc15fa7c1b5ad55d6772dea0d6865df1">word</a>-&gt;<a class="code" href="class_w_e_r_d.html#ab2979974cf23f5c66f4e77cc51f2e189">space</a>() == 1)
<a name="l00312"></a>00312               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a6164dbe5d7d34658c64682be24ea257a">reject_spaces</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00313"></a>00313             word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#aa86752e4e9277f2a616df08459ea08e3">rej_word_block_rej</a>();
<a name="l00314"></a>00314           }
<a name="l00315"></a>00315           prev_word_rejected = rej_word;
<a name="l00316"></a>00316           page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a>();
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318       } <span class="keywordflow">else</span> {
<a name="l00319"></a>00319         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#afe2ceb83896ec93f0add94703dee79ce">tessedit_debug_block_rejection</a>) {
<a name="l00320"></a>00320           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;NOT REJECTING BLOCK %d #chars: %d  # Rejects: %d; \n&quot;</span>,
<a name="l00321"></a>00321                   block_no, page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a>()-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a9b394a8aa95834346c8bc02f0493933b">char_count</a>,
<a name="l00322"></a>00322                   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a>()-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#a508dffc62c4a514859372e0a9a6530ca">rej_count</a>);
<a name="l00323"></a>00323         }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325         <span class="comment">/* Walk rows in block testing for row rejection */</span>
<a name="l00326"></a>00326         row_no = 0;
<a name="l00327"></a>00327         <span class="keywordflow">while</span> ((word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00328"></a>00328                page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a>() == current_block) {
<a name="l00329"></a>00329           current_row = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a>();
<a name="l00330"></a>00330           row_no++;
<a name="l00331"></a>00331           <span class="comment">/* Reject whole row if:</span>
<a name="l00332"></a>00332 <span class="comment">            fraction of chars on row which are rejected exceed a limit AND</span>
<a name="l00333"></a>00333 <span class="comment">            fraction rejects which occur in WHOLE WERD rejects is LESS THAN a</span>
<a name="l00334"></a>00334 <span class="comment">            limit</span>
<a name="l00335"></a>00335 <span class="comment">          */</span>
<a name="l00336"></a>00336           <span class="keywordflow">if</span> (current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a> &gt; 0 &amp;&amp;
<a name="l00337"></a>00337               (current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#afe7c692eeef6f934ef1c3bd208dd115c">rej_count</a> * 100.0 / current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a>) &gt;
<a name="l00338"></a>00338               <a class="code" href="classtesseract_1_1_tesseract.html#a73cfd99b1d3cd76679efa1a19a4e1d1a">tessedit_reject_row_percent</a> &amp;&amp;
<a name="l00339"></a>00339               (current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aee04e075058db382613b9fd2d6302d1a">whole_word_rej_count</a> * 100.0 /
<a name="l00340"></a>00340                   current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#afe7c692eeef6f934ef1c3bd208dd115c">rej_count</a>) &lt;
<a name="l00341"></a>00341               <a class="code" href="classtesseract_1_1_tesseract.html#a7124d6d656fc163de05f88b6e31e9681">tessedit_whole_wd_rej_row_percent</a>) {
<a name="l00342"></a>00342             <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#afe2ceb83896ec93f0add94703dee79ce">tessedit_debug_block_rejection</a>) {
<a name="l00343"></a>00343               <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;REJECTING ROW %d  #chars: %d;  #Rejects: %d\n&quot;</span>,
<a name="l00344"></a>00344                       row_no, current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a>,
<a name="l00345"></a>00345                       current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#afe7c692eeef6f934ef1c3bd208dd115c">rej_count</a>);
<a name="l00346"></a>00346             }
<a name="l00347"></a>00347             prev_word_rejected = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00348"></a>00348             <span class="keywordflow">while</span> ((word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00349"></a>00349                    page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a> () == current_row) {
<a name="l00350"></a>00350               <span class="comment">/* Preserve words on good docs unless they are mostly rejected*/</span>
<a name="l00351"></a>00351               <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_tesseract.html#ade40da20d4ed20ac262fb25b50757623">tessedit_row_rej_good_docs</a> &amp;&amp; good_quality_doc) {
<a name="l00352"></a>00352                 rej_word = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ac8e3f1806f06dfb616d76f68f1b96bc6">reject_count</a>() /
<a name="l00353"></a>00353                     <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>()) &gt;
<a name="l00354"></a>00354                     <a class="code" href="classtesseract_1_1_tesseract.html#afe905eb6b5f607815ccff87755af5d30">tessedit_good_doc_still_rowrej_wd</a>;
<a name="l00355"></a>00355               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a1ac173c27cc204ef8efa50dc7476296a">tessedit_preserve_row_rej_perfect_wds</a>) {
<a name="l00356"></a>00356                 <span class="comment">/* Preserve perfect words anyway */</span>
<a name="l00357"></a>00357                 rej_word = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ac8e3f1806f06dfb616d76f68f1b96bc6">reject_count</a>() &gt; 0 ||
<a name="l00358"></a>00358                     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a> () &lt; <a class="code" href="classtesseract_1_1_tesseract.html#a98362ec97923314723dbeb56fd2528fd">tessedit_preserve_min_wd_len</a>;
<a name="l00359"></a>00359                 <span class="keywordflow">if</span> (rej_word &amp;&amp; <a class="code" href="classtesseract_1_1_tesseract.html#a1ede84f4a4f39a9b6f5376ea36907b98">tessedit_dont_rowrej_good_wds</a> &amp;&amp;
<a name="l00360"></a>00360                     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>() &gt;= <a class="code" href="classtesseract_1_1_tesseract.html#a98362ec97923314723dbeb56fd2528fd">tessedit_preserve_min_wd_len</a> &amp;&amp;
<a name="l00361"></a>00361                     <a class="code" href="classtesseract_1_1_tesseract.html#a51f2ad8b2d849d90bbcfbfca3067c0f1">acceptable_word_string</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>,
<a name="l00362"></a>00362                         word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(),
<a name="l00363"></a>00363                         word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a93ab94b6fa6d5c0469fb52d66c62968c">unichar_lengths</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>()) !=
<a name="l00364"></a>00364                             <a class="code" href="control_8h.html#af9ff5a7d7a1b9eeea7ce4106bffa7eeeaab0741a5a5ff9757ca343af255353ba0" title="Unacceptable word.">AC_UNACCEPTABLE</a>) {
<a name="l00365"></a>00365                   <a class="code" href="classtesseract_1_1_tesseract.html#a348314a50f786908e27bbaa3733d14d4">word_char_quality</a>(word, page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a>()-&gt;<a class="code" href="class_r_o_w___r_e_s.html#ad3a856f3e9217c47b8f2f54cd3908721">row</a>,
<a name="l00366"></a>00366                                     &amp;char_quality,
<a name="l00367"></a>00367                                     &amp;accepted_char_quality);
<a name="l00368"></a>00368                   rej_word = char_quality != word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>();
<a name="l00369"></a>00369                 }
<a name="l00370"></a>00370               } <span class="keywordflow">else</span> {
<a name="l00371"></a>00371                 rej_word = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00372"></a>00372               }
<a name="l00373"></a>00373               <span class="keywordflow">if</span> (rej_word) {
<a name="l00374"></a>00374                 <span class="comment">/*</span>
<a name="l00375"></a>00375 <span class="comment">                  Reject spacing if both current and prev words are rejected.</span>
<a name="l00376"></a>00376 <span class="comment">                  NOTE - this is NOT restricted to FUZZY spaces. - When tried</span>
<a name="l00377"></a>00377 <span class="comment">                  this generated more space errors.</span>
<a name="l00378"></a>00378 <span class="comment">                */</span>
<a name="l00379"></a>00379                 <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#aad38132f39f060b3bf998f316abb4d76">tessedit_use_reject_spaces</a> &amp;&amp;
<a name="l00380"></a>00380                     prev_word_rejected &amp;&amp;
<a name="l00381"></a>00381                     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a67bcb98908ab79b0a00e1d0823208a23">prev_row</a>() == page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a>() &amp;&amp;
<a name="l00382"></a>00382                     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#afc15fa7c1b5ad55d6772dea0d6865df1">word</a>-&gt;<a class="code" href="class_w_e_r_d.html#ab2979974cf23f5c66f4e77cc51f2e189">space</a> () == 1)
<a name="l00383"></a>00383                   word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a6164dbe5d7d34658c64682be24ea257a">reject_spaces</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00384"></a>00384                 word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#a03037d4a12a4ea33a377cf21c9400139">rej_word_row_rej</a>();
<a name="l00385"></a>00385               }
<a name="l00386"></a>00386               prev_word_rejected = rej_word;
<a name="l00387"></a>00387               page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a>();
<a name="l00388"></a>00388             }
<a name="l00389"></a>00389           } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390             <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#afe2ceb83896ec93f0add94703dee79ce">tessedit_debug_block_rejection</a>) {
<a name="l00391"></a>00391               <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;NOT REJECTING ROW %d #chars: %d  # Rejects: %d; \n&quot;</span>,
<a name="l00392"></a>00392                       row_no, current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#aad86ecebb53eb63c4038c5a95d932eea">char_count</a>, current_row-&gt;<a class="code" href="class_r_o_w___r_e_s.html#afe7c692eeef6f934ef1c3bd208dd115c">rej_count</a>);
<a name="l00393"></a>00393             }
<a name="l00394"></a>00394             <span class="keywordflow">while</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>() != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00395"></a>00395                    page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a312f58081e9410962396160eaf5f90e4">row</a>() == current_row)
<a name="l00396"></a>00396               page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a>();
<a name="l00397"></a>00397           }
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399       }
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401   }
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 }  <span class="comment">// namespace tesseract</span>
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="comment">/*************************************************************************</span>
<a name="l00408"></a>00408 <span class="comment"> * reject_whole_page()</span>
<a name="l00409"></a>00409 <span class="comment"> * Dont believe any of it - set the reject map to 00..00 in all words</span>
<a name="l00410"></a>00410 <span class="comment"> *</span>
<a name="l00411"></a>00411 <span class="comment"> *************************************************************************/</span>
<a name="l00412"></a>00412 
<a name="l00413"></a><a class="code" href="docqual_8h.html#a1b9934928e2b953ee5e91abb58cf043f">00413</a> <span class="keywordtype">void</span> <a class="code" href="docqual_8cpp.html#a1b9934928e2b953ee5e91abb58cf043f">reject_whole_page</a>(<a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> &amp;page_res_it) {
<a name="l00414"></a>00414   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a15febd45d0904bb3c5f7d506368177f0">restart_page</a> ();
<a name="l00415"></a>00415   <span class="keywordflow">while</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> () != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00416"></a>00416     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> ()-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#a9fb4a691f24ea06370b55650c197db8b">rej_word_doc_rej</a> ();
<a name="l00417"></a>00417     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00418"></a>00418   }
<a name="l00419"></a>00419                                  <span class="comment">//whole page is rejected</span>
<a name="l00420"></a>00420   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#aab221a373111c4be685444b5633e22a5">page_res</a>-&gt;<a class="code" href="class_p_a_g_e___r_e_s.html#a65ed9c199c2ef8b3dc464225ad893e7d">rejected</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="keyword">namespace </span>tesseract {
<a name="l00424"></a><a class="code" href="classtesseract_1_1_tesseract.html#a2c77d5d94321d7fc717b5376bcb02b79">00424</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#a2c77d5d94321d7fc717b5376bcb02b79">Tesseract::tilde_crunch</a>(<a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> &amp;page_res_it) {
<a name="l00425"></a>00425   <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word;
<a name="l00426"></a>00426   <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42">GARBAGE_LEVEL</a> garbage_level;
<a name="l00427"></a>00427   <a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> copy_it;
<a name="l00428"></a>00428   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> prev_potential_marked = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00429"></a>00429   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> found_terrible_word = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00430"></a>00430   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> ok_dict_word;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a15febd45d0904bb3c5f7d506368177f0">restart_page</a>();
<a name="l00433"></a>00433   <span class="keywordflow">while</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>() != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00434"></a>00434     <a class="code" href="class_p_o_l_y___b_l_o_c_k.html">POLY_BLOCK</a>* pb = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a8a349c5163802e1f127d5c88db044059">block</a>()-&gt;<a class="code" href="class_b_l_o_c_k___r_e_s.html#ae7c240d4878247ebdfe78433446751bf">block</a>-&gt;<a class="code" href="class_p_d_b_l_k.html#a6670779c69aca2d574e4a0590d9b3939">poly_block</a>();
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (pb != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; !pb-&gt;<a class="code" href="class_p_o_l_y___b_l_o_c_k.html#abd32dee532afe634cdbacffc0b53e660">IsText</a>()) {
<a name="l00436"></a>00436       page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a>();
<a name="l00437"></a>00437       <span class="keywordflow">continue</span>;
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439     word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>();
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a49a94ed873a2ddeea43f4b12a8774222">crunch_early_convert_bad_unlv_chs</a>)
<a name="l00442"></a>00442       <a class="code" href="classtesseract_1_1_tesseract.html#a81b3e2c28a090f5a877dd0f67a4080b6">convert_bad_unlv_chs</a>(word);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#aefd718b3d3abe04fba6ff083019f8374">crunch_early_merge_tess_fails</a>)
<a name="l00445"></a>00445       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af092edf58a4a718687aa35c6a458cada">merge_tess_fails</a>();
<a name="l00446"></a>00446 
<a name="l00447"></a>00447     <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#aec0cef1513cd939f0db5f5436f8fdbc6">accept_count</a> () != 0) {
<a name="l00448"></a>00448       found_terrible_word = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00449"></a>00449                                  <span class="comment">//Forget earlier potential crunches</span>
<a name="l00450"></a>00450       prev_potential_marked = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452     <span class="keywordflow">else</span> {
<a name="l00453"></a>00453       ok_dict_word = <a class="code" href="classtesseract_1_1_tesseract.html#a5c4eea7412e972bf2fdd2638315e5457">safe_dict_word</a>(word);
<a name="l00454"></a>00454       garbage_level = <a class="code" href="classtesseract_1_1_tesseract.html#afad44e1105d7f57e1a99d9076c4a3b25">garbage_word</a> (word, ok_dict_word);
<a name="l00455"></a>00455 
<a name="l00456"></a>00456       <span class="keywordflow">if</span> ((garbage_level != <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42ac744add072d392855d098a995acb3751">G_NEVER_CRUNCH</a>) &amp;&amp;
<a name="l00457"></a>00457       (<a class="code" href="classtesseract_1_1_tesseract.html#a12c9ef89f1b328cb272cae894895b2c7">terrible_word_crunch</a> (word, garbage_level))) {
<a name="l00458"></a>00458         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 0) {
<a name="l00459"></a>00459           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;T CRUNCHING: \&quot;%s\&quot;\n&quot;</span>,
<a name="l00460"></a>00460             word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00461"></a>00461         }
<a name="l00462"></a>00462         word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> = <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9ad0198ebd5b9e3299dd94f0c5f4d3e003">CR_KEEP_SPACE</a>;
<a name="l00463"></a>00463         <span class="keywordflow">if</span> (prev_potential_marked) {
<a name="l00464"></a>00464           <span class="keywordflow">while</span> (copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> () != word) {
<a name="l00465"></a>00465             <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 0) {
<a name="l00466"></a>00466               <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;P1 CRUNCHING: \&quot;%s\&quot;\n&quot;</span>,
<a name="l00467"></a>00467                 copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>()-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00468"></a>00468             }
<a name="l00469"></a>00469             copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> ()-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> = <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9ad0198ebd5b9e3299dd94f0c5f4d3e003">CR_KEEP_SPACE</a>;
<a name="l00470"></a>00470             copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00471"></a>00471           }
<a name="l00472"></a>00472           prev_potential_marked = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00473"></a>00473         }
<a name="l00474"></a>00474         found_terrible_word = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((garbage_level != <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42ac744add072d392855d098a995acb3751">G_NEVER_CRUNCH</a>) &amp;&amp;
<a name="l00477"></a>00477         (<a class="code" href="classtesseract_1_1_tesseract.html#a042a9bb2b0053f825baf0825addd54fe">potential_word_crunch</a> (word,
<a name="l00478"></a>00478       garbage_level, ok_dict_word))) {
<a name="l00479"></a>00479         <span class="keywordflow">if</span> (found_terrible_word) {
<a name="l00480"></a>00480           <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 0) {
<a name="l00481"></a>00481             <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;P2 CRUNCHING: \&quot;%s\&quot;\n&quot;</span>,
<a name="l00482"></a>00482               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00483"></a>00483           }
<a name="l00484"></a>00484           word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> = <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9ad0198ebd5b9e3299dd94f0c5f4d3e003">CR_KEEP_SPACE</a>;
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!prev_potential_marked) {
<a name="l00487"></a>00487           copy_it = page_res_it;
<a name="l00488"></a>00488           prev_potential_marked = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00489"></a>00489           <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 1) {
<a name="l00490"></a>00490             <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;P3 CRUNCHING: \&quot;%s\&quot;\n&quot;</span>,
<a name="l00491"></a>00491               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00492"></a>00492           }
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494       }
<a name="l00495"></a>00495       <span class="keywordflow">else</span> {
<a name="l00496"></a>00496         found_terrible_word = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00497"></a>00497                                  <span class="comment">//Forget earlier potential crunches</span>
<a name="l00498"></a>00498         prev_potential_marked = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00499"></a>00499         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 2) {
<a name="l00500"></a>00500           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;NO CRUNCH: \&quot;%s\&quot;\n&quot;</span>,
<a name="l00501"></a>00501             word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503       }
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00506"></a>00506   }
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="classtesseract_1_1_tesseract.html#a12c9ef89f1b328cb272cae894895b2c7">00510</a> <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="classtesseract_1_1_tesseract.html#a12c9ef89f1b328cb272cae894895b2c7">Tesseract::terrible_word_crunch</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word,
<a name="l00511"></a>00511                                       <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42">GARBAGE_LEVEL</a> garbage_level) {
<a name="l00512"></a>00512   <span class="keywordtype">float</span> rating_per_ch;
<a name="l00513"></a>00513   <span class="keywordtype">int</span> adjusted_len;
<a name="l00514"></a>00514   <span class="keywordtype">int</span> crunch_mode = 0;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <span class="keywordflow">if</span> ((word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a168505a533eda60219c93e25adf4cdc5">length</a> () == 0) ||
<a name="l00517"></a>00517     (strspn (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), <span class="stringliteral">&quot; &quot;</span>) ==
<a name="l00518"></a>00518     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a168505a533eda60219c93e25adf4cdc5">length</a> ()))
<a name="l00519"></a>00519     crunch_mode = 1;
<a name="l00520"></a>00520   <span class="keywordflow">else</span> {
<a name="l00521"></a>00521     adjusted_len = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a> ();
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (adjusted_len &gt; <a class="code" href="classtesseract_1_1_tesseract.html#a69c6af52a20db78eb5bfe14a1bc70162">crunch_rating_max</a>)
<a name="l00523"></a>00523       adjusted_len = <a class="code" href="classtesseract_1_1_tesseract.html#a69c6af52a20db78eb5bfe14a1bc70162">crunch_rating_max</a>;
<a name="l00524"></a>00524     rating_per_ch = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a52ea24dcb5ff15ad8aee3fd774622216">rating</a> () / adjusted_len;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     <span class="keywordflow">if</span> (rating_per_ch &gt; <a class="code" href="classtesseract_1_1_tesseract.html#a21a76e19dd03c1f03aad1b922fa3b21a">crunch_terrible_rating</a>)
<a name="l00527"></a>00527       crunch_mode = 2;
<a name="l00528"></a>00528     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#ae69c2f057f0474b533183f618e27d447">crunch_terrible_garbage</a> &amp;&amp; (garbage_level == <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a2400fb7991d9c94896464522e10c49ad">G_TERRIBLE</a>))
<a name="l00529"></a>00529       crunch_mode = 3;
<a name="l00530"></a>00530     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a1b25ef2b44d21a7204483a7ca804f293">certainty</a> () &lt; <a class="code" href="classtesseract_1_1_tesseract.html#aa3b5f0beacd8d0d328e66dfe8b850187">crunch_poor_garbage_cert</a>) &amp;&amp;
<a name="l00531"></a>00531       (garbage_level != <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>))
<a name="l00532"></a>00532       crunch_mode = 4;
<a name="l00533"></a>00533     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rating_per_ch &gt; <a class="code" href="classtesseract_1_1_tesseract.html#aec4f861a8e55288700ee622d3e885540">crunch_poor_garbage_rate</a>) &amp;&amp;
<a name="l00534"></a>00534       (garbage_level != <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>))
<a name="l00535"></a>00535       crunch_mode = 5;
<a name="l00536"></a>00536   }
<a name="l00537"></a>00537   <span class="keywordflow">if</span> (crunch_mode &gt; 0) {
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 2) {
<a name="l00539"></a>00539       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;Terrible_word_crunch (%d) on \&quot;%s\&quot;\n&quot;</span>,
<a name="l00540"></a>00540         crunch_mode, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544   <span class="keywordflow">else</span>
<a name="l00545"></a>00545     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a><a class="code" href="classtesseract_1_1_tesseract.html#a042a9bb2b0053f825baf0825addd54fe">00548</a> <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="classtesseract_1_1_tesseract.html#a042a9bb2b0053f825baf0825addd54fe">Tesseract::potential_word_crunch</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word,
<a name="l00549"></a>00549                                        <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42">GARBAGE_LEVEL</a> garbage_level,
<a name="l00550"></a>00550                                        <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> ok_dict_word) {
<a name="l00551"></a>00551   <span class="keywordtype">float</span> rating_per_ch;
<a name="l00552"></a>00552   <span class="keywordtype">int</span> adjusted_len;
<a name="l00553"></a>00553   <span class="keyword">const</span> <span class="keywordtype">char</span> *str = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>();
<a name="l00554"></a>00554   <span class="keyword">const</span> <span class="keywordtype">char</span> *lengths = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a93ab94b6fa6d5c0469fb52d66c62968c">unichar_lengths</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>();
<a name="l00555"></a>00555   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> word_crunchable;
<a name="l00556"></a>00556   <span class="keywordtype">int</span> poor_indicator_count = 0;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558   word_crunchable = !<a class="code" href="classtesseract_1_1_tesseract.html#a3b9dd1d5d1a309b0ce4f1ef34c0a8a2a">crunch_leave_accept_strings</a> ||
<a name="l00559"></a>00559                     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>() &lt; 3 ||
<a name="l00560"></a>00560                     (<a class="code" href="classtesseract_1_1_tesseract.html#a51f2ad8b2d849d90bbcfbfca3067c0f1">acceptable_word_string</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>,
<a name="l00561"></a>00561                                             str, lengths) == <a class="code" href="control_8h.html#af9ff5a7d7a1b9eeea7ce4106bffa7eeeaab0741a5a5ff9757ca343af255353ba0" title="Unacceptable word.">AC_UNACCEPTABLE</a> &amp;&amp;
<a name="l00562"></a>00562                      !ok_dict_word);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   adjusted_len = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>();
<a name="l00565"></a>00565   <span class="keywordflow">if</span> (adjusted_len &gt; 10)
<a name="l00566"></a>00566     adjusted_len = 10;
<a name="l00567"></a>00567   rating_per_ch = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a52ea24dcb5ff15ad8aee3fd774622216">rating</a>() / adjusted_len;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (rating_per_ch &gt; <a class="code" href="classtesseract_1_1_tesseract.html#ae98cef95f80d5939eaf80b123fd3c402">crunch_pot_poor_rate</a>) {
<a name="l00570"></a>00570     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 2) {
<a name="l00571"></a>00571       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Potential poor rating on \&quot;%s\&quot;\n&quot;</span>,
<a name="l00572"></a>00572               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574     poor_indicator_count++;
<a name="l00575"></a>00575   }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   <span class="keywordflow">if</span> (word_crunchable &amp;&amp;
<a name="l00578"></a>00578       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a1b25ef2b44d21a7204483a7ca804f293">certainty</a>() &lt; <a class="code" href="classtesseract_1_1_tesseract.html#aee487bb533118fcd5f1994e54ba86fff">crunch_pot_poor_cert</a>) {
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 2) {
<a name="l00580"></a>00580       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Potential poor cert on \&quot;%s\&quot;\n&quot;</span>,
<a name="l00581"></a>00581               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583     poor_indicator_count++;
<a name="l00584"></a>00584   }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586   <span class="keywordflow">if</span> (garbage_level != <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>) {
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 2) {
<a name="l00588"></a>00588       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Potential garbage on \&quot;%s\&quot;\n&quot;</span>,
<a name="l00589"></a>00589               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591     poor_indicator_count++;
<a name="l00592"></a>00592   }
<a name="l00593"></a>00593   <span class="keywordflow">return</span> poor_indicator_count &gt;= <a class="code" href="classtesseract_1_1_tesseract.html#af5c0420627cd4d8b1273916d8b86c354">crunch_pot_indicators</a>;
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="classtesseract_1_1_tesseract.html#a06a8ab9064d4c6da290c82e7adf53a8c">00596</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#a06a8ab9064d4c6da290c82e7adf53a8c">Tesseract::tilde_delete</a>(<a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> &amp;page_res_it) {
<a name="l00597"></a>00597   <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word;
<a name="l00598"></a>00598   <a class="code" href="class_p_a_g_e___r_e_s___i_t.html">PAGE_RES_IT</a> copy_it;
<a name="l00599"></a>00599   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> deleting_from_bol = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00600"></a>00600   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> marked_delete_point = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00601"></a>00601   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> debug_delete_mode;
<a name="l00602"></a>00602   <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9">CRUNCH_MODE</a> delete_mode;
<a name="l00603"></a>00603   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> x_debug_delete_mode;
<a name="l00604"></a>00604   <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9">CRUNCH_MODE</a> x_delete_mode;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606   page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#a15febd45d0904bb3c5f7d506368177f0">restart_page</a>();
<a name="l00607"></a>00607   <span class="keywordflow">while</span> (page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>() != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00608"></a>00608     word = page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>();
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     delete_mode = <a class="code" href="classtesseract_1_1_tesseract.html#a42d3b5e26902af46296cfdc24bb4b195">word_deletable</a> (word, debug_delete_mode);
<a name="l00611"></a>00611     <span class="keywordflow">if</span> (delete_mode != <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1eac25752f2c55f1809d11d4ef917ff9">CR_NONE</a>) {
<a name="l00612"></a>00612       <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#afc15fa7c1b5ad55d6772dea0d6865df1">word</a>-&gt;<a class="code" href="class_w_e_r_d.html#a81edde8597a3d9fd8a664d703d332c41">flag</a> (<a class="code" href="werd_8h.html#ad6968adbf8f2cc44adf333ec96efb0beaff21d7c8c8992120fff35942408a00d2">W_BOL</a>) || deleting_from_bol) {
<a name="l00613"></a>00613         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 0) {
<a name="l00614"></a>00614           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;BOL CRUNCH DELETING(%d): \&quot;%s\&quot;\n&quot;</span>,
<a name="l00615"></a>00615             debug_delete_mode,
<a name="l00616"></a>00616             word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618         word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> = delete_mode;
<a name="l00619"></a>00619         deleting_from_bol = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00620"></a>00620       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#afc15fa7c1b5ad55d6772dea0d6865df1">word</a>-&gt;<a class="code" href="class_w_e_r_d.html#a81edde8597a3d9fd8a664d703d332c41">flag</a>(<a class="code" href="werd_8h.html#ad6968adbf8f2cc44adf333ec96efb0bea62efb985a62d85e014ee5ab039dd50ce">W_EOL</a>)) {
<a name="l00621"></a>00621         <span class="keywordflow">if</span> (marked_delete_point) {
<a name="l00622"></a>00622           <span class="keywordflow">while</span> (copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>() != word) {
<a name="l00623"></a>00623             x_delete_mode = <a class="code" href="classtesseract_1_1_tesseract.html#a42d3b5e26902af46296cfdc24bb4b195">word_deletable</a> (copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> (),
<a name="l00624"></a>00624               x_debug_delete_mode);
<a name="l00625"></a>00625             <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 0) {
<a name="l00626"></a>00626               <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;EOL CRUNCH DELETING(%d): \&quot;%s\&quot;\n&quot;</span>,
<a name="l00627"></a>00627                 x_debug_delete_mode,
<a name="l00628"></a>00628                 copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a>()-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00629"></a>00629             }
<a name="l00630"></a>00630             copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab84b4850200ba8802791c6197c113fd0">word</a> ()-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> = x_delete_mode;
<a name="l00631"></a>00631             copy_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00632"></a>00632           }
<a name="l00633"></a>00633         }
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 0) {
<a name="l00635"></a>00635           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;EOL CRUNCH DELETING(%d): \&quot;%s\&quot;\n&quot;</span>,
<a name="l00636"></a>00636             debug_delete_mode,
<a name="l00637"></a>00637             word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639         word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> = delete_mode;
<a name="l00640"></a>00640         deleting_from_bol = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00641"></a>00641         marked_delete_point = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00642"></a>00642       }
<a name="l00643"></a>00643       <span class="keywordflow">else</span> {
<a name="l00644"></a>00644         <span class="keywordflow">if</span> (!marked_delete_point) {
<a name="l00645"></a>00645           copy_it = page_res_it;
<a name="l00646"></a>00646           marked_delete_point = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648       }
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650     <span class="keywordflow">else</span> {
<a name="l00651"></a>00651       deleting_from_bol = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00652"></a>00652                                  <span class="comment">//Forget earlier potential crunches</span>
<a name="l00653"></a>00653       marked_delete_point = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655     <span class="comment">/*</span>
<a name="l00656"></a>00656 <span class="comment">      The following step has been left till now as the tess fails are used to</span>
<a name="l00657"></a>00657 <span class="comment">      determine if the word is deletable.</span>
<a name="l00658"></a>00658 <span class="comment">    */</span>
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_tesseract.html#aefd718b3d3abe04fba6ff083019f8374">crunch_early_merge_tess_fails</a>)
<a name="l00660"></a>00660       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#af092edf58a4a718687aa35c6a458cada">merge_tess_fails</a>();
<a name="l00661"></a>00661     page_res_it.<a class="code" href="class_p_a_g_e___r_e_s___i_t.html#ab29005f235cc738eebafb7d9ed6fe70b">forward</a> ();
<a name="l00662"></a>00662   }
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 
<a name="l00666"></a><a class="code" href="classtesseract_1_1_tesseract.html#a81b3e2c28a090f5a877dd0f67a4080b6">00666</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_tesseract.html#a81b3e2c28a090f5a877dd0f67a4080b6">Tesseract::convert_bad_unlv_chs</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word_res) {
<a name="l00667"></a>00667   <span class="keywordtype">int</span> i;
<a name="l00668"></a>00668   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_dash = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(<span class="stringliteral">&quot;-&quot;</span>);
<a name="l00669"></a>00669   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_space = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(<span class="stringliteral">&quot; &quot;</span>);
<a name="l00670"></a>00670   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_tilde = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(<span class="stringliteral">&quot;~&quot;</span>);
<a name="l00671"></a>00671   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_pow = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(<span class="stringliteral">&quot;^&quot;</span>);
<a name="l00672"></a>00672   <span class="keywordtype">bool</span> modified = <span class="keyword">false</span>;
<a name="l00673"></a>00673   <span class="keywordflow">for</span> (i = 0; i &lt; word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>(); ++i) {
<a name="l00674"></a>00674     <span class="keywordflow">if</span> (word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a6b917b2e6157f7956ff53ca230425ed3">unichar_id</a>(i) == unichar_tilde) {
<a name="l00675"></a>00675       word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a8238d436806c40b2e01b9659dfab5eb3">set_unichar_id</a>(unichar_dash, i);
<a name="l00676"></a>00676       modified = <span class="keyword">true</span>;
<a name="l00677"></a>00677       <span class="keywordflow">if</span> (word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[i].accepted ())
<a name="l00678"></a>00678         word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[i].setrej_unlv_rej ();
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     <span class="keywordflow">if</span> (word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a6b917b2e6157f7956ff53ca230425ed3">unichar_id</a>(i) == unichar_pow) {
<a name="l00681"></a>00681       word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a8238d436806c40b2e01b9659dfab5eb3">set_unichar_id</a>(unichar_space, i);
<a name="l00682"></a>00682       modified = <span class="keyword">true</span>;
<a name="l00683"></a>00683       <span class="keywordflow">if</span> (word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[i].accepted ())
<a name="l00684"></a>00684         word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>[i].setrej_unlv_rej ();
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a><a class="code" href="classtesseract_1_1_tesseract.html#afad44e1105d7f57e1a99d9076c4a3b25">00689</a> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42">GARBAGE_LEVEL</a> <a class="code" href="classtesseract_1_1_tesseract.html#afad44e1105d7f57e1a99d9076c4a3b25">Tesseract::garbage_word</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word, <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> ok_dict_word) {
<a name="l00690"></a>00690   <span class="keyword">enum</span> STATES
<a name="l00691"></a>00691   {
<a name="l00692"></a>00692     JUNK,
<a name="l00693"></a>00693     FIRST_UPPER,
<a name="l00694"></a>00694     FIRST_LOWER,
<a name="l00695"></a>00695     FIRST_NUM,
<a name="l00696"></a>00696     SUBSEQUENT_UPPER,
<a name="l00697"></a>00697     SUBSEQUENT_LOWER,
<a name="l00698"></a>00698     SUBSEQUENT_NUM
<a name="l00699"></a>00699   };
<a name="l00700"></a>00700   <span class="keyword">const</span> <span class="keywordtype">char</span> *str = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>();
<a name="l00701"></a>00701   <span class="keyword">const</span> <span class="keywordtype">char</span> *lengths = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a93ab94b6fa6d5c0469fb52d66c62968c">unichar_lengths</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>();
<a name="l00702"></a>00702   STATES state = JUNK;
<a name="l00703"></a>00703   <span class="keywordtype">int</span> len = 0;
<a name="l00704"></a>00704   <span class="keywordtype">int</span> isolated_digits = 0;
<a name="l00705"></a>00705   <span class="keywordtype">int</span> isolated_alphas = 0;
<a name="l00706"></a>00706   <span class="keywordtype">int</span> bad_char_count = 0;
<a name="l00707"></a>00707   <span class="keywordtype">int</span> tess_rejs = 0;
<a name="l00708"></a>00708   <span class="keywordtype">int</span> dodgy_chars = 0;
<a name="l00709"></a>00709   <span class="keywordtype">int</span> ok_chars;
<a name="l00710"></a>00710   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> last_char = -1;
<a name="l00711"></a>00711   <span class="keywordtype">int</span> alpha_repetition_count = 0;
<a name="l00712"></a>00712   <span class="keywordtype">int</span> longest_alpha_repetition_count = 0;
<a name="l00713"></a>00713   <span class="keywordtype">int</span> longest_lower_run_len = 0;
<a name="l00714"></a>00714   <span class="keywordtype">int</span> lower_string_count = 0;
<a name="l00715"></a>00715   <span class="keywordtype">int</span> longest_upper_run_len = 0;
<a name="l00716"></a>00716   <span class="keywordtype">int</span> upper_string_count = 0;
<a name="l00717"></a>00717   <span class="keywordtype">int</span> total_alpha_count = 0;
<a name="l00718"></a>00718   <span class="keywordtype">int</span> total_digit_count = 0;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720   <span class="keywordflow">for</span> (; *str != <span class="charliteral">&#39;\0&#39;</span>; str += *(lengths++)) {
<a name="l00721"></a>00721     len++;
<a name="l00722"></a>00722     <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a482a94b3e6fcd4e5b9b9363bb9e0ee59">get_isupper</a> (str, *lengths)) {
<a name="l00723"></a>00723       total_alpha_count++;
<a name="l00724"></a>00724       <span class="keywordflow">switch</span> (state) {
<a name="l00725"></a>00725         <span class="keywordflow">case</span> SUBSEQUENT_UPPER:
<a name="l00726"></a>00726         <span class="keywordflow">case</span> FIRST_UPPER:
<a name="l00727"></a>00727           state = SUBSEQUENT_UPPER;
<a name="l00728"></a>00728           upper_string_count++;
<a name="l00729"></a>00729           <span class="keywordflow">if</span> (longest_upper_run_len &lt; upper_string_count)
<a name="l00730"></a>00730             longest_upper_run_len = upper_string_count;
<a name="l00731"></a>00731           <span class="keywordflow">if</span> (last_char == word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(str, *lengths)) {
<a name="l00732"></a>00732             alpha_repetition_count++;
<a name="l00733"></a>00733             <span class="keywordflow">if</span> (longest_alpha_repetition_count &lt; alpha_repetition_count) {
<a name="l00734"></a>00734               longest_alpha_repetition_count = alpha_repetition_count;
<a name="l00735"></a>00735             }
<a name="l00736"></a>00736           }
<a name="l00737"></a>00737           <span class="keywordflow">else</span> {
<a name="l00738"></a>00738             last_char = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(str, *lengths);
<a name="l00739"></a>00739             alpha_repetition_count = 1;
<a name="l00740"></a>00740           }
<a name="l00741"></a>00741           <span class="keywordflow">break</span>;
<a name="l00742"></a>00742         <span class="keywordflow">case</span> FIRST_NUM:
<a name="l00743"></a>00743           isolated_digits++;
<a name="l00744"></a>00744         <span class="keywordflow">default</span>:
<a name="l00745"></a>00745           state = FIRST_UPPER;
<a name="l00746"></a>00746           last_char = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(str, *lengths);
<a name="l00747"></a>00747           alpha_repetition_count = 1;
<a name="l00748"></a>00748           upper_string_count = 1;
<a name="l00749"></a>00749           <span class="keywordflow">break</span>;
<a name="l00750"></a>00750       }
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a074096c823dd5b9bc02c02a59784bf34">get_islower</a> (str, *lengths)) {
<a name="l00753"></a>00753       total_alpha_count++;
<a name="l00754"></a>00754       <span class="keywordflow">switch</span> (state) {
<a name="l00755"></a>00755         <span class="keywordflow">case</span> SUBSEQUENT_LOWER:
<a name="l00756"></a>00756         <span class="keywordflow">case</span> FIRST_LOWER:
<a name="l00757"></a>00757           state = SUBSEQUENT_LOWER;
<a name="l00758"></a>00758           lower_string_count++;
<a name="l00759"></a>00759           <span class="keywordflow">if</span> (longest_lower_run_len &lt; lower_string_count)
<a name="l00760"></a>00760             longest_lower_run_len = lower_string_count;
<a name="l00761"></a>00761           <span class="keywordflow">if</span> (last_char == word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(str, *lengths)) {
<a name="l00762"></a>00762             alpha_repetition_count++;
<a name="l00763"></a>00763             <span class="keywordflow">if</span> (longest_alpha_repetition_count &lt; alpha_repetition_count) {
<a name="l00764"></a>00764               longest_alpha_repetition_count = alpha_repetition_count;
<a name="l00765"></a>00765             }
<a name="l00766"></a>00766           }
<a name="l00767"></a>00767           <span class="keywordflow">else</span> {
<a name="l00768"></a>00768             last_char = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(str, *lengths);
<a name="l00769"></a>00769             alpha_repetition_count = 1;
<a name="l00770"></a>00770           }
<a name="l00771"></a>00771           <span class="keywordflow">break</span>;
<a name="l00772"></a>00772         <span class="keywordflow">case</span> FIRST_NUM:
<a name="l00773"></a>00773           isolated_digits++;
<a name="l00774"></a>00774         <span class="keywordflow">default</span>:
<a name="l00775"></a>00775           state = FIRST_LOWER;
<a name="l00776"></a>00776           last_char = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(str, *lengths);
<a name="l00777"></a>00777           alpha_repetition_count = 1;
<a name="l00778"></a>00778           lower_string_count = 1;
<a name="l00779"></a>00779           <span class="keywordflow">break</span>;
<a name="l00780"></a>00780       }
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a5951dde3ab90c12c309d776570a10725">get_isdigit</a> (str, *lengths)) {
<a name="l00783"></a>00783       total_digit_count++;
<a name="l00784"></a>00784       <span class="keywordflow">switch</span> (state) {
<a name="l00785"></a>00785         <span class="keywordflow">case</span> FIRST_NUM:
<a name="l00786"></a>00786           state = SUBSEQUENT_NUM;
<a name="l00787"></a>00787         <span class="keywordflow">case</span> SUBSEQUENT_NUM:
<a name="l00788"></a>00788           <span class="keywordflow">break</span>;
<a name="l00789"></a>00789         <span class="keywordflow">case</span> FIRST_UPPER:
<a name="l00790"></a>00790         <span class="keywordflow">case</span> FIRST_LOWER:
<a name="l00791"></a>00791           isolated_alphas++;
<a name="l00792"></a>00792         <span class="keywordflow">default</span>:
<a name="l00793"></a>00793           state = FIRST_NUM;
<a name="l00794"></a>00794           <span class="keywordflow">break</span>;
<a name="l00795"></a>00795       }
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797     <span class="keywordflow">else</span> {
<a name="l00798"></a>00798       <span class="keywordflow">if</span> (*lengths == 1 &amp;&amp; *str == <span class="charliteral">&#39; &#39;</span>)
<a name="l00799"></a>00799         tess_rejs++;
<a name="l00800"></a>00800       <span class="keywordflow">else</span>
<a name="l00801"></a>00801         bad_char_count++;
<a name="l00802"></a>00802       <span class="keywordflow">switch</span> (state) {
<a name="l00803"></a>00803         <span class="keywordflow">case</span> FIRST_NUM:
<a name="l00804"></a>00804           isolated_digits++;
<a name="l00805"></a>00805           <span class="keywordflow">break</span>;
<a name="l00806"></a>00806         <span class="keywordflow">case</span> FIRST_UPPER:
<a name="l00807"></a>00807         <span class="keywordflow">case</span> FIRST_LOWER:
<a name="l00808"></a>00808           isolated_alphas++;
<a name="l00809"></a>00809         <span class="keywordflow">default</span>:
<a name="l00810"></a>00810           <span class="keywordflow">break</span>;
<a name="l00811"></a>00811       }
<a name="l00812"></a>00812       state = JUNK;
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814   }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <span class="keywordflow">switch</span> (state) {
<a name="l00817"></a>00817     <span class="keywordflow">case</span> FIRST_NUM:
<a name="l00818"></a>00818       isolated_digits++;
<a name="l00819"></a>00819       <span class="keywordflow">break</span>;
<a name="l00820"></a>00820     <span class="keywordflow">case</span> FIRST_UPPER:
<a name="l00821"></a>00821     <span class="keywordflow">case</span> FIRST_LOWER:
<a name="l00822"></a>00822       isolated_alphas++;
<a name="l00823"></a>00823     <span class="keywordflow">default</span>:
<a name="l00824"></a>00824       <span class="keywordflow">break</span>;
<a name="l00825"></a>00825   }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a260642901c32784e997473bc298346cc">crunch_include_numerals</a>) {
<a name="l00828"></a>00828     total_alpha_count += total_digit_count - isolated_digits;
<a name="l00829"></a>00829   }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a267ae2256478e0caa24cc4eda6f78afa">crunch_leave_ok_strings</a> &amp;&amp; len &gt;= 4 &amp;&amp;
<a name="l00832"></a>00832       2 * (total_alpha_count - isolated_alphas) &gt; len &amp;&amp;
<a name="l00833"></a>00833       longest_alpha_repetition_count &lt; <a class="code" href="classtesseract_1_1_tesseract.html#a2cba6d61cfdced5bdea7461938b45c72">crunch_long_repetitions</a>) {
<a name="l00834"></a>00834     <span class="keywordflow">if</span> ((<a class="code" href="classtesseract_1_1_tesseract.html#a0fc0f88a88d8cf4837c6b85ab9f1fd00">crunch_accept_ok</a> &amp;&amp;
<a name="l00835"></a>00835          <a class="code" href="classtesseract_1_1_tesseract.html#a51f2ad8b2d849d90bbcfbfca3067c0f1">acceptable_word_string</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>, str, lengths) !=
<a name="l00836"></a>00836              <a class="code" href="control_8h.html#af9ff5a7d7a1b9eeea7ce4106bffa7eeeaab0741a5a5ff9757ca343af255353ba0" title="Unacceptable word.">AC_UNACCEPTABLE</a>) ||
<a name="l00837"></a>00837         longest_lower_run_len &gt; <a class="code" href="classtesseract_1_1_tesseract.html#a62ab8881690e98143d62f1ac528041f8">crunch_leave_lc_strings</a> ||
<a name="l00838"></a>00838         longest_upper_run_len &gt; <a class="code" href="classtesseract_1_1_tesseract.html#a557bc470ec0edc0bd11b4fb3432b2266">crunch_leave_uc_strings</a>)
<a name="l00839"></a>00839       <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42ac744add072d392855d098a995acb3751">G_NEVER_CRUNCH</a>;
<a name="l00840"></a>00840   }
<a name="l00841"></a>00841   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a>() &gt; 1 &amp;&amp;
<a name="l00842"></a>00842       strpbrk(str, <span class="stringliteral">&quot; &quot;</span>) == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00843"></a>00843       (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a161ac137df2d063a6421728e6aa08fcb">permuter</a>() == SYSTEM_DAWG_PERM ||
<a name="l00844"></a>00844        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a161ac137df2d063a6421728e6aa08fcb">permuter</a>() == FREQ_DAWG_PERM ||
<a name="l00845"></a>00845        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a161ac137df2d063a6421728e6aa08fcb">permuter</a>() == USER_DAWG_PERM ||
<a name="l00846"></a>00846        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a161ac137df2d063a6421728e6aa08fcb">permuter</a>() == NUMBER_PERM ||
<a name="l00847"></a>00847        <a class="code" href="classtesseract_1_1_tesseract.html#a51f2ad8b2d849d90bbcfbfca3067c0f1">acceptable_word_string</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>, str, lengths) !=
<a name="l00848"></a>00848            <a class="code" href="control_8h.html#af9ff5a7d7a1b9eeea7ce4106bffa7eeeaab0741a5a5ff9757ca343af255353ba0" title="Unacceptable word.">AC_UNACCEPTABLE</a> || ok_dict_word))
<a name="l00849"></a>00849     <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   ok_chars = len - bad_char_count - isolated_digits -
<a name="l00852"></a>00852     isolated_alphas - tess_rejs;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a20a1206ce17b07676f829fdee0034eb5">crunch_debug</a> &gt; 3) {
<a name="l00855"></a>00855     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;garbage_word: \&quot;%s\&quot;\n&quot;</span>,
<a name="l00856"></a>00856             word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00857"></a>00857     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;LEN: %d  bad: %d  iso_N: %d  iso_A: %d  rej: %d\n&quot;</span>,
<a name="l00858"></a>00858             len,
<a name="l00859"></a>00859             bad_char_count, isolated_digits, isolated_alphas, tess_rejs);
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861   <span class="keywordflow">if</span> (bad_char_count == 0 &amp;&amp;
<a name="l00862"></a>00862       tess_rejs == 0 &amp;&amp;
<a name="l00863"></a>00863       (len &gt; isolated_digits + isolated_alphas || len &lt;= 2))
<a name="l00864"></a>00864     <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>;
<a name="l00865"></a>00865 
<a name="l00866"></a>00866   <span class="keywordflow">if</span> (tess_rejs &gt; ok_chars ||
<a name="l00867"></a>00867       (tess_rejs &gt; 0 &amp;&amp; (bad_char_count + tess_rejs) * 2 &gt; len))
<a name="l00868"></a>00868     <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a2400fb7991d9c94896464522e10c49ad">G_TERRIBLE</a>;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870   <span class="keywordflow">if</span> (len &gt; 4) {
<a name="l00871"></a>00871     dodgy_chars = 2 * tess_rejs + bad_char_count + isolated_digits +
<a name="l00872"></a>00872         isolated_alphas;
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (dodgy_chars &gt; 5 || (dodgy_chars / (<span class="keywordtype">float</span>) len) &gt; 0.5)
<a name="l00874"></a>00874       <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a17acba0fc01478524c8214f0da82815a">G_DODGY</a>;
<a name="l00875"></a>00875     <span class="keywordflow">else</span>
<a name="l00876"></a>00876       <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>;
<a name="l00877"></a>00877   } <span class="keywordflow">else</span> {
<a name="l00878"></a>00878     dodgy_chars = 2 * tess_rejs + bad_char_count;
<a name="l00879"></a>00879     <span class="keywordflow">if</span> ((len == 4 &amp;&amp; dodgy_chars &gt; 2) ||
<a name="l00880"></a>00880         (len == 3 &amp;&amp; dodgy_chars &gt; 2) || dodgy_chars &gt;= len)
<a name="l00881"></a>00881       <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a17acba0fc01478524c8214f0da82815a">G_DODGY</a>;
<a name="l00882"></a>00882     <span class="keywordflow">else</span>
<a name="l00883"></a>00883       <span class="keywordflow">return</span> <a class="code" href="docqual_8h.html#ac4a411895d63e3bb0bea788e92894d42a46d03f2b7d080cc8319a43ef4bad82b3">G_OK</a>;
<a name="l00884"></a>00884   }
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 <span class="comment">/*************************************************************************</span>
<a name="l00889"></a>00889 <span class="comment"> * word_deletable()</span>
<a name="l00890"></a>00890 <span class="comment"> *     DELETE WERDS AT ENDS OF ROWS IF</span>
<a name="l00891"></a>00891 <span class="comment"> *        Word is crunched &amp;&amp;</span>
<a name="l00892"></a>00892 <span class="comment"> *        ( string length = 0                                          OR</span>
<a name="l00893"></a>00893 <span class="comment"> *          &gt; 50% of chars are &quot;|&quot; (before merging)                    OR</span>
<a name="l00894"></a>00894 <span class="comment"> *          certainty &lt; -10                                            OR</span>
<a name="l00895"></a>00895 <span class="comment"> *          rating /char &gt; 60                                          OR</span>
<a name="l00896"></a>00896 <span class="comment"> *          TOP of word is more than 0.5 xht BELOW baseline            OR</span>
<a name="l00897"></a>00897 <span class="comment"> *          BOTTOM of word is more than 0.5 xht ABOVE xht              OR</span>
<a name="l00898"></a>00898 <span class="comment"> *          length of word &lt; 3xht                                      OR</span>
<a name="l00899"></a>00899 <span class="comment"> *          height of word &lt; 0.7 xht                                   OR</span>
<a name="l00900"></a>00900 <span class="comment"> *          height of word &gt; 3.0 xht                                   OR</span>
<a name="l00901"></a>00901 <span class="comment"> *          &gt;75% of the outline BBs have longest dimension &lt; 0.5xht</span>
<a name="l00902"></a>00902 <span class="comment"> *************************************************************************/</span>
<a name="l00903"></a>00903 
<a name="l00904"></a><a class="code" href="classtesseract_1_1_tesseract.html#a42d3b5e26902af46296cfdc24bb4b195">00904</a> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9">CRUNCH_MODE</a> <a class="code" href="classtesseract_1_1_tesseract.html#a42d3b5e26902af46296cfdc24bb4b195">Tesseract::word_deletable</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word, <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> &amp;delete_mode) {
<a name="l00905"></a>00905   <span class="keywordtype">int</span> word_len = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae24eb58be06cf275aee411d947fd31ef">reject_map</a>.<a class="code" href="class_r_e_j_m_a_p.html#ab3760d96d63b5ca6c4bfeb32ffc8183c">length</a> ();
<a name="l00906"></a>00906   <span class="keywordtype">float</span> rating_per_ch;
<a name="l00907"></a>00907   <a class="code" href="class_t_b_o_x.html">TBOX</a> box;                       <span class="comment">//BB of word</span>
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a82d32a9f59bc1c08da9537303c56615b">unlv_crunch_mode</a> == <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1eac25752f2c55f1809d11d4ef917ff9">CR_NONE</a>) {
<a name="l00910"></a>00910     delete_mode = 0;
<a name="l00911"></a>00911     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1eac25752f2c55f1809d11d4ef917ff9">CR_NONE</a>;
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (word_len == 0) {
<a name="l00915"></a>00915     delete_mode = 1;
<a name="l00916"></a>00916     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1799c83261446306e1d1527f1779d6a4">CR_DELETE</a>;
<a name="l00917"></a>00917   }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00920"></a>00920     <span class="comment">// Cube leaves rebuild_word NULL.</span>
<a name="l00921"></a>00921     box = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#a8278c9db39975f181ad074bf343ea402">bounding_box</a>();
<a name="l00922"></a>00922     <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#a8379d4bbc72bdbb1f069fc14790e632d">height</a> () &lt; <a class="code" href="classtesseract_1_1_tesseract.html#a40051cf485581289adcf04cc4733df41">crunch_del_min_ht</a> * <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a>) {
<a name="l00923"></a>00923       delete_mode = 4;
<a name="l00924"></a>00924       <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1799c83261446306e1d1527f1779d6a4">CR_DELETE</a>;
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_tesseract.html#a63d37ef049d0902573211d4301564a1a">noise_outlines</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>)) {
<a name="l00928"></a>00928       delete_mode = 5;
<a name="l00929"></a>00929       <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1799c83261446306e1d1527f1779d6a4">CR_DELETE</a>;
<a name="l00930"></a>00930     }
<a name="l00931"></a>00931   }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933   <span class="keywordflow">if</span> ((<a class="code" href="classtesseract_1_1_tesseract.html#ae180ffab43d41336d8418e30004d1866">failure_count</a> (word) * 1.5) &gt; word_len) {
<a name="l00934"></a>00934     delete_mode = 2;
<a name="l00935"></a>00935     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00936"></a>00936   }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a1b25ef2b44d21a7204483a7ca804f293">certainty</a> () &lt; <a class="code" href="classtesseract_1_1_tesseract.html#a5c24b5ef1b42bebf68d3ab54acc94ccf">crunch_del_cert</a>) {
<a name="l00939"></a>00939     delete_mode = 7;
<a name="l00940"></a>00940     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00941"></a>00941   }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   rating_per_ch = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a52ea24dcb5ff15ad8aee3fd774622216">rating</a> () / word_len;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945   <span class="keywordflow">if</span> (rating_per_ch &gt; <a class="code" href="classtesseract_1_1_tesseract.html#a10e3b50d7d9fc570d752d31b05d6971b">crunch_del_rating</a>) {
<a name="l00946"></a>00946     delete_mode = 8;
<a name="l00947"></a>00947     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00948"></a>00948   }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950   <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a> () &lt; <a class="code" href="normalis_8h.html#abe10ce41bf7240ae8a053dea471d6ed5">kBlnBaselineOffset</a> - <a class="code" href="classtesseract_1_1_tesseract.html#a86f631e39200ed6d92a92ccd6a1de2c9">crunch_del_low_word</a> * <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a>) {
<a name="l00951"></a>00951     delete_mode = 9;
<a name="l00952"></a>00952     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00953"></a>00953   }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a> () &gt;
<a name="l00956"></a>00956   <a class="code" href="normalis_8h.html#abe10ce41bf7240ae8a053dea471d6ed5">kBlnBaselineOffset</a> + <a class="code" href="classtesseract_1_1_tesseract.html#ad6665d769dab6f71751fd64af3837674">crunch_del_high_word</a> * <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a>) {
<a name="l00957"></a>00957     delete_mode = 10;
<a name="l00958"></a>00958     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00959"></a>00959   }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#a8379d4bbc72bdbb1f069fc14790e632d">height</a> () &gt; <a class="code" href="classtesseract_1_1_tesseract.html#ae8bf52f3bdd158ca70e25231e485ce1a">crunch_del_max_ht</a> * <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a>) {
<a name="l00962"></a>00962     delete_mode = 11;
<a name="l00963"></a>00963     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00964"></a>00964   }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966   <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a> () &lt; <a class="code" href="classtesseract_1_1_tesseract.html#a82fcb38c1bdc5bce93ff69c94ef7e2b9">crunch_del_min_width</a> * <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a>) {
<a name="l00967"></a>00967     delete_mode = 3;
<a name="l00968"></a>00968     <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a223aec7f7b2d11193c90d04d8f589387">CR_LOOSE_SPACE</a>;
<a name="l00969"></a>00969   }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971   delete_mode = 0;
<a name="l00972"></a>00972   <span class="keywordflow">return</span> <a class="code" href="pageres_8h.html#affc9a96d31e23e645355e534f11c40e9a1eac25752f2c55f1809d11d4ef917ff9">CR_NONE</a>;
<a name="l00973"></a>00973 }
<a name="l00974"></a>00974 
<a name="l00975"></a><a class="code" href="classtesseract_1_1_tesseract.html#ae180ffab43d41336d8418e30004d1866">00975</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="classtesseract_1_1_tesseract.html#ae180ffab43d41336d8418e30004d1866">Tesseract::failure_count</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word) {
<a name="l00976"></a>00976   <span class="keyword">const</span> <span class="keywordtype">char</span> *str = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a41d740f0accccdfb245d34d554122116">unichar_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>();
<a name="l00977"></a>00977   <span class="keywordtype">int</span> tess_rejs = 0;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979   <span class="keywordflow">for</span> (; *str != <span class="charliteral">&#39;\0&#39;</span>; str++) {
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (*str == <span class="charliteral">&#39; &#39;</span>)
<a name="l00981"></a>00981       tess_rejs++;
<a name="l00982"></a>00982   }
<a name="l00983"></a>00983   <span class="keywordflow">return</span> tess_rejs;
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 
<a name="l00987"></a><a class="code" href="classtesseract_1_1_tesseract.html#a63d37ef049d0902573211d4301564a1a">00987</a> <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="classtesseract_1_1_tesseract.html#a63d37ef049d0902573211d4301564a1a">Tesseract::noise_outlines</a>(<a class="code" href="struct_t_w_e_r_d.html">TWERD</a> *word) {
<a name="l00988"></a>00988   <a class="code" href="class_t_b_o_x.html">TBOX</a> box;                       <span class="comment">// BB of outline</span>
<a name="l00989"></a>00989   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> outline_count = 0;
<a name="l00990"></a>00990   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> small_outline_count = 0;
<a name="l00991"></a>00991   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> max_dimension;
<a name="l00992"></a>00992   <span class="keywordtype">float</span> small_limit = <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a> * <a class="code" href="classtesseract_1_1_tesseract.html#a422f7f28537d7127b0965b6224f2891e">crunch_small_outlines_size</a>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994   <span class="keywordflow">for</span> (<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* blob = word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>; blob != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; blob = blob-&gt;next) {
<a name="l00995"></a>00995     <span class="keywordflow">for</span> (<a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a>* ol = blob-&gt;outlines; ol != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; ol = ol-&gt;next) {
<a name="l00996"></a>00996       outline_count++;
<a name="l00997"></a>00997       box = ol-&gt;bounding_box();
<a name="l00998"></a>00998       <span class="keywordflow">if</span> (box.<a class="code" href="class_t_b_o_x.html#a8379d4bbc72bdbb1f069fc14790e632d">height</a>() &gt; box.<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>())
<a name="l00999"></a>00999         max_dimension = box.<a class="code" href="class_t_b_o_x.html#a8379d4bbc72bdbb1f069fc14790e632d">height</a>();
<a name="l01000"></a>01000       <span class="keywordflow">else</span>
<a name="l01001"></a>01001         max_dimension = box.<a class="code" href="class_t_b_o_x.html#af95494a2ccacc70cc2b83820b2948619">width</a>();
<a name="l01002"></a>01002       <span class="keywordflow">if</span> (max_dimension &lt; small_limit)
<a name="l01003"></a>01003         small_outline_count++;
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005   }
<a name="l01006"></a>01006   <span class="keywordflow">return</span> (small_outline_count &gt;= outline_count);
<a name="l01007"></a>01007 }
<a name="l01008"></a>01008 }  <span class="comment">// namespace tesseract</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="docqual_8cpp.html">docqual.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Thu Mar 29 2012 23:42:08 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
