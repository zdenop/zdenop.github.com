<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/viewer/scrollview.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('scrollview_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/viewer/scrollview.cpp</div>  </div>
</div>
<div class="contents">
<a href="scrollview_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">// File:        scrollview.cc</span>
<a name="l00003"></a>00003 <span class="comment">// Description: ScrollView</span>
<a name="l00004"></a>00004 <span class="comment">// Author:      Joern Wanke</span>
<a name="l00005"></a>00005 <span class="comment">// Created:     Thu Nov 29 2007</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// (C) Copyright 2007, Google Inc.</span>
<a name="l00008"></a>00008 <span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00009"></a>00009 <span class="comment">// you may not use this file except in compliance with the License.</span>
<a name="l00010"></a>00010 <span class="comment">// You may obtain a copy of the License at</span>
<a name="l00011"></a>00011 <span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00012"></a>00012 <span class="comment">// Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00014"></a>00014 <span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment">// See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment">// limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="comment"></span><span class="comment">//</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;utility&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment">// Include automatically generated configuration file if running autoconf.</span>
<a name="l00033"></a>00033 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="config__auto_8h.html">config_auto.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="comment">// This class contains the main ScrollView-logic,</span>
<a name="l00039"></a>00039 <span class="comment">// e.g. parsing &amp; sending messages, images etc.</span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#pragma warning(disable:4786)  // Don&#39;t give stupid warnings for stl</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#pragma warning(disable:4018)  // signed/unsigned warnings</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#pragma warning(disable:4530)  // exception warnings</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a><a class="code" href="scrollview_8cpp.html#a79eb5da6093373f064e897ad5aedc18c">00046</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="scrollview_8cpp.html#a79eb5da6093373f064e897ad5aedc18c">kSvPort</a> = 8461;
<a name="l00047"></a><a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">00047</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a> = 4096;
<a name="l00048"></a><a class="code" href="scrollview_8cpp.html#ae89c23582ae7fd97e4884a7402d8959c">00048</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="scrollview_8cpp.html#ae89c23582ae7fd97e4884a7402d8959c">kMaxIntPairSize</a> = 45;  <span class="comment">// Holds %d,%d, for upto 64 bit.</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="scrollview_8h.html">scrollview.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="svutil_8h.html">svutil.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;allheaders.h&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="struct_s_v_poly_line_buffer.html">00055</a> <span class="keyword">struct </span><a class="code" href="struct_s_v_poly_line_buffer.html">SVPolyLineBuffer</a> {
<a name="l00056"></a><a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">00056</a>   <span class="keywordtype">bool</span> <a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">empty</a>;  <span class="comment">// Independent indicator to allow SendMsg to call SendPolygon.</span>
<a name="l00057"></a><a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">00057</a>   std::vector&lt;int&gt; <a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>;
<a name="l00058"></a><a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">00058</a>   std::vector&lt;int&gt; <a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>;
<a name="l00059"></a>00059 };
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">// A map between the window IDs and their corresponding pointers.</span>
<a name="l00062"></a>00062 <span class="keyword">static</span> std::map&lt;int, ScrollView*&gt; svmap;
<a name="l00063"></a>00063 <span class="keyword">static</span> <a class="code" href="class_s_v_mutex.html">SVMutex</a>* svmap_mu;
<a name="l00064"></a>00064 <span class="comment">// A map of all semaphores waiting for a specific event on a specific window.</span>
<a name="l00065"></a>00065 <span class="keyword">static</span> std::map&lt;std::pair&lt;ScrollView*, SVEventType&gt;,
<a name="l00066"></a>00066                 std::pair&lt;SVSemaphore*, SVEvent*&gt; &gt; waiting_for_events;
<a name="l00067"></a>00067 <span class="keyword">static</span> <a class="code" href="class_s_v_mutex.html">SVMutex</a>* waiting_for_events_mu;
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="struct_s_v_event.html#a4623a97ad24f2d850490a6533f680432">00069</a> <a class="code" href="struct_s_v_event.html">SVEvent</a>* <a class="code" href="struct_s_v_event.html#a4623a97ad24f2d850490a6533f680432">SVEvent::copy</a>() {
<a name="l00070"></a>00070   <a class="code" href="struct_s_v_event.html">SVEvent</a>* any = <span class="keyword">new</span> <a class="code" href="struct_s_v_event.html#a994da78408d630a919c761787851e4b3">SVEvent</a>;
<a name="l00071"></a>00071   any-&gt;<a class="code" href="struct_s_v_event.html#ad0db5c2aa893a41b6c6f65b9d3f62318">command_id</a> = <a class="code" href="struct_s_v_event.html#ad0db5c2aa893a41b6c6f65b9d3f62318">command_id</a>;
<a name="l00072"></a>00072   any-&gt;<a class="code" href="struct_s_v_event.html#a899b70794c509a3c06e9c5c9fc251780">counter</a> = <a class="code" href="struct_s_v_event.html#a899b70794c509a3c06e9c5c9fc251780">counter</a>;
<a name="l00073"></a>00073   any-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>) + 1];
<a name="l00074"></a>00074   strncpy(any-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>, <a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>, strlen(<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>));
<a name="l00075"></a>00075   any-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>[strlen(<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>)] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00076"></a>00076   any-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a> = <a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a>;
<a name="l00077"></a>00077   any-&gt;<a class="code" href="struct_s_v_event.html#a45ffe2bc44987a5461278e78de76f6f7">x</a> = <a class="code" href="struct_s_v_event.html#a45ffe2bc44987a5461278e78de76f6f7">x</a>;
<a name="l00078"></a>00078   any-&gt;<a class="code" href="struct_s_v_event.html#aabace8b3b902fe15aef808ad9c203bb7">y</a> = <a class="code" href="struct_s_v_event.html#aabace8b3b902fe15aef808ad9c203bb7">y</a>;
<a name="l00079"></a>00079   any-&gt;<a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a> = <a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a>;
<a name="l00080"></a>00080   any-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a> = <a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a>;
<a name="l00081"></a>00081   any-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a> = <a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a>;
<a name="l00082"></a>00082   <span class="keywordflow">return</span> any;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00089"></a>00089 <span class="keywordtype">void</span>* ScrollView::MessageReceiver(<span class="keywordtype">void</span>* a) {
<a name="l00090"></a>00090   <span class="keywordtype">int</span> counter_event_id = 0;  <span class="comment">// ongoing counter</span>
<a name="l00091"></a>00091   <span class="keywordtype">char</span>* message = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00092"></a>00092   <span class="comment">// Wait until a new message appears in the input stream_.</span>
<a name="l00093"></a>00093   <span class="keywordflow">do</span> {
<a name="l00094"></a>00094     message = ScrollView::GetStream()-&gt;<a class="code" href="class_s_v_network.html#a6cf1cd38c287bdce0ed8594ed9076c2d">Receive</a>();
<a name="l00095"></a>00095   } <span class="keywordflow">while</span> (message == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">// This is the main loop which iterates until the server is dead (strlen = -1).</span>
<a name="l00098"></a>00098 <span class="comment">// It basically parses for 3 different messagetypes and then distributes the</span>
<a name="l00099"></a>00099 <span class="comment">// events accordingly.</span>
<a name="l00100"></a>00100   <span class="keywordflow">while</span> (strlen(message) != -1) {
<a name="l00101"></a>00101       <span class="comment">// The new event we create.</span>
<a name="l00102"></a>00102       <a class="code" href="struct_s_v_event.html">SVEvent</a>* cur = <span class="keyword">new</span> <a class="code" href="struct_s_v_event.html">SVEvent</a>;
<a name="l00103"></a>00103       <span class="comment">// The ID of the corresponding window.</span>
<a name="l00104"></a>00104       <span class="keywordtype">int</span> window_id;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106       <span class="keywordtype">int</span> ev_type;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108       <span class="keywordtype">int</span> n;
<a name="l00109"></a>00109       <span class="comment">// Fill the new SVEvent properly.</span>
<a name="l00110"></a>00110       sscanf(message, <span class="stringliteral">&quot;%d,%d,%d,%d,%d,%d,%d,%n&quot;</span>, &amp;window_id, &amp;ev_type, &amp;cur-&gt;<a class="code" href="struct_s_v_event.html#a45ffe2bc44987a5461278e78de76f6f7">x</a>,
<a name="l00111"></a>00111              &amp;cur-&gt;<a class="code" href="struct_s_v_event.html#aabace8b3b902fe15aef808ad9c203bb7">y</a>, &amp;cur-&gt;<a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a>, &amp;cur-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a>, &amp;cur-&gt;<a class="code" href="struct_s_v_event.html#ad0db5c2aa893a41b6c6f65b9d3f62318">command_id</a>, &amp;n);
<a name="l00112"></a>00112       <span class="keywordtype">char</span>* p = (message + n);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114       svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00115"></a>00115       cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a> = svmap[window_id];
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00118"></a>00118         cur-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(p) + 1];
<a name="l00119"></a>00119         strncpy(cur-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>, p, strlen(p) + 1);
<a name="l00120"></a>00120         <span class="keywordflow">if</span> (strlen(p) &gt; 0) {  <span class="comment">// remove the last \n</span>
<a name="l00121"></a>00121           cur-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>[strlen(p)] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123         cur-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a> = <span class="keyword">static_cast&lt;</span><a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0">SVEventType</a><span class="keyword">&gt;</span>(ev_type);
<a name="l00124"></a>00124         <span class="comment">// Correct selection coordinates so x,y is the min pt and size is +ve.</span>
<a name="l00125"></a>00125         <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a> &gt; 0)
<a name="l00126"></a>00126           cur-&gt;<a class="code" href="struct_s_v_event.html#a45ffe2bc44987a5461278e78de76f6f7">x</a> -= cur-&gt;<a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a>;
<a name="l00127"></a>00127         <span class="keywordflow">else</span>
<a name="l00128"></a>00128           cur-&gt;<a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a> = -cur-&gt;<a class="code" href="struct_s_v_event.html#a5fd198e994158c7bd67cb5e099beb3bc">x_size</a>;
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a> &gt; 0)
<a name="l00130"></a>00130           cur-&gt;<a class="code" href="struct_s_v_event.html#aabace8b3b902fe15aef808ad9c203bb7">y</a> -= cur-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a>;
<a name="l00131"></a>00131         <span class="keywordflow">else</span>
<a name="l00132"></a>00132           cur-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a> = -cur-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a>;
<a name="l00133"></a>00133         <span class="comment">// Returned y will be the bottom-left if y is reversed.</span>
<a name="l00134"></a>00134         <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a>-&gt;y_axis_is_reversed_)
<a name="l00135"></a>00135           cur-&gt;<a class="code" href="struct_s_v_event.html#aabace8b3b902fe15aef808ad9c203bb7">y</a> = cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a>-&gt;<a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(cur-&gt;<a class="code" href="struct_s_v_event.html#aabace8b3b902fe15aef808ad9c203bb7">y</a> + cur-&gt;<a class="code" href="struct_s_v_event.html#ad0a03e02e396750e6f77e01fe22d5ae0">y_size</a>);
<a name="l00136"></a>00136         cur-&gt;<a class="code" href="struct_s_v_event.html#a899b70794c509a3c06e9c5c9fc251780">counter</a> = counter_event_id;
<a name="l00137"></a>00137         <span class="comment">// Increase by 2 since we will also create an SVET_ANY event from cur,</span>
<a name="l00138"></a>00138         <span class="comment">// which will have a counter_id of cur + 1 (and thus gets processed</span>
<a name="l00139"></a>00139         <span class="comment">// after cur).</span>
<a name="l00140"></a>00140         counter_event_id += 2;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <span class="comment">// In case of an SVET_EXIT event, quit the whole application.</span>
<a name="l00143"></a>00143         <span class="keywordflow">if</span> (ev_type == <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a317899e24e3c2342d1dd2c6cdadde5d7">SVET_EXIT</a>) { <a class="code" href="class_scroll_view.html#a0114095f359d22a67375f19f8c8d2bd7">ScrollView::Exit</a>(); }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         <span class="comment">// Place two copies of it in the table for the window.</span>
<a name="l00146"></a>00146         cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a>-&gt;SetEvent(cur);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="comment">// Check if any of the threads currently waiting want it.</span>
<a name="l00149"></a>00149         std::pair&lt;ScrollView*, SVEventType&gt; awaiting_list(cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a>,
<a name="l00150"></a>00150                                                           cur-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a>);
<a name="l00151"></a>00151         std::pair&lt;ScrollView*, SVEventType&gt; awaiting_list_any(cur-&gt;<a class="code" href="struct_s_v_event.html#af1db7555f5bfd1585ccb0fb9f134c4df">window</a>,
<a name="l00152"></a>00152                                                               <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a6eec81ed585bda7ff47ec38918cb2a0e">SVET_ANY</a>);
<a name="l00153"></a>00153         std::pair&lt;ScrollView*, SVEventType&gt; awaiting_list_any_window((<a class="code" href="class_scroll_view.html">ScrollView</a>*)0,
<a name="l00154"></a>00154                                                               <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a6eec81ed585bda7ff47ec38918cb2a0e">SVET_ANY</a>);
<a name="l00155"></a>00155         waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00156"></a>00156         <span class="keywordflow">if</span> (waiting_for_events.count(awaiting_list) &gt; 0) {
<a name="l00157"></a>00157           waiting_for_events[awaiting_list].second = cur;
<a name="l00158"></a>00158           waiting_for_events[awaiting_list].first-&gt;Signal();
<a name="l00159"></a>00159         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (waiting_for_events.count(awaiting_list_any) &gt; 0) {
<a name="l00160"></a>00160           waiting_for_events[awaiting_list_any].second = cur;
<a name="l00161"></a>00161           waiting_for_events[awaiting_list_any].first-&gt;Signal();
<a name="l00162"></a>00162         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (waiting_for_events.count(awaiting_list_any_window) &gt; 0) {
<a name="l00163"></a>00163           waiting_for_events[awaiting_list_any_window].second = cur;
<a name="l00164"></a>00164           waiting_for_events[awaiting_list_any_window].first-&gt;Signal();
<a name="l00165"></a>00165         } <span class="keywordflow">else</span> {
<a name="l00166"></a>00166           <span class="comment">// No one wanted it, so delete it.</span>
<a name="l00167"></a>00167           <span class="keyword">delete</span> cur;
<a name="l00168"></a>00168         }
<a name="l00169"></a>00169         waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00170"></a>00170         <span class="comment">// Signal the corresponding semaphore twice (for both copies).</span>
<a name="l00171"></a>00171         <a class="code" href="class_scroll_view.html">ScrollView</a>* sv = svmap[window_id];
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (sv != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00173"></a>00173           sv-&gt;Signal();
<a name="l00174"></a>00174           sv-&gt;Signal();
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176       }
<a name="l00177"></a>00177       svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00178"></a>00178 
<a name="l00179"></a>00179       <span class="comment">// Wait until a new message appears in the input stream_.</span>
<a name="l00180"></a>00180       <span class="keywordflow">do</span> {
<a name="l00181"></a>00181         message = ScrollView::GetStream()-&gt;<a class="code" href="class_s_v_network.html#a6cf1cd38c287bdce0ed8594ed9076c2d">Receive</a>();
<a name="l00182"></a>00182       } <span class="keywordflow">while</span> (message == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184   <span class="keywordflow">return</span> 0;
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="comment">// Table to implement the color index values in the old system.</span>
<a name="l00188"></a><a class="code" href="scrollview_8cpp.html#a56b146063453a9e06f0edb8dc5ee6b3a">00188</a> <span class="keywordtype">int</span> <a class="code" href="scrollview_8cpp.html#a56b146063453a9e06f0edb8dc5ee6b3a">table_colors</a>[<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a9a3622e1a820651d08bea683ca17f8c9">ScrollView::GREEN_YELLOW</a>+1][4]= {
<a name="l00189"></a>00189   {0, 0, 0, 0},        <span class="comment">// NONE (transparent)</span>
<a name="l00190"></a>00190   {0, 0, 0, 255},        <span class="comment">// BLACK.</span>
<a name="l00191"></a>00191   {255, 255, 255, 255},  <span class="comment">// WHITE.</span>
<a name="l00192"></a>00192   {255, 0, 0, 255},      <span class="comment">// RED.</span>
<a name="l00193"></a>00193   {255, 255, 0, 255},    <span class="comment">// YELLOW.</span>
<a name="l00194"></a>00194   {0, 255, 0, 255},      <span class="comment">// GREEN.</span>
<a name="l00195"></a>00195   {0, 255, 255, 255},    <span class="comment">// CYAN.</span>
<a name="l00196"></a>00196   {0, 0, 255, 255},      <span class="comment">// BLUE.</span>
<a name="l00197"></a>00197   {255, 0, 255, 255},    <span class="comment">// MAGENTA.</span>
<a name="l00198"></a>00198   {0, 128, 255, 255},    <span class="comment">// AQUAMARINE.</span>
<a name="l00199"></a>00199   {0, 0, 64, 255},       <span class="comment">// DARK_SLATE_BLUE.</span>
<a name="l00200"></a>00200   {128, 128, 255, 255},  <span class="comment">// LIGHT_BLUE.</span>
<a name="l00201"></a>00201   {64, 64, 255, 255},    <span class="comment">// MEDIUM_BLUE.</span>
<a name="l00202"></a>00202   {0, 0, 32, 255},       <span class="comment">// MIDNIGHT_BLUE.</span>
<a name="l00203"></a>00203   {0, 0, 128, 255},      <span class="comment">// NAVY_BLUE.</span>
<a name="l00204"></a>00204   {192, 192, 255, 255},  <span class="comment">// SKY_BLUE.</span>
<a name="l00205"></a>00205   {64, 64, 128, 255},    <span class="comment">// SLATE_BLUE.</span>
<a name="l00206"></a>00206   {32, 32, 64, 255},     <span class="comment">// STEEL_BLUE.</span>
<a name="l00207"></a>00207   {255, 128, 128, 255},  <span class="comment">// CORAL.</span>
<a name="l00208"></a>00208   {128, 64, 0, 255},     <span class="comment">// BROWN.</span>
<a name="l00209"></a>00209   {128, 128, 0, 255},    <span class="comment">// SANDY_BROWN.</span>
<a name="l00210"></a>00210   {192, 192, 0, 255},    <span class="comment">// GOLD.</span>
<a name="l00211"></a>00211   {192, 192, 128, 255},  <span class="comment">// GOLDENROD.</span>
<a name="l00212"></a>00212   {0, 64, 0, 255},       <span class="comment">// DARK_GREEN.</span>
<a name="l00213"></a>00213   {32, 64, 0, 255},      <span class="comment">// DARK_OLIVE_GREEN.</span>
<a name="l00214"></a>00214   {64, 128, 0, 255},     <span class="comment">// FOREST_GREEN.</span>
<a name="l00215"></a>00215   {128, 255, 0, 255},    <span class="comment">// LIME_GREEN.</span>
<a name="l00216"></a>00216   {192, 255, 192, 255},  <span class="comment">// PALE_GREEN.</span>
<a name="l00217"></a>00217   {192, 255, 0, 255},    <span class="comment">// YELLOW_GREEN.</span>
<a name="l00218"></a>00218   {192, 192, 192, 255},  <span class="comment">// LIGHT_GREY.</span>
<a name="l00219"></a>00219   {64, 64, 128, 255},    <span class="comment">// DARK_SLATE_GREY.</span>
<a name="l00220"></a>00220   {64, 64, 64, 255},     <span class="comment">// DIM_GREY.</span>
<a name="l00221"></a>00221   {128, 128, 128, 255},  <span class="comment">// GREY.</span>
<a name="l00222"></a>00222   {64, 192, 0, 255},     <span class="comment">// KHAKI.</span>
<a name="l00223"></a>00223   {255, 0, 192, 255},    <span class="comment">// MAROON.</span>
<a name="l00224"></a>00224   {255, 128, 0, 255},    <span class="comment">// ORANGE.</span>
<a name="l00225"></a>00225   {255, 128, 64, 255},   <span class="comment">// ORCHID.</span>
<a name="l00226"></a>00226   {255, 192, 192, 255},  <span class="comment">// PINK.</span>
<a name="l00227"></a>00227   {128, 0, 128, 255},    <span class="comment">// PLUM.</span>
<a name="l00228"></a>00228   {255, 0, 64, 255},     <span class="comment">// INDIAN_RED.</span>
<a name="l00229"></a>00229   {255, 64, 0, 255},     <span class="comment">// ORANGE_RED.</span>
<a name="l00230"></a>00230   {255, 0, 192, 255},    <span class="comment">// VIOLET_RED.</span>
<a name="l00231"></a>00231   {255, 192, 128, 255},  <span class="comment">// SALMON.</span>
<a name="l00232"></a>00232   {128, 128, 0, 255},    <span class="comment">// TAN.</span>
<a name="l00233"></a>00233   {0, 255, 255, 255},    <span class="comment">// TURQUOISE.</span>
<a name="l00234"></a>00234   {0, 128, 128, 255},    <span class="comment">// DARK_TURQUOISE.</span>
<a name="l00235"></a>00235   {192, 0, 255, 255},    <span class="comment">// VIOLET.</span>
<a name="l00236"></a>00236   {128, 128, 0, 255},    <span class="comment">// WHEAT.</span>
<a name="l00237"></a>00237   {128, 255, 0, 255}     <span class="comment">// GREEN_YELLOW</span>
<a name="l00238"></a>00238 };
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">/*******************************************************************************</span>
<a name="l00242"></a>00242 <span class="comment">* Scrollview implementation.</span>
<a name="l00243"></a>00243 <span class="comment">*******************************************************************************/</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 <a class="code" href="class_s_v_network.html">SVNetwork</a>* ScrollView::stream_ = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00246"></a>00246 <span class="keywordtype">int</span> ScrollView::nr_created_windows_ = 0;
<a name="l00247"></a>00247 <span class="keywordtype">int</span> ScrollView::image_index_ = 0;
<a name="l00248"></a>00248 
<a name="l00250"></a><a class="code" href="class_scroll_view.html#ab0a7ca2226bf6cb2338dc12210df9605">00250</a> <a class="code" href="class_scroll_view.html#a0420563a900fd5b0b59f497ca6d34a09" title="Calls Initialize with default argument for server_name_ &amp; y_axis_reversed.">ScrollView::ScrollView</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> x_pos, <span class="keywordtype">int</span> y_pos, <span class="keywordtype">int</span> x_size,
<a name="l00251"></a>00251                        <span class="keywordtype">int</span> y_size, <span class="keywordtype">int</span> x_canvas_size, <span class="keywordtype">int</span> y_canvas_size,
<a name="l00252"></a>00252                        <span class="keywordtype">bool</span> y_axis_reversed, <span class="keyword">const</span> <span class="keywordtype">char</span>* server_name) {
<a name="l00253"></a>00253   Initialize(name, x_pos, y_pos, x_size, y_size, x_canvas_size, y_canvas_size,
<a name="l00254"></a>00254              y_axis_reversed, server_name);}
<a name="l00255"></a>00255 
<a name="l00257"></a><a class="code" href="class_scroll_view.html#adec5eebb678a6da1cc276bcb33ba41ef">00257</a> <a class="code" href="class_scroll_view.html#a0420563a900fd5b0b59f497ca6d34a09" title="Calls Initialize with default argument for server_name_ &amp; y_axis_reversed.">ScrollView::ScrollView</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> x_pos, <span class="keywordtype">int</span> y_pos, <span class="keywordtype">int</span> x_size,
<a name="l00258"></a>00258                        <span class="keywordtype">int</span> y_size, <span class="keywordtype">int</span> x_canvas_size, <span class="keywordtype">int</span> y_canvas_size,
<a name="l00259"></a>00259                        <span class="keywordtype">bool</span> y_axis_reversed) {
<a name="l00260"></a>00260   Initialize(name, x_pos, y_pos, x_size, y_size, x_canvas_size, y_canvas_size,
<a name="l00261"></a>00261              y_axis_reversed, <span class="stringliteral">&quot;localhost&quot;</span>);
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00265"></a><a class="code" href="class_scroll_view.html#a0420563a900fd5b0b59f497ca6d34a09">00265</a> <a class="code" href="class_scroll_view.html#a0420563a900fd5b0b59f497ca6d34a09" title="Calls Initialize with default argument for server_name_ &amp; y_axis_reversed.">ScrollView::ScrollView</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> x_pos, <span class="keywordtype">int</span> y_pos, <span class="keywordtype">int</span> x_size,
<a name="l00266"></a>00266                        <span class="keywordtype">int</span> y_size, <span class="keywordtype">int</span> x_canvas_size, <span class="keywordtype">int</span> y_canvas_size) {
<a name="l00267"></a>00267   Initialize(name, x_pos, y_pos, x_size, y_size, x_canvas_size, y_canvas_size,
<a name="l00268"></a>00268              <span class="keyword">false</span>, <span class="stringliteral">&quot;localhost&quot;</span>);
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00272"></a>00272 <span class="keywordtype">void</span> ScrollView::Initialize(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> x_pos, <span class="keywordtype">int</span> y_pos, <span class="keywordtype">int</span> x_size,
<a name="l00273"></a>00273                             <span class="keywordtype">int</span> y_size, <span class="keywordtype">int</span> x_canvas_size, <span class="keywordtype">int</span> y_canvas_size,
<a name="l00274"></a>00274                             <span class="keywordtype">bool</span> y_axis_reversed, <span class="keyword">const</span> <span class="keywordtype">char</span>* server_name) {
<a name="l00275"></a>00275   <span class="comment">// If this is the first ScrollView Window which gets created, there is no</span>
<a name="l00276"></a>00276   <span class="comment">// network connection yet and we have to set it up in a different thread.</span>
<a name="l00277"></a>00277   <span class="keywordflow">if</span> (stream_ == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00278"></a>00278     nr_created_windows_ = 0;
<a name="l00279"></a>00279     stream_ = <span class="keyword">new</span> <a class="code" href="class_s_v_network.html">SVNetwork</a>(server_name, <a class="code" href="scrollview_8cpp.html#a79eb5da6093373f064e897ad5aedc18c">kSvPort</a>);
<a name="l00280"></a>00280     waiting_for_events_mu = <span class="keyword">new</span> <a class="code" href="class_s_v_mutex.html">SVMutex</a>();
<a name="l00281"></a>00281     svmap_mu = <span class="keyword">new</span> <a class="code" href="class_s_v_mutex.html">SVMutex</a>();
<a name="l00282"></a>00282     <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(
<a name="l00283"></a>00283         <span class="stringliteral">&quot;svmain = luajava.bindClass(&#39;com.google.scrollview.ScrollView&#39;)\n&quot;</span>);
<a name="l00284"></a>00284     <a class="code" href="class_s_v_sync.html#a125c68e610da736499500f145601799a" title="Create new thread.">SVSync::StartThread</a>(MessageReceiver, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00285"></a>00285   }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   <span class="comment">// Set up the variables on the clientside.</span>
<a name="l00288"></a>00288   nr_created_windows_++;
<a name="l00289"></a>00289   event_handler_ = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00290"></a>00290   event_handler_ended_ = <span class="keyword">false</span>;
<a name="l00291"></a>00291   y_axis_is_reversed_ = y_axis_reversed;
<a name="l00292"></a>00292   y_size_ = y_canvas_size;
<a name="l00293"></a>00293   window_name_ = name;
<a name="l00294"></a>00294   window_id_ = nr_created_windows_;
<a name="l00295"></a>00295   <span class="comment">// Set up polygon buffering.</span>
<a name="l00296"></a>00296   points_ = <span class="keyword">new</span> <a class="code" href="struct_s_v_poly_line_buffer.html">SVPolyLineBuffer</a>;
<a name="l00297"></a>00297   points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">empty</a> = <span class="keyword">true</span>;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00300"></a>00300   svmap[window_id_] = <span class="keyword">this</span>;
<a name="l00301"></a>00301   svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0aeda6f98e68a05d6788490868c306ea7f">SVET_COUNT</a>; i++) {
<a name="l00304"></a>00304     event_table_[i] = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   mutex_ = <span class="keyword">new</span> <a class="code" href="class_s_v_mutex.html">SVMutex</a>();
<a name="l00308"></a>00308   semaphore_ = <span class="keyword">new</span> <a class="code" href="class_s_v_semaphore.html">SVSemaphore</a>();
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="comment">// Set up an actual Window on the client side.</span>
<a name="l00311"></a>00311   <span class="keywordtype">char</span> message[<a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>];
<a name="l00312"></a>00312   snprintf(message, <span class="keyword">sizeof</span>(message),
<a name="l00313"></a>00313            <span class="stringliteral">&quot;w%u = luajava.newInstance(&#39;com.google.scrollview.ui&quot;</span>
<a name="l00314"></a>00314            <span class="stringliteral">&quot;.SVWindow&#39;,&#39;%s&#39;,%u,%u,%u,%u,%u,%u,%u)\n&quot;</span>,
<a name="l00315"></a>00315            window_id_, window_name_, window_id_,
<a name="l00316"></a>00316            x_pos, y_pos, x_size, y_size, x_canvas_size, y_canvas_size);
<a name="l00317"></a>00317   <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(message);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <a class="code" href="class_s_v_sync.html#a125c68e610da736499500f145601799a" title="Create new thread.">SVSync::StartThread</a>(StartEventHandler, <span class="keyword">this</span>);
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00323"></a>00323 <span class="keywordtype">void</span>* ScrollView::StartEventHandler(<span class="keywordtype">void</span>* a) {
<a name="l00324"></a>00324   <a class="code" href="class_scroll_view.html">ScrollView</a>* sv = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="class_scroll_view.html">ScrollView</a>*<span class="keyword">&gt;</span>(a);
<a name="l00325"></a>00325   <a class="code" href="struct_s_v_event.html">SVEvent</a>* new_event;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="keywordflow">do</span> {
<a name="l00328"></a>00328     stream_-&gt;<a class="code" href="class_s_v_network.html#ad89f207ad0f1b7fa764e2edb37c0e2c0" title="Flush the buffer.">Flush</a>();
<a name="l00329"></a>00329     sv-&gt;semaphore_-&gt;<a class="code" href="class_s_v_semaphore.html#a83a06106c3881b8248fd907029583902" title="Wait on a semaphore.">Wait</a>();
<a name="l00330"></a>00330     new_event = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00331"></a>00331     <span class="keywordtype">int</span> serial = -1;
<a name="l00332"></a>00332     <span class="keywordtype">int</span> k = -1;
<a name="l00333"></a>00333     sv-&gt;mutex_-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00334"></a>00334     <span class="comment">// Check every table entry if he is is valid and not already processed.</span>
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0aeda6f98e68a05d6788490868c306ea7f">SVET_COUNT</a>; i++) {
<a name="l00337"></a>00337       <span class="keywordflow">if</span> (sv-&gt;event_table_[i] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00338"></a>00338           (serial &lt; 0 || sv-&gt;event_table_[i]-&gt;counter &lt; serial)) {
<a name="l00339"></a>00339         new_event = sv-&gt;event_table_[i];
<a name="l00340"></a>00340         serial = sv-&gt;event_table_[i]-&gt;<a class="code" href="struct_s_v_event.html#a899b70794c509a3c06e9c5c9fc251780">counter</a>;
<a name="l00341"></a>00341         k = i;
<a name="l00342"></a>00342       }
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344     <span class="comment">// If we didnt find anything we had an old alarm and just sleep again.</span>
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (new_event != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00346"></a>00346       sv-&gt;event_table_[k] = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00347"></a>00347       sv-&gt;mutex_-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00348"></a>00348       <span class="keywordflow">if</span> (sv-&gt;event_handler_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { sv-&gt;event_handler_-&gt;<a class="code" href="class_s_v_event_handler.html#a7f4f886aeca11e15ceab97833f070887">Notify</a>(new_event); }
<a name="l00349"></a>00349       <span class="keywordflow">if</span> (new_event-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a> == <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0adbe9fb2ca110dbf1b838d845d32a89e7">SVET_DESTROY</a>) {
<a name="l00350"></a>00350         <span class="comment">// Signal the destructor that it is safe to terminate.</span>
<a name="l00351"></a>00351         sv-&gt;event_handler_ended_ = <span class="keyword">true</span>;
<a name="l00352"></a>00352         sv = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00353"></a>00353       }
<a name="l00354"></a>00354       <span class="keyword">delete</span> new_event;  <span class="comment">// Delete the pointer after it has been processed.</span>
<a name="l00355"></a>00355     } <span class="keywordflow">else</span> { sv-&gt;mutex_-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>(); }
<a name="l00356"></a>00356   <span class="comment">// The thread should run as long as its associated window is alive.</span>
<a name="l00357"></a>00357   } <span class="keywordflow">while</span> (sv != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00358"></a>00358   <span class="keywordflow">return</span> 0;
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="class_scroll_view.html#a4a5220ac36e0c7d03973be1bdde8d7a1">00361</a> <a class="code" href="class_scroll_view.html#a4a5220ac36e0c7d03973be1bdde8d7a1">ScrollView::~ScrollView</a>() {
<a name="l00362"></a>00362   svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00363"></a>00363   <span class="keywordflow">if</span> (svmap[window_id_] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00364"></a>00364     svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00365"></a>00365     <span class="comment">// So the event handling thread can quit.</span>
<a name="l00366"></a>00366     <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;destroy()&quot;</span>);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <a class="code" href="struct_s_v_event.html">SVEvent</a>* sve = <a class="code" href="class_scroll_view.html#a0b820b3fe7a2ce083da0784e9339a1ad">AwaitEvent</a>(<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0adbe9fb2ca110dbf1b838d845d32a89e7">SVET_DESTROY</a>);
<a name="l00369"></a>00369     <span class="keyword">delete</span> sve;
<a name="l00370"></a>00370     svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00371"></a>00371     svmap[window_id_] = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00372"></a>00372     svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00373"></a>00373     <span class="comment">// The event handler thread for this window *must* receive the</span>
<a name="l00374"></a>00374     <span class="comment">// destroy event and set its pointer to this to NULL before we allow</span>
<a name="l00375"></a>00375     <span class="comment">// the destructor to exit.</span>
<a name="l00376"></a>00376     <span class="keywordflow">while</span> (!event_handler_ended_)
<a name="l00377"></a>00377       <a class="code" href="class_scroll_view.html#a0830a51981a20c8700b5ec49137e46e9">Update</a>();
<a name="l00378"></a>00378   } <span class="keywordflow">else</span> {
<a name="l00379"></a>00379     svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00380"></a>00380   }
<a name="l00381"></a>00381   <span class="keyword">delete</span> mutex_;
<a name="l00382"></a>00382   <span class="keyword">delete</span> semaphore_;
<a name="l00383"></a>00383   <span class="keyword">delete</span> points_;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00387"></a><a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a">00387</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">ScrollView::SendMsg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...) {
<a name="l00388"></a>00388   <span class="keywordflow">if</span> (!points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">empty</a>)
<a name="l00389"></a>00389     SendPolygon();
<a name="l00390"></a>00390   va_list args;
<a name="l00391"></a>00391   <span class="keywordtype">char</span> message[<a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>];
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   va_start(args, format);  <span class="comment">// variable list</span>
<a name="l00394"></a>00394   vsnprintf(message, <a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>, format, args);
<a name="l00395"></a>00395   va_end(args);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="keywordtype">char</span> form[<a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>];
<a name="l00398"></a>00398   snprintf(form, <a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>, <span class="stringliteral">&quot;w%u:%s\n&quot;</span>, window_id_, message);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400   stream_-&gt;<a class="code" href="class_s_v_network.html#a2de9fb634926d1ffc46b617e87d129f6" title="Put a message in the messagebuffer to the server and try to send it.">Send</a>(form);
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00405"></a><a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">00405</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">ScrollView::SendRawMessage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg) {
<a name="l00406"></a>00406   stream_-&gt;<a class="code" href="class_s_v_network.html#a2de9fb634926d1ffc46b617e87d129f6" title="Put a message in the messagebuffer to the server and try to send it.">Send</a>(msg);
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00410"></a><a class="code" href="class_scroll_view.html#a598dcb006fb07910229fcfcf1ee05543">00410</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a598dcb006fb07910229fcfcf1ee05543" title="Add an Event Listener to this ScrollView Window.">ScrollView::AddEventHandler</a>(<a class="code" href="class_s_v_event_handler.html">SVEventHandler</a>* listener) {
<a name="l00411"></a>00411   event_handler_ = listener;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="keywordtype">void</span> ScrollView::Signal() {
<a name="l00415"></a>00415   semaphore_-&gt;<a class="code" href="class_s_v_semaphore.html#aed4f0b877daff9550350035478a2356c" title="Signal a semaphore.">Signal</a>();
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <span class="keywordtype">void</span> ScrollView::SetEvent(<a class="code" href="struct_s_v_event.html">SVEvent</a>* svevent) {
<a name="l00419"></a>00419 <span class="comment">// Copy event</span>
<a name="l00420"></a>00420   <a class="code" href="struct_s_v_event.html">SVEvent</a>* any = svevent-&gt;<a class="code" href="struct_s_v_event.html#a4623a97ad24f2d850490a6533f680432">copy</a>();
<a name="l00421"></a>00421   <a class="code" href="struct_s_v_event.html">SVEvent</a>* specific = svevent-&gt;<a class="code" href="struct_s_v_event.html#a4623a97ad24f2d850490a6533f680432">copy</a>();
<a name="l00422"></a>00422   any-&gt;<a class="code" href="struct_s_v_event.html#a899b70794c509a3c06e9c5c9fc251780">counter</a> = specific-&gt;<a class="code" href="struct_s_v_event.html#a899b70794c509a3c06e9c5c9fc251780">counter</a> + 1;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="comment">// Place both events into the queue.</span>
<a name="l00425"></a>00425   mutex_-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00426"></a>00426   <span class="comment">// Delete the old objects..</span>
<a name="l00427"></a>00427   <span class="keywordflow">if</span> (event_table_[specific-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a>] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00428"></a>00428     <span class="keyword">delete</span> event_table_[specific-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a>]; }
<a name="l00429"></a>00429   <span class="keywordflow">if</span> (event_table_[<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a6eec81ed585bda7ff47ec38918cb2a0e">SVET_ANY</a>] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00430"></a>00430     <span class="keyword">delete</span> event_table_[<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a6eec81ed585bda7ff47ec38918cb2a0e">SVET_ANY</a>]; }
<a name="l00431"></a>00431   <span class="comment">// ...and put the new ones in the table.</span>
<a name="l00432"></a>00432   event_table_[specific-&gt;<a class="code" href="struct_s_v_event.html#a5bf8585bd1901b9103eb2783f8afe508">type</a>] = specific;
<a name="l00433"></a>00433   event_table_[<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a6eec81ed585bda7ff47ec38918cb2a0e">SVET_ANY</a>] = any;
<a name="l00434"></a>00434   mutex_-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 
<a name="l00441"></a><a class="code" href="class_scroll_view.html#a0b820b3fe7a2ce083da0784e9339a1ad">00441</a> <a class="code" href="struct_s_v_event.html">SVEvent</a>* <a class="code" href="class_scroll_view.html#a0b820b3fe7a2ce083da0784e9339a1ad">ScrollView::AwaitEvent</a>(<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0">SVEventType</a> type) {
<a name="l00442"></a>00442   <span class="comment">// Initialize the waiting semaphore.</span>
<a name="l00443"></a>00443   <a class="code" href="class_s_v_semaphore.html">SVSemaphore</a>* sem = <span class="keyword">new</span> <a class="code" href="class_s_v_semaphore.html">SVSemaphore</a>();
<a name="l00444"></a>00444   std::pair&lt;ScrollView*, SVEventType&gt; ea(<span class="keyword">this</span>, type);
<a name="l00445"></a>00445   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00446"></a>00446   waiting_for_events[ea] = std::pair&lt;SVSemaphore*, SVEvent*&gt; (sem, (<a class="code" href="struct_s_v_event.html">SVEvent</a>*)0);
<a name="l00447"></a>00447   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00448"></a>00448   <span class="comment">// Wait on it, but first flush.</span>
<a name="l00449"></a>00449   stream_-&gt;<a class="code" href="class_s_v_network.html#ad89f207ad0f1b7fa764e2edb37c0e2c0" title="Flush the buffer.">Flush</a>();
<a name="l00450"></a>00450   sem-&gt;Wait();
<a name="l00451"></a>00451   <span class="comment">// Process the event we got woken up for (its in waiting_for_events pair).</span>
<a name="l00452"></a>00452   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00453"></a>00453   <a class="code" href="struct_s_v_event.html">SVEvent</a>* ret = waiting_for_events[ea].second;
<a name="l00454"></a>00454   waiting_for_events.erase(ea);
<a name="l00455"></a>00455   <span class="keyword">delete</span> sem;
<a name="l00456"></a>00456   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00457"></a>00457   <span class="keywordflow">return</span> ret;
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="comment">// Block until any event on any window is received.</span>
<a name="l00461"></a>00461 <span class="comment">// No event is returned here!</span>
<a name="l00462"></a><a class="code" href="class_scroll_view.html#a463daf8c21aaf4da30171128257b53f9">00462</a> <a class="code" href="struct_s_v_event.html">SVEvent</a>* <a class="code" href="class_scroll_view.html#a463daf8c21aaf4da30171128257b53f9">ScrollView::AwaitEventAnyWindow</a>() {
<a name="l00463"></a>00463   <span class="comment">// Initialize the waiting semaphore.</span>
<a name="l00464"></a>00464   <a class="code" href="class_s_v_semaphore.html">SVSemaphore</a>* sem = <span class="keyword">new</span> <a class="code" href="class_s_v_semaphore.html">SVSemaphore</a>();
<a name="l00465"></a>00465   std::pair&lt;ScrollView*, SVEventType&gt; ea((<a class="code" href="class_scroll_view.html">ScrollView</a>*)0, <a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0a6eec81ed585bda7ff47ec38918cb2a0e">SVET_ANY</a>);
<a name="l00466"></a>00466   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00467"></a>00467   waiting_for_events[ea] = std::pair&lt;SVSemaphore*, SVEvent*&gt; (sem, (<a class="code" href="struct_s_v_event.html">SVEvent</a>*)0);
<a name="l00468"></a>00468   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00469"></a>00469   <span class="comment">// Wait on it.</span>
<a name="l00470"></a>00470   stream_-&gt;<a class="code" href="class_s_v_network.html#ad89f207ad0f1b7fa764e2edb37c0e2c0" title="Flush the buffer.">Flush</a>();
<a name="l00471"></a>00471   sem-&gt;Wait();
<a name="l00472"></a>00472   <span class="comment">// Process the event we got woken up for (its in waiting_for_events pair).</span>
<a name="l00473"></a>00473   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00474"></a>00474   <a class="code" href="struct_s_v_event.html">SVEvent</a>* ret = waiting_for_events[ea].second;
<a name="l00475"></a>00475   waiting_for_events.erase(ea);
<a name="l00476"></a>00476   waiting_for_events_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00477"></a>00477   <span class="keywordflow">return</span> ret;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="comment">// Send the current buffered polygon (if any) and clear it.</span>
<a name="l00481"></a>00481 <span class="keywordtype">void</span> ScrollView::SendPolygon() {
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (!points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">empty</a>) {
<a name="l00483"></a>00483     points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">empty</a> = <span class="keyword">true</span>;  <span class="comment">// Allows us to use SendMsg.</span>
<a name="l00484"></a>00484     <span class="keywordtype">int</span> length = points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.size();
<a name="l00485"></a>00485     <span class="comment">// length == 1 corresponds to 2 SetCursors in a row and only the</span>
<a name="l00486"></a>00486     <span class="comment">// last setCursor has any effect.</span>
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (length == 2) {
<a name="l00488"></a>00488       <span class="comment">// An isolated line!</span>
<a name="l00489"></a>00489       <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawLine(%d,%d,%d,%d)&quot;</span>,
<a name="l00490"></a>00490               points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>[0], points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>[0],
<a name="l00491"></a>00491               points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>[1], points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>[1]);
<a name="l00492"></a>00492     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length &gt; 2) {
<a name="l00493"></a>00493       <span class="comment">// A polyline.</span>
<a name="l00494"></a>00494       <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;createPolyline(%d)&quot;</span>, length);
<a name="l00495"></a>00495       <span class="keywordtype">char</span> coordpair[<a class="code" href="scrollview_8cpp.html#ae89c23582ae7fd97e4884a7402d8959c">kMaxIntPairSize</a>];
<a name="l00496"></a>00496       std::string decimal_coords;
<a name="l00497"></a>00497       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; length; ++i) {
<a name="l00498"></a>00498         snprintf(coordpair, <a class="code" href="scrollview_8cpp.html#ae89c23582ae7fd97e4884a7402d8959c">kMaxIntPairSize</a>, <span class="stringliteral">&quot;%d,%d,&quot;</span>,
<a name="l00499"></a>00499                  points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>[i], points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>[i]);
<a name="l00500"></a>00500         decimal_coords += coordpair;
<a name="l00501"></a>00501       }
<a name="l00502"></a>00502       decimal_coords += <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00503"></a>00503       <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(decimal_coords.c_str());
<a name="l00504"></a>00504       <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawPolyline()&quot;</span>);
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506     points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.clear();
<a name="l00507"></a>00507     points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>.clear();
<a name="l00508"></a>00508   }
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="comment">/*******************************************************************************</span>
<a name="l00513"></a>00513 <span class="comment">* LUA &quot;API&quot; functions.</span>
<a name="l00514"></a>00514 <span class="comment">*******************************************************************************/</span>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="comment">// Sets the position from which to draw to (x,y).</span>
<a name="l00517"></a><a class="code" href="class_scroll_view.html#a730b182e350dfe37b0986d7f0591fee5">00517</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a730b182e350dfe37b0986d7f0591fee5">ScrollView::SetCursor</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y) {
<a name="l00518"></a>00518   SendPolygon();
<a name="l00519"></a>00519   <a class="code" href="class_scroll_view.html#a101de80a4722fe821969f61f6e7303a6">DrawTo</a>(x, y);
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="comment">// Draws from the current position to (x,y) and sets the new position to it.</span>
<a name="l00523"></a><a class="code" href="class_scroll_view.html#a101de80a4722fe821969f61f6e7303a6">00523</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a101de80a4722fe821969f61f6e7303a6">ScrollView::DrawTo</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y) {
<a name="l00524"></a>00524   points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.push_back(x);
<a name="l00525"></a>00525   points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>.push_back(<a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y));
<a name="l00526"></a>00526   points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a4845d1075be2adfc225ad2f084967c0d">empty</a> = <span class="keyword">false</span>;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">// Draw a line using the current pen color.</span>
<a name="l00530"></a><a class="code" href="class_scroll_view.html#a2ba16f17fc401bb28be1a08160207e45">00530</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a2ba16f17fc401bb28be1a08160207e45">ScrollView::Line</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2) {
<a name="l00531"></a>00531   <span class="keywordflow">if</span> (!points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.empty() &amp;&amp; x1 == points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.back() &amp;&amp;
<a name="l00532"></a>00532       <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y1) == points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>.back()) {
<a name="l00533"></a>00533     <span class="comment">// We are already at x1, y1, so just draw to x2, y2.</span>
<a name="l00534"></a>00534     <a class="code" href="class_scroll_view.html#a101de80a4722fe821969f61f6e7303a6">DrawTo</a>(x2, y2);
<a name="l00535"></a>00535   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.empty() &amp;&amp; x2 == points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a173b50f037a7dd74903dc2a90f6f6c35">xcoords</a>.back() &amp;&amp;
<a name="l00536"></a>00536       <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y2) == points_-&gt;<a class="code" href="struct_s_v_poly_line_buffer.html#a6c1e6afb4e159c283f9a4cde91457960">ycoords</a>.back()) {
<a name="l00537"></a>00537     <span class="comment">// We are already at x2, y2, so just draw to x1, y1.</span>
<a name="l00538"></a>00538     <a class="code" href="class_scroll_view.html#a101de80a4722fe821969f61f6e7303a6">DrawTo</a>(x1, y1);
<a name="l00539"></a>00539   } <span class="keywordflow">else</span> {
<a name="l00540"></a>00540     <span class="comment">// This is a new line.</span>
<a name="l00541"></a>00541     <a class="code" href="class_scroll_view.html#a730b182e350dfe37b0986d7f0591fee5">SetCursor</a>(x1, y1);
<a name="l00542"></a>00542     <a class="code" href="class_scroll_view.html#a101de80a4722fe821969f61f6e7303a6">DrawTo</a>(x2, y2);
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="comment">// Set the visibility of the window.</span>
<a name="l00547"></a><a class="code" href="class_scroll_view.html#a9b065fb8e11357d41bb0f55a510e9f40">00547</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a9b065fb8e11357d41bb0f55a510e9f40">ScrollView::SetVisible</a>(<span class="keywordtype">bool</span> visible) {
<a name="l00548"></a>00548   <span class="keywordflow">if</span> (visible) { <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;setVisible(true)&quot;</span>);
<a name="l00549"></a>00549   } <span class="keywordflow">else</span> { <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;setVisible(false)&quot;</span>); }
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 <span class="comment">// Set the alwaysOnTop flag.</span>
<a name="l00553"></a><a class="code" href="class_scroll_view.html#a8ed1dae1c986a3cad1571edfe40a97dd">00553</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a8ed1dae1c986a3cad1571edfe40a97dd">ScrollView::AlwaysOnTop</a>(<span class="keywordtype">bool</span> b) {
<a name="l00554"></a>00554   <span class="keywordflow">if</span> (b) { <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;setAlwaysOnTop(true)&quot;</span>);
<a name="l00555"></a>00555   } <span class="keywordflow">else</span> { <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;setAlwaysOnTop(false)&quot;</span>); }
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">// Adds a message entry to the message box.</span>
<a name="l00559"></a><a class="code" href="class_scroll_view.html#aeeb2a822cfbad2f87696eacc79774027">00559</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#aeeb2a822cfbad2f87696eacc79774027">ScrollView::AddMessage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...) {
<a name="l00560"></a>00560   va_list args;
<a name="l00561"></a>00561   <span class="keywordtype">char</span> message[<a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>];
<a name="l00562"></a>00562   <span class="keywordtype">char</span> form[<a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>];
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   va_start(args, format);  <span class="comment">// variable list</span>
<a name="l00565"></a>00565   vsnprintf(message, <a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>, format, args);
<a name="l00566"></a>00566   va_end(args);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   snprintf(form, <a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>, <span class="stringliteral">&quot;w%u:%s&quot;</span>, window_id_, message);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570   <span class="keywordtype">char</span>* esc = AddEscapeChars(form);
<a name="l00571"></a>00571   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addMessage(\&quot;%s\&quot;)&quot;</span>, esc);
<a name="l00572"></a>00572   <span class="keyword">delete</span>[] esc;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <span class="comment">// Set a messagebox.</span>
<a name="l00576"></a><a class="code" href="class_scroll_view.html#a24426b6b054999946f9acd3bc7479b54">00576</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a24426b6b054999946f9acd3bc7479b54">ScrollView::AddMessageBox</a>() {
<a name="l00577"></a>00577   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addMessageBox()&quot;</span>);
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="comment">// Exit the client completely (and notify the server of it).</span>
<a name="l00581"></a><a class="code" href="class_scroll_view.html#a0114095f359d22a67375f19f8c8d2bd7">00581</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a0114095f359d22a67375f19f8c8d2bd7">ScrollView::Exit</a>() {
<a name="l00582"></a>00582   <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(<span class="stringliteral">&quot;svmain:exit()&quot;</span>);
<a name="l00583"></a>00583   exit(0);
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 <span class="comment">// Clear the canvas.</span>
<a name="l00587"></a><a class="code" href="class_scroll_view.html#a5386b0da16d7cbdd33044e53b95313ac">00587</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a5386b0da16d7cbdd33044e53b95313ac">ScrollView::Clear</a>() {
<a name="l00588"></a>00588   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;clear()&quot;</span>);
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="comment">// Set the stroke width.</span>
<a name="l00592"></a><a class="code" href="class_scroll_view.html#aea3a39b8d64aa9ad15ec2e33e4a6e286">00592</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#aea3a39b8d64aa9ad15ec2e33e4a6e286">ScrollView::Stroke</a>(<span class="keywordtype">float</span> width) {
<a name="l00593"></a>00593   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;setStrokeWidth(%f)&quot;</span>, width);
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="comment">// Draw a rectangle using the current pen color.</span>
<a name="l00597"></a>00597 <span class="comment">// The rectangle is filled with the current brush color.</span>
<a name="l00598"></a><a class="code" href="class_scroll_view.html#ac2a8fdf5d37967ea4a298dc092b6ed0e">00598</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#ac2a8fdf5d37967ea4a298dc092b6ed0e">ScrollView::Rectangle</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2) {
<a name="l00599"></a>00599   <span class="keywordflow">if</span> (x1 == x2 &amp;&amp; y1 == y2)
<a name="l00600"></a>00600     <span class="keywordflow">return</span>;  <span class="comment">// Scrollviewer locks up.</span>
<a name="l00601"></a>00601   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawRectangle(%d,%d,%d,%d)&quot;</span>,
<a name="l00602"></a>00602     x1, <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y1), x2, <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y2));
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 <span class="comment">// Draw an ellipse using the current pen color.</span>
<a name="l00606"></a>00606 <span class="comment">// The ellipse is filled with the current brush color.</span>
<a name="l00607"></a><a class="code" href="class_scroll_view.html#a2c2cf6a263579ef46cbc8933c02e3549">00607</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a2c2cf6a263579ef46cbc8933c02e3549">ScrollView::Ellipse</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) {
<a name="l00608"></a>00608   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawEllipse(%d,%d,%u,%u)&quot;</span>,
<a name="l00609"></a>00609     x1, <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y1), width, height);
<a name="l00610"></a>00610 }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="comment">// Set the pen color to the given RGB values.</span>
<a name="l00613"></a><a class="code" href="class_scroll_view.html#a34929057291998178b2635cf4b7775fe">00613</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">ScrollView::Pen</a>(<span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue) {
<a name="l00614"></a>00614   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;pen(%d,%d,%d)&quot;</span>, red, green, blue);
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="comment">// Set the pen color to the given RGB values.</span>
<a name="l00618"></a><a class="code" href="class_scroll_view.html#ae3ea809b51a795b6fd88273057ebf3bd">00618</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">ScrollView::Pen</a>(<span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue, <span class="keywordtype">int</span> alpha) {
<a name="l00619"></a>00619   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;pen(%d,%d,%d,%d)&quot;</span>, red, green, blue, alpha);
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="comment">// Set the brush color to the given RGB values.</span>
<a name="l00623"></a><a class="code" href="class_scroll_view.html#a5c8c0c87b482e41dfabb476d09dae408">00623</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">ScrollView::Brush</a>(<span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue) {
<a name="l00624"></a>00624   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;brush(%d,%d,%d)&quot;</span>, red, green, blue);
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 <span class="comment">// Set the brush color to the given RGB values.</span>
<a name="l00628"></a><a class="code" href="class_scroll_view.html#a4cdf11cf1e7b5bcad6d92295ebabdcf3">00628</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">ScrollView::Brush</a>(<span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue, <span class="keywordtype">int</span> alpha) {
<a name="l00629"></a>00629   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;brush(%d,%d,%d,%d)&quot;</span>, red, green, blue, alpha);
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632 <span class="comment">// Set the attributes for future Text(..) calls.</span>
<a name="l00633"></a><a class="code" href="class_scroll_view.html#a2e1d3849b95cecdcb2026b48d8f38cde">00633</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a2e1d3849b95cecdcb2026b48d8f38cde">ScrollView::TextAttributes</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* font, <span class="keywordtype">int</span> pixel_size,
<a name="l00634"></a>00634                                 <span class="keywordtype">bool</span> bold, <span class="keywordtype">bool</span> italic, <span class="keywordtype">bool</span> underlined) {
<a name="l00635"></a>00635   <span class="keyword">const</span> <span class="keywordtype">char</span>* b;
<a name="l00636"></a>00636   <span class="keyword">const</span> <span class="keywordtype">char</span>* i;
<a name="l00637"></a>00637   <span class="keyword">const</span> <span class="keywordtype">char</span>* u;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="keywordflow">if</span> (bold) { b = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00640"></a>00640   } <span class="keywordflow">else</span> { b = <span class="stringliteral">&quot;false&quot;</span>; }
<a name="l00641"></a>00641   <span class="keywordflow">if</span> (italic) { i = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00642"></a>00642   } <span class="keywordflow">else</span> { i = <span class="stringliteral">&quot;false&quot;</span>; }
<a name="l00643"></a>00643   <span class="keywordflow">if</span> (underlined) { u = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00644"></a>00644   } <span class="keywordflow">else</span> { u = <span class="stringliteral">&quot;false&quot;</span>; }
<a name="l00645"></a>00645   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;textAttributes(&#39;%s&#39;,%u,%s,%s,%s)&quot;</span>, font, pixel_size,
<a name="l00646"></a>00646     b, i, u);
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 <span class="comment">// Draw text at the given coordinates.</span>
<a name="l00650"></a><a class="code" href="class_scroll_view.html#a4c5cb55d6eab9d7d996d25ed8922593d">00650</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a4c5cb55d6eab9d7d996d25ed8922593d">ScrollView::Text</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <span class="keywordtype">char</span>* mystring) {
<a name="l00651"></a>00651   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawText(%d,%d,&#39;%s&#39;)&quot;</span>, x, <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y), mystring);
<a name="l00652"></a>00652 }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 <span class="comment">// Open and draw an image given a name at (x,y).</span>
<a name="l00655"></a><a class="code" href="class_scroll_view.html#a68bfeb426addd08adab87389472e4a79">00655</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a45881e629322d82c9fc0c5f926a76f16">ScrollView::Image</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* image, <span class="keywordtype">int</span> x_pos, <span class="keywordtype">int</span> y_pos) {
<a name="l00656"></a>00656   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;openImage(&#39;%s&#39;)&quot;</span>, image);
<a name="l00657"></a>00657   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawImage(&#39;%s&#39;,%d,%d)&quot;</span>,
<a name="l00658"></a>00658                 image, x_pos, <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y_pos));
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="comment">// Add new checkboxmenuentry to menubar.</span>
<a name="l00662"></a><a class="code" href="class_scroll_view.html#a2388f89653ef8b1b6ed0e19e66b73f0d">00662</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a08a6a071e1c7705a87664c8a8af70e5f">ScrollView::MenuItem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name,
<a name="l00663"></a>00663                           <span class="keywordtype">int</span> cmdEvent, <span class="keywordtype">bool</span> flag) {
<a name="l00664"></a>00664   <span class="keywordflow">if</span> (parent == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { parent = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00665"></a>00665   <span class="keywordflow">if</span> (flag) { <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addMenuBarItem(&#39;%s&#39;,&#39;%s&#39;,%d,true)&quot;</span>,
<a name="l00666"></a>00666                       parent, name, cmdEvent);
<a name="l00667"></a>00667   } <span class="keywordflow">else</span> { <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addMenuBarItem(&#39;%s&#39;,&#39;%s&#39;,%d,false)&quot;</span>,
<a name="l00668"></a>00668                    parent, name, cmdEvent); }
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="comment">// Add new menuentry to menubar.</span>
<a name="l00672"></a><a class="code" href="class_scroll_view.html#a3c054590931dcf5285c088749939e861">00672</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a08a6a071e1c7705a87664c8a8af70e5f">ScrollView::MenuItem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> cmdEvent) {
<a name="l00673"></a>00673   <span class="keywordflow">if</span> (parent == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { parent = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00674"></a>00674   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addMenuBarItem(&#39;%s&#39;,&#39;%s&#39;,%d)&quot;</span>, parent, name, cmdEvent);
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 <span class="comment">// Add new submenu to menubar.</span>
<a name="l00678"></a><a class="code" href="class_scroll_view.html#a08a6a071e1c7705a87664c8a8af70e5f">00678</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a08a6a071e1c7705a87664c8a8af70e5f">ScrollView::MenuItem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {
<a name="l00679"></a>00679   <span class="keywordflow">if</span> (parent == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { parent = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00680"></a>00680   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addMenuBarItem(&#39;%s&#39;,&#39;%s&#39;)&quot;</span>, parent, name);
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 <span class="comment">// Add new submenu to popupmenu.</span>
<a name="l00684"></a><a class="code" href="class_scroll_view.html#a245a24cbd1ad39085e450765980113e1">00684</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a245a24cbd1ad39085e450765980113e1">ScrollView::PopupItem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {
<a name="l00685"></a>00685   <span class="keywordflow">if</span> (parent == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { parent = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00686"></a>00686   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addPopupMenuItem(&#39;%s&#39;,&#39;%s&#39;)&quot;</span>, parent, name);
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="comment">// Add new submenuentry to popupmenu.</span>
<a name="l00690"></a><a class="code" href="class_scroll_view.html#ad9671cdaa4e47c782138f0e99ec1da20">00690</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a245a24cbd1ad39085e450765980113e1">ScrollView::PopupItem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name,
<a name="l00691"></a>00691                            <span class="keywordtype">int</span> cmdEvent, <span class="keyword">const</span> <span class="keywordtype">char</span>* value, <span class="keyword">const</span> <span class="keywordtype">char</span>* desc) {
<a name="l00692"></a>00692   <span class="keywordflow">if</span> (parent == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { parent = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l00693"></a>00693   <span class="keywordtype">char</span>* esc = AddEscapeChars(value);
<a name="l00694"></a>00694   <span class="keywordtype">char</span>* esc2 = AddEscapeChars(desc);
<a name="l00695"></a>00695   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;addPopupMenuItem(&#39;%s&#39;,&#39;%s&#39;,%d,&#39;%s&#39;,&#39;%s&#39;)&quot;</span>, parent, name,
<a name="l00696"></a>00696           cmdEvent, esc, esc2);
<a name="l00697"></a>00697   <span class="keyword">delete</span>[] esc;
<a name="l00698"></a>00698   <span class="keyword">delete</span>[] esc2;
<a name="l00699"></a>00699 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="comment">// Send an update message for a single window.</span>
<a name="l00702"></a><a class="code" href="class_scroll_view.html#a609e2f95d6421deb558244f5d45cf25a">00702</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a609e2f95d6421deb558244f5d45cf25a">ScrollView::UpdateWindow</a>() {
<a name="l00703"></a>00703   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;update()&quot;</span>);
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 <span class="comment">// Note: this is an update to all windows</span>
<a name="l00707"></a><a class="code" href="class_scroll_view.html#a0830a51981a20c8700b5ec49137e46e9">00707</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a0830a51981a20c8700b5ec49137e46e9">ScrollView::Update</a>() {
<a name="l00708"></a>00708   svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#ac2a19e2b7ce47e75ee1f72870574e41f" title="Locks on a mutex.">Lock</a>();
<a name="l00709"></a>00709   <span class="keywordflow">for</span> (std::map&lt;int, ScrollView*&gt;::iterator iter = svmap.begin();
<a name="l00710"></a>00710       iter != svmap.end(); ++iter) {
<a name="l00711"></a>00711     <span class="keywordflow">if</span> (iter-&gt;second != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00712"></a>00712       iter-&gt;second-&gt;UpdateWindow();
<a name="l00713"></a>00713   }
<a name="l00714"></a>00714   svmap_mu-&gt;<a class="code" href="class_s_v_mutex.html#aa70f2446491c0de56b69eba6dd877f31" title="Unlocks on a mutex.">Unlock</a>();
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 <span class="comment">// Set the pen color, using an enum value (e.g. ScrollView::ORANGE)</span>
<a name="l00718"></a><a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">00718</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">ScrollView::Pen</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">Color</a> color) {
<a name="l00719"></a>00719   <a class="code" href="class_scroll_view.html#a79855c525ec660b452382e9813d2edb5">Pen</a>(table_colors[color][0], table_colors[color][1],
<a name="l00720"></a>00720       table_colors[color][2], table_colors[color][3]);
<a name="l00721"></a>00721 }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="comment">// Set the brush color, using an enum value (e.g. ScrollView::ORANGE)</span>
<a name="l00724"></a><a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">00724</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">ScrollView::Brush</a>(<a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8">Color</a> color) {
<a name="l00725"></a>00725   <a class="code" href="class_scroll_view.html#ad5f03af259325c42eaaffa843cd1fdde">Brush</a>(table_colors[color][0],
<a name="l00726"></a>00726         table_colors[color][1],
<a name="l00727"></a>00727         table_colors[color][2],
<a name="l00728"></a>00728         table_colors[color][3]);
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">// Shows a modal Input Dialog which can return any kind of String</span>
<a name="l00732"></a><a class="code" href="class_scroll_view.html#ac8df851fca17eed55ad4e70d27104265">00732</a> <span class="keywordtype">char</span>* <a class="code" href="class_scroll_view.html#ac8df851fca17eed55ad4e70d27104265">ScrollView::ShowInputDialog</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg) {
<a name="l00733"></a>00733   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;showInputDialog(\&quot;%s\&quot;)&quot;</span>, msg);
<a name="l00734"></a>00734   <a class="code" href="struct_s_v_event.html">SVEvent</a>* ev;
<a name="l00735"></a>00735   <span class="comment">// wait till an input event (all others are thrown away)</span>
<a name="l00736"></a>00736   ev = <a class="code" href="class_scroll_view.html#a0b820b3fe7a2ce083da0784e9339a1ad">AwaitEvent</a>(<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0aee5f6202613f111d11fc310ccba2fa25">SVET_INPUT</a>);
<a name="l00737"></a>00737   <span class="keywordtype">char</span>* p = <span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(ev-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>) + 1];
<a name="l00738"></a>00738   strncpy(p, ev-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>, strlen(ev-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>));
<a name="l00739"></a>00739   p[strlen(ev-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>)] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00740"></a>00740   <span class="keyword">delete</span> ev;
<a name="l00741"></a>00741   <span class="keywordflow">return</span> p;
<a name="l00742"></a>00742 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744 <span class="comment">// Shows a modal Yes/No Dialog which will return &#39;y&#39; or &#39;n&#39;</span>
<a name="l00745"></a><a class="code" href="class_scroll_view.html#ab4e471faa54fa9399eac548094734167">00745</a> <span class="keywordtype">int</span> <a class="code" href="class_scroll_view.html#ab4e471faa54fa9399eac548094734167">ScrollView::ShowYesNoDialog</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg) {
<a name="l00746"></a>00746   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;showYesNoDialog(\&quot;%s\&quot;)&quot;</span>, msg);
<a name="l00747"></a>00747   <a class="code" href="struct_s_v_event.html">SVEvent</a>* ev;
<a name="l00748"></a>00748   <span class="comment">// Wait till an input event (all others are thrown away)</span>
<a name="l00749"></a>00749   ev = <a class="code" href="class_scroll_view.html#a0b820b3fe7a2ce083da0784e9339a1ad">AwaitEvent</a>(<a class="code" href="scrollview_8h.html#a3688a0cf2f95d10a57e095222ccfe9a0aee5f6202613f111d11fc310ccba2fa25">SVET_INPUT</a>);
<a name="l00750"></a>00750   <span class="keywordtype">int</span> a = ev-&gt;<a class="code" href="struct_s_v_event.html#a6e0de466c57df117c731bfb4db68fc79">parameter</a>[0];
<a name="l00751"></a>00751   <span class="keyword">delete</span> ev;
<a name="l00752"></a>00752   <span class="keywordflow">return</span> a;
<a name="l00753"></a>00753 }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <span class="comment">// Zoom the window to the rectangle given upper left corner and</span>
<a name="l00756"></a>00756 <span class="comment">// lower right corner.</span>
<a name="l00757"></a><a class="code" href="class_scroll_view.html#a5a6c86ea0a618cf7642a8228fd7faab9">00757</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a5a6c86ea0a618cf7642a8228fd7faab9">ScrollView::ZoomToRectangle</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2) {
<a name="l00758"></a>00758   y1 = <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y1);
<a name="l00759"></a>00759   y2 = <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">TranslateYCoordinate</a>(y2);
<a name="l00760"></a>00760   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;zoomRectangle(%d,%d,%d,%d)&quot;</span>,
<a name="l00761"></a>00761           <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(x1, x2), <a class="code" href="ndminx_8h.html#a74e75242132eaabbc1c512488a135926">MIN</a>(y1, y2), <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(x1, x2), <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(y1, y2));
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="comment">// Send an image of type Pix.</span>
<a name="l00765"></a><a class="code" href="class_scroll_view.html#a45881e629322d82c9fc0c5f926a76f16">00765</a> <span class="keywordtype">void</span> <a class="code" href="class_scroll_view.html#a45881e629322d82c9fc0c5f926a76f16">ScrollView::Image</a>(<span class="keyword">struct</span> Pix* image, <span class="keywordtype">int</span> x_pos, <span class="keywordtype">int</span> y_pos) {
<a name="l00766"></a>00766   <span class="keywordtype">int</span> width = image-&gt;w;
<a name="l00767"></a>00767   <span class="keywordtype">int</span> height = image-&gt;h;
<a name="l00768"></a>00768   l_uint32 bpp = image-&gt;d;
<a name="l00769"></a>00769   ++image_index_;
<a name="l00770"></a>00770   <span class="comment">// PIX* do not have a unique identifier/name associated, so name them &quot;lept&quot;.</span>
<a name="l00771"></a>00771   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;createImage(&#39;lept%d&#39;,%d,%d,%d)&quot;</span>, image_index_, width, height, bpp);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   <span class="keywordflow">if</span> (bpp == 32) {
<a name="l00774"></a>00774     Transfer32bppImage(image);
<a name="l00775"></a>00775   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bpp == 8) {
<a name="l00776"></a>00776     TransferGrayImage(image);
<a name="l00777"></a>00777   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bpp == 1) {
<a name="l00778"></a>00778     TransferBinaryImage(image);
<a name="l00779"></a>00779   }
<a name="l00780"></a>00780   <span class="comment">// PIX* do not have a unique identifier/name associated, so name them &quot;lept&quot;.</span>
<a name="l00781"></a>00781   <a class="code" href="class_scroll_view.html#a603f7d9313903b176ecbd9f49a7b6e1a" title="Send a message to the server, attaching the window id.">SendMsg</a>(<span class="stringliteral">&quot;drawImage(&#39;lept%d&#39;,%d,%d)&quot;</span>, image_index_, x_pos, y_pos);
<a name="l00782"></a>00782 }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 <span class="comment">// Sends each pixel as hex value like html, e.g. #00FF00 for green.</span>
<a name="l00785"></a>00785 <span class="keywordtype">void</span> ScrollView::Transfer32bppImage(PIX* image) {
<a name="l00786"></a>00786   <span class="keywordtype">int</span> ppL = pixGetWidth(image);
<a name="l00787"></a>00787   <span class="keywordtype">int</span> h = pixGetHeight(image);
<a name="l00788"></a>00788   <span class="keywordtype">int</span> wpl = pixGetWpl(image);
<a name="l00789"></a>00789   <span class="keywordtype">int</span> transfer_size= ppL * 7 + 2;
<a name="l00790"></a>00790   <span class="keywordtype">char</span>* pixel_data = <span class="keyword">new</span> <span class="keywordtype">char</span>[transfer_size];
<a name="l00791"></a>00791   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; h; ++y) {
<a name="l00792"></a>00792     l_uint32* data = pixGetData(image) + y*wpl;
<a name="l00793"></a>00793     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; ppL; ++x, ++data) {
<a name="l00794"></a>00794       snprintf(&amp;pixel_data[x*7], 7, <span class="stringliteral">&quot;#%.2x%.2x%.2x&quot;</span>,
<a name="l00795"></a>00795                GET_DATA_BYTE(data, COLOR_RED),
<a name="l00796"></a>00796                GET_DATA_BYTE(data, COLOR_GREEN),
<a name="l00797"></a>00797                GET_DATA_BYTE(data, COLOR_BLUE));
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799     pixel_data[transfer_size - 2] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00800"></a>00800     pixel_data[transfer_size - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00801"></a>00801     <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(pixel_data);
<a name="l00802"></a>00802   }
<a name="l00803"></a>00803   <span class="keyword">delete</span>[] pixel_data;
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 <span class="comment">// Sends for each pixel either &#39;1&#39; or &#39;0&#39;.</span>
<a name="l00807"></a>00807 <span class="keywordtype">void</span> ScrollView::TransferGrayImage(PIX* image) {
<a name="l00808"></a>00808   <span class="keywordtype">char</span>* pixel_data = <span class="keyword">new</span> <span class="keywordtype">char</span>[image-&gt;w * 2 + 2];
<a name="l00809"></a>00809   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; image-&gt;h; y++) {
<a name="l00810"></a>00810     l_uint32* data = pixGetData(image) + y * pixGetWpl(image);
<a name="l00811"></a>00811     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; image-&gt;w; x++) {
<a name="l00812"></a>00812       snprintf(&amp;pixel_data[x*2], 2, <span class="stringliteral">&quot;%.2x&quot;</span>, (GET_DATA_BYTE(data, x)));
<a name="l00813"></a>00813       pixel_data[image-&gt;w * 2] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00814"></a>00814       pixel_data[image-&gt;w * 2 + 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00815"></a>00815       <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(pixel_data);
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817   }
<a name="l00818"></a>00818   <span class="keyword">delete</span> [] pixel_data;
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="comment">// Sends for each pixel either &#39;1&#39; or &#39;0&#39;.</span>
<a name="l00822"></a>00822 <span class="keywordtype">void</span> ScrollView::TransferBinaryImage(PIX* image) {
<a name="l00823"></a>00823   <span class="keywordtype">char</span>* pixel_data = <span class="keyword">new</span> <span class="keywordtype">char</span>[image-&gt;w + 2];
<a name="l00824"></a>00824   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; image-&gt;h; y++) {
<a name="l00825"></a>00825     l_uint32* data = pixGetData(image) + y * pixGetWpl(image);
<a name="l00826"></a>00826     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; image-&gt;w; x++) {
<a name="l00827"></a>00827       <span class="keywordflow">if</span> (GET_DATA_BIT(data, x))
<a name="l00828"></a>00828         pixel_data[x] = <span class="charliteral">&#39;1&#39;</span>;
<a name="l00829"></a>00829       <span class="keywordflow">else</span>
<a name="l00830"></a>00830         pixel_data[x] = <span class="charliteral">&#39;0&#39;</span>;
<a name="l00831"></a>00831     }
<a name="l00832"></a>00832     pixel_data[image-&gt;w] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00833"></a>00833     pixel_data[image-&gt;w + 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00834"></a>00834     <a class="code" href="class_scroll_view.html#a6d9945c4437a9961c8f5768bbb812db5">SendRawMessage</a>(pixel_data);
<a name="l00835"></a>00835   }
<a name="l00836"></a>00836   <span class="keyword">delete</span> [] pixel_data;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="comment">// Escapes the &#39; character with a \, so it can be processed by LUA.</span>
<a name="l00840"></a>00840 <span class="comment">// Note: The caller will have to make sure he deletes the newly allocated item.</span>
<a name="l00841"></a>00841 <span class="keywordtype">char</span>* ScrollView::AddEscapeChars(<span class="keyword">const</span> <span class="keywordtype">char</span>* input) {
<a name="l00842"></a>00842   <span class="keyword">const</span> <span class="keywordtype">char</span>* nextptr = strchr(input, <span class="charliteral">&#39;\&#39;&#39;</span>);
<a name="l00843"></a>00843   <span class="keyword">const</span> <span class="keywordtype">char</span>* lastptr = input;
<a name="l00844"></a>00844   <span class="keywordtype">char</span>* message = <span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="scrollview_8cpp.html#a4a4ce82f9687ca37d149b0a62c5ed379">kMaxMsgSize</a>];
<a name="l00845"></a>00845   <span class="keywordtype">int</span> pos = 0;
<a name="l00846"></a>00846   <span class="keywordflow">while</span> (nextptr != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00847"></a>00847     strncpy(message+pos, lastptr, nextptr-lastptr);
<a name="l00848"></a>00848     pos += nextptr - lastptr;
<a name="l00849"></a>00849     message[pos] = <span class="charliteral">&#39;\\&#39;</span>;
<a name="l00850"></a>00850     pos += 1;
<a name="l00851"></a>00851     lastptr = nextptr;
<a name="l00852"></a>00852     nextptr = strchr(nextptr+1, <span class="charliteral">&#39;\&#39;&#39;</span>);
<a name="l00853"></a>00853   }
<a name="l00854"></a>00854   strncpy(message+pos, lastptr, strlen(lastptr));
<a name="l00855"></a>00855   message[pos+strlen(lastptr)] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00856"></a>00856   <span class="keywordflow">return</span> message;
<a name="l00857"></a>00857 }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859 <span class="comment">// Inverse the Y axis if the coordinates are actually inversed.</span>
<a name="l00860"></a><a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">00860</a> <span class="keywordtype">int</span> <a class="code" href="class_scroll_view.html#a919331a29ba9fdaeacf1e06ab7917616">ScrollView::TranslateYCoordinate</a>(<span class="keywordtype">int</span> y) {
<a name="l00861"></a>00861   <span class="keywordflow">if</span> (!y_axis_is_reversed_) { <span class="keywordflow">return</span> y;
<a name="l00862"></a>00862   } <span class="keywordflow">else</span> { <span class="keywordflow">return</span> y_size_ - y; }
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="preprocessor">#endif  // GRAPHICS_DISABLED</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="scrollview_8cpp.html">scrollview.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Fri Mar 30 2012 17:39:16 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
