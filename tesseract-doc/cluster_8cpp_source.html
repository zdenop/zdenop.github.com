<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/classify/cluster.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('cluster_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/classify/cluster.cpp</div>  </div>
</div>
<div class="contents">
<a href="cluster_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> **     Filename:       cluster.c</span>
<a name="l00003"></a>00003 <span class="comment"> **     Purpose:        Routines for clustering points in N-D space</span>
<a name="l00004"></a>00004 <span class="comment"> **     Author:         Dan Johnson</span>
<a name="l00005"></a>00005 <span class="comment"> **     History:        5/29/89, DSJ, Created.</span>
<a name="l00006"></a>00006 <span class="comment"> **</span>
<a name="l00007"></a>00007 <span class="comment"> **     (c) Copyright Hewlett-Packard Company, 1988.</span>
<a name="l00008"></a>00008 <span class="comment"> ** Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00009"></a>00009 <span class="comment"> ** you may not use this file except in compliance with the License.</span>
<a name="l00010"></a>00010 <span class="comment"> ** You may obtain a copy of the License at</span>
<a name="l00011"></a>00011 <span class="comment"> ** http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00012"></a>00012 <span class="comment"> ** Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment"> ** distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00014"></a>00014 <span class="comment"> ** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment"> ** See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment"> ** limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment"> ******************************************************************************/</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="oldheap_8h.html">oldheap.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="const_8h.html">const.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="cluster_8h.html">cluster.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="emalloc_8h.html">emalloc.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="helpers_8h.html">helpers.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="matrix_8h.html">matrix.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="tprintf_8h.html">tprintf.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="danerror_8h.html">danerror.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="freelist_8h.html">freelist.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="cluster_8cpp.html#a6c16d1564de65f394e737811e5389042">00029</a> <span class="preprocessor">#define HOTELLING 1  // If true use Hotelling&#39;s test to decide where to split.</span>
<a name="l00030"></a><a class="code" href="cluster_8cpp.html#a1f0a56d752a245eeeabb4514e8b22cf8">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define FTABLE_X 10  // Size of FTable.</span>
<a name="l00031"></a><a class="code" href="cluster_8cpp.html#acd517e6d49c3394f0b9fe04fdb970699">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define FTABLE_Y 100  // Size of FTable.</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="comment">// Table of values approximating the cumulative F-distribution for a confidence of 1%.</span>
<a name="l00034"></a><a class="code" href="cluster_8cpp.html#a1e2410dc2e3eb34ef861fbfeb2f05f4d">00034</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="cluster_8cpp.html#a1e2410dc2e3eb34ef861fbfeb2f05f4d">FTable</a>[<a class="code" href="cluster_8cpp.html#acd517e6d49c3394f0b9fe04fdb970699">FTABLE_Y</a>][<a class="code" href="cluster_8cpp.html#a1f0a56d752a245eeeabb4514e8b22cf8">FTABLE_X</a>] = {
<a name="l00035"></a>00035  {4052.19, 4999.52, 5403.34, 5624.62, 5763.65, 5858.97, 5928.33, 5981.10, 6022.50, 6055.85,},
<a name="l00036"></a>00036   {98.502,  99.000,  99.166,  99.249,  99.300,  99.333,  99.356,  99.374,  99.388,  99.399,},
<a name="l00037"></a>00037   {34.116,  30.816,  29.457,  28.710,  28.237,  27.911,  27.672,  27.489,  27.345,  27.229,},
<a name="l00038"></a>00038   {21.198,  18.000,  16.694,  15.977,  15.522,  15.207,  14.976,  14.799,  14.659,  14.546,},
<a name="l00039"></a>00039   {16.258,  13.274,  12.060,  11.392,  10.967,  10.672,  10.456,  10.289,  10.158,  10.051,},
<a name="l00040"></a>00040   {13.745,  10.925,   9.780,   9.148,   8.746,   8.466,   8.260,   8.102,   7.976,   7.874,},
<a name="l00041"></a>00041   {12.246,   9.547,   8.451,   7.847,   7.460,   7.191,   6.993,   6.840,   6.719,   6.620,},
<a name="l00042"></a>00042   {11.259,   8.649,   7.591,   7.006,   6.632,   6.371,   6.178,   6.029,   5.911,   5.814,},
<a name="l00043"></a>00043   {10.561,   8.022,   6.992,   6.422,   6.057,   5.802,   5.613,   5.467,   5.351,   5.257,},
<a name="l00044"></a>00044   {10.044,   7.559,   6.552,   5.994,   5.636,   5.386,   5.200,   5.057,   4.942,   4.849,},
<a name="l00045"></a>00045   { 9.646,   7.206,   6.217,   5.668,   5.316,   5.069,   4.886,   4.744,   4.632,   4.539,},
<a name="l00046"></a>00046   { 9.330,   6.927,   5.953,   5.412,   5.064,   4.821,   4.640,   4.499,   4.388,   4.296,},
<a name="l00047"></a>00047   { 9.074,   6.701,   5.739,   5.205,   4.862,   4.620,   4.441,   4.302,   4.191,   4.100,},
<a name="l00048"></a>00048   { 8.862,   6.515,   5.564,   5.035,   4.695,   4.456,   4.278,   4.140,   4.030,   3.939,},
<a name="l00049"></a>00049   { 8.683,   6.359,   5.417,   4.893,   4.556,   4.318,   4.142,   4.004,   3.895,   3.805,},
<a name="l00050"></a>00050   { 8.531,   6.226,   5.292,   4.773,   4.437,   4.202,   4.026,   3.890,   3.780,   3.691,},
<a name="l00051"></a>00051   { 8.400,   6.112,   5.185,   4.669,   4.336,   4.102,   3.927,   3.791,   3.682,   3.593,},
<a name="l00052"></a>00052   { 8.285,   6.013,   5.092,   4.579,   4.248,   4.015,   3.841,   3.705,   3.597,   3.508,},
<a name="l00053"></a>00053   { 8.185,   5.926,   5.010,   4.500,   4.171,   3.939,   3.765,   3.631,   3.523,   3.434,},
<a name="l00054"></a>00054   { 8.096,   5.849,   4.938,   4.431,   4.103,   3.871,   3.699,   3.564,   3.457,   3.368,},
<a name="l00055"></a>00055   { 8.017,   5.780,   4.874,   4.369,   4.042,   3.812,   3.640,   3.506,   3.398,   3.310,},
<a name="l00056"></a>00056   { 7.945,   5.719,   4.817,   4.313,   3.988,   3.758,   3.587,   3.453,   3.346,   3.258,},
<a name="l00057"></a>00057   { 7.881,   5.664,   4.765,   4.264,   3.939,   3.710,   3.539,   3.406,   3.299,   3.211,},
<a name="l00058"></a>00058   { 7.823,   5.614,   4.718,   4.218,   3.895,   3.667,   3.496,   3.363,   3.256,   3.168,},
<a name="l00059"></a>00059   { 7.770,   5.568,   4.675,   4.177,   3.855,   3.627,   3.457,   3.324,   3.217,   3.129,},
<a name="l00060"></a>00060   { 7.721,   5.526,   4.637,   4.140,   3.818,   3.591,   3.421,   3.288,   3.182,   3.094,},
<a name="l00061"></a>00061   { 7.677,   5.488,   4.601,   4.106,   3.785,   3.558,   3.388,   3.256,   3.149,   3.062,},
<a name="l00062"></a>00062   { 7.636,   5.453,   4.568,   4.074,   3.754,   3.528,   3.358,   3.226,   3.120,   3.032,},
<a name="l00063"></a>00063   { 7.598,   5.420,   4.538,   4.045,   3.725,   3.499,   3.330,   3.198,   3.092,   3.005,},
<a name="l00064"></a>00064   { 7.562,   5.390,   4.510,   4.018,   3.699,   3.473,   3.305,   3.173,   3.067,   2.979,},
<a name="l00065"></a>00065   { 7.530,   5.362,   4.484,   3.993,   3.675,   3.449,   3.281,   3.149,   3.043,   2.955,},
<a name="l00066"></a>00066   { 7.499,   5.336,   4.459,   3.969,   3.652,   3.427,   3.258,   3.127,   3.021,   2.934,},
<a name="l00067"></a>00067   { 7.471,   5.312,   4.437,   3.948,   3.630,   3.406,   3.238,   3.106,   3.000,   2.913,},
<a name="l00068"></a>00068   { 7.444,   5.289,   4.416,   3.927,   3.611,   3.386,   3.218,   3.087,   2.981,   2.894,},
<a name="l00069"></a>00069   { 7.419,   5.268,   4.396,   3.908,   3.592,   3.368,   3.200,   3.069,   2.963,   2.876,},
<a name="l00070"></a>00070   { 7.396,   5.248,   4.377,   3.890,   3.574,   3.351,   3.183,   3.052,   2.946,   2.859,},
<a name="l00071"></a>00071   { 7.373,   5.229,   4.360,   3.873,   3.558,   3.334,   3.167,   3.036,   2.930,   2.843,},
<a name="l00072"></a>00072   { 7.353,   5.211,   4.343,   3.858,   3.542,   3.319,   3.152,   3.021,   2.915,   2.828,},
<a name="l00073"></a>00073   { 7.333,   5.194,   4.327,   3.843,   3.528,   3.305,   3.137,   3.006,   2.901,   2.814,},
<a name="l00074"></a>00074   { 7.314,   5.179,   4.313,   3.828,   3.514,   3.291,   3.124,   2.993,   2.888,   2.801,},
<a name="l00075"></a>00075   { 7.296,   5.163,   4.299,   3.815,   3.501,   3.278,   3.111,   2.980,   2.875,   2.788,},
<a name="l00076"></a>00076   { 7.280,   5.149,   4.285,   3.802,   3.488,   3.266,   3.099,   2.968,   2.863,   2.776,},
<a name="l00077"></a>00077   { 7.264,   5.136,   4.273,   3.790,   3.476,   3.254,   3.087,   2.957,   2.851,   2.764,},
<a name="l00078"></a>00078   { 7.248,   5.123,   4.261,   3.778,   3.465,   3.243,   3.076,   2.946,   2.840,   2.754,},
<a name="l00079"></a>00079   { 7.234,   5.110,   4.249,   3.767,   3.454,   3.232,   3.066,   2.935,   2.830,   2.743,},
<a name="l00080"></a>00080   { 7.220,   5.099,   4.238,   3.757,   3.444,   3.222,   3.056,   2.925,   2.820,   2.733,},
<a name="l00081"></a>00081   { 7.207,   5.087,   4.228,   3.747,   3.434,   3.213,   3.046,   2.916,   2.811,   2.724,},
<a name="l00082"></a>00082   { 7.194,   5.077,   4.218,   3.737,   3.425,   3.204,   3.037,   2.907,   2.802,   2.715,},
<a name="l00083"></a>00083   { 7.182,   5.066,   4.208,   3.728,   3.416,   3.195,   3.028,   2.898,   2.793,   2.706,},
<a name="l00084"></a>00084   { 7.171,   5.057,   4.199,   3.720,   3.408,   3.186,   3.020,   2.890,   2.785,   2.698,},
<a name="l00085"></a>00085   { 7.159,   5.047,   4.191,   3.711,   3.400,   3.178,   3.012,   2.882,   2.777,   2.690,},
<a name="l00086"></a>00086   { 7.149,   5.038,   4.182,   3.703,   3.392,   3.171,   3.005,   2.874,   2.769,   2.683,},
<a name="l00087"></a>00087   { 7.139,   5.030,   4.174,   3.695,   3.384,   3.163,   2.997,   2.867,   2.762,   2.675,},
<a name="l00088"></a>00088   { 7.129,   5.021,   4.167,   3.688,   3.377,   3.156,   2.990,   2.860,   2.755,   2.668,},
<a name="l00089"></a>00089   { 7.119,   5.013,   4.159,   3.681,   3.370,   3.149,   2.983,   2.853,   2.748,   2.662,},
<a name="l00090"></a>00090   { 7.110,   5.006,   4.152,   3.674,   3.363,   3.143,   2.977,   2.847,   2.742,   2.655,},
<a name="l00091"></a>00091   { 7.102,   4.998,   4.145,   3.667,   3.357,   3.136,   2.971,   2.841,   2.736,   2.649,},
<a name="l00092"></a>00092   { 7.093,   4.991,   4.138,   3.661,   3.351,   3.130,   2.965,   2.835,   2.730,   2.643,},
<a name="l00093"></a>00093   { 7.085,   4.984,   4.132,   3.655,   3.345,   3.124,   2.959,   2.829,   2.724,   2.637,},
<a name="l00094"></a>00094   { 7.077,   4.977,   4.126,   3.649,   3.339,   3.119,   2.953,   2.823,   2.718,   2.632,},
<a name="l00095"></a>00095   { 7.070,   4.971,   4.120,   3.643,   3.333,   3.113,   2.948,   2.818,   2.713,   2.626,},
<a name="l00096"></a>00096   { 7.062,   4.965,   4.114,   3.638,   3.328,   3.108,   2.942,   2.813,   2.708,   2.621,},
<a name="l00097"></a>00097   { 7.055,   4.959,   4.109,   3.632,   3.323,   3.103,   2.937,   2.808,   2.703,   2.616,},
<a name="l00098"></a>00098   { 7.048,   4.953,   4.103,   3.627,   3.318,   3.098,   2.932,   2.803,   2.698,   2.611,},
<a name="l00099"></a>00099   { 7.042,   4.947,   4.098,   3.622,   3.313,   3.093,   2.928,   2.798,   2.693,   2.607,},
<a name="l00100"></a>00100   { 7.035,   4.942,   4.093,   3.618,   3.308,   3.088,   2.923,   2.793,   2.689,   2.602,},
<a name="l00101"></a>00101   { 7.029,   4.937,   4.088,   3.613,   3.304,   3.084,   2.919,   2.789,   2.684,   2.598,},
<a name="l00102"></a>00102   { 7.023,   4.932,   4.083,   3.608,   3.299,   3.080,   2.914,   2.785,   2.680,   2.593,},
<a name="l00103"></a>00103   { 7.017,   4.927,   4.079,   3.604,   3.295,   3.075,   2.910,   2.781,   2.676,   2.589,},
<a name="l00104"></a>00104   { 7.011,   4.922,   4.074,   3.600,   3.291,   3.071,   2.906,   2.777,   2.672,   2.585,},
<a name="l00105"></a>00105   { 7.006,   4.917,   4.070,   3.596,   3.287,   3.067,   2.902,   2.773,   2.668,   2.581,},
<a name="l00106"></a>00106   { 7.001,   4.913,   4.066,   3.591,   3.283,   3.063,   2.898,   2.769,   2.664,   2.578,},
<a name="l00107"></a>00107   { 6.995,   4.908,   4.062,   3.588,   3.279,   3.060,   2.895,   2.765,   2.660,   2.574,},
<a name="l00108"></a>00108   { 6.990,   4.904,   4.058,   3.584,   3.275,   3.056,   2.891,   2.762,   2.657,   2.570,},
<a name="l00109"></a>00109   { 6.985,   4.900,   4.054,   3.580,   3.272,   3.052,   2.887,   2.758,   2.653,   2.567,},
<a name="l00110"></a>00110   { 6.981,   4.896,   4.050,   3.577,   3.268,   3.049,   2.884,   2.755,   2.650,   2.563,},
<a name="l00111"></a>00111   { 6.976,   4.892,   4.047,   3.573,   3.265,   3.046,   2.881,   2.751,   2.647,   2.560,},
<a name="l00112"></a>00112   { 6.971,   4.888,   4.043,   3.570,   3.261,   3.042,   2.877,   2.748,   2.644,   2.557,},
<a name="l00113"></a>00113   { 6.967,   4.884,   4.040,   3.566,   3.258,   3.039,   2.874,   2.745,   2.640,   2.554,},
<a name="l00114"></a>00114   { 6.963,   4.881,   4.036,   3.563,   3.255,   3.036,   2.871,   2.742,   2.637,   2.551,},
<a name="l00115"></a>00115   { 6.958,   4.877,   4.033,   3.560,   3.252,   3.033,   2.868,   2.739,   2.634,   2.548,},
<a name="l00116"></a>00116   { 6.954,   4.874,   4.030,   3.557,   3.249,   3.030,   2.865,   2.736,   2.632,   2.545,},
<a name="l00117"></a>00117   { 6.950,   4.870,   4.027,   3.554,   3.246,   3.027,   2.863,   2.733,   2.629,   2.542,},
<a name="l00118"></a>00118   { 6.947,   4.867,   4.024,   3.551,   3.243,   3.025,   2.860,   2.731,   2.626,   2.539,},
<a name="l00119"></a>00119   { 6.943,   4.864,   4.021,   3.548,   3.240,   3.022,   2.857,   2.728,   2.623,   2.537,},
<a name="l00120"></a>00120   { 6.939,   4.861,   4.018,   3.545,   3.238,   3.019,   2.854,   2.725,   2.621,   2.534,},
<a name="l00121"></a>00121   { 6.935,   4.858,   4.015,   3.543,   3.235,   3.017,   2.852,   2.723,   2.618,   2.532,},
<a name="l00122"></a>00122   { 6.932,   4.855,   4.012,   3.540,   3.233,   3.014,   2.849,   2.720,   2.616,   2.529,},
<a name="l00123"></a>00123   { 6.928,   4.852,   4.010,   3.538,   3.230,   3.012,   2.847,   2.718,   2.613,   2.527,},
<a name="l00124"></a>00124   { 6.925,   4.849,   4.007,   3.535,   3.228,   3.009,   2.845,   2.715,   2.611,   2.524,},
<a name="l00125"></a>00125   { 6.922,   4.846,   4.004,   3.533,   3.225,   3.007,   2.842,   2.713,   2.609,   2.522,},
<a name="l00126"></a>00126   { 6.919,   4.844,   4.002,   3.530,   3.223,   3.004,   2.840,   2.711,   2.606,   2.520,},
<a name="l00127"></a>00127   { 6.915,   4.841,   3.999,   3.528,   3.221,   3.002,   2.838,   2.709,   2.604,   2.518,},
<a name="l00128"></a>00128   { 6.912,   4.838,   3.997,   3.525,   3.218,   3.000,   2.835,   2.706,   2.602,   2.515,},
<a name="l00129"></a>00129   { 6.909,   4.836,   3.995,   3.523,   3.216,   2.998,   2.833,   2.704,   2.600,   2.513,},
<a name="l00130"></a>00130   { 6.906,   4.833,   3.992,   3.521,   3.214,   2.996,   2.831,   2.702,   2.598,   2.511,},
<a name="l00131"></a>00131   { 6.904,   4.831,   3.990,   3.519,   3.212,   2.994,   2.829,   2.700,   2.596,   2.509,},
<a name="l00132"></a>00132   { 6.901,   4.829,   3.988,   3.517,   3.210,   2.992,   2.827,   2.698,   2.594,   2.507,},
<a name="l00133"></a>00133   { 6.898,   4.826,   3.986,   3.515,   3.208,   2.990,   2.825,   2.696,   2.592,   2.505,},
<a name="l00134"></a>00134   { 6.895,   4.824,   3.984,   3.513,   3.206,   2.988,   2.823,   2.694,   2.590,   2.503}
<a name="l00135"></a>00135 };
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">/* define the variance which will be used as a minimum variance for any</span>
<a name="l00138"></a>00138 <span class="comment">  dimension of any feature. Since most features are calculated from numbers</span>
<a name="l00139"></a>00139 <span class="comment">  with a precision no better than 1 in 128, the variance should never be</span>
<a name="l00140"></a>00140 <span class="comment">  less than the square of this number for parameters whose range is 1. */</span>
<a name="l00141"></a><a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">00141</a> <span class="preprocessor">#define MINVARIANCE     0.0004</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>
<a name="l00143"></a>00143 <span class="comment">/* define the absolute minimum number of samples which must be present in</span>
<a name="l00144"></a>00144 <span class="comment">  order to accurately test hypotheses about underlying probability</span>
<a name="l00145"></a>00145 <span class="comment">  distributions.  Define separately the minimum samples that are needed</span>
<a name="l00146"></a>00146 <span class="comment">  before a statistical analysis is attempted; this number should be</span>
<a name="l00147"></a>00147 <span class="comment">  equal to MINSAMPLES but can be set to a lower number for early testing</span>
<a name="l00148"></a>00148 <span class="comment">  when very few samples are available. */</span>
<a name="l00149"></a><a class="code" href="cluster_8cpp.html#aef647ca436686ede9c7bb5a9fb203372">00149</a> <span class="preprocessor">#define MINSAMPLESPERBUCKET 5</span>
<a name="l00150"></a><a class="code" href="cluster_8cpp.html#a47c31dab77cf79b225315601107dfd67">00150</a> <span class="preprocessor"></span><span class="preprocessor">#define MINSAMPLES    (MINBUCKETS * MINSAMPLESPERBUCKET)</span>
<a name="l00151"></a><a class="code" href="cluster_8cpp.html#a6b4ec5de41f65e6f0f69b57db368bd54">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define MINSAMPLESNEEDED  1</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00153"></a>00153 <span class="comment">/* define the size of the table which maps normalized samples to</span>
<a name="l00154"></a>00154 <span class="comment">  histogram buckets.  Also define the number of standard deviations</span>
<a name="l00155"></a>00155 <span class="comment">  in a normal distribution which are considered to be significant.</span>
<a name="l00156"></a>00156 <span class="comment">  The mapping table will be defined in such a way that it covers</span>
<a name="l00157"></a>00157 <span class="comment">  the specified number of standard deviations on either side of</span>
<a name="l00158"></a>00158 <span class="comment">  the mean.  BUCKETTABLESIZE should always be even. */</span>
<a name="l00159"></a><a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">00159</a> <span class="preprocessor">#define BUCKETTABLESIZE   1024</span>
<a name="l00160"></a><a class="code" href="cluster_8cpp.html#ad3f8e9aec305987f3daa2d431da4cac3">00160</a> <span class="preprocessor"></span><span class="preprocessor">#define NORMALEXTENT    3.0</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>
<a name="l00162"></a><a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">00162</a> <span class="keyword">struct </span><a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> {
<a name="l00163"></a><a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">00163</a>   <a class="code" href="structsample.html">CLUSTER</a> *<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a>;
<a name="l00164"></a><a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">00164</a>   <a class="code" href="structsample.html">CLUSTER</a> *<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a>;
<a name="l00165"></a>00165 };
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">00167</a> <span class="keyword">struct </span><a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> {
<a name="l00168"></a><a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">00168</a>   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a>;
<a name="l00169"></a><a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">00169</a>   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>;
<a name="l00170"></a><a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">00170</a>   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>;                  <span class="comment">// largest negative distance from the mean</span>
<a name="l00171"></a><a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">00171</a>   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>;                  <span class="comment">// largest positive distance from the mean</span>
<a name="l00172"></a>00172 };
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="struct_b_u_c_k_e_t_s.html">00174</a> <span class="keyword">struct </span><a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> {
<a name="l00175"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#ad2b1ef5944d42354519db2895a8ca062">00175</a>   <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> <a class="code" href="struct_b_u_c_k_e_t_s.html#ad2b1ef5944d42354519db2895a8ca062">Distribution</a>;     <span class="comment">// distribution being tested for</span>
<a name="l00176"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#a8e352450eb27c8a017a037f71796b402">00176</a>   <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> <a class="code" href="struct_b_u_c_k_e_t_s.html#a8e352450eb27c8a017a037f71796b402">SampleCount</a>;            <span class="comment">// # of samples in histogram</span>
<a name="l00177"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#aeef80a305501f83af63153e6b2e362a8">00177</a>   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="struct_b_u_c_k_e_t_s.html#aeef80a305501f83af63153e6b2e362a8">Confidence</a>;            <span class="comment">// confidence level of test</span>
<a name="l00178"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#a4dedca1b6c939050313aa761b59a0a11">00178</a>   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="struct_b_u_c_k_e_t_s.html#a4dedca1b6c939050313aa761b59a0a11">ChiSquared</a>;            <span class="comment">// test threshold</span>
<a name="l00179"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">00179</a>   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>;        <span class="comment">// number of cells in histogram</span>
<a name="l00180"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#aaa108173d6611040d567271a1262b67e">00180</a>   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="struct_b_u_c_k_e_t_s.html#aaa108173d6611040d567271a1262b67e">Bucket</a>[<a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a>];<span class="comment">// mapping to histogram buckets</span>
<a name="l00181"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">00181</a>   <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> *<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>;                 <span class="comment">// frequency of occurence histogram</span>
<a name="l00182"></a><a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">00182</a>   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>;        <span class="comment">// expected histogram</span>
<a name="l00183"></a>00183 };
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">00185</a> <span class="keyword">struct </span><a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a>{
<a name="l00186"></a><a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a15a3b870d88bb0fcedd7accc60d195c7">00186</a>   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a15a3b870d88bb0fcedd7accc60d195c7">DegreesOfFreedom</a>;
<a name="l00187"></a><a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">00187</a>   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">Alpha</a>;
<a name="l00188"></a><a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#ab8ebe43673dcf3e24c6a792c3bed43ea">00188</a>   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#ab8ebe43673dcf3e24c6a792c3bed43ea">ChiSquared</a>;
<a name="l00189"></a>00189 };
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">// For use with KDWalk / MakePotentialClusters</span>
<a name="l00192"></a><a class="code" href="struct_clustering_context.html">00192</a> <span class="keyword">struct </span><a class="code" href="struct_clustering_context.html">ClusteringContext</a> {
<a name="l00193"></a><a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">00193</a>   <a class="code" href="struct_h_e_a_p.html">HEAP</a> *<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a>;  <span class="comment">// heap used to hold temp clusters, &quot;best&quot; on top</span>
<a name="l00194"></a><a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">00194</a>   <a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> *<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>;  <span class="comment">// array of potential clusters</span>
<a name="l00195"></a><a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">00195</a>   <a class="code" href="struct_k_d_t_r_e_e.html">KDTREE</a> *<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a>;  <span class="comment">// kd-tree to be searched for neighbors</span>
<a name="l00196"></a><a class="code" href="struct_clustering_context.html#a6e7e68c81c4925fb0cc24fa90d1fa358">00196</a>   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> <a class="code" href="struct_clustering_context.html#a6e7e68c81c4925fb0cc24fa90d1fa358">next</a>;  <span class="comment">// next candidate to be used</span>
<a name="l00197"></a>00197 };
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="cluster_8cpp.html#a32b61dc3b9e8987cc1a63db31c99c6e9">00199</a> <span class="keyword">typedef</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> (*<a class="code" href="cluster_8cpp.html#a32b61dc3b9e8987cc1a63db31c99c6e9">DENSITYFUNC</a>) (<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a>);
<a name="l00200"></a><a class="code" href="cluster_8cpp.html#a170fa76dec6514a98bb069c4b9652f2d">00200</a> <span class="keyword">typedef</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> (*<a class="code" href="cluster_8cpp.html#a170fa76dec6514a98bb069c4b9652f2d">SOLVEFUNC</a>) (<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *, double);
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="cluster_8cpp.html#a0662f2b2f6ae8b7ed59d9da773c0da35">00202</a> <span class="preprocessor">#define Odd(N) ((N)%2)</span>
<a name="l00203"></a><a class="code" href="cluster_8cpp.html#a42e41a23d64c7e8a69fbfd802e72c239">00203</a> <span class="preprocessor"></span><span class="preprocessor">#define Mirror(N,R) ((R) - (N) - 1)</span>
<a name="l00204"></a><a class="code" href="cluster_8cpp.html#a060002a5aeab470cb24c8343daa1db08">00204</a> <span class="preprocessor"></span><span class="preprocessor">#define Abs(N) ( ( (N) &lt; 0 ) ? ( -(N) ) : (N) )</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>
<a name="l00206"></a>00206 <span class="comment">//--------------Global Data Definitions and Declarations----------------------</span>
<a name="l00207"></a>00207 <span class="comment">/* the following variables describe a discrete normal distribution</span>
<a name="l00208"></a>00208 <span class="comment">  which is used by NormalDensity() and NormalBucket().  The</span>
<a name="l00209"></a>00209 <span class="comment">  constant NORMALEXTENT determines how many standard</span>
<a name="l00210"></a>00210 <span class="comment">  deviations of the distribution are mapped onto the fixed</span>
<a name="l00211"></a>00211 <span class="comment">  discrete range of x.  x=0 is mapped to -NORMALEXTENT standard</span>
<a name="l00212"></a>00212 <span class="comment">  deviations and x=BUCKETTABLESIZE is mapped to</span>
<a name="l00213"></a>00213 <span class="comment">  +NORMALEXTENT standard deviations. */</span>
<a name="l00214"></a><a class="code" href="cluster_8cpp.html#a5b63c74defa53affeb3825bec1aa894d">00214</a> <span class="preprocessor">#define SqrtOf2Pi     2.506628275</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> kNormalStdDev = <a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a> / (2.0 * <a class="code" href="cluster_8cpp.html#ad3f8e9aec305987f3daa2d431da4cac3">NORMALEXTENT</a>);
<a name="l00216"></a>00216 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> kNormalVariance =
<a name="l00217"></a>00217     (<a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a> * <a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a>) / (4.0 * <a class="code" href="cluster_8cpp.html#ad3f8e9aec305987f3daa2d431da4cac3">NORMALEXTENT</a> * <a class="code" href="cluster_8cpp.html#ad3f8e9aec305987f3daa2d431da4cac3">NORMALEXTENT</a>);
<a name="l00218"></a>00218 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> kNormalMagnitude =
<a name="l00219"></a>00219     (2.0 * <a class="code" href="cluster_8cpp.html#ad3f8e9aec305987f3daa2d431da4cac3">NORMALEXTENT</a>) / (<a class="code" href="cluster_8cpp.html#a5b63c74defa53affeb3825bec1aa894d">SqrtOf2Pi</a> * <a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a>);
<a name="l00220"></a>00220 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> kNormalMean = BUCKETTABLESIZE / 2;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">/* define lookup tables used to compute the number of histogram buckets</span>
<a name="l00223"></a>00223 <span class="comment">  that should be used for a given number of samples. */</span>
<a name="l00224"></a><a class="code" href="cluster_8cpp.html#a4342455851ae586637e6a0abaf3b3f14">00224</a> <span class="preprocessor">#define LOOKUPTABLESIZE   8</span>
<a name="l00225"></a><a class="code" href="cluster_8cpp.html#a1d372c446071a329984f36c50a4e6a8f">00225</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXDEGREESOFFREEDOM MAXBUCKETS</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>
<a name="l00227"></a>00227 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> kCountTable[<a class="code" href="cluster_8cpp.html#a4342455851ae586637e6a0abaf3b3f14">LOOKUPTABLESIZE</a>] = {
<a name="l00228"></a>00228   <a class="code" href="cluster_8cpp.html#a47c31dab77cf79b225315601107dfd67">MINSAMPLES</a>, 200, 400, 600, 800, 1000, 1500, 2000
<a name="l00229"></a>00229 };  <span class="comment">// number of samples</span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> kBucketsTable[<a class="code" href="cluster_8cpp.html#a4342455851ae586637e6a0abaf3b3f14">LOOKUPTABLESIZE</a>] = {
<a name="l00232"></a>00232   <a class="code" href="cluster_8h.html#a759b3b99f54d92a0c6c5471a4c87c42b">MINBUCKETS</a>, 16, 20, 24, 27, 30, 35, <a class="code" href="cluster_8h.html#a17645698964d2a3c89b72281594c58a3">MAXBUCKETS</a>
<a name="l00233"></a>00233 };  <span class="comment">// number of buckets</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="comment">/*-------------------------------------------------------------------------</span>
<a name="l00236"></a>00236 <span class="comment">          Private Function Prototypes</span>
<a name="l00237"></a>00237 <span class="comment">--------------------------------------------------------------------------*/</span>
<a name="l00238"></a>00238 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a4c81bc8616b0a41fc46726affcda9728">CreateClusterTree</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#ae250df46fa1538fb7932e11d5a6aa98a">MakePotentialClusters</a>(<a class="code" href="struct_clustering_context.html">ClusteringContext</a> *context, <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00241"></a>00241                            <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> Level);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <a class="code" href="structsample.html">CLUSTER</a> *<a class="code" href="cluster_8cpp.html#a45fae84caf7ba68e1a77fdffe9f0d112">FindNearestNeighbor</a>(<a class="code" href="struct_k_d_t_r_e_e.html">KDTREE</a> *Tree,
<a name="l00244"></a>00244                              <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00245"></a>00245                              <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *Distance);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <a class="code" href="structsample.html">CLUSTER</a> *<a class="code" href="cluster_8cpp.html#ab73b69de28e8bb2f1332524a02f6f475">MakeNewCluster</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer, <a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> *TempCluster);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> <a class="code" href="cluster_8cpp.html#a13004a2cbbcf26c3d95fd207274823c9">MergeClusters</a> (<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N,
<a name="l00250"></a>00250 <span class="keyword">register</span> <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[],
<a name="l00251"></a>00251 <span class="keyword">register</span> <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> n1,
<a name="l00252"></a>00252 <span class="keyword">register</span> <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> n2,
<a name="l00253"></a>00253 <span class="keyword">register</span> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> m[],
<a name="l00254"></a>00254 <span class="keyword">register</span> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> m1[], <span class="keyword">register</span> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> m2[]);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a85e813bae86e0c290ceb0f99d83ae9bf">ComputePrototypes</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer, <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#aa37ac7f48ca91b0afb78f8408e8b9b6f">MakePrototype</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00259"></a>00259                          <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>,
<a name="l00260"></a>00260                          <a class="code" href="structsample.html">CLUSTER</a> *Cluster);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#abd55a5befb4eda77f5d0abbd460cc501">MakeDegenerateProto</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> N,
<a name="l00263"></a>00263                                <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00264"></a>00264                                <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l00265"></a>00265                                <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9ea">PROTOSTYLE</a> Style,
<a name="l00266"></a>00266                                <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> MinSamples);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a52963d24aa278bff9a1de24806954d61">TestEllipticalProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00269"></a>00269                                <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>,
<a name="l00270"></a>00270                                <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00271"></a>00271                                <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#ad04d25bb39e413b1cd7064534b98f9a4">MakeSphericalProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00274"></a>00274                               <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00275"></a>00275                               <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l00276"></a>00276                               <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a076b9ff3e723f44987211c9bf5f77523">MakeEllipticalProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00279"></a>00279                                <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00280"></a>00280                                <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l00281"></a>00281                                <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a2ebb51aa33fe2a99f5326366ed86b42e">MakeMixedProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00284"></a>00284                           <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00285"></a>00285                           <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l00286"></a>00286                           <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *NormalBuckets,
<a name="l00287"></a>00287                           <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Confidence);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#ae018c99abb6b7f691f2e4b711485b45b">MakeDimRandom</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> i, <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto, <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a12a01c4bc8f83968f4b64600bfff82de">MakeDimUniform</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> i, <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto, <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *<a class="code" href="cluster_8cpp.html#aa60411f531ca1f230d001973299d1c09">ComputeStatistics</a> (<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N,
<a name="l00294"></a>00294 <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[], <a class="code" href="structsample.html">CLUSTER</a> * Cluster);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a96019ee068587b2d17ddb6f43ded872b">NewSphericalProto</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> N,
<a name="l00297"></a>00297                              <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00298"></a>00298                              <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">NewEllipticalProto</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N,
<a name="l00301"></a>00301                               <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00302"></a>00302                               <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#accc05d5eedc4d765148eaa99c1927a79">NewMixedProto</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="structsample.html">CLUSTER</a> *Cluster, <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#adf2445f2aae1e1e03f06eefb85c95b8d">NewSimpleProto</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="structsample.html">CLUSTER</a> *Cluster);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="cluster_8cpp.html#a0a6fea38a06375666937701fb21e6a05">Independent</a> (<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[],
<a name="l00309"></a>00309 <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> * CoVariance, <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Independence);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *<a class="code" href="cluster_8cpp.html#a0924b73d8bc3cd1269aa64f5a41b633f">GetBuckets</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a>* clusterer,
<a name="l00312"></a>00312                     <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> Distribution,
<a name="l00313"></a>00313                     <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCount,
<a name="l00314"></a>00314                     <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Confidence);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *<a class="code" href="cluster_8cpp.html#a93a38445707d2a943e60fafebe0c2b4d">MakeBuckets</a>(<a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> Distribution,
<a name="l00317"></a>00317                      <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCount,
<a name="l00318"></a>00318                      <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Confidence);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#ab182ad32f9100ae8e29e72db623c70dd">OptimumNumberOfBuckets</a>(<a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCount);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a952909dfb237bce2b90d33204b3efe3e">ComputeChiSquared</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Alpha);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a46fa6d94ca57427d93d1f306c4bbcf46">NormalDensity</a>(<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> x);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a5abc8ec5703c3d471dc0dd172cb22168">UniformDensity</a>(<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> x);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#af0eb798915396ae610f1701708a7b816">Integral</a>(<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> f1, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> f2, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Dx);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets,
<a name="l00331"></a>00331                  <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00332"></a>00332                  <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> Dim,
<a name="l00333"></a>00333                  <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc,
<a name="l00334"></a>00334                  <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>,
<a name="l00335"></a>00335                  <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> StdDev);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#a8e988f373e1dc7d9a55043f3db047d09">NormalBucket</a>(<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc,
<a name="l00338"></a>00338                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> x,
<a name="l00339"></a>00339                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>,
<a name="l00340"></a>00340                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> StdDev);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#a43e2cce8f045a700cd6fb0684761cc0c">UniformBucket</a>(<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc,
<a name="l00343"></a>00343                      <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> x,
<a name="l00344"></a>00344                      <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>,
<a name="l00345"></a>00345                      <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> StdDev);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">FreeStatistics</a>(<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a1afe8a387c2e426eea3e152bb1cdd3e9">FreeBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#ac66b8beb503d71773eba9bc47d386ae8">FreeCluster</a>(<a class="code" href="structsample.html">CLUSTER</a> *Cluster);
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>(<a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> Distribution, <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> HistogramBuckets);
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="keywordtype">int</span> <a class="code" href="cluster_8cpp.html#af8d341c60c044ac30867d767c6b9b091">NumBucketsMatch</a>(<span class="keywordtype">void</span> *arg1,   <span class="comment">// BUCKETS *Histogram,</span>
<a name="l00358"></a>00358                     <span class="keywordtype">void</span> *arg2);  <span class="comment">// uinT16 *DesiredNumberOfBuckets);</span>
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="keywordtype">int</span> <a class="code" href="cluster_8cpp.html#a7f39be063580c1c7c5566faf0398dfb0">ListEntryMatch</a>(<span class="keywordtype">void</span> *arg1, <span class="keywordtype">void</span> *arg2);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a02e72bde5b9d967258769d4a75f07e46">AdjustBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets, <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> NewSampleCount);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a0f9ec282a0fa768a4b5bd0d5efaca7d2">InitBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="keywordtype">int</span> <a class="code" href="cluster_8cpp.html#ad39bd07ace019e3862769098fae02f93">AlphaMatch</a>(<span class="keywordtype">void</span> *arg1,   <span class="comment">// CHISTRUCT *ChiStruct,</span>
<a name="l00367"></a>00367                <span class="keywordtype">void</span> *arg2);  <span class="comment">// CHISTRUCT *SearchKey);</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *<a class="code" href="cluster_8cpp.html#ac16f25cf71bcb2632f695f55fb9a5980">NewChiStruct</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Alpha);
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a8098e057438e6f07276dd005f28ef13c">Solve</a>(<a class="code" href="cluster_8cpp.html#a170fa76dec6514a98bb069c4b9652f2d">SOLVEFUNC</a> Function,
<a name="l00372"></a>00372               <span class="keywordtype">void</span> *FunctionParams,
<a name="l00373"></a>00373               <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> InitialGuess,
<a name="l00374"></a>00374               <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Accuracy);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a444724ad6aa7b59e010c1089af12b0b0">ChiArea</a>(<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *ChiParams, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> x);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="cluster_8cpp.html#a39583ff2f6db38f0c2e26f7ad87f2c0c">MultipleCharSamples</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00379"></a>00379                           <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l00380"></a>00380                           <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> MaxIllegal);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="keywordtype">double</span> <a class="code" href="cluster_8cpp.html#a40c47f6785ad5d50a9b113761e16ab9d">InvertMatrix</a>(<span class="keyword">const</span> <span class="keywordtype">float</span>* input, <span class="keywordtype">int</span> size, <span class="keywordtype">float</span>* inv);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="comment">//--------------------------Public Code--------------------------------------</span>
<a name="l00394"></a>00394 <span class="comment"></span><a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *
<a name="l00395"></a><a class="code" href="cluster_8h.html#a93e53684b74358b68adf48b2ee32b042">00395</a> <a class="code" href="cluster_8cpp.html#a93e53684b74358b68adf48b2ee32b042">MakeClusterer</a> (<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> SampleSize, <span class="keyword">const</span> <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[]) {
<a name="l00396"></a>00396   <a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer;
<a name="l00397"></a>00397   <span class="keywordtype">int</span> i;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   <span class="comment">// allocate main clusterer data structure and init simple fields</span>
<a name="l00400"></a>00400   Clusterer = (<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a>));
<a name="l00401"></a>00401   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a> = SampleSize;
<a name="l00402"></a>00402   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a04b44b06900e7a0c8d8d4d4e5a00c3aa">NumberOfSamples</a> = 0;
<a name="l00403"></a>00403   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a> = 0;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="comment">// init fields which will not be used initially</span>
<a name="l00406"></a>00406   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00407"></a>00407   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af6bd9758400f9a886e8fde8d009de70f">ProtoList</a> = <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="comment">// maintain a copy of param descriptors in the clusterer data structure</span>
<a name="l00410"></a>00410   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a> =
<a name="l00411"></a>00411     (<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (SampleSize * <span class="keyword">sizeof</span> (<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a>));
<a name="l00412"></a>00412   <span class="keywordflow">for</span> (i = 0; i &lt; SampleSize; i++) {
<a name="l00413"></a>00413     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a55807f1e0be0daba2a33380ea29b2f1d">Circular</a> = ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a55807f1e0be0daba2a33380ea29b2f1d">Circular</a>;
<a name="l00414"></a>00414     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a> = ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>;
<a name="l00415"></a>00415     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6445e8e433a99239e56c3218437f2695">Min</a> = ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6445e8e433a99239e56c3218437f2695">Min</a>;
<a name="l00416"></a>00416     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a73e76f946bbd324e60914a991d3343d1">Max</a> = ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a73e76f946bbd324e60914a991d3343d1">Max</a>;
<a name="l00417"></a>00417     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a> = ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a73e76f946bbd324e60914a991d3343d1">Max</a> - ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6445e8e433a99239e56c3218437f2695">Min</a>;
<a name="l00418"></a>00418     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a1df92d879d7ec8ea6662e956d27154b5">HalfRange</a> = Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a> / 2;
<a name="l00419"></a>00419     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a7c7bec15766be3633c649a0a9409b512">MidRange</a> =
<a name="l00420"></a>00420       (ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a73e76f946bbd324e60914a991d3343d1">Max</a> + ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6445e8e433a99239e56c3218437f2695">Min</a>) / 2;
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <span class="comment">// allocate a kd tree to hold the samples</span>
<a name="l00424"></a>00424   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a> = <a class="code" href="kdtree_8cpp.html#a92b996eb8120afe351d8e7ee82c96ece">MakeKDTree</a> (SampleSize, ParamDesc);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="comment">// Initialize cache of histogram buckets to minimize recomputing them.</span>
<a name="l00427"></a>00427   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a1223ae56d204b110bd185b7dbdda258e">DISTRIBUTION_COUNT</a>; ++d) {
<a name="l00428"></a>00428     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="cluster_8h.html#a17645698964d2a3c89b72281594c58a3">MAXBUCKETS</a> + 1 - <a class="code" href="cluster_8h.html#a759b3b99f54d92a0c6c5471a4c87c42b">MINBUCKETS</a>; ++c)
<a name="l00429"></a>00429       Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a30ffab128a2b2f6f738b48697bebd5b6">bucket_cache</a>[d][c] = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00430"></a>00430   }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="keywordflow">return</span> Clusterer;
<a name="l00433"></a>00433 }                                <span class="comment">// MakeClusterer</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 
<a name="l00450"></a><a class="code" href="cluster_8h.html#ab3cc5ee277d4a2cf4000668b1ffbcf4a">00450</a> <a class="code" href="structsample.html">SAMPLE</a>* <a class="code" href="cluster_8cpp.html#ab3cc5ee277d4a2cf4000668b1ffbcf4a">MakeSample</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> * Clusterer, <span class="keyword">const</span> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>* Feature,
<a name="l00451"></a>00451                    <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> CharID) {
<a name="l00452"></a>00452   <a class="code" href="structsample.html">SAMPLE</a> *Sample;
<a name="l00453"></a>00453   <span class="keywordtype">int</span> i;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   <span class="comment">// see if the samples have already been clustered - if so trap an error</span>
<a name="l00456"></a>00456   <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00457"></a>00457     <a class="code" href="danerror_8cpp.html#a480942fa88232bda23e9809e5afa9f25">DoError</a> (<a class="code" href="cluster_8h.html#aa086ccbc1343c3ac99987b23d500adab">ALREADYCLUSTERED</a>,
<a name="l00458"></a>00458       <span class="stringliteral">&quot;Can&#39;t add samples after they have been clustered&quot;</span>);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="comment">// allocate the new sample and initialize it</span>
<a name="l00461"></a>00461   Sample = (<a class="code" href="structsample.html">SAMPLE</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="structsample.html">SAMPLE</a>) +
<a name="l00462"></a>00462     (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a> -
<a name="l00463"></a>00463     1) * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00464"></a>00464   Sample-&gt;<a class="code" href="structsample.html#aa6b39588394fbede2bdcac083bf3832d">Clustered</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00465"></a>00465   Sample-&gt;<a class="code" href="structsample.html#af0c82e552c662971cf574f9ee8bcb40f">Prototype</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00466"></a>00466   Sample-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a> = 1;
<a name="l00467"></a>00467   Sample-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00468"></a>00468   Sample-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00469"></a>00469   Sample-&gt;<a class="code" href="structsample.html#a564df9059b85a37e9f4e69843eec3e20">CharID</a> = CharID;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <span class="keywordflow">for</span> (i = 0; i &lt; Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>; i++)
<a name="l00472"></a>00472     Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i] = Feature[i];
<a name="l00473"></a>00473 
<a name="l00474"></a>00474   <span class="comment">// add the sample to the KD tree - keep track of the total # of samples</span>
<a name="l00475"></a>00475   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a04b44b06900e7a0c8d8d4d4e5a00c3aa">NumberOfSamples</a>++;
<a name="l00476"></a>00476   <a class="code" href="kdtree_8cpp.html#a596422fd837fb6937c12be6b277423a0">KDStore</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>, Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, (<span class="keywordtype">char</span> *) Sample);
<a name="l00477"></a>00477   <span class="keywordflow">if</span> (CharID &gt;= Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a>)
<a name="l00478"></a>00478     Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a> = CharID + 1;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480   <span class="comment">// execute hook for monitoring clustering operation</span>
<a name="l00481"></a>00481   <span class="comment">// (*SampleCreationHook)( Sample );</span>
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   <span class="keywordflow">return</span> (Sample);
<a name="l00484"></a>00484 }                                <span class="comment">// MakeSample</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00504"></a><a class="code" href="cluster_8h.html#ac7c6943d214b9c60e0f37cbb1a2111b4">00504</a> <a class="code" href="structlist__rec.html">LIST</a> <a class="code" href="cluster_8cpp.html#ac7c6943d214b9c60e0f37cbb1a2111b4">ClusterSamples</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer, <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>) {
<a name="l00505"></a>00505   <span class="comment">//only create cluster tree if samples have never been clustered before</span>
<a name="l00506"></a>00506   <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00507"></a>00507     <a class="code" href="cluster_8cpp.html#a4c81bc8616b0a41fc46726affcda9728">CreateClusterTree</a>(Clusterer);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <span class="comment">//deallocate the old prototype list if one exists</span>
<a name="l00510"></a>00510   <a class="code" href="cluster_8cpp.html#a7e5357920f0bded023b15d29ddf15ebf">FreeProtoList</a> (&amp;Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af6bd9758400f9a886e8fde8d009de70f">ProtoList</a>);
<a name="l00511"></a>00511   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af6bd9758400f9a886e8fde8d009de70f">ProtoList</a> = <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513   <span class="comment">//compute prototypes starting at the root node in the tree</span>
<a name="l00514"></a>00514   <a class="code" href="cluster_8cpp.html#a85e813bae86e0c290ceb0f99d83ae9bf">ComputePrototypes</a>(Clusterer, Config);
<a name="l00515"></a>00515   <span class="keywordflow">return</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af6bd9758400f9a886e8fde8d009de70f">ProtoList</a>);
<a name="l00516"></a>00516 }                                <span class="comment">// ClusterSamples</span>
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 
<a name="l00532"></a><a class="code" href="cluster_8h.html#aa5b6309260cd2d1acac25bd9cc9e9a66">00532</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#aa5b6309260cd2d1acac25bd9cc9e9a66">FreeClusterer</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer) {
<a name="l00533"></a>00533   <span class="keywordflow">if</span> (Clusterer != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00534"></a>00534     <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>);
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00536"></a>00536       <a class="code" href="kdtree_8cpp.html#a37e4019555a2b5284b17237373913346">FreeKDTree</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>);
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00538"></a>00538       <a class="code" href="cluster_8cpp.html#ac66b8beb503d71773eba9bc47d386ae8">FreeCluster</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a>);
<a name="l00539"></a>00539     <span class="comment">// Free up all used buckets structures.</span>
<a name="l00540"></a>00540     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a1223ae56d204b110bd185b7dbdda258e">DISTRIBUTION_COUNT</a>; ++d) {
<a name="l00541"></a>00541       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="cluster_8h.html#a17645698964d2a3c89b72281594c58a3">MAXBUCKETS</a> + 1 - <a class="code" href="cluster_8h.html#a759b3b99f54d92a0c6c5471a4c87c42b">MINBUCKETS</a>; ++c)
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a30ffab128a2b2f6f738b48697bebd5b6">bucket_cache</a>[d][c] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00543"></a>00543           <a class="code" href="cluster_8cpp.html#a1afe8a387c2e426eea3e152bb1cdd3e9">FreeBuckets</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a30ffab128a2b2f6f738b48697bebd5b6">bucket_cache</a>[d][c]);
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Clusterer);
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548 }                                <span class="comment">// FreeClusterer</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00560"></a><a class="code" href="cluster_8h.html#a7e5357920f0bded023b15d29ddf15ebf">00560</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a7e5357920f0bded023b15d29ddf15ebf">FreeProtoList</a>(<a class="code" href="structlist__rec.html">LIST</a> *ProtoList) {
<a name="l00561"></a>00561   <a class="code" href="oldlist_8cpp.html#a1a1efc1a269e5bb5bf16c1a174363ba4">destroy_nodes</a>(*ProtoList, <a class="code" href="cluster_8cpp.html#aa5d7083be183c7a4e2b2fa746a560a7b">FreePrototype</a>);
<a name="l00562"></a>00562 }                                <span class="comment">// FreeProtoList</span>
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 
<a name="l00575"></a><a class="code" href="cluster_8h.html#aa5d7083be183c7a4e2b2fa746a560a7b">00575</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#aa5d7083be183c7a4e2b2fa746a560a7b">FreePrototype</a>(<span class="keywordtype">void</span> *arg) {  <span class="comment">//PROTOTYPE     *Prototype)</span>
<a name="l00576"></a>00576   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Prototype = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) arg;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   <span class="comment">// unmark the corresponding cluster (if there is one</span>
<a name="l00579"></a>00579   <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aff59384612de343b799b92a5d80282b7">Cluster</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00580"></a>00580     Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aff59384612de343b799b92a5d80282b7">Cluster</a>-&gt;<a class="code" href="structsample.html#af0c82e552c662971cf574f9ee8bcb40f">Prototype</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582   <span class="comment">// deallocate the prototype statistics and then the prototype itself</span>
<a name="l00583"></a>00583   <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00584"></a>00584     <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a>);
<a name="l00585"></a>00585   <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00586"></a>00586     <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>);
<a name="l00587"></a>00587   <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a> != <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa93d6901f160899d15f69322530595f4f">spherical</a>) {
<a name="l00588"></a>00588     <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00589"></a>00589       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>);
<a name="l00590"></a>00590     <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00591"></a>00591       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>);
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00593"></a>00593       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>);
<a name="l00594"></a>00594   }
<a name="l00595"></a>00595   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Prototype);
<a name="l00596"></a>00596 }                                <span class="comment">// FreePrototype</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 
<a name="l00614"></a><a class="code" href="cluster_8h.html#abf5d9e3b151ac51b27bd9dc797ac261c">00614</a> <a class="code" href="structsample.html">CLUSTER</a> *<a class="code" href="cluster_8cpp.html#abf5d9e3b151ac51b27bd9dc797ac261c">NextSample</a>(<a class="code" href="structlist__rec.html">LIST</a> *SearchState) {
<a name="l00615"></a>00615   <a class="code" href="structsample.html">CLUSTER</a> *Cluster;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617   <span class="keywordflow">if</span> (*SearchState == <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>)
<a name="l00618"></a>00618     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00619"></a>00619   Cluster = (<a class="code" href="structsample.html">CLUSTER</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (*SearchState);
<a name="l00620"></a>00620   *SearchState = <a class="code" href="oldlist_8cpp.html#a4a16ea0d766f4b3bc697142d5303a62c">pop</a> (*SearchState);
<a name="l00621"></a>00621   <span class="keywordflow">while</span> (<a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l00622"></a>00622     <span class="keywordflow">if</span> (Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00623"></a>00623       <span class="keywordflow">return</span> (Cluster);
<a name="l00624"></a>00624     *SearchState = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (*SearchState, Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>);
<a name="l00625"></a>00625     Cluster = Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>;
<a name="l00626"></a>00626   }
<a name="l00627"></a>00627 }                                <span class="comment">// NextSample</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 
<a name="l00639"></a><a class="code" href="cluster_8h.html#ad99e1235a4e63880ab2f72bfdff26e28">00639</a> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>(<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto, <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> Dimension) {
<a name="l00640"></a>00640   <span class="keywordflow">return</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[Dimension]);
<a name="l00641"></a>00641 }                                <span class="comment">// Mean</span>
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 
<a name="l00653"></a><a class="code" href="cluster_8h.html#a8bdd5efd86c814e7f069aa7674cd5178">00653</a> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#a8bdd5efd86c814e7f069aa7674cd5178">StandardDeviation</a>(<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto, <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> Dimension) {
<a name="l00654"></a>00654   <span class="keywordflow">switch</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a>) {
<a name="l00655"></a>00655     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa93d6901f160899d15f69322530595f4f">spherical</a>:
<a name="l00656"></a>00656       <span class="keywordflow">return</span> ((<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>) sqrt ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a>));
<a name="l00657"></a>00657     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa39d32ff639641ca169c9729c58614459">elliptical</a>:
<a name="l00658"></a>00658       <span class="keywordflow">return</span> ((<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>)
<a name="l00659"></a>00659         sqrt ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[Dimension]));
<a name="l00660"></a>00660     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaab164032fff82a847826b4887d9e7be58">mixed</a>:
<a name="l00661"></a>00661       <span class="keywordflow">switch</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a>[Dimension]) {
<a name="l00662"></a>00662         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0aebc81705969b8c5ae986b0b2ec08d1d5">normal</a>:
<a name="l00663"></a>00663           <span class="keywordflow">return</span> ((<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>)
<a name="l00664"></a>00664             sqrt ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[Dimension]));
<a name="l00665"></a>00665         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a56013d9ac59a24fb94d9acb932a04b2f">uniform</a>:
<a name="l00666"></a>00666         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a21504929e31ddde091641bb817e32320">D_random</a>:
<a name="l00667"></a>00667           <span class="keywordflow">return</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[Dimension]);
<a name="l00668"></a>00668         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a1223ae56d204b110bd185b7dbdda258e">DISTRIBUTION_COUNT</a>:
<a name="l00669"></a>00669           <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(!<span class="stringliteral">&quot;Distribution count not allowed!&quot;</span>);
<a name="l00670"></a>00670       }
<a name="l00671"></a>00671   }
<a name="l00672"></a>00672   <span class="keywordflow">return</span> 0.0f;
<a name="l00673"></a>00673 }                                <span class="comment">// StandardDeviation</span>
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="comment">/*---------------------------------------------------------------------------</span>
<a name="l00677"></a>00677 <span class="comment">            Private Code</span>
<a name="l00678"></a>00678 <span class="comment">----------------------------------------------------------------------------*/</span>
<a name="l00694"></a><a class="code" href="cluster_8cpp.html#a4c81bc8616b0a41fc46726affcda9728">00694</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a4c81bc8616b0a41fc46726affcda9728">CreateClusterTree</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer) {
<a name="l00695"></a>00695   <a class="code" href="struct_clustering_context.html">ClusteringContext</a> context;
<a name="l00696"></a>00696   <a class="code" href="struct_h_e_a_p_e_n_t_r_y.html">HEAPENTRY</a> HeapEntry;
<a name="l00697"></a>00697   <a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> *PotentialCluster;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="comment">// each sample and its nearest neighbor form a &quot;potential&quot; cluster</span>
<a name="l00700"></a>00700   <span class="comment">// save these in a heap with the &quot;best&quot; potential clusters on top</span>
<a name="l00701"></a>00701   context.<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a> = Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>;
<a name="l00702"></a>00702   context.<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a> = (<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> *)
<a name="l00703"></a>00703     <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a04b44b06900e7a0c8d8d4d4e5a00c3aa">NumberOfSamples</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a>));
<a name="l00704"></a>00704   context.<a class="code" href="struct_clustering_context.html#a6e7e68c81c4925fb0cc24fa90d1fa358">next</a> = 0;
<a name="l00705"></a>00705   context.<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a> = <a class="code" href="oldheap_8cpp.html#a101bee15b825fee78f29c8679cc00595">MakeHeap</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a04b44b06900e7a0c8d8d4d4e5a00c3aa">NumberOfSamples</a>);
<a name="l00706"></a>00706   <a class="code" href="kdtree_8cpp.html#abf3863949061899c45c47ec81c416234">KDWalk</a>(context.<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a>, (<a class="code" href="cutil_8h.html#adec17f7c242871b5c6efb7bdb4050b9e">void_proc</a>)<a class="code" href="cluster_8cpp.html#ae250df46fa1538fb7932e11d5a6aa98a">MakePotentialClusters</a>, &amp;context);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   <span class="comment">// form potential clusters into actual clusters - always do &quot;best&quot; first</span>
<a name="l00709"></a>00709   <span class="keywordflow">while</span> (<a class="code" href="oldheap_8cpp.html#aad11f18baf53c82e65a054ff7552d0d1">GetTopOfHeap</a>(context.<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a>, &amp;HeapEntry) != <a class="code" href="oldheap_8h.html#a2b7cf2a3641be7b89138615764d60ba3">EMPTY</a>) {
<a name="l00710"></a>00710     PotentialCluster = (<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> *)HeapEntry.<a class="code" href="struct_h_e_a_p_e_n_t_r_y.html#ab04a38c2cfaa44594782f052cbe7414d">Data</a>;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="comment">// if main cluster of potential cluster is already in another cluster</span>
<a name="l00713"></a>00713     <span class="comment">// then we don&#39;t need to worry about it</span>
<a name="l00714"></a>00714     if (PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a>-&gt;<a class="code" href="structsample.html#aa6b39588394fbede2bdcac083bf3832d">Clustered</a>) {
<a name="l00715"></a>00715       <span class="keywordflow">continue</span>;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="comment">// if main cluster is not yet clustered, but its nearest neighbor is</span>
<a name="l00719"></a>00719     <span class="comment">// then we must find a new nearest neighbor</span>
<a name="l00720"></a>00720     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a>-&gt;<a class="code" href="structsample.html#aa6b39588394fbede2bdcac083bf3832d">Clustered</a>) {
<a name="l00721"></a>00721       PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a> =
<a name="l00722"></a>00722         <a class="code" href="cluster_8cpp.html#a45fae84caf7ba68e1a77fdffe9f0d112">FindNearestNeighbor</a>(context.<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a>, PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a>,
<a name="l00723"></a>00723                             &amp;HeapEntry.<a class="code" href="struct_h_e_a_p_e_n_t_r_y.html#aa80cabd8128f5fa5a64e00b2e41e9c54">Key</a>);
<a name="l00724"></a>00724       <span class="keywordflow">if</span> (PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00725"></a>00725         <a class="code" href="oldheap_8cpp.html#a21a037334c93e1d0e7ae2059203a9cf3">HeapStore</a>(context.<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a>, &amp;HeapEntry);
<a name="l00726"></a>00726       }
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     <span class="comment">// if neither cluster is already clustered, form permanent cluster</span>
<a name="l00730"></a>00730     <span class="keywordflow">else</span> {
<a name="l00731"></a>00731       PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a> =
<a name="l00732"></a>00732           <a class="code" href="cluster_8cpp.html#ab73b69de28e8bb2f1332524a02f6f475">MakeNewCluster</a>(Clusterer, PotentialCluster);
<a name="l00733"></a>00733       PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a> =
<a name="l00734"></a>00734           <a class="code" href="cluster_8cpp.html#a45fae84caf7ba68e1a77fdffe9f0d112">FindNearestNeighbor</a>(context.<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a>, PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a>,
<a name="l00735"></a>00735                               &amp;HeapEntry.<a class="code" href="struct_h_e_a_p_e_n_t_r_y.html#aa80cabd8128f5fa5a64e00b2e41e9c54">Key</a>);
<a name="l00736"></a>00736       <span class="keywordflow">if</span> (PotentialCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00737"></a>00737         <a class="code" href="oldheap_8cpp.html#a21a037334c93e1d0e7ae2059203a9cf3">HeapStore</a>(context.<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a>, &amp;HeapEntry);
<a name="l00738"></a>00738       }
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   <span class="comment">// the root node in the cluster tree is now the only node in the kd-tree</span>
<a name="l00743"></a>00743   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a> = (<a class="code" href="structsample.html">CLUSTER</a> *) <a class="code" href="kdtree_8h.html#aa17af5e06853a731f52d4b4a84c3df90">RootOf</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745   <span class="comment">// free up the memory used by the K-D tree, heap, and temp clusters</span>
<a name="l00746"></a>00746   <a class="code" href="kdtree_8cpp.html#a37e4019555a2b5284b17237373913346">FreeKDTree</a>(context.<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a>);
<a name="l00747"></a>00747   Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00748"></a>00748   <a class="code" href="oldheap_8h.html#a8631cc3f443c4ea3e99195df1ca1dd8d">FreeHeap</a>(context.<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a>);
<a name="l00749"></a>00749   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(context.<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>);
<a name="l00750"></a>00750 }                                <span class="comment">// CreateClusterTree</span>
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 
<a name="l00764"></a><a class="code" href="cluster_8cpp.html#ae250df46fa1538fb7932e11d5a6aa98a">00764</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#ae250df46fa1538fb7932e11d5a6aa98a">MakePotentialClusters</a>(<a class="code" href="struct_clustering_context.html">ClusteringContext</a> *context,
<a name="l00765"></a>00765                            <a class="code" href="structsample.html">CLUSTER</a> *Cluster, <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> Level) {
<a name="l00766"></a>00766   <a class="code" href="struct_h_e_a_p_e_n_t_r_y.html">HEAPENTRY</a> HeapEntry;
<a name="l00767"></a>00767   <span class="keywordtype">int</span> next = context-&gt;<a class="code" href="struct_clustering_context.html#a6e7e68c81c4925fb0cc24fa90d1fa358">next</a>;
<a name="l00768"></a>00768   context-&gt;<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>[next].<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a> = Cluster;
<a name="l00769"></a>00769   HeapEntry.<a class="code" href="struct_h_e_a_p_e_n_t_r_y.html#ab04a38c2cfaa44594782f052cbe7414d">Data</a> = (<span class="keywordtype">char</span> *) &amp;(context-&gt;<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>[next]);
<a name="l00770"></a>00770   context-&gt;<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>[next].<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a> =
<a name="l00771"></a>00771       <a class="code" href="cluster_8cpp.html#a45fae84caf7ba68e1a77fdffe9f0d112">FindNearestNeighbor</a>(context-&gt;<a class="code" href="struct_clustering_context.html#a6414b57292a4e25bfe1af8bd47258817">tree</a>,
<a name="l00772"></a>00772                           context-&gt;<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>[next].<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a>,
<a name="l00773"></a>00773                           &amp;HeapEntry.<a class="code" href="struct_h_e_a_p_e_n_t_r_y.html#aa80cabd8128f5fa5a64e00b2e41e9c54">Key</a>);
<a name="l00774"></a>00774   <span class="keywordflow">if</span> (context-&gt;<a class="code" href="struct_clustering_context.html#abcdf0ba8732036cb540bb470956186d3">candidates</a>[next].<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00775"></a>00775     <a class="code" href="oldheap_8cpp.html#a21a037334c93e1d0e7ae2059203a9cf3">HeapStore</a>(context-&gt;<a class="code" href="struct_clustering_context.html#a411623fe2aa0ed365290e1f0c8ac81a4">heap</a>, &amp;HeapEntry);
<a name="l00776"></a>00776     context-&gt;<a class="code" href="struct_clustering_context.html#a6e7e68c81c4925fb0cc24fa90d1fa358">next</a>++;
<a name="l00777"></a>00777   }
<a name="l00778"></a>00778 }                                <span class="comment">// MakePotentialClusters</span>
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 
<a name="l00797"></a>00797 <a class="code" href="structsample.html">CLUSTER</a> *
<a name="l00798"></a><a class="code" href="cluster_8cpp.html#a45fae84caf7ba68e1a77fdffe9f0d112">00798</a> <a class="code" href="cluster_8cpp.html#a45fae84caf7ba68e1a77fdffe9f0d112">FindNearestNeighbor</a>(<a class="code" href="struct_k_d_t_r_e_e.html">KDTREE</a> * Tree, <a class="code" href="structsample.html">CLUSTER</a> * Cluster, <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> * Distance)
<a name="l00799"></a>00799 <span class="preprocessor">#define MAXNEIGHBORS  2</span>
<a name="l00800"></a>00800 <span class="preprocessor"></span><span class="preprocessor">#define MAXDISTANCE   MAX_FLOAT32</span>
<a name="l00801"></a>00801 <span class="preprocessor"></span>{
<a name="l00802"></a>00802   <a class="code" href="structsample.html">CLUSTER</a> *Neighbor[<a class="code" href="cluster_8cpp.html#a8bfc8221d16b9c34781f2bf8753bd380">MAXNEIGHBORS</a>];
<a name="l00803"></a>00803   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Dist[<a class="code" href="cluster_8cpp.html#a8bfc8221d16b9c34781f2bf8753bd380">MAXNEIGHBORS</a>];
<a name="l00804"></a>00804   <span class="keywordtype">int</span> NumberOfNeighbors;
<a name="l00805"></a>00805   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> i;
<a name="l00806"></a>00806   <a class="code" href="structsample.html">CLUSTER</a> *BestNeighbor;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808   <span class="comment">// find the 2 nearest neighbors of the cluster</span>
<a name="l00809"></a>00809   <a class="code" href="kdtree_8cpp.html#a9a3e49226adc75b00fee5116b401f3e3">KDNearestNeighborSearch</a>(Tree, Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, <a class="code" href="cluster_8cpp.html#a8bfc8221d16b9c34781f2bf8753bd380">MAXNEIGHBORS</a>, <a class="code" href="cluster_8cpp.html#a010fa716ced1170c05d8fc9da46a5d34">MAXDISTANCE</a>,
<a name="l00810"></a>00810                           &amp;NumberOfNeighbors, (<span class="keywordtype">void</span> **)Neighbor, Dist);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812   <span class="comment">// search for the nearest neighbor that is not the cluster itself</span>
<a name="l00813"></a>00813   *Distance = <a class="code" href="cluster_8cpp.html#a010fa716ced1170c05d8fc9da46a5d34">MAXDISTANCE</a>;
<a name="l00814"></a>00814   BestNeighbor = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00815"></a>00815   <span class="keywordflow">for</span> (i = 0; i &lt; NumberOfNeighbors; i++) {
<a name="l00816"></a>00816     <span class="keywordflow">if</span> ((Dist[i] &lt; *Distance) &amp;&amp; (Neighbor[i] != Cluster)) {
<a name="l00817"></a>00817       *Distance = Dist[i];
<a name="l00818"></a>00818       BestNeighbor = Neighbor[i];
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821   <span class="keywordflow">return</span> BestNeighbor;
<a name="l00822"></a>00822 }                                <span class="comment">// FindNearestNeighbor</span>
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 
<a name="l00837"></a><a class="code" href="cluster_8cpp.html#ab73b69de28e8bb2f1332524a02f6f475">00837</a> <a class="code" href="structsample.html">CLUSTER</a> *<a class="code" href="cluster_8cpp.html#ab73b69de28e8bb2f1332524a02f6f475">MakeNewCluster</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer, <a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html">TEMPCLUSTER</a> *TempCluster) {
<a name="l00838"></a>00838   <a class="code" href="structsample.html">CLUSTER</a> *Cluster;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840   <span class="comment">// allocate the new cluster and initialize it</span>
<a name="l00841"></a>00841   Cluster = (<a class="code" href="structsample.html">CLUSTER</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(
<a name="l00842"></a>00842       <span class="keyword">sizeof</span>(<a class="code" href="structsample.html">CLUSTER</a>) + (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a> - 1) * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00843"></a>00843   Cluster-&gt;<a class="code" href="structsample.html#aa6b39588394fbede2bdcac083bf3832d">Clustered</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00844"></a>00844   Cluster-&gt;<a class="code" href="structsample.html#af0c82e552c662971cf574f9ee8bcb40f">Prototype</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00845"></a>00845   Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a> = TempCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#adfa4721271456305d40524737800bb2e">Cluster</a>;
<a name="l00846"></a>00846   Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a> = TempCluster-&gt;<a class="code" href="struct_t_e_m_p_c_l_u_s_t_e_r.html#abc9f805357e72eae3febb1dbd4c412ac">Neighbor</a>;
<a name="l00847"></a>00847   Cluster-&gt;<a class="code" href="structsample.html#a564df9059b85a37e9f4e69843eec3e20">CharID</a> = -1;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   <span class="comment">// mark the old clusters as &quot;clustered&quot; and delete them from the kd-tree</span>
<a name="l00850"></a>00850   Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>-&gt;<a class="code" href="structsample.html#aa6b39588394fbede2bdcac083bf3832d">Clustered</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00851"></a>00851   Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>-&gt;<a class="code" href="structsample.html#aa6b39588394fbede2bdcac083bf3832d">Clustered</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00852"></a>00852   <a class="code" href="kdtree_8cpp.html#a270d3ef72c3f0097f249ca75c2aafa3c">KDDelete</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>, Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>);
<a name="l00853"></a>00853   <a class="code" href="kdtree_8cpp.html#a270d3ef72c3f0097f249ca75c2aafa3c">KDDelete</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>, Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <span class="comment">// compute the mean and sample count for the new cluster</span>
<a name="l00856"></a>00856   Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a> =
<a name="l00857"></a>00857       <a class="code" href="cluster_8cpp.html#a13004a2cbbcf26c3d95fd207274823c9">MergeClusters</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>,
<a name="l00858"></a>00858                     Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>, Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>,
<a name="l00859"></a>00859                     Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>);
<a name="l00860"></a>00860 
<a name="l00861"></a>00861   <span class="comment">// add the new cluster to the KD tree</span>
<a name="l00862"></a>00862   <a class="code" href="kdtree_8cpp.html#a596422fd837fb6937c12be6b277423a0">KDStore</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af2c9040008b80775815320a327f21242">KDTree</a>, Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>, Cluster);
<a name="l00863"></a>00863   <span class="keywordflow">return</span> Cluster;
<a name="l00864"></a>00864 }                                <span class="comment">// MakeNewCluster</span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 
<a name="l00882"></a><a class="code" href="cluster_8h.html#a69b09f11067d2b087f4da951934ca556">00882</a> <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> <a class="code" href="cluster_8cpp.html#a13004a2cbbcf26c3d95fd207274823c9">MergeClusters</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N,
<a name="l00883"></a>00883                     <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[],
<a name="l00884"></a>00884                     <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> n1,
<a name="l00885"></a>00885                     <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> n2,
<a name="l00886"></a>00886                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> m[],
<a name="l00887"></a>00887                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> m1[], <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> m2[]) {
<a name="l00888"></a>00888   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> i, n;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890   n = n1 + n2;
<a name="l00891"></a>00891   <span class="keywordflow">for</span> (i = N; i &gt; 0; i--, ParamDesc++, m++, m1++, m2++) {
<a name="l00892"></a>00892     <span class="keywordflow">if</span> (ParamDesc-&gt;Circular) {
<a name="l00893"></a>00893       <span class="comment">// if distance between means is greater than allowed</span>
<a name="l00894"></a>00894       <span class="comment">// reduce upper point by one &quot;rotation&quot; to compute mean</span>
<a name="l00895"></a>00895       <span class="comment">// then normalize the mean back into the accepted range</span>
<a name="l00896"></a>00896       <span class="keywordflow">if</span> ((*m2 - *m1) &gt; ParamDesc-&gt;HalfRange) {
<a name="l00897"></a>00897         *m = (n1 * *m1 + n2 * (*m2 - ParamDesc-&gt;Range)) / n;
<a name="l00898"></a>00898         <span class="keywordflow">if</span> (*m &lt; ParamDesc-&gt;Min)
<a name="l00899"></a>00899           *m += ParamDesc-&gt;Range;
<a name="l00900"></a>00900       }
<a name="l00901"></a>00901       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*m1 - *m2) &gt; ParamDesc-&gt;HalfRange) {
<a name="l00902"></a>00902         *m = (n1 * (*m1 - ParamDesc-&gt;Range) + n2 * *m2) / n;
<a name="l00903"></a>00903         <span class="keywordflow">if</span> (*m &lt; ParamDesc-&gt;Min)
<a name="l00904"></a>00904           *m += ParamDesc-&gt;Range;
<a name="l00905"></a>00905       }
<a name="l00906"></a>00906       <span class="keywordflow">else</span>
<a name="l00907"></a>00907         *m = (n1 * *m1 + n2 * *m2) / n;
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909     <span class="keywordflow">else</span>
<a name="l00910"></a>00910       *m = (n1 * *m1 + n2 * *m2) / n;
<a name="l00911"></a>00911   }
<a name="l00912"></a>00912   <span class="keywordflow">return</span> n;
<a name="l00913"></a>00913 }                                <span class="comment">// MergeClusters</span>
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 
<a name="l00927"></a><a class="code" href="cluster_8cpp.html#a85e813bae86e0c290ceb0f99d83ae9bf">00927</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a85e813bae86e0c290ceb0f99d83ae9bf">ComputePrototypes</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer, <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>) {
<a name="l00928"></a>00928   <a class="code" href="structlist__rec.html">LIST</a> ClusterStack = <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>;
<a name="l00929"></a>00929   <a class="code" href="structsample.html">CLUSTER</a> *Cluster;
<a name="l00930"></a>00930   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Prototype;
<a name="l00931"></a>00931 
<a name="l00932"></a>00932   <span class="comment">// use a stack to keep track of clusters waiting to be processed</span>
<a name="l00933"></a>00933   <span class="comment">// initially the only cluster on the stack is the root cluster</span>
<a name="l00934"></a>00934   <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00935"></a>00935     ClusterStack = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (<a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>, Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a0178d3dfedb397870384f599d809c54d">Root</a>);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937   <span class="comment">// loop until we have analyzed all clusters which are potential prototypes</span>
<a name="l00938"></a>00938   <span class="keywordflow">while</span> (ClusterStack != <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>) {
<a name="l00939"></a>00939     <span class="comment">// remove the next cluster to be analyzed from the stack</span>
<a name="l00940"></a>00940     <span class="comment">// try to make a prototype from the cluster</span>
<a name="l00941"></a>00941     <span class="comment">// if successful, put it on the proto list, else split the cluster</span>
<a name="l00942"></a>00942     Cluster = (<a class="code" href="structsample.html">CLUSTER</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (ClusterStack);
<a name="l00943"></a>00943     ClusterStack = <a class="code" href="oldlist_8cpp.html#a4a16ea0d766f4b3bc697142d5303a62c">pop</a> (ClusterStack);
<a name="l00944"></a>00944     Prototype = <a class="code" href="cluster_8cpp.html#aa37ac7f48ca91b0afb78f8408e8b9b6f">MakePrototype</a>(Clusterer, Config, Cluster);
<a name="l00945"></a>00945     <span class="keywordflow">if</span> (Prototype != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00946"></a>00946       Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af6bd9758400f9a886e8fde8d009de70f">ProtoList</a> = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af6bd9758400f9a886e8fde8d009de70f">ProtoList</a>, Prototype);
<a name="l00947"></a>00947     }
<a name="l00948"></a>00948     <span class="keywordflow">else</span> {
<a name="l00949"></a>00949       ClusterStack = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (ClusterStack, Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>);
<a name="l00950"></a>00950       ClusterStack = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (ClusterStack, Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>);
<a name="l00951"></a>00951     }
<a name="l00952"></a>00952   }
<a name="l00953"></a>00953 }                                <span class="comment">// ComputePrototypes</span>
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 
<a name="l00974"></a><a class="code" href="cluster_8cpp.html#aa37ac7f48ca91b0afb78f8408e8b9b6f">00974</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#aa37ac7f48ca91b0afb78f8408e8b9b6f">MakePrototype</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l00975"></a>00975                          <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>,
<a name="l00976"></a>00976                          <a class="code" href="structsample.html">CLUSTER</a> *Cluster) {
<a name="l00977"></a>00977   <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics;
<a name="l00978"></a>00978   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto;
<a name="l00979"></a>00979   <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981   <span class="comment">// filter out clusters which contain samples from the same character</span>
<a name="l00982"></a>00982   <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a39583ff2f6db38f0c2e26f7ad87f2c0c">MultipleCharSamples</a> (Clusterer, Cluster, Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#aaf0758a0e763d9525d6d7781db8ade14">MaxIllegal</a>))
<a name="l00983"></a>00983     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00984"></a>00984 
<a name="l00985"></a>00985   <span class="comment">// compute the covariance matrix and ranges for the cluster</span>
<a name="l00986"></a>00986   Statistics =
<a name="l00987"></a>00987       <a class="code" href="cluster_8cpp.html#aa60411f531ca1f230d001973299d1c09">ComputeStatistics</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>, Cluster);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989   <span class="comment">// check for degenerate clusters which need not be analyzed further</span>
<a name="l00990"></a>00990   <span class="comment">// note that the MinSamples test assumes that all clusters with multiple</span>
<a name="l00991"></a>00991   <span class="comment">// character samples have been removed (as above)</span>
<a name="l00992"></a>00992   Proto = <a class="code" href="cluster_8cpp.html#abd55a5befb4eda77f5d0abbd460cc501">MakeDegenerateProto</a>(
<a name="l00993"></a>00993       Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Cluster, Statistics, Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a53c426e655c701e99f7744a35ecced70">ProtoStyle</a>,
<a name="l00994"></a>00994       (<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a>) (Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a> * Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a>));
<a name="l00995"></a>00995   <span class="keywordflow">if</span> (Proto != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00996"></a>00996     <a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">FreeStatistics</a>(Statistics);
<a name="l00997"></a>00997     <span class="keywordflow">return</span> Proto;
<a name="l00998"></a>00998   }
<a name="l00999"></a>00999   <span class="comment">// check to ensure that all dimensions are independent</span>
<a name="l01000"></a>01000   <span class="keywordflow">if</span> (!<a class="code" href="cluster_8cpp.html#a0a6fea38a06375666937701fb21e6a05">Independent</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>, Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>,
<a name="l01001"></a>01001                    Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>, Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a77c7d2361e92592098a3287cabc26a6d">Independence</a>)) {
<a name="l01002"></a>01002     <a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">FreeStatistics</a>(Statistics);
<a name="l01003"></a>01003     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01004"></a>01004   }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006   <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a6c16d1564de65f394e737811e5389042">HOTELLING</a> &amp;&amp; Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a53c426e655c701e99f7744a35ecced70">ProtoStyle</a> == <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa39d32ff639641ca169c9729c58614459">elliptical</a>) {
<a name="l01007"></a>01007     Proto = <a class="code" href="cluster_8cpp.html#a52963d24aa278bff9a1de24806954d61">TestEllipticalProto</a>(Clusterer, Config, Cluster, Statistics);
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (Proto != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01009"></a>01009       <a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">FreeStatistics</a>(Statistics);
<a name="l01010"></a>01010       <span class="keywordflow">return</span> Proto;
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012   }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014   <span class="comment">// create a histogram data structure used to evaluate distributions</span>
<a name="l01015"></a>01015   Buckets = <a class="code" href="cluster_8cpp.html#a0924b73d8bc3cd1269aa64f5a41b633f">GetBuckets</a>(Clusterer, <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0aebc81705969b8c5ae986b0b2ec08d1d5">normal</a>, Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>,
<a name="l01016"></a>01016                        Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a>);
<a name="l01017"></a>01017 
<a name="l01018"></a>01018   <span class="comment">// create a prototype based on the statistics and test it</span>
<a name="l01019"></a>01019   <span class="keywordflow">switch</span> (Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a53c426e655c701e99f7744a35ecced70">ProtoStyle</a>) {
<a name="l01020"></a>01020     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa93d6901f160899d15f69322530595f4f">spherical</a>:
<a name="l01021"></a>01021       Proto = <a class="code" href="cluster_8cpp.html#ad04d25bb39e413b1cd7064534b98f9a4">MakeSphericalProto</a>(Clusterer, Cluster, Statistics, Buckets);
<a name="l01022"></a>01022       <span class="keywordflow">break</span>;
<a name="l01023"></a>01023     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa39d32ff639641ca169c9729c58614459">elliptical</a>:
<a name="l01024"></a>01024       Proto = <a class="code" href="cluster_8cpp.html#a076b9ff3e723f44987211c9bf5f77523">MakeEllipticalProto</a>(Clusterer, Cluster, Statistics, Buckets);
<a name="l01025"></a>01025       <span class="keywordflow">break</span>;
<a name="l01026"></a>01026     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaab164032fff82a847826b4887d9e7be58">mixed</a>:
<a name="l01027"></a>01027       Proto = <a class="code" href="cluster_8cpp.html#a2ebb51aa33fe2a99f5326366ed86b42e">MakeMixedProto</a>(Clusterer, Cluster, Statistics, Buckets,
<a name="l01028"></a>01028                              Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a>);
<a name="l01029"></a>01029       <span class="keywordflow">break</span>;
<a name="l01030"></a>01030     <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa9761086e420b925e438327ad385b304d">automatic</a>:
<a name="l01031"></a>01031       Proto = <a class="code" href="cluster_8cpp.html#ad04d25bb39e413b1cd7064534b98f9a4">MakeSphericalProto</a>(Clusterer, Cluster, Statistics, Buckets);
<a name="l01032"></a>01032       <span class="keywordflow">if</span> (Proto != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01033"></a>01033         <span class="keywordflow">break</span>;
<a name="l01034"></a>01034       Proto = <a class="code" href="cluster_8cpp.html#a076b9ff3e723f44987211c9bf5f77523">MakeEllipticalProto</a>(Clusterer, Cluster, Statistics, Buckets);
<a name="l01035"></a>01035       <span class="keywordflow">if</span> (Proto != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01036"></a>01036         <span class="keywordflow">break</span>;
<a name="l01037"></a>01037       Proto = <a class="code" href="cluster_8cpp.html#a2ebb51aa33fe2a99f5326366ed86b42e">MakeMixedProto</a>(Clusterer, Cluster, Statistics, Buckets,
<a name="l01038"></a>01038                              Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a>);
<a name="l01039"></a>01039       <span class="keywordflow">break</span>;
<a name="l01040"></a>01040   }
<a name="l01041"></a>01041   <a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">FreeStatistics</a>(Statistics);
<a name="l01042"></a>01042   <span class="keywordflow">return</span> Proto;
<a name="l01043"></a>01043 }                                <span class="comment">// MakePrototype</span>
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 
<a name="l01067"></a><a class="code" href="cluster_8cpp.html#abd55a5befb4eda77f5d0abbd460cc501">01067</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#abd55a5befb4eda77f5d0abbd460cc501">MakeDegenerateProto</a>(  <span class="comment">//this was MinSample</span>
<a name="l01068"></a>01068                                <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> N,
<a name="l01069"></a>01069                                <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01070"></a>01070                                <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l01071"></a>01071                                <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9ea">PROTOSTYLE</a> Style,
<a name="l01072"></a>01072                                <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> MinSamples) {
<a name="l01073"></a>01073   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075   <span class="keywordflow">if</span> (MinSamples &lt; <a class="code" href="cluster_8cpp.html#a6b4ec5de41f65e6f0f69b57db368bd54">MINSAMPLESNEEDED</a>)
<a name="l01076"></a>01076     MinSamples = <a class="code" href="cluster_8cpp.html#a6b4ec5de41f65e6f0f69b57db368bd54">MINSAMPLESNEEDED</a>;
<a name="l01077"></a>01077 
<a name="l01078"></a>01078   <span class="keywordflow">if</span> (Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a> &lt; MinSamples) {
<a name="l01079"></a>01079     <span class="keywordflow">switch</span> (Style) {
<a name="l01080"></a>01080       <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa93d6901f160899d15f69322530595f4f">spherical</a>:
<a name="l01081"></a>01081         Proto = <a class="code" href="cluster_8cpp.html#a96019ee068587b2d17ddb6f43ded872b">NewSphericalProto</a> (N, Cluster, Statistics);
<a name="l01082"></a>01082         <span class="keywordflow">break</span>;
<a name="l01083"></a>01083       <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa39d32ff639641ca169c9729c58614459">elliptical</a>:
<a name="l01084"></a>01084       <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa9761086e420b925e438327ad385b304d">automatic</a>:
<a name="l01085"></a>01085         Proto = <a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">NewEllipticalProto</a> (N, Cluster, Statistics);
<a name="l01086"></a>01086         <span class="keywordflow">break</span>;
<a name="l01087"></a>01087       <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaab164032fff82a847826b4887d9e7be58">mixed</a>:
<a name="l01088"></a>01088         Proto = <a class="code" href="cluster_8cpp.html#accc05d5eedc4d765148eaa99c1927a79">NewMixedProto</a> (N, Cluster, Statistics);
<a name="l01089"></a>01089         <span class="keywordflow">break</span>;
<a name="l01090"></a>01090     }
<a name="l01091"></a>01091     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01092"></a>01092   }
<a name="l01093"></a>01093   <span class="keywordflow">return</span> (Proto);
<a name="l01094"></a>01094 }                                <span class="comment">// MakeDegenerateProto</span>
<a name="l01095"></a>01095 
<a name="l01109"></a><a class="code" href="cluster_8cpp.html#a52963d24aa278bff9a1de24806954d61">01109</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a52963d24aa278bff9a1de24806954d61">TestEllipticalProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l01110"></a>01110                                <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *<a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>,
<a name="l01111"></a>01111                                <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01112"></a>01112                                <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics) {
<a name="l01113"></a>01113   <span class="comment">// Fraction of the number of samples used as a range around 1 within</span>
<a name="l01114"></a>01114   <span class="comment">// which a cluster has the magic size that allows a boost to the</span>
<a name="l01115"></a>01115   <span class="comment">// FTable by kFTableBoostMargin, thus allowing clusters near the</span>
<a name="l01116"></a>01116   <span class="comment">// magic size (equal to the number of sample characters) to be more</span>
<a name="l01117"></a>01117   <span class="comment">// likely to stay together.</span>
<a name="l01118"></a>01118   <span class="keyword">const</span> <span class="keywordtype">double</span> kMagicSampleMargin = 0.0625;
<a name="l01119"></a>01119   <span class="keyword">const</span> <span class="keywordtype">double</span> kFTableBoostMargin = 2.0;
<a name="l01120"></a>01120 
<a name="l01121"></a>01121   <span class="keywordtype">int</span> N = Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>;
<a name="l01122"></a>01122   <a class="code" href="structsample.html">CLUSTER</a>* Left = Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>;
<a name="l01123"></a>01123   <a class="code" href="structsample.html">CLUSTER</a>* Right = Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>;
<a name="l01124"></a>01124   <span class="keywordflow">if</span> (Left == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || Right == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01125"></a>01125     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01126"></a>01126   <span class="keywordtype">int</span> TotalDims = Left-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a> + Right-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>;
<a name="l01127"></a>01127   <span class="keywordflow">if</span> (TotalDims &lt; N + 1 || TotalDims &lt; 2)
<a name="l01128"></a>01128     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01129"></a>01129   <span class="keyword">const</span> <span class="keywordtype">int</span> kMatrixSize = N * N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>);
<a name="l01130"></a>01130   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>* Covariance = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *<span class="keyword">&gt;</span>(<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(kMatrixSize));
<a name="l01131"></a>01131   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>* Inverse = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *<span class="keyword">&gt;</span>(<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(kMatrixSize));
<a name="l01132"></a>01132   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>* Delta = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>*<span class="keyword">&gt;</span>(<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>)));
<a name="l01133"></a>01133   <span class="comment">// Compute a new covariance matrix that only uses essential features.</span>
<a name="l01134"></a>01134   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N; ++i) {
<a name="l01135"></a>01135     <span class="keywordtype">int</span> row_offset = i * N;
<a name="l01136"></a>01136     <span class="keywordflow">if</span> (!Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>) {
<a name="l01137"></a>01137       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; N; ++j) {
<a name="l01138"></a>01138         <span class="keywordflow">if</span> (!Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[j].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>)
<a name="l01139"></a>01139           Covariance[j + row_offset] = Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>[j + row_offset];
<a name="l01140"></a>01140         <span class="keywordflow">else</span>
<a name="l01141"></a>01141           Covariance[j + row_offset] = 0.0f;
<a name="l01142"></a>01142       }
<a name="l01143"></a>01143     } <span class="keywordflow">else</span> {
<a name="l01144"></a>01144       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; N; ++j) {
<a name="l01145"></a>01145         <span class="keywordflow">if</span> (i == j)
<a name="l01146"></a>01146           Covariance[j + row_offset] = 1.0f;
<a name="l01147"></a>01147         <span class="keywordflow">else</span>
<a name="l01148"></a>01148           Covariance[j + row_offset] = 0.0f;
<a name="l01149"></a>01149       }
<a name="l01150"></a>01150     }
<a name="l01151"></a>01151   }
<a name="l01152"></a>01152   <span class="keywordtype">double</span> err = <a class="code" href="cluster_8cpp.html#a40c47f6785ad5d50a9b113761e16ab9d">InvertMatrix</a>(Covariance, N, Inverse);
<a name="l01153"></a>01153   <span class="keywordflow">if</span> (err &gt; 1) {
<a name="l01154"></a>01154     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Clustering error: Matrix inverse failed with error %g\n&quot;</span>, err);
<a name="l01155"></a>01155   }
<a name="l01156"></a>01156   <span class="keywordtype">int</span> EssentialN = 0;
<a name="l01157"></a>01157   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dim = 0; dim &lt; N; ++dim) {
<a name="l01158"></a>01158     <span class="keywordflow">if</span> (!Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[dim].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>) {
<a name="l01159"></a>01159       Delta[dim] = Left-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[dim] - Right-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[dim];
<a name="l01160"></a>01160       ++EssentialN;
<a name="l01161"></a>01161     } <span class="keywordflow">else</span> {
<a name="l01162"></a>01162       Delta[dim] = 0.0f;
<a name="l01163"></a>01163     }
<a name="l01164"></a>01164   }
<a name="l01165"></a>01165   <span class="comment">// Compute Hotelling&#39;s T-squared.</span>
<a name="l01166"></a>01166   <span class="keywordtype">double</span> Tsq = 0.0;
<a name="l01167"></a>01167   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; N; ++x) {
<a name="l01168"></a>01168     <span class="keywordtype">double</span> temp = 0.0;
<a name="l01169"></a>01169     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; N; ++y) {
<a name="l01170"></a>01170       temp += Inverse[y + N*x] * Delta[y];
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172     Tsq += Delta[x] * temp;
<a name="l01173"></a>01173   }
<a name="l01174"></a>01174   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Covariance);
<a name="l01175"></a>01175   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Inverse);
<a name="l01176"></a>01176   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Delta);
<a name="l01177"></a>01177   <span class="comment">// Changed this function to match the formula in</span>
<a name="l01178"></a>01178   <span class="comment">// Statistical Methods in Medical Research p 473</span>
<a name="l01179"></a>01179   <span class="comment">// By Peter Armitage, Geoffrey Berry, J. N. S. Matthews.</span>
<a name="l01180"></a>01180   <span class="comment">// Tsq *= Left-&gt;SampleCount * Right-&gt;SampleCount / TotalDims;</span>
<a name="l01181"></a>01181   <span class="keywordtype">double</span> F = Tsq * (TotalDims - EssentialN - 1) / ((TotalDims - 2)*EssentialN);
<a name="l01182"></a>01182   <span class="keywordtype">int</span> Fx = EssentialN;
<a name="l01183"></a>01183   <span class="keywordflow">if</span> (Fx &gt; <a class="code" href="cluster_8cpp.html#a1f0a56d752a245eeeabb4514e8b22cf8">FTABLE_X</a>)
<a name="l01184"></a>01184     Fx = <a class="code" href="cluster_8cpp.html#a1f0a56d752a245eeeabb4514e8b22cf8">FTABLE_X</a>;
<a name="l01185"></a>01185   --Fx;
<a name="l01186"></a>01186   <span class="keywordtype">int</span> Fy = TotalDims - EssentialN - 1;
<a name="l01187"></a>01187   <span class="keywordflow">if</span> (Fy &gt; <a class="code" href="cluster_8cpp.html#acd517e6d49c3394f0b9fe04fdb970699">FTABLE_Y</a>)
<a name="l01188"></a>01188     Fy = <a class="code" href="cluster_8cpp.html#acd517e6d49c3394f0b9fe04fdb970699">FTABLE_Y</a>;
<a name="l01189"></a>01189   --Fy;
<a name="l01190"></a>01190   <span class="keywordtype">double</span> FTarget = <a class="code" href="cluster_8cpp.html#a1e2410dc2e3eb34ef861fbfeb2f05f4d">FTable</a>[Fy][Fx];
<a name="l01191"></a>01191   <span class="keywordflow">if</span> (Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a3578d77905f03b8d4321568be8f030c2">MagicSamples</a> &gt; 0 &amp;&amp;
<a name="l01192"></a>01192       TotalDims &gt;= Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a3578d77905f03b8d4321568be8f030c2">MagicSamples</a> * (1.0 - kMagicSampleMargin) &amp;&amp;
<a name="l01193"></a>01193       TotalDims &lt;= Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a3578d77905f03b8d4321568be8f030c2">MagicSamples</a> * (1.0 + kMagicSampleMargin)) {
<a name="l01194"></a>01194     <span class="comment">// Give magic-sized clusters a magic FTable boost.</span>
<a name="l01195"></a>01195     FTarget += kFTableBoostMargin;
<a name="l01196"></a>01196   }
<a name="l01197"></a>01197   <span class="keywordflow">if</span> (F &lt; FTarget) {
<a name="l01198"></a>01198     <span class="keywordflow">return</span> <a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">NewEllipticalProto</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Cluster, Statistics);
<a name="l01199"></a>01199   }
<a name="l01200"></a>01200   <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01201"></a>01201 }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203 <span class="comment">/* MakeSphericalProto *******************************************************</span>
<a name="l01204"></a>01204 <span class="comment">Parameters:     Clusterer       data struct containing samples being clustered</span>
<a name="l01205"></a>01205 <span class="comment">      Cluster           cluster to be made into a spherical prototype</span>
<a name="l01206"></a>01206 <span class="comment">      Statistics        statistical info about cluster</span>
<a name="l01207"></a>01207 <span class="comment">      Buckets           histogram struct used to analyze distribution</span>
<a name="l01208"></a>01208 <span class="comment">Operation:      This routine tests the specified cluster to see if it can</span>
<a name="l01209"></a>01209 <span class="comment">      be approximated by a spherical normal distribution.  If it</span>
<a name="l01210"></a>01210 <span class="comment">      can be, then a new prototype is formed and returned to the</span>
<a name="l01211"></a>01211 <span class="comment">      caller.  If it can&#39;t be, then NULL is returned to the caller.</span>
<a name="l01212"></a>01212 <span class="comment">Return:         Pointer to new spherical prototype or NULL.</span>
<a name="l01213"></a>01213 <span class="comment">Exceptions:     None</span>
<a name="l01214"></a>01214 <span class="comment">History:        6/1/89, DSJ, Created.</span>
<a name="l01215"></a>01215 <span class="comment">******************************************************************************/</span>
<a name="l01216"></a><a class="code" href="cluster_8cpp.html#ad04d25bb39e413b1cd7064534b98f9a4">01216</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#ad04d25bb39e413b1cd7064534b98f9a4">MakeSphericalProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l01217"></a>01217                               <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01218"></a>01218                               <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l01219"></a>01219                               <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets) {
<a name="l01220"></a>01220   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01221"></a>01221   <span class="keywordtype">int</span> i;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223   <span class="comment">// check that each dimension is a normal distribution</span>
<a name="l01224"></a>01224   <span class="keywordflow">for</span> (i = 0; i &lt; Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>; i++) {
<a name="l01225"></a>01225     <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>)
<a name="l01226"></a>01226       <span class="keywordflow">continue</span>;
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a> (Buckets, Cluster, i, &amp;(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i]),
<a name="l01229"></a>01229       Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i],
<a name="l01230"></a>01230       sqrt ((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) (Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a>)));
<a name="l01231"></a>01231     <span class="keywordflow">if</span> (!<a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a> (Buckets))
<a name="l01232"></a>01232       <span class="keywordflow">break</span>;
<a name="l01233"></a>01233   }
<a name="l01234"></a>01234   <span class="comment">// if all dimensions matched a normal distribution, make a proto</span>
<a name="l01235"></a>01235   <span class="keywordflow">if</span> (i &gt;= Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>)
<a name="l01236"></a>01236     Proto = <a class="code" href="cluster_8cpp.html#a96019ee068587b2d17ddb6f43ded872b">NewSphericalProto</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Cluster, Statistics);
<a name="l01237"></a>01237   <span class="keywordflow">return</span> (Proto);
<a name="l01238"></a>01238 }                                <span class="comment">// MakeSphericalProto</span>
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 
<a name="l01254"></a><a class="code" href="cluster_8cpp.html#a076b9ff3e723f44987211c9bf5f77523">01254</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a076b9ff3e723f44987211c9bf5f77523">MakeEllipticalProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l01255"></a>01255                                <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01256"></a>01256                                <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l01257"></a>01257                                <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets) {
<a name="l01258"></a>01258   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01259"></a>01259   <span class="keywordtype">int</span> i;
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   <span class="comment">// check that each dimension is a normal distribution</span>
<a name="l01262"></a>01262   <span class="keywordflow">for</span> (i = 0; i &lt; Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>; i++) {
<a name="l01263"></a>01263     <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>)
<a name="l01264"></a>01264       <span class="keywordflow">continue</span>;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a> (Buckets, Cluster, i, &amp;(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i]),
<a name="l01267"></a>01267       Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i],
<a name="l01268"></a>01268       sqrt ((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) Statistics-&gt;
<a name="l01269"></a>01269       CoVariance[i * (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a> + 1)]));
<a name="l01270"></a>01270     <span class="keywordflow">if</span> (!<a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a> (Buckets))
<a name="l01271"></a>01271       <span class="keywordflow">break</span>;
<a name="l01272"></a>01272   }
<a name="l01273"></a>01273   <span class="comment">// if all dimensions matched a normal distribution, make a proto</span>
<a name="l01274"></a>01274   <span class="keywordflow">if</span> (i &gt;= Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>)
<a name="l01275"></a>01275     Proto = <a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">NewEllipticalProto</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Cluster, Statistics);
<a name="l01276"></a>01276   <span class="keywordflow">return</span> (Proto);
<a name="l01277"></a>01277 }                                <span class="comment">// MakeEllipticalProto</span>
<a name="l01278"></a>01278 
<a name="l01279"></a>01279 
<a name="l01298"></a><a class="code" href="cluster_8cpp.html#a2ebb51aa33fe2a99f5326366ed86b42e">01298</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a2ebb51aa33fe2a99f5326366ed86b42e">MakeMixedProto</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer,
<a name="l01299"></a>01299                           <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01300"></a>01300                           <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics,
<a name="l01301"></a>01301                           <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *NormalBuckets,
<a name="l01302"></a>01302                           <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Confidence) {
<a name="l01303"></a>01303   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto;
<a name="l01304"></a>01304   <span class="keywordtype">int</span> i;
<a name="l01305"></a>01305   <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *UniformBuckets = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01306"></a>01306   <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *RandomBuckets = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01307"></a>01307 
<a name="l01308"></a>01308   <span class="comment">// create a mixed proto to work on - initially assume all dimensions normal*/</span>
<a name="l01309"></a>01309   Proto = <a class="code" href="cluster_8cpp.html#accc05d5eedc4d765148eaa99c1927a79">NewMixedProto</a> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>, Cluster, Statistics);
<a name="l01310"></a>01310 
<a name="l01311"></a>01311   <span class="comment">// find the proper distribution for each dimension</span>
<a name="l01312"></a>01312   <span class="keywordflow">for</span> (i = 0; i &lt; Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>; i++) {
<a name="l01313"></a>01313     <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a6b9843466a3ddf33bfab18f85ca06501">NonEssential</a>)
<a name="l01314"></a>01314       <span class="keywordflow">continue</span>;
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a> (NormalBuckets, Cluster, i, &amp;(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i]),
<a name="l01317"></a>01317       Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i],
<a name="l01318"></a>01318       sqrt ((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i]));
<a name="l01319"></a>01319     <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a> (NormalBuckets))
<a name="l01320"></a>01320       <span class="keywordflow">continue</span>;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322     <span class="keywordflow">if</span> (RandomBuckets == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01323"></a>01323       RandomBuckets =
<a name="l01324"></a>01324         <a class="code" href="cluster_8cpp.html#a0924b73d8bc3cd1269aa64f5a41b633f">GetBuckets</a>(Clusterer, <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a21504929e31ddde091641bb817e32320">D_random</a>, Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>, Confidence);
<a name="l01325"></a>01325     <a class="code" href="cluster_8cpp.html#ae018c99abb6b7f691f2e4b711485b45b">MakeDimRandom</a> (i, Proto, &amp;(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i]));
<a name="l01326"></a>01326     <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a> (RandomBuckets, Cluster, i, &amp;(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i]),
<a name="l01327"></a>01327       Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i], Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i]);
<a name="l01328"></a>01328     <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a> (RandomBuckets))
<a name="l01329"></a>01329       <span class="keywordflow">continue</span>;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331     <span class="keywordflow">if</span> (UniformBuckets == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01332"></a>01332       UniformBuckets =
<a name="l01333"></a>01333         <a class="code" href="cluster_8cpp.html#a0924b73d8bc3cd1269aa64f5a41b633f">GetBuckets</a>(Clusterer, <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a56013d9ac59a24fb94d9acb932a04b2f">uniform</a>, Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>, Confidence);
<a name="l01334"></a>01334     <a class="code" href="cluster_8cpp.html#a12a01c4bc8f83968f4b64600bfff82de">MakeDimUniform</a>(i, Proto, Statistics);
<a name="l01335"></a>01335     <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a> (UniformBuckets, Cluster, i, &amp;(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>[i]),
<a name="l01336"></a>01336       Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i], Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i]);
<a name="l01337"></a>01337     <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a> (UniformBuckets))
<a name="l01338"></a>01338       <span class="keywordflow">continue</span>;
<a name="l01339"></a>01339     <span class="keywordflow">break</span>;
<a name="l01340"></a>01340   }
<a name="l01341"></a>01341   <span class="comment">// if any dimension failed to match a distribution, discard the proto</span>
<a name="l01342"></a>01342   <span class="keywordflow">if</span> (i &lt; Clusterer-&gt;SampleSize) {
<a name="l01343"></a>01343     <a class="code" href="cluster_8cpp.html#aa5d7083be183c7a4e2b2fa746a560a7b">FreePrototype</a>(Proto);
<a name="l01344"></a>01344     Proto = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01345"></a>01345   }
<a name="l01346"></a>01346   <span class="keywordflow">return</span> (Proto);
<a name="l01347"></a>01347 }                                <span class="comment">// MakeMixedProto</span>
<a name="l01348"></a>01348 
<a name="l01349"></a>01349 
<a name="l01350"></a>01350 <span class="comment">/* MakeDimRandom *************************************************************</span>
<a name="l01351"></a>01351 <span class="comment">Parameters:     i               index of dimension to be changed</span>
<a name="l01352"></a>01352 <span class="comment">      Proto             prototype whose dimension is to be altered</span>
<a name="l01353"></a>01353 <span class="comment">      ParamDesc description of specified dimension</span>
<a name="l01354"></a>01354 <span class="comment">Operation:      This routine alters the ith dimension of the specified</span>
<a name="l01355"></a>01355 <span class="comment">      mixed prototype to be D_random.</span>
<a name="l01356"></a>01356 <span class="comment">Return:         None</span>
<a name="l01357"></a>01357 <span class="comment">Exceptions:     None</span>
<a name="l01358"></a>01358 <span class="comment">History:        6/20/89, DSJ, Created.</span>
<a name="l01359"></a>01359 <span class="comment">******************************************************************************/</span>
<a name="l01360"></a><a class="code" href="cluster_8cpp.html#ae018c99abb6b7f691f2e4b711485b45b">01360</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#ae018c99abb6b7f691f2e4b711485b45b">MakeDimRandom</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> i, <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto, <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc) {
<a name="l01361"></a>01361   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a>[i] = <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a21504929e31ddde091641bb817e32320">D_random</a>;
<a name="l01362"></a>01362   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i] = ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a7c7bec15766be3633c649a0a9409b512">MidRange</a>;
<a name="l01363"></a>01363   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a1df92d879d7ec8ea6662e956d27154b5">HalfRange</a>;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365   <span class="comment">// subtract out the previous magnitude of this dimension from the total</span>
<a name="l01366"></a>01366   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> /= Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l01367"></a>01367   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = 1.0 / ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l01368"></a>01368   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> *= Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l01369"></a>01369   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aefd3ba15fc4dd0029aa9cda07092382b">LogMagnitude</a> = log ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a>);
<a name="l01370"></a>01370 
<a name="l01371"></a>01371   <span class="comment">// note that the proto Weight is irrelevant for D_random protos</span>
<a name="l01372"></a>01372 }                                <span class="comment">// MakeDimRandom</span>
<a name="l01373"></a>01373 
<a name="l01374"></a>01374 
<a name="l01385"></a><a class="code" href="cluster_8cpp.html#a12a01c4bc8f83968f4b64600bfff82de">01385</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a12a01c4bc8f83968f4b64600bfff82de">MakeDimUniform</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> i, <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto, <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics) {
<a name="l01386"></a>01386   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a>[i] = <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a56013d9ac59a24fb94d9acb932a04b2f">uniform</a>;
<a name="l01387"></a>01387   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i] = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aff59384612de343b799b92a5d80282b7">Cluster</a>-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i] +
<a name="l01388"></a>01388     (Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>[i] + Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>[i]) / 2;
<a name="l01389"></a>01389   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] =
<a name="l01390"></a>01390     (Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>[i] - Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>[i]) / 2;
<a name="l01391"></a>01391   <span class="keywordflow">if</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] &lt; <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>)
<a name="l01392"></a>01392     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>;
<a name="l01393"></a>01393 
<a name="l01394"></a>01394   <span class="comment">// subtract out the previous magnitude of this dimension from the total</span>
<a name="l01395"></a>01395   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> /= Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l01396"></a>01396   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] =
<a name="l01397"></a>01397     1.0 / (2.0 * Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i]);
<a name="l01398"></a>01398   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> *= Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l01399"></a>01399   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aefd3ba15fc4dd0029aa9cda07092382b">LogMagnitude</a> = log ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a>);
<a name="l01400"></a>01400 
<a name="l01401"></a>01401   <span class="comment">// note that the proto Weight is irrelevant for uniform protos</span>
<a name="l01402"></a>01402 }                                <span class="comment">// MakeDimUniform</span>
<a name="l01403"></a>01403 
<a name="l01404"></a>01404 
<a name="l01421"></a>01421 <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *
<a name="l01422"></a><a class="code" href="cluster_8cpp.html#aa60411f531ca1f230d001973299d1c09">01422</a> <a class="code" href="cluster_8cpp.html#aa60411f531ca1f230d001973299d1c09">ComputeStatistics</a> (<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[], <a class="code" href="structsample.html">CLUSTER</a> * Cluster) {
<a name="l01423"></a>01423   <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics;
<a name="l01424"></a>01424   <span class="keywordtype">int</span> i, j;
<a name="l01425"></a>01425   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *CoVariance;
<a name="l01426"></a>01426   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *Distance;
<a name="l01427"></a>01427   <a class="code" href="structlist__rec.html">LIST</a> SearchState;
<a name="l01428"></a>01428   <a class="code" href="structsample.html">SAMPLE</a> *Sample;
<a name="l01429"></a>01429   <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCountAdjustedForBias;
<a name="l01430"></a>01430 
<a name="l01431"></a>01431   <span class="comment">// allocate memory to hold the statistics results</span>
<a name="l01432"></a>01432   Statistics = (<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a>));
<a name="l01433"></a>01433   Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01434"></a>01434   Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01435"></a>01435   Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01436"></a>01436 
<a name="l01437"></a>01437   <span class="comment">// allocate temporary memory to hold the sample to mean distances</span>
<a name="l01438"></a>01438   Distance = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01439"></a>01439 
<a name="l01440"></a>01440   <span class="comment">// initialize the statistics</span>
<a name="l01441"></a>01441   Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a> = 1.0;
<a name="l01442"></a>01442   CoVariance = Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>;
<a name="l01443"></a>01443   <span class="keywordflow">for</span> (i = 0; i &lt; N; i++) {
<a name="l01444"></a>01444     Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>[i] = 0.0;
<a name="l01445"></a>01445     Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>[i] = 0.0;
<a name="l01446"></a>01446     <span class="keywordflow">for</span> (j = 0; j &lt; N; j++, CoVariance++)
<a name="l01447"></a>01447       *CoVariance = 0;
<a name="l01448"></a>01448   }
<a name="l01449"></a>01449   <span class="comment">// find each sample in the cluster and merge it into the statistics</span>
<a name="l01450"></a>01450   <a class="code" href="cluster_8h.html#af125589eadf8dca87cf904ebcb77c896">InitSampleSearch</a>(SearchState, Cluster);
<a name="l01451"></a>01451   <span class="keywordflow">while</span> ((Sample = <a class="code" href="cluster_8cpp.html#abf5d9e3b151ac51b27bd9dc797ac261c">NextSample</a> (&amp;SearchState)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01452"></a>01452     <span class="keywordflow">for</span> (i = 0; i &lt; N; i++) {
<a name="l01453"></a>01453       Distance[i] = Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i] - Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i];
<a name="l01454"></a>01454       <span class="keywordflow">if</span> (ParamDesc[i].Circular) {
<a name="l01455"></a>01455         <span class="keywordflow">if</span> (Distance[i] &gt; ParamDesc[i].HalfRange)
<a name="l01456"></a>01456           Distance[i] -= ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l01457"></a>01457         <span class="keywordflow">if</span> (Distance[i] &lt; -ParamDesc[i].HalfRange)
<a name="l01458"></a>01458           Distance[i] += ParamDesc[i].<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l01459"></a>01459       }
<a name="l01460"></a>01460       <span class="keywordflow">if</span> (Distance[i] &lt; Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>[i])
<a name="l01461"></a>01461         Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>[i] = Distance[i];
<a name="l01462"></a>01462       <span class="keywordflow">if</span> (Distance[i] &gt; Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>[i])
<a name="l01463"></a>01463         Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>[i] = Distance[i];
<a name="l01464"></a>01464     }
<a name="l01465"></a>01465     CoVariance = Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>;
<a name="l01466"></a>01466     <span class="keywordflow">for</span> (i = 0; i &lt; N; i++)
<a name="l01467"></a>01467       <span class="keywordflow">for</span> (j = 0; j &lt; N; j++, CoVariance++)
<a name="l01468"></a>01468         *CoVariance += Distance[i] * Distance[j];
<a name="l01469"></a>01469   }
<a name="l01470"></a>01470   <span class="comment">// normalize the variances by the total number of samples</span>
<a name="l01471"></a>01471   <span class="comment">// use SampleCount-1 instead of SampleCount to get an unbiased estimate</span>
<a name="l01472"></a>01472   <span class="comment">// also compute the geometic mean of the diagonal variances</span>
<a name="l01473"></a>01473   <span class="comment">// ensure that clusters with only 1 sample are handled correctly</span>
<a name="l01474"></a>01474   <span class="keywordflow">if</span> (Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a> &gt; 1)
<a name="l01475"></a>01475     SampleCountAdjustedForBias = Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a> - 1;
<a name="l01476"></a>01476   <span class="keywordflow">else</span>
<a name="l01477"></a>01477     SampleCountAdjustedForBias = 1;
<a name="l01478"></a>01478   CoVariance = Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>;
<a name="l01479"></a>01479   <span class="keywordflow">for</span> (i = 0; i &lt; N; i++)
<a name="l01480"></a>01480   <span class="keywordflow">for</span> (j = 0; j &lt; N; j++, CoVariance++) {
<a name="l01481"></a>01481     *CoVariance /= SampleCountAdjustedForBias;
<a name="l01482"></a>01482     <span class="keywordflow">if</span> (j == i) {
<a name="l01483"></a>01483       <span class="keywordflow">if</span> (*CoVariance &lt; <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>)
<a name="l01484"></a>01484         *CoVariance = <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>;
<a name="l01485"></a>01485       Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a> *= *CoVariance;
<a name="l01486"></a>01486     }
<a name="l01487"></a>01487   }
<a name="l01488"></a>01488   Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a> = (float)pow((<span class="keywordtype">double</span>)Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a>,
<a name="l01489"></a>01489                                        1.0 / N);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="comment">// release temporary memory and return</span>
<a name="l01492"></a>01492   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Distance);
<a name="l01493"></a>01493   <span class="keywordflow">return</span> (Statistics);
<a name="l01494"></a>01494 }                                <span class="comment">// ComputeStatistics</span>
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 
<a name="l01510"></a><a class="code" href="cluster_8cpp.html#a96019ee068587b2d17ddb6f43ded872b">01510</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a96019ee068587b2d17ddb6f43ded872b">NewSphericalProto</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> N,
<a name="l01511"></a>01511                              <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01512"></a>01512                              <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics) {
<a name="l01513"></a>01513   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto;
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   Proto = <a class="code" href="cluster_8cpp.html#adf2445f2aae1e1e03f06eefb85c95b8d">NewSimpleProto</a> (N, Cluster);
<a name="l01516"></a>01516 
<a name="l01517"></a>01517   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a> = Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#aec33c119c63aad5cd1c4e75c6afe2968">AvgVariance</a>;
<a name="l01518"></a>01518   <span class="keywordflow">if</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a> &lt; <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>)
<a name="l01519"></a>01519     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a> = <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a> =
<a name="l01522"></a>01522     1.0 / sqrt ((<span class="keywordtype">double</span>) (2.0 * <a class="code" href="const_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a> * Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a>));
<a name="l01523"></a>01523   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> = (float)pow((<span class="keywordtype">double</span>)Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a>,
<a name="l01524"></a>01524                                      (double) N);
<a name="l01525"></a>01525   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a> = 1.0 / Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#ad883f0258d034e4fd77ce450c3e058d2">Spherical</a>;
<a name="l01526"></a>01526   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aefd3ba15fc4dd0029aa9cda07092382b">LogMagnitude</a> = log ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a>);
<a name="l01527"></a>01527 
<a name="l01528"></a>01528   <span class="keywordflow">return</span> (Proto);
<a name="l01529"></a>01529 }                                <span class="comment">// NewSphericalProto</span>
<a name="l01530"></a>01530 
<a name="l01531"></a>01531 
<a name="l01544"></a><a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">01544</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">NewEllipticalProto</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N,
<a name="l01545"></a>01545                               <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l01546"></a>01546                               <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics) {
<a name="l01547"></a>01547   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto;
<a name="l01548"></a>01548   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *CoVariance;
<a name="l01549"></a>01549   <span class="keywordtype">int</span> i;
<a name="l01550"></a>01550 
<a name="l01551"></a>01551   Proto = <a class="code" href="cluster_8cpp.html#adf2445f2aae1e1e03f06eefb85c95b8d">NewSimpleProto</a> (N, Cluster);
<a name="l01552"></a>01552   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01553"></a>01553   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01554"></a>01554   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01555"></a>01555 
<a name="l01556"></a>01556   CoVariance = Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>;
<a name="l01557"></a>01557   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> = 1.0;
<a name="l01558"></a>01558   <span class="keywordflow">for</span> (i = 0; i &lt; N; i++, CoVariance += N + 1) {
<a name="l01559"></a>01559     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = *CoVariance;
<a name="l01560"></a>01560     <span class="keywordflow">if</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] &lt; <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>)
<a name="l01561"></a>01561       Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = <a class="code" href="cluster_8cpp.html#ab070d4fc08948b5047625cb799a9ac89">MINVARIANCE</a>;
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] =
<a name="l01564"></a>01564       1.0 / sqrt ((<span class="keywordtype">double</span>) (2.0 * <a class="code" href="const_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a> * Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i]));
<a name="l01565"></a>01565     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = 1.0 / Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l01566"></a>01566     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> *= Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l01567"></a>01567   }
<a name="l01568"></a>01568   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aefd3ba15fc4dd0029aa9cda07092382b">LogMagnitude</a> = log ((<span class="keywordtype">double</span>) Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a>);
<a name="l01569"></a>01569   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a> = <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa39d32ff639641ca169c9729c58614459">elliptical</a>;
<a name="l01570"></a>01570   <span class="keywordflow">return</span> (Proto);
<a name="l01571"></a>01571 }                                <span class="comment">// NewEllipticalProto</span>
<a name="l01572"></a>01572 
<a name="l01573"></a>01573 
<a name="l01589"></a><a class="code" href="cluster_8cpp.html#accc05d5eedc4d765148eaa99c1927a79">01589</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#accc05d5eedc4d765148eaa99c1927a79">NewMixedProto</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="structsample.html">CLUSTER</a> *Cluster, <a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics) {
<a name="l01590"></a>01590   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto;
<a name="l01591"></a>01591   <span class="keywordtype">int</span> i;
<a name="l01592"></a>01592 
<a name="l01593"></a>01593   Proto = <a class="code" href="cluster_8cpp.html#a1453a157e92261f5331f8624dfc4d3c0">NewEllipticalProto</a> (N, Cluster, Statistics);
<a name="l01594"></a>01594   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a> = (<a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a>));
<a name="l01595"></a>01595 
<a name="l01596"></a>01596   <span class="keywordflow">for</span> (i = 0; i &lt; N; i++) {
<a name="l01597"></a>01597     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a>[i] = <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0aebc81705969b8c5ae986b0b2ec08d1d5">normal</a>;
<a name="l01598"></a>01598   }
<a name="l01599"></a>01599   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a> = <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaab164032fff82a847826b4887d9e7be58">mixed</a>;
<a name="l01600"></a>01600   <span class="keywordflow">return</span> (Proto);
<a name="l01601"></a>01601 }                                <span class="comment">// NewMixedProto</span>
<a name="l01602"></a>01602 
<a name="l01603"></a>01603 
<a name="l01614"></a><a class="code" href="cluster_8cpp.html#adf2445f2aae1e1e03f06eefb85c95b8d">01614</a> <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *<a class="code" href="cluster_8cpp.html#adf2445f2aae1e1e03f06eefb85c95b8d">NewSimpleProto</a>(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="structsample.html">CLUSTER</a> *Cluster) {
<a name="l01615"></a>01615   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *Proto;
<a name="l01616"></a>01616   <span class="keywordtype">int</span> i;
<a name="l01617"></a>01617 
<a name="l01618"></a>01618   Proto = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>));
<a name="l01619"></a>01619   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (N * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l01620"></a>01620 
<a name="l01621"></a>01621   <span class="keywordflow">for</span> (i = 0; i &lt; N; i++)
<a name="l01622"></a>01622     Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i] = Cluster-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[i];
<a name="l01623"></a>01623   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01624"></a>01624 
<a name="l01625"></a>01625   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01626"></a>01626   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a8e04c7f378d30c248bc6e55703ac69a6">Merged</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01627"></a>01627   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a> = <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa93d6901f160899d15f69322530595f4f">spherical</a>;
<a name="l01628"></a>01628   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a> = Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>;
<a name="l01629"></a>01629   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aff59384612de343b799b92a5d80282b7">Cluster</a> = Cluster;
<a name="l01630"></a>01630   Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aff59384612de343b799b92a5d80282b7">Cluster</a>-&gt;<a class="code" href="structsample.html#af0c82e552c662971cf574f9ee8bcb40f">Prototype</a> = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01631"></a>01631   return (Proto);
<a name="l01632"></a>01632 }                                <span class="comment">// NewSimpleProto</span>
<a name="l01633"></a>01633 
<a name="l01634"></a>01634 
<a name="l01655"></a>01655 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a>
<a name="l01656"></a><a class="code" href="cluster_8cpp.html#a0a6fea38a06375666937701fb21e6a05">01656</a> <a class="code" href="cluster_8cpp.html#a0a6fea38a06375666937701fb21e6a05">Independent</a> (<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> ParamDesc[],
<a name="l01657"></a>01657 <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> N, <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> * CoVariance, <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Independence) {
<a name="l01658"></a>01658   <span class="keywordtype">int</span> i, j;
<a name="l01659"></a>01659   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *VARii;                <span class="comment">// points to ith on-diagonal element</span>
<a name="l01660"></a>01660   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *VARjj;                <span class="comment">// points to jth on-diagonal element</span>
<a name="l01661"></a>01661   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> CorrelationCoeff;
<a name="l01662"></a>01662 
<a name="l01663"></a>01663   VARii = CoVariance;
<a name="l01664"></a>01664   <span class="keywordflow">for</span> (i = 0; i &lt; N; i++, VARii += N + 1) {
<a name="l01665"></a>01665     <span class="keywordflow">if</span> (ParamDesc[i].NonEssential)
<a name="l01666"></a>01666       <span class="keywordflow">continue</span>;
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     VARjj = VARii + N + 1;
<a name="l01669"></a>01669     CoVariance = VARii + 1;
<a name="l01670"></a>01670     <span class="keywordflow">for</span> (j = i + 1; j &lt; N; j++, CoVariance++, VARjj += N + 1) {
<a name="l01671"></a>01671       <span class="keywordflow">if</span> (ParamDesc[j].NonEssential)
<a name="l01672"></a>01672         <span class="keywordflow">continue</span>;
<a name="l01673"></a>01673 
<a name="l01674"></a>01674       <span class="keywordflow">if</span> ((*VARii == 0.0) || (*VARjj == 0.0))
<a name="l01675"></a>01675         CorrelationCoeff = 0.0;
<a name="l01676"></a>01676       <span class="keywordflow">else</span>
<a name="l01677"></a>01677         CorrelationCoeff =
<a name="l01678"></a>01678           sqrt (sqrt (*CoVariance * *CoVariance / (*VARii * *VARjj)));
<a name="l01679"></a>01679       <span class="keywordflow">if</span> (CorrelationCoeff &gt; Independence)
<a name="l01680"></a>01680         <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01681"></a>01681     }
<a name="l01682"></a>01682   }
<a name="l01683"></a>01683   <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01684"></a>01684 }                                <span class="comment">// Independent</span>
<a name="l01685"></a>01685 
<a name="l01686"></a>01686 
<a name="l01705"></a><a class="code" href="cluster_8cpp.html#a0924b73d8bc3cd1269aa64f5a41b633f">01705</a> <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *<a class="code" href="cluster_8cpp.html#a0924b73d8bc3cd1269aa64f5a41b633f">GetBuckets</a>(<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a>* clusterer,
<a name="l01706"></a>01706                     <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> Distribution,
<a name="l01707"></a>01707                     <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCount,
<a name="l01708"></a>01708                     <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Confidence) {
<a name="l01709"></a>01709   <span class="comment">// Get an old bucket structure with the same number of buckets.</span>
<a name="l01710"></a>01710   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> NumberOfBuckets = <a class="code" href="cluster_8cpp.html#ab182ad32f9100ae8e29e72db623c70dd">OptimumNumberOfBuckets</a>(SampleCount);
<a name="l01711"></a>01711   <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets =
<a name="l01712"></a>01712       clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a30ffab128a2b2f6f738b48697bebd5b6">bucket_cache</a>[Distribution][NumberOfBuckets - <a class="code" href="cluster_8h.html#a759b3b99f54d92a0c6c5471a4c87c42b">MINBUCKETS</a>];
<a name="l01713"></a>01713 
<a name="l01714"></a>01714   <span class="comment">// If a matching bucket structure is not found, make one and save it.</span>
<a name="l01715"></a>01715   <span class="keywordflow">if</span> (Buckets == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01716"></a>01716     Buckets = <a class="code" href="cluster_8cpp.html#a93a38445707d2a943e60fafebe0c2b4d">MakeBuckets</a>(Distribution, SampleCount, Confidence);
<a name="l01717"></a>01717     clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#a30ffab128a2b2f6f738b48697bebd5b6">bucket_cache</a>[Distribution][NumberOfBuckets - <a class="code" href="cluster_8h.html#a759b3b99f54d92a0c6c5471a4c87c42b">MINBUCKETS</a>] =
<a name="l01718"></a>01718         Buckets;
<a name="l01719"></a>01719   } <span class="keywordflow">else</span> {
<a name="l01720"></a>01720     <span class="comment">// Just adjust the existing buckets.</span>
<a name="l01721"></a>01721     <span class="keywordflow">if</span> (SampleCount != Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a8e352450eb27c8a017a037f71796b402">SampleCount</a>)
<a name="l01722"></a>01722       <a class="code" href="cluster_8cpp.html#a02e72bde5b9d967258769d4a75f07e46">AdjustBuckets</a>(Buckets, SampleCount);
<a name="l01723"></a>01723     <span class="keywordflow">if</span> (Confidence != Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aeef80a305501f83af63153e6b2e362a8">Confidence</a>) {
<a name="l01724"></a>01724       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aeef80a305501f83af63153e6b2e362a8">Confidence</a> = Confidence;
<a name="l01725"></a>01725       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4dedca1b6c939050313aa761b59a0a11">ChiSquared</a> = <a class="code" href="cluster_8cpp.html#a952909dfb237bce2b90d33204b3efe3e">ComputeChiSquared</a>(
<a name="l01726"></a>01726           <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>(Distribution, Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>),
<a name="l01727"></a>01727           Confidence);
<a name="l01728"></a>01728     }
<a name="l01729"></a>01729     <a class="code" href="cluster_8cpp.html#a0f9ec282a0fa768a4b5bd0d5efaca7d2">InitBuckets</a>(Buckets);
<a name="l01730"></a>01730   }
<a name="l01731"></a>01731   <span class="keywordflow">return</span> Buckets;
<a name="l01732"></a>01732 }                                <span class="comment">// GetBuckets</span>
<a name="l01733"></a>01733 
<a name="l01734"></a>01734 
<a name="l01755"></a><a class="code" href="cluster_8cpp.html#a93a38445707d2a943e60fafebe0c2b4d">01755</a> <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *<a class="code" href="cluster_8cpp.html#a93a38445707d2a943e60fafebe0c2b4d">MakeBuckets</a>(<a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> Distribution,
<a name="l01756"></a>01756                      <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCount,
<a name="l01757"></a>01757                      <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Confidence) {
<a name="l01758"></a>01758   <span class="keyword">const</span> <a class="code" href="cluster_8cpp.html#a32b61dc3b9e8987cc1a63db31c99c6e9">DENSITYFUNC</a> DensityFunction[] =
<a name="l01759"></a>01759     { <a class="code" href="cluster_8cpp.html#a46fa6d94ca57427d93d1f306c4bbcf46">NormalDensity</a>, <a class="code" href="cluster_8cpp.html#a5abc8ec5703c3d471dc0dd172cb22168">UniformDensity</a>, UniformDensity };
<a name="l01760"></a>01760   <span class="keywordtype">int</span> i, j;
<a name="l01761"></a>01761   <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets;
<a name="l01762"></a>01762   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> BucketProbability;
<a name="l01763"></a>01763   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> NextBucketBoundary;
<a name="l01764"></a>01764   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Probability;
<a name="l01765"></a>01765   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> ProbabilityDelta;
<a name="l01766"></a>01766   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> LastProbDensity;
<a name="l01767"></a>01767   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> ProbDensity;
<a name="l01768"></a>01768   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> CurrentBucket;
<a name="l01769"></a>01769   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> Symmetrical;
<a name="l01770"></a>01770 
<a name="l01771"></a>01771   <span class="comment">// allocate memory needed for data structure</span>
<a name="l01772"></a>01772   Buckets = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a>*<span class="keyword">&gt;</span>(<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a>)));
<a name="l01773"></a>01773   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a> = <a class="code" href="cluster_8cpp.html#ab182ad32f9100ae8e29e72db623c70dd">OptimumNumberOfBuckets</a>(SampleCount);
<a name="l01774"></a>01774   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a8e352450eb27c8a017a037f71796b402">SampleCount</a> = SampleCount;
<a name="l01775"></a>01775   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aeef80a305501f83af63153e6b2e362a8">Confidence</a> = Confidence;
<a name="l01776"></a>01776   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a>*<span class="keyword">&gt;</span>(
<a name="l01777"></a>01777       <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a> * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a>)));
<a name="l01778"></a>01778   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>*<span class="keyword">&gt;</span>(
<a name="l01779"></a>01779       <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a> * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>)));
<a name="l01780"></a>01780 
<a name="l01781"></a>01781   <span class="comment">// initialize simple fields</span>
<a name="l01782"></a>01782   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#ad2b1ef5944d42354519db2895a8ca062">Distribution</a> = Distribution;
<a name="l01783"></a>01783   <span class="keywordflow">for</span> (i = 0; i &lt; Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>; i++) {
<a name="l01784"></a>01784     Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>[i] = 0;
<a name="l01785"></a>01785     Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[i] = 0.0;
<a name="l01786"></a>01786   }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   <span class="comment">// all currently defined distributions are symmetrical</span>
<a name="l01789"></a>01789   Symmetrical = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01790"></a>01790   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4dedca1b6c939050313aa761b59a0a11">ChiSquared</a> = <a class="code" href="cluster_8cpp.html#a952909dfb237bce2b90d33204b3efe3e">ComputeChiSquared</a>(
<a name="l01791"></a>01791       <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>(Distribution, Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>), Confidence);
<a name="l01792"></a>01792 
<a name="l01793"></a>01793   <span class="keywordflow">if</span> (Symmetrical) {
<a name="l01794"></a>01794     <span class="comment">// allocate buckets so that all have approx. equal probability</span>
<a name="l01795"></a>01795     BucketProbability = 1.0 / (<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) (Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="comment">// distribution is symmetric so fill in upper half then copy</span>
<a name="l01798"></a>01798     CurrentBucket = Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a> / 2;
<a name="l01799"></a>01799     <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a0662f2b2f6ae8b7ed59d9da773c0da35">Odd</a> (Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>))
<a name="l01800"></a>01800       NextBucketBoundary = BucketProbability / 2;
<a name="l01801"></a>01801     <span class="keywordflow">else</span>
<a name="l01802"></a>01802       NextBucketBoundary = BucketProbability;
<a name="l01803"></a>01803 
<a name="l01804"></a>01804     Probability = 0.0;
<a name="l01805"></a>01805     LastProbDensity =
<a name="l01806"></a>01806       (*DensityFunction[(int) Distribution]) (BUCKETTABLESIZE / 2);
<a name="l01807"></a>01807     <span class="keywordflow">for</span> (i = BUCKETTABLESIZE / 2; i &lt; <a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a>; i++) {
<a name="l01808"></a>01808       ProbDensity = (*DensityFunction[(int) Distribution]) (i + 1);
<a name="l01809"></a>01809       ProbabilityDelta = <a class="code" href="cluster_8cpp.html#af0eb798915396ae610f1701708a7b816">Integral</a> (LastProbDensity, ProbDensity, 1.0);
<a name="l01810"></a>01810       Probability += ProbabilityDelta;
<a name="l01811"></a>01811       <span class="keywordflow">if</span> (Probability &gt; NextBucketBoundary) {
<a name="l01812"></a>01812         <span class="keywordflow">if</span> (CurrentBucket &lt; Buckets-&gt;NumberOfBuckets - 1)
<a name="l01813"></a>01813           CurrentBucket++;
<a name="l01814"></a>01814         NextBucketBoundary += BucketProbability;
<a name="l01815"></a>01815       }
<a name="l01816"></a>01816       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aaa108173d6611040d567271a1262b67e">Bucket</a>[i] = CurrentBucket;
<a name="l01817"></a>01817       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[CurrentBucket] +=
<a name="l01818"></a>01818         (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>) (ProbabilityDelta * SampleCount);
<a name="l01819"></a>01819       LastProbDensity = ProbDensity;
<a name="l01820"></a>01820     }
<a name="l01821"></a>01821     <span class="comment">// place any leftover probability into the last bucket</span>
<a name="l01822"></a>01822     Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[CurrentBucket] +=
<a name="l01823"></a>01823       (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>) ((0.5 - Probability) * SampleCount);
<a name="l01824"></a>01824 
<a name="l01825"></a>01825     <span class="comment">// copy upper half of distribution to lower half</span>
<a name="l01826"></a>01826     <span class="keywordflow">for</span> (i = 0, j = BUCKETTABLESIZE - 1; i &lt; j; i++, j--)
<a name="l01827"></a>01827       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aaa108173d6611040d567271a1262b67e">Bucket</a>[i] =
<a name="l01828"></a>01828         <a class="code" href="cluster_8cpp.html#a42e41a23d64c7e8a69fbfd802e72c239">Mirror</a>(Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aaa108173d6611040d567271a1262b67e">Bucket</a>[j], Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>);
<a name="l01829"></a>01829 
<a name="l01830"></a>01830     <span class="comment">// copy upper half of expected counts to lower half</span>
<a name="l01831"></a>01831     <span class="keywordflow">for</span> (i = 0, j = Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a> - 1; i &lt;= j; i++, j--)
<a name="l01832"></a>01832       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[i] += Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[j];
<a name="l01833"></a>01833   }
<a name="l01834"></a>01834   <span class="keywordflow">return</span> Buckets;
<a name="l01835"></a>01835 }                                <span class="comment">// MakeBuckets</span>
<a name="l01836"></a>01836 
<a name="l01837"></a>01837 
<a name="l01838"></a>01838 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l01839"></a><a class="code" href="cluster_8cpp.html#ab182ad32f9100ae8e29e72db623c70dd">01839</a> <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#ab182ad32f9100ae8e29e72db623c70dd">OptimumNumberOfBuckets</a>(<a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> SampleCount) {
<a name="l01840"></a>01840 <span class="comment">/*</span>
<a name="l01841"></a>01841 <span class="comment"> **     Parameters:</span>
<a name="l01842"></a>01842 <span class="comment"> **             SampleCount     number of samples to be tested</span>
<a name="l01843"></a>01843 <span class="comment">  **    Operation:</span>
<a name="l01844"></a>01844 <span class="comment"> **             This routine computes the optimum number of histogram</span>
<a name="l01845"></a>01845 <span class="comment"> **             buckets that should be used in a chi-squared goodness of</span>
<a name="l01846"></a>01846 <span class="comment"> **             fit test for the specified number of samples.  The optimum</span>
<a name="l01847"></a>01847 <span class="comment"> **             number is computed based on Table 4.1 on pg. 147 of</span>
<a name="l01848"></a>01848 <span class="comment"> **             &quot;Measurement and Analysis of Random Data&quot; by Bendat &amp; Piersol.</span>
<a name="l01849"></a>01849 <span class="comment"> **             Linear interpolation is used to interpolate between table</span>
<a name="l01850"></a>01850 <span class="comment"> **             values.  The table is intended for a 0.05 level of</span>
<a name="l01851"></a>01851 <span class="comment"> **             significance (alpha).  This routine assumes that it is</span>
<a name="l01852"></a>01852 <span class="comment"> **             equally valid for other alpha&#39;s, which may not be true.</span>
<a name="l01853"></a>01853 <span class="comment"> **     Return:</span>
<a name="l01854"></a>01854 <span class="comment"> **             Optimum number of histogram buckets</span>
<a name="l01855"></a>01855 <span class="comment"> **     Exceptions:</span>
<a name="l01856"></a>01856 <span class="comment"> **             None</span>
<a name="l01857"></a>01857 <span class="comment"> **     History:</span>
<a name="l01858"></a>01858 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l01859"></a>01859 <span class="comment"> */</span>
<a name="l01860"></a>01860   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a> Last, Next;
<a name="l01861"></a>01861   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Slope;
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   <span class="keywordflow">if</span> (SampleCount &lt; kCountTable[0])
<a name="l01864"></a>01864     <span class="keywordflow">return</span> kBucketsTable[0];
<a name="l01865"></a>01865 
<a name="l01866"></a>01866   <span class="keywordflow">for</span> (Last = 0, Next = 1; Next &lt; <a class="code" href="cluster_8cpp.html#a4342455851ae586637e6a0abaf3b3f14">LOOKUPTABLESIZE</a>; Last++, Next++) {
<a name="l01867"></a>01867     <span class="keywordflow">if</span> (SampleCount &lt;= kCountTable[Next]) {
<a name="l01868"></a>01868       Slope = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>) (kBucketsTable[Next] - kBucketsTable[Last]) /
<a name="l01869"></a>01869           (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>) (kCountTable[Next] - kCountTable[Last]);
<a name="l01870"></a>01870       <span class="keywordflow">return</span> ((<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a>) (kBucketsTable[Last] +
<a name="l01871"></a>01871           Slope * (SampleCount - kCountTable[Last])));
<a name="l01872"></a>01872     }
<a name="l01873"></a>01873   }
<a name="l01874"></a>01874   <span class="keywordflow">return</span> kBucketsTable[Last];
<a name="l01875"></a>01875 }                                <span class="comment">// OptimumNumberOfBuckets</span>
<a name="l01876"></a>01876 
<a name="l01877"></a>01877 
<a name="l01878"></a>01878 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l01879"></a>01879 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>
<a name="l01880"></a><a class="code" href="cluster_8cpp.html#a952909dfb237bce2b90d33204b3efe3e">01880</a> <a class="code" href="cluster_8cpp.html#a952909dfb237bce2b90d33204b3efe3e">ComputeChiSquared</a> (<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Alpha)
<a name="l01881"></a>01881 <span class="comment">/*</span>
<a name="l01882"></a>01882 <span class="comment"> **     Parameters:</span>
<a name="l01883"></a>01883 <span class="comment"> **             DegreesOfFreedom        determines shape of distribution</span>
<a name="l01884"></a>01884 <span class="comment"> **             Alpha                   probability of right tail</span>
<a name="l01885"></a>01885 <span class="comment"> **     Operation:</span>
<a name="l01886"></a>01886 <span class="comment"> **             This routine computes the chi-squared value which will</span>
<a name="l01887"></a>01887 <span class="comment"> **             leave a cumulative probability of Alpha in the right tail</span>
<a name="l01888"></a>01888 <span class="comment"> **             of a chi-squared distribution with the specified number of</span>
<a name="l01889"></a>01889 <span class="comment"> **             degrees of freedom.  Alpha must be between 0 and 1.</span>
<a name="l01890"></a>01890 <span class="comment"> **             DegreesOfFreedom must be even.  The routine maintains an</span>
<a name="l01891"></a>01891 <span class="comment"> **             array of lists.  Each list corresponds to a different</span>
<a name="l01892"></a>01892 <span class="comment"> **             number of degrees of freedom.  Each entry in the list</span>
<a name="l01893"></a>01893 <span class="comment"> **             corresponds to a different alpha value and its corresponding</span>
<a name="l01894"></a>01894 <span class="comment"> **             chi-squared value.  Therefore, once a particular chi-squared</span>
<a name="l01895"></a>01895 <span class="comment"> **             value is computed, it is stored in the list and never</span>
<a name="l01896"></a>01896 <span class="comment"> **             needs to be computed again.</span>
<a name="l01897"></a>01897 <span class="comment"> **     Return: Desired chi-squared value</span>
<a name="l01898"></a>01898 <span class="comment"> **     Exceptions: none</span>
<a name="l01899"></a>01899 <span class="comment"> **     History: 6/5/89, DSJ, Created.</span>
<a name="l01900"></a>01900 <span class="comment"> */</span>
<a name="l01901"></a>01901 <span class="preprocessor">#define CHIACCURACY     0.01</span>
<a name="l01902"></a>01902 <span class="preprocessor"></span><span class="preprocessor">#define MINALPHA  (1e-200)</span>
<a name="l01903"></a>01903 <span class="preprocessor"></span>{
<a name="l01904"></a>01904   <span class="keyword">static</span> <a class="code" href="structlist__rec.html">LIST</a> ChiWith[<a class="code" href="cluster_8cpp.html#a1d372c446071a329984f36c50a4e6a8f">MAXDEGREESOFFREEDOM</a> + 1];
<a name="l01905"></a>01905 
<a name="l01906"></a>01906   <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *OldChiSquared;
<a name="l01907"></a>01907   <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> SearchKey;
<a name="l01908"></a>01908 
<a name="l01909"></a>01909   <span class="comment">// limit the minimum alpha that can be used - if alpha is too small</span>
<a name="l01910"></a>01910   <span class="comment">//      it may not be possible to compute chi-squared.</span>
<a name="l01911"></a>01911   Alpha = <a class="code" href="helpers_8h.html#af8739168d5b3235996eeb25dac3c4044">ClipToRange</a>(Alpha, <a class="code" href="cluster_8cpp.html#a01e04cb3a03fa1080646bfbcc45728d2">MINALPHA</a>, 1.0);
<a name="l01912"></a>01912   <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a0662f2b2f6ae8b7ed59d9da773c0da35">Odd</a> (DegreesOfFreedom))
<a name="l01913"></a>01913     DegreesOfFreedom++;
<a name="l01914"></a>01914 
<a name="l01915"></a>01915   <span class="comment">/* find the list of chi-squared values which have already been computed</span>
<a name="l01916"></a>01916 <span class="comment">     for the specified number of degrees of freedom.  Search the list for</span>
<a name="l01917"></a>01917 <span class="comment">     the desired chi-squared. */</span>
<a name="l01918"></a>01918   SearchKey.<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">Alpha</a> = Alpha;
<a name="l01919"></a>01919   OldChiSquared = (<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (<a class="code" href="oldlist_8cpp.html#a1d8af9328f064a9df6d6f88336dd054e">search</a> (ChiWith[DegreesOfFreedom],
<a name="l01920"></a>01920     &amp;SearchKey, <a class="code" href="cluster_8cpp.html#ad39bd07ace019e3862769098fae02f93">AlphaMatch</a>));
<a name="l01921"></a>01921 
<a name="l01922"></a>01922   <span class="keywordflow">if</span> (OldChiSquared == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01923"></a>01923     OldChiSquared = <a class="code" href="cluster_8cpp.html#ac16f25cf71bcb2632f695f55fb9a5980">NewChiStruct</a> (DegreesOfFreedom, Alpha);
<a name="l01924"></a>01924     OldChiSquared-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#ab8ebe43673dcf3e24c6a792c3bed43ea">ChiSquared</a> = <a class="code" href="cluster_8cpp.html#a8098e057438e6f07276dd005f28ef13c">Solve</a> (<a class="code" href="cluster_8cpp.html#a444724ad6aa7b59e010c1089af12b0b0">ChiArea</a>, OldChiSquared,
<a name="l01925"></a>01925       (<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) DegreesOfFreedom,
<a name="l01926"></a>01926       (<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) <a class="code" href="cluster_8cpp.html#aafca5fbbdd94e29a7a3b9ed7b41c1a4b">CHIACCURACY</a>);
<a name="l01927"></a>01927     ChiWith[<a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>] = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (ChiWith[DegreesOfFreedom],
<a name="l01928"></a>01928       OldChiSquared);
<a name="l01929"></a>01929   }
<a name="l01930"></a>01930   <span class="keywordflow">else</span> {
<a name="l01931"></a>01931     <span class="comment">// further optimization might move OldChiSquared to front of list</span>
<a name="l01932"></a>01932   }
<a name="l01933"></a>01933 
<a name="l01934"></a>01934   <span class="keywordflow">return</span> (OldChiSquared-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#ab8ebe43673dcf3e24c6a792c3bed43ea">ChiSquared</a>);
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 }                                <span class="comment">// ComputeChiSquared</span>
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l01940"></a><a class="code" href="cluster_8cpp.html#a46fa6d94ca57427d93d1f306c4bbcf46">01940</a> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a46fa6d94ca57427d93d1f306c4bbcf46">NormalDensity</a>(<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> x) {
<a name="l01941"></a>01941 <span class="comment">/*</span>
<a name="l01942"></a>01942 <span class="comment"> **     Parameters:</span>
<a name="l01943"></a>01943 <span class="comment"> **             x       number to compute the normal probability density for</span>
<a name="l01944"></a>01944 <span class="comment"> **     Globals:</span>
<a name="l01945"></a>01945 <span class="comment"> **             kNormalMean     mean of a discrete normal distribution</span>
<a name="l01946"></a>01946 <span class="comment"> **             kNormalVariance variance of a discrete normal distribution</span>
<a name="l01947"></a>01947 <span class="comment"> **             kNormalMagnitude        magnitude of a discrete normal distribution</span>
<a name="l01948"></a>01948 <span class="comment"> **     Operation:</span>
<a name="l01949"></a>01949 <span class="comment"> **             This routine computes the probability density function</span>
<a name="l01950"></a>01950 <span class="comment"> **             of a discrete normal distribution defined by the global</span>
<a name="l01951"></a>01951 <span class="comment"> **             variables kNormalMean, kNormalVariance, and kNormalMagnitude.</span>
<a name="l01952"></a>01952 <span class="comment"> **             Normal magnitude could, of course, be computed in terms of</span>
<a name="l01953"></a>01953 <span class="comment"> **             the normal variance but it is precomputed for efficiency.</span>
<a name="l01954"></a>01954 <span class="comment"> **     Return:</span>
<a name="l01955"></a>01955 <span class="comment"> **             The value of the normal distribution at x.</span>
<a name="l01956"></a>01956 <span class="comment"> **     Exceptions:</span>
<a name="l01957"></a>01957 <span class="comment"> **             None</span>
<a name="l01958"></a>01958 <span class="comment"> **     History:</span>
<a name="l01959"></a>01959 <span class="comment"> **             6/4/89, DSJ, Created.</span>
<a name="l01960"></a>01960 <span class="comment"> */</span>
<a name="l01961"></a>01961   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Distance;
<a name="l01962"></a>01962 
<a name="l01963"></a>01963   Distance = x - kNormalMean;
<a name="l01964"></a>01964   <span class="keywordflow">return</span> kNormalMagnitude * exp(-0.5 * Distance * Distance / kNormalVariance);
<a name="l01965"></a>01965 }                                <span class="comment">// NormalDensity</span>
<a name="l01966"></a>01966 
<a name="l01967"></a>01967 
<a name="l01968"></a>01968 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l01969"></a><a class="code" href="cluster_8cpp.html#a5abc8ec5703c3d471dc0dd172cb22168">01969</a> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a5abc8ec5703c3d471dc0dd172cb22168">UniformDensity</a>(<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> x) {
<a name="l01970"></a>01970 <span class="comment">/*</span>
<a name="l01971"></a>01971 <span class="comment"> **     Parameters:</span>
<a name="l01972"></a>01972 <span class="comment"> **             x       number to compute the uniform probability density for</span>
<a name="l01973"></a>01973 <span class="comment"> **     Operation:</span>
<a name="l01974"></a>01974 <span class="comment"> **             This routine computes the probability density function</span>
<a name="l01975"></a>01975 <span class="comment"> **             of a uniform distribution at the specified point.  The</span>
<a name="l01976"></a>01976 <span class="comment"> **             range of the distribution is from 0 to BUCKETTABLESIZE.</span>
<a name="l01977"></a>01977 <span class="comment"> **     Return:</span>
<a name="l01978"></a>01978 <span class="comment"> **             The value of the uniform distribution at x.</span>
<a name="l01979"></a>01979 <span class="comment"> **     Exceptions:</span>
<a name="l01980"></a>01980 <span class="comment"> **             None</span>
<a name="l01981"></a>01981 <span class="comment"> **     History:</span>
<a name="l01982"></a>01982 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l01983"></a>01983 <span class="comment"> */</span>
<a name="l01984"></a>01984   <span class="keyword">static</span> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> UniformDistributionDensity = (<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) 1.0 / BUCKETTABLESIZE;
<a name="l01985"></a>01985 
<a name="l01986"></a>01986   <span class="keywordflow">if</span> ((x &gt;= 0.0) &amp;&amp; (x &lt;= <a class="code" href="cluster_8cpp.html#a0b0900161a8584a70a474237621ce953">BUCKETTABLESIZE</a>))
<a name="l01987"></a>01987     <span class="keywordflow">return</span> UniformDistributionDensity;
<a name="l01988"></a>01988   <span class="keywordflow">else</span>
<a name="l01989"></a>01989     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) 0.0;
<a name="l01990"></a>01990 }                                <span class="comment">// UniformDensity</span>
<a name="l01991"></a>01991 
<a name="l01992"></a>01992 
<a name="l01993"></a>01993 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l01994"></a><a class="code" href="cluster_8cpp.html#af0eb798915396ae610f1701708a7b816">01994</a> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#af0eb798915396ae610f1701708a7b816">Integral</a>(<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> f1, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> f2, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Dx) {
<a name="l01995"></a>01995 <span class="comment">/*</span>
<a name="l01996"></a>01996 <span class="comment"> **     Parameters:</span>
<a name="l01997"></a>01997 <span class="comment"> **             f1      value of function at x1</span>
<a name="l01998"></a>01998 <span class="comment"> **             f2      value of function at x2</span>
<a name="l01999"></a>01999 <span class="comment"> **             Dx      x2 - x1 (should always be positive)</span>
<a name="l02000"></a>02000 <span class="comment"> **     Operation:</span>
<a name="l02001"></a>02001 <span class="comment"> **             This routine computes a trapezoidal approximation to the</span>
<a name="l02002"></a>02002 <span class="comment"> **             integral of a function over a small delta in x.</span>
<a name="l02003"></a>02003 <span class="comment"> **     Return:</span>
<a name="l02004"></a>02004 <span class="comment"> **             Approximation of the integral of the function from x1 to x2.</span>
<a name="l02005"></a>02005 <span class="comment"> **     Exceptions:</span>
<a name="l02006"></a>02006 <span class="comment"> **             None</span>
<a name="l02007"></a>02007 <span class="comment"> **     History:</span>
<a name="l02008"></a>02008 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l02009"></a>02009 <span class="comment"> */</span>
<a name="l02010"></a>02010   <span class="keywordflow">return</span> (f1 + f2) * Dx / 2.0;
<a name="l02011"></a>02011 }                                <span class="comment">// Integral</span>
<a name="l02012"></a>02012 
<a name="l02013"></a>02013 
<a name="l02014"></a>02014 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02015"></a><a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">02015</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a54c75ac15de9474adc1387dc0c809c0b">FillBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets,
<a name="l02016"></a>02016                  <a class="code" href="structsample.html">CLUSTER</a> *Cluster,
<a name="l02017"></a>02017                  <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> Dim,
<a name="l02018"></a>02018                  <a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc,
<a name="l02019"></a>02019                  <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>,
<a name="l02020"></a>02020                  <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> StdDev) {
<a name="l02021"></a>02021 <span class="comment">/*</span>
<a name="l02022"></a>02022 <span class="comment"> **     Parameters:</span>
<a name="l02023"></a>02023 <span class="comment"> **             Buckets         histogram buckets to count samples</span>
<a name="l02024"></a>02024 <span class="comment"> **             Cluster         cluster whose samples are being analyzed</span>
<a name="l02025"></a>02025 <span class="comment"> **             Dim             dimension of samples which is being analyzed</span>
<a name="l02026"></a>02026 <span class="comment"> **             ParamDesc       description of the dimension</span>
<a name="l02027"></a>02027 <span class="comment"> **             Mean            &quot;mean&quot; of the distribution</span>
<a name="l02028"></a>02028 <span class="comment"> **             StdDev          &quot;standard deviation&quot; of the distribution</span>
<a name="l02029"></a>02029 <span class="comment"> **     Operation:</span>
<a name="l02030"></a>02030 <span class="comment"> **             This routine counts the number of cluster samples which</span>
<a name="l02031"></a>02031 <span class="comment"> **             fall within the various histogram buckets in Buckets.  Only</span>
<a name="l02032"></a>02032 <span class="comment"> **             one dimension of each sample is examined.  The exact meaning</span>
<a name="l02033"></a>02033 <span class="comment"> **             of the Mean and StdDev parameters depends on the</span>
<a name="l02034"></a>02034 <span class="comment"> **             distribution which is being analyzed (this info is in the</span>
<a name="l02035"></a>02035 <span class="comment"> **             Buckets data structure).  For normal distributions, Mean</span>
<a name="l02036"></a>02036 <span class="comment"> **             and StdDev have the expected meanings.  For uniform and</span>
<a name="l02037"></a>02037 <span class="comment"> **             random distributions the Mean is the center point of the</span>
<a name="l02038"></a>02038 <span class="comment"> **             range and the StdDev is 1/2 the range.  A dimension with</span>
<a name="l02039"></a>02039 <span class="comment"> **             zero standard deviation cannot be statistically analyzed.</span>
<a name="l02040"></a>02040 <span class="comment"> **             In this case, a pseudo-analysis is used.</span>
<a name="l02041"></a>02041 <span class="comment"> **     Return:</span>
<a name="l02042"></a>02042 <span class="comment"> **             None (the Buckets data structure is filled in)</span>
<a name="l02043"></a>02043 <span class="comment"> **     Exceptions:</span>
<a name="l02044"></a>02044 <span class="comment"> **             None</span>
<a name="l02045"></a>02045 <span class="comment"> **     History:</span>
<a name="l02046"></a>02046 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l02047"></a>02047 <span class="comment"> */</span>
<a name="l02048"></a>02048   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> BucketID;
<a name="l02049"></a>02049   <span class="keywordtype">int</span> i;
<a name="l02050"></a>02050   <a class="code" href="structlist__rec.html">LIST</a> SearchState;
<a name="l02051"></a>02051   <a class="code" href="structsample.html">SAMPLE</a> *Sample;
<a name="l02052"></a>02052 
<a name="l02053"></a>02053   <span class="comment">// initialize the histogram bucket counts to 0</span>
<a name="l02054"></a>02054   <span class="keywordflow">for</span> (i = 0; i &lt; Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>; i++)
<a name="l02055"></a>02055     Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>[i] = 0;
<a name="l02056"></a>02056 
<a name="l02057"></a>02057   if (StdDev == 0.0) {
<a name="l02058"></a>02058     <span class="comment">/* if the standard deviation is zero, then we can&#39;t statistically</span>
<a name="l02059"></a>02059 <span class="comment">       analyze the cluster.  Use a pseudo-analysis: samples exactly on</span>
<a name="l02060"></a>02060 <span class="comment">       the mean are distributed evenly across all buckets.  Samples greater</span>
<a name="l02061"></a>02061 <span class="comment">       than the mean are placed in the last bucket; samples less than the</span>
<a name="l02062"></a>02062 <span class="comment">       mean are placed in the first bucket. */</span>
<a name="l02063"></a>02063 
<a name="l02064"></a>02064     <a class="code" href="cluster_8h.html#af125589eadf8dca87cf904ebcb77c896">InitSampleSearch</a>(SearchState, Cluster);
<a name="l02065"></a>02065     i = 0;
<a name="l02066"></a>02066     <span class="keywordflow">while</span> ((Sample = <a class="code" href="cluster_8cpp.html#abf5d9e3b151ac51b27bd9dc797ac261c">NextSample</a> (&amp;SearchState)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02067"></a>02067       <span class="keywordflow">if</span> (Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[Dim] &gt; Mean)
<a name="l02068"></a>02068         BucketID = Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a> - 1;
<a name="l02069"></a>02069       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[Dim] &lt; Mean)
<a name="l02070"></a>02070         BucketID = 0;
<a name="l02071"></a>02071       <span class="keywordflow">else</span>
<a name="l02072"></a>02072         BucketID = i;
<a name="l02073"></a>02073       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>[BucketID] += 1;
<a name="l02074"></a>02074       i++;
<a name="l02075"></a>02075       <span class="keywordflow">if</span> (i &gt;= Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>)
<a name="l02076"></a>02076         i = 0;
<a name="l02077"></a>02077     }
<a name="l02078"></a>02078   }
<a name="l02079"></a>02079   <span class="keywordflow">else</span> {
<a name="l02080"></a>02080     <span class="comment">// search for all samples in the cluster and add to histogram buckets</span>
<a name="l02081"></a>02081     <a class="code" href="cluster_8h.html#af125589eadf8dca87cf904ebcb77c896">InitSampleSearch</a>(SearchState, Cluster);
<a name="l02082"></a>02082     <span class="keywordflow">while</span> ((Sample = <a class="code" href="cluster_8cpp.html#abf5d9e3b151ac51b27bd9dc797ac261c">NextSample</a> (&amp;SearchState)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02083"></a>02083       <span class="keywordflow">switch</span> (Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#ad2b1ef5944d42354519db2895a8ca062">Distribution</a>) {
<a name="l02084"></a>02084         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0aebc81705969b8c5ae986b0b2ec08d1d5">normal</a>:
<a name="l02085"></a>02085           BucketID = <a class="code" href="cluster_8cpp.html#a8e988f373e1dc7d9a55043f3db047d09">NormalBucket</a> (ParamDesc, Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[Dim],
<a name="l02086"></a>02086             Mean, StdDev);
<a name="l02087"></a>02087           <span class="keywordflow">break</span>;
<a name="l02088"></a>02088         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a21504929e31ddde091641bb817e32320">D_random</a>:
<a name="l02089"></a>02089         <span class="keywordflow">case</span> <a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0a56013d9ac59a24fb94d9acb932a04b2f">uniform</a>:
<a name="l02090"></a>02090           BucketID = <a class="code" href="cluster_8cpp.html#a43e2cce8f045a700cd6fb0684761cc0c">UniformBucket</a> (ParamDesc, Sample-&gt;<a class="code" href="structsample.html#ac4a33bc0bdd82dd732bbb2f7c593ec78">Mean</a>[Dim],
<a name="l02091"></a>02091             Mean, StdDev);
<a name="l02092"></a>02092           <span class="keywordflow">break</span>;
<a name="l02093"></a>02093         <span class="keywordflow">default</span>:
<a name="l02094"></a>02094           BucketID = 0;
<a name="l02095"></a>02095       }
<a name="l02096"></a>02096       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>[Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#aaa108173d6611040d567271a1262b67e">Bucket</a>[BucketID]] += 1;
<a name="l02097"></a>02097     }
<a name="l02098"></a>02098   }
<a name="l02099"></a>02099 }                                <span class="comment">// FillBuckets</span>
<a name="l02100"></a>02100 
<a name="l02101"></a>02101 
<a name="l02102"></a>02102 <span class="comment">//---------------------------------------------------------------------------*/</span>
<a name="l02103"></a><a class="code" href="cluster_8cpp.html#a8e988f373e1dc7d9a55043f3db047d09">02103</a> <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#a8e988f373e1dc7d9a55043f3db047d09">NormalBucket</a>(<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc,
<a name="l02104"></a>02104                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> x,
<a name="l02105"></a>02105                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>,
<a name="l02106"></a>02106                     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> StdDev) {
<a name="l02107"></a>02107 <span class="comment">/*</span>
<a name="l02108"></a>02108 <span class="comment"> **     Parameters:</span>
<a name="l02109"></a>02109 <span class="comment"> **             ParamDesc       used to identify circular dimensions</span>
<a name="l02110"></a>02110 <span class="comment"> **             x               value to be normalized</span>
<a name="l02111"></a>02111 <span class="comment"> **             Mean            mean of normal distribution</span>
<a name="l02112"></a>02112 <span class="comment"> **             StdDev          standard deviation of normal distribution</span>
<a name="l02113"></a>02113 <span class="comment"> **     Operation:</span>
<a name="l02114"></a>02114 <span class="comment"> **             This routine determines which bucket x falls into in the</span>
<a name="l02115"></a>02115 <span class="comment"> **             discrete normal distribution defined by kNormalMean</span>
<a name="l02116"></a>02116 <span class="comment"> **             and kNormalStdDev.  x values which exceed the range of</span>
<a name="l02117"></a>02117 <span class="comment"> **             the discrete distribution are clipped.</span>
<a name="l02118"></a>02118 <span class="comment"> **     Return:</span>
<a name="l02119"></a>02119 <span class="comment"> **             Bucket number into which x falls</span>
<a name="l02120"></a>02120 <span class="comment"> **     Exceptions:</span>
<a name="l02121"></a>02121 <span class="comment"> **             None</span>
<a name="l02122"></a>02122 <span class="comment"> **     History:</span>
<a name="l02123"></a>02123 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l02124"></a>02124 <span class="comment"> */</span>
<a name="l02125"></a>02125   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> X;
<a name="l02126"></a>02126 
<a name="l02127"></a>02127   <span class="comment">// wraparound circular parameters if necessary</span>
<a name="l02128"></a>02128   <span class="keywordflow">if</span> (ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a55807f1e0be0daba2a33380ea29b2f1d">Circular</a>) {
<a name="l02129"></a>02129     <span class="keywordflow">if</span> (x - Mean &gt; ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a1df92d879d7ec8ea6662e956d27154b5">HalfRange</a>)
<a name="l02130"></a>02130       x -= ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l02131"></a>02131     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x - Mean &lt; -ParamDesc-&gt;HalfRange)
<a name="l02132"></a>02132       x += ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l02133"></a>02133   }
<a name="l02134"></a>02134 
<a name="l02135"></a>02135   X = ((x - <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>) / StdDev) * kNormalStdDev + kNormalMean;
<a name="l02136"></a>02136   <span class="keywordflow">if</span> (X &lt; 0)
<a name="l02137"></a>02137     <span class="keywordflow">return</span> 0;
<a name="l02138"></a>02138   <span class="keywordflow">if</span> (X &gt; BUCKETTABLESIZE - 1)
<a name="l02139"></a>02139     <span class="keywordflow">return</span> ((<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a>) (BUCKETTABLESIZE - 1));
<a name="l02140"></a>02140   <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a>) floor((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) X);
<a name="l02141"></a>02141 }                                <span class="comment">// NormalBucket</span>
<a name="l02142"></a>02142 
<a name="l02143"></a>02143 
<a name="l02144"></a>02144 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02145"></a><a class="code" href="cluster_8cpp.html#a43e2cce8f045a700cd6fb0684761cc0c">02145</a> <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#a43e2cce8f045a700cd6fb0684761cc0c">UniformBucket</a>(<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html">PARAM_DESC</a> *ParamDesc,
<a name="l02146"></a>02146                      <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> x,
<a name="l02147"></a>02147                      <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>,
<a name="l02148"></a>02148                      <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> StdDev) {
<a name="l02149"></a>02149 <span class="comment">/*</span>
<a name="l02150"></a>02150 <span class="comment"> **     Parameters:</span>
<a name="l02151"></a>02151 <span class="comment"> **             ParamDesc       used to identify circular dimensions</span>
<a name="l02152"></a>02152 <span class="comment"> **             x               value to be normalized</span>
<a name="l02153"></a>02153 <span class="comment"> **             Mean            center of range of uniform distribution</span>
<a name="l02154"></a>02154 <span class="comment"> **             StdDev          1/2 the range of the uniform distribution</span>
<a name="l02155"></a>02155 <span class="comment"> **     Operation:</span>
<a name="l02156"></a>02156 <span class="comment"> **             This routine determines which bucket x falls into in the</span>
<a name="l02157"></a>02157 <span class="comment"> **             discrete uniform distribution defined by</span>
<a name="l02158"></a>02158 <span class="comment"> **             BUCKETTABLESIZE.  x values which exceed the range of</span>
<a name="l02159"></a>02159 <span class="comment"> **             the discrete distribution are clipped.</span>
<a name="l02160"></a>02160 <span class="comment"> **     Return:</span>
<a name="l02161"></a>02161 <span class="comment"> **             Bucket number into which x falls</span>
<a name="l02162"></a>02162 <span class="comment"> **     Exceptions:</span>
<a name="l02163"></a>02163 <span class="comment"> **             None</span>
<a name="l02164"></a>02164 <span class="comment"> **     History:</span>
<a name="l02165"></a>02165 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l02166"></a>02166 <span class="comment"> */</span>
<a name="l02167"></a>02167   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> X;
<a name="l02168"></a>02168 
<a name="l02169"></a>02169   <span class="comment">// wraparound circular parameters if necessary</span>
<a name="l02170"></a>02170   <span class="keywordflow">if</span> (ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a55807f1e0be0daba2a33380ea29b2f1d">Circular</a>) {
<a name="l02171"></a>02171     <span class="keywordflow">if</span> (x - Mean &gt; ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a1df92d879d7ec8ea6662e956d27154b5">HalfRange</a>)
<a name="l02172"></a>02172       x -= ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l02173"></a>02173     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x - Mean &lt; -ParamDesc-&gt;HalfRange)
<a name="l02174"></a>02174       x += ParamDesc-&gt;<a class="code" href="struct_p_a_r_a_m___d_e_s_c.html#a031dddcdc1744e777435f8ceea197448">Range</a>;
<a name="l02175"></a>02175   }
<a name="l02176"></a>02176 
<a name="l02177"></a>02177   X = ((x - <a class="code" href="cluster_8cpp.html#ad99e1235a4e63880ab2f72bfdff26e28">Mean</a>) / (2 * StdDev) * BUCKETTABLESIZE + BUCKETTABLESIZE / 2.0);
<a name="l02178"></a>02178   <span class="keywordflow">if</span> (X &lt; 0)
<a name="l02179"></a>02179     <span class="keywordflow">return</span> 0;
<a name="l02180"></a>02180   <span class="keywordflow">if</span> (X &gt; BUCKETTABLESIZE - 1)
<a name="l02181"></a>02181     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a>) (BUCKETTABLESIZE - 1);
<a name="l02182"></a>02182   <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a>) floor((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) X);
<a name="l02183"></a>02183 }                                <span class="comment">// UniformBucket</span>
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 
<a name="l02186"></a>02186 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02187"></a><a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">02187</a> <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> <a class="code" href="cluster_8cpp.html#a4c5b32330cf58e89e2352deb84394332">DistributionOK</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets) {
<a name="l02188"></a>02188 <span class="comment">/*</span>
<a name="l02189"></a>02189 <span class="comment"> **     Parameters:</span>
<a name="l02190"></a>02190 <span class="comment"> **             Buckets         histogram data to perform chi-square test on</span>
<a name="l02191"></a>02191 <span class="comment"> **     Operation:</span>
<a name="l02192"></a>02192 <span class="comment"> **             This routine performs a chi-square goodness of fit test</span>
<a name="l02193"></a>02193 <span class="comment"> **             on the histogram data in the Buckets data structure.  TRUE</span>
<a name="l02194"></a>02194 <span class="comment"> **             is returned if the histogram matches the probability</span>
<a name="l02195"></a>02195 <span class="comment"> **             distribution which was specified when the Buckets</span>
<a name="l02196"></a>02196 <span class="comment"> **             structure was originally created.  Otherwise FALSE is</span>
<a name="l02197"></a>02197 <span class="comment"> **             returned.</span>
<a name="l02198"></a>02198 <span class="comment"> **     Return:</span>
<a name="l02199"></a>02199 <span class="comment"> **             TRUE if samples match distribution, FALSE otherwise</span>
<a name="l02200"></a>02200 <span class="comment"> **     Exceptions:</span>
<a name="l02201"></a>02201 <span class="comment"> **             None</span>
<a name="l02202"></a>02202 <span class="comment"> **     History:</span>
<a name="l02203"></a>02203 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l02204"></a>02204 <span class="comment"> */</span>
<a name="l02205"></a>02205   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> FrequencyDifference;
<a name="l02206"></a>02206   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> TotalDifference;
<a name="l02207"></a>02207   <span class="keywordtype">int</span> i;
<a name="l02208"></a>02208 
<a name="l02209"></a>02209   <span class="comment">// compute how well the histogram matches the expected histogram</span>
<a name="l02210"></a>02210   TotalDifference = 0.0;
<a name="l02211"></a>02211   <span class="keywordflow">for</span> (i = 0; i &lt; Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>; i++) {
<a name="l02212"></a>02212     FrequencyDifference = Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>[i] - Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[i];
<a name="l02213"></a>02213     TotalDifference += (FrequencyDifference * FrequencyDifference) /
<a name="l02214"></a>02214       Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[i];
<a name="l02215"></a>02215   }
<a name="l02216"></a>02216 
<a name="l02217"></a>02217   <span class="comment">// test to see if the difference is more than expected</span>
<a name="l02218"></a>02218   <span class="keywordflow">if</span> (TotalDifference &gt; Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4dedca1b6c939050313aa761b59a0a11">ChiSquared</a>)
<a name="l02219"></a>02219     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02220"></a>02220   <span class="keywordflow">else</span>
<a name="l02221"></a>02221     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02222"></a>02222 }                                <span class="comment">// DistributionOK</span>
<a name="l02223"></a>02223 
<a name="l02224"></a>02224 
<a name="l02225"></a>02225 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02226"></a><a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">02226</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#aef1b69ed626e557bf84c9c0b18db6b95">FreeStatistics</a>(<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html">STATISTICS</a> *Statistics) {
<a name="l02227"></a>02227 <span class="comment">/*</span>
<a name="l02228"></a>02228 <span class="comment"> **     Parameters:</span>
<a name="l02229"></a>02229 <span class="comment"> **             Statistics      pointer to data structure to be freed</span>
<a name="l02230"></a>02230 <span class="comment"> **     Operation:</span>
<a name="l02231"></a>02231 <span class="comment"> **             This routine frees the memory used by the statistics</span>
<a name="l02232"></a>02232 <span class="comment"> **             data structure.</span>
<a name="l02233"></a>02233 <span class="comment"> **     Return:</span>
<a name="l02234"></a>02234 <span class="comment"> **             None</span>
<a name="l02235"></a>02235 <span class="comment"> **     Exceptions:</span>
<a name="l02236"></a>02236 <span class="comment"> **             None</span>
<a name="l02237"></a>02237 <span class="comment"> **     History:</span>
<a name="l02238"></a>02238 <span class="comment"> **             6/5/89, DSJ, Created.</span>
<a name="l02239"></a>02239 <span class="comment"> */</span>
<a name="l02240"></a>02240   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a1a87c66cfa2a256ff9b13d5858bf9650">CoVariance</a>);
<a name="l02241"></a>02241   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#ae03871d16f8d02e97e24401324565ab5">Min</a>);
<a name="l02242"></a>02242   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a> (Statistics-&gt;<a class="code" href="struct_s_t_a_t_i_s_t_i_c_s.html#a6f553b49759c072107a7c1c5606bbc72">Max</a>);
<a name="l02243"></a>02243   <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Statistics);
<a name="l02244"></a>02244 }                                <span class="comment">// FreeStatistics</span>
<a name="l02245"></a>02245 
<a name="l02246"></a>02246 
<a name="l02247"></a>02247 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02248"></a><a class="code" href="cluster_8cpp.html#a1afe8a387c2e426eea3e152bb1cdd3e9">02248</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a1afe8a387c2e426eea3e152bb1cdd3e9">FreeBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *buckets) {
<a name="l02249"></a>02249 <span class="comment">/*</span>
<a name="l02250"></a>02250 <span class="comment"> **  Parameters:</span>
<a name="l02251"></a>02251 <span class="comment"> **      buckets  pointer to data structure to be freed</span>
<a name="l02252"></a>02252 <span class="comment"> **  Operation:</span>
<a name="l02253"></a>02253 <span class="comment"> **      This routine properly frees the memory used by a BUCKETS.</span>
<a name="l02254"></a>02254 <span class="comment"> */</span>
<a name="l02255"></a>02255   <a class="code" href="emalloc_8cpp.html#af846576ae65dc13e49ddc616e17baa27">Efree</a>(buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>);
<a name="l02256"></a>02256   <a class="code" href="emalloc_8cpp.html#af846576ae65dc13e49ddc616e17baa27">Efree</a>(buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>);
<a name="l02257"></a>02257   <a class="code" href="emalloc_8cpp.html#af846576ae65dc13e49ddc616e17baa27">Efree</a>(buckets);
<a name="l02258"></a>02258 }                                <span class="comment">// FreeBuckets</span>
<a name="l02259"></a>02259 
<a name="l02260"></a>02260 
<a name="l02261"></a>02261 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02262"></a><a class="code" href="cluster_8cpp.html#ac66b8beb503d71773eba9bc47d386ae8">02262</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#ac66b8beb503d71773eba9bc47d386ae8">FreeCluster</a>(<a class="code" href="structsample.html">CLUSTER</a> *Cluster) {
<a name="l02263"></a>02263 <span class="comment">/*</span>
<a name="l02264"></a>02264 <span class="comment"> **     Parameters:</span>
<a name="l02265"></a>02265 <span class="comment"> **             Cluster         pointer to cluster to be freed</span>
<a name="l02266"></a>02266 <span class="comment"> **     Operation:</span>
<a name="l02267"></a>02267 <span class="comment"> **             This routine frees the memory consumed by the specified</span>
<a name="l02268"></a>02268 <span class="comment"> **             cluster and all of its subclusters.  This is done by</span>
<a name="l02269"></a>02269 <span class="comment"> **             recursive calls to FreeCluster().</span>
<a name="l02270"></a>02270 <span class="comment"> **     Return:</span>
<a name="l02271"></a>02271 <span class="comment"> **             None</span>
<a name="l02272"></a>02272 <span class="comment"> **     Exceptions:</span>
<a name="l02273"></a>02273 <span class="comment"> **             None</span>
<a name="l02274"></a>02274 <span class="comment"> **     History:</span>
<a name="l02275"></a>02275 <span class="comment"> **             6/6/89, DSJ, Created.</span>
<a name="l02276"></a>02276 <span class="comment"> */</span>
<a name="l02277"></a>02277   <span class="keywordflow">if</span> (Cluster != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02278"></a>02278     <a class="code" href="cluster_8cpp.html#ac66b8beb503d71773eba9bc47d386ae8">FreeCluster</a> (Cluster-&gt;<a class="code" href="structsample.html#ae6abb40063761a77d4275c79c5c0bb49">Left</a>);
<a name="l02279"></a>02279     <a class="code" href="cluster_8cpp.html#ac66b8beb503d71773eba9bc47d386ae8">FreeCluster</a> (Cluster-&gt;<a class="code" href="structsample.html#a2d66168da8fd6b92aed011277f54843a">Right</a>);
<a name="l02280"></a>02280     <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Cluster);
<a name="l02281"></a>02281   }
<a name="l02282"></a>02282 }                                <span class="comment">// FreeCluster</span>
<a name="l02283"></a>02283 
<a name="l02284"></a>02284 
<a name="l02285"></a>02285 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02286"></a><a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">02286</a> <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>(<a class="code" href="cluster_8h.html#ade80fdcd8f2dde57393f56d0cdfaeed0">DISTRIBUTION</a> Distribution, <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> HistogramBuckets) {
<a name="l02287"></a>02287 <span class="comment">/*</span>
<a name="l02288"></a>02288 <span class="comment"> **     Parameters:</span>
<a name="l02289"></a>02289 <span class="comment"> **             Distribution            distribution being tested for</span>
<a name="l02290"></a>02290 <span class="comment"> **             HistogramBuckets        number of buckets in chi-square test</span>
<a name="l02291"></a>02291 <span class="comment"> **     Operation:</span>
<a name="l02292"></a>02292 <span class="comment"> **             This routine computes the degrees of freedom that should</span>
<a name="l02293"></a>02293 <span class="comment"> **             be used in a chi-squared test with the specified number of</span>
<a name="l02294"></a>02294 <span class="comment"> **             histogram buckets.  The result is always rounded up to</span>
<a name="l02295"></a>02295 <span class="comment"> **             the next even number so that the value of chi-squared can be</span>
<a name="l02296"></a>02296 <span class="comment"> **             computed more easily.  This will cause the value of</span>
<a name="l02297"></a>02297 <span class="comment"> **             chi-squared to be higher than the optimum value, resulting</span>
<a name="l02298"></a>02298 <span class="comment"> **             in the chi-square test being more lenient than optimum.</span>
<a name="l02299"></a>02299 <span class="comment"> **     Return: The number of degrees of freedom for a chi-square test</span>
<a name="l02300"></a>02300 <span class="comment"> **     Exceptions: none</span>
<a name="l02301"></a>02301 <span class="comment"> **     History: Thu Aug  3 14:04:18 1989, DSJ, Created.</span>
<a name="l02302"></a>02302 <span class="comment"> */</span>
<a name="l02303"></a>02303   <span class="keyword">static</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a> DegreeOffsets[] = { 3, 3, 1 };
<a name="l02304"></a>02304 
<a name="l02305"></a>02305   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> AdjustedNumBuckets;
<a name="l02306"></a>02306 
<a name="l02307"></a>02307   AdjustedNumBuckets = HistogramBuckets - DegreeOffsets[(int) Distribution];
<a name="l02308"></a>02308   <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a0662f2b2f6ae8b7ed59d9da773c0da35">Odd</a> (AdjustedNumBuckets))
<a name="l02309"></a>02309     AdjustedNumBuckets++;
<a name="l02310"></a>02310   <span class="keywordflow">return</span> (AdjustedNumBuckets);
<a name="l02311"></a>02311 
<a name="l02312"></a>02312 }                                <span class="comment">// DegreesOfFreedom</span>
<a name="l02313"></a>02313 
<a name="l02314"></a>02314 
<a name="l02315"></a>02315 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02316"></a><a class="code" href="cluster_8cpp.html#af8d341c60c044ac30867d767c6b9b091">02316</a> <span class="keywordtype">int</span> <a class="code" href="cluster_8cpp.html#af8d341c60c044ac30867d767c6b9b091">NumBucketsMatch</a>(<span class="keywordtype">void</span> *arg1,    <span class="comment">// BUCKETS *Histogram,</span>
<a name="l02317"></a>02317                     <span class="keywordtype">void</span> *arg2) {  <span class="comment">// uinT16 *DesiredNumberOfBuckets)</span>
<a name="l02318"></a>02318 <span class="comment">/*</span>
<a name="l02319"></a>02319 <span class="comment"> **     Parameters:</span>
<a name="l02320"></a>02320 <span class="comment"> **             Histogram       current histogram being tested for a match</span>
<a name="l02321"></a>02321 <span class="comment"> **             DesiredNumberOfBuckets  match key</span>
<a name="l02322"></a>02322 <span class="comment"> **     Operation:</span>
<a name="l02323"></a>02323 <span class="comment"> **             This routine is used to search a list of histogram data</span>
<a name="l02324"></a>02324 <span class="comment"> **             structures to find one with the specified number of</span>
<a name="l02325"></a>02325 <span class="comment"> **             buckets.  It is called by the list search routines.</span>
<a name="l02326"></a>02326 <span class="comment"> **     Return: TRUE if Histogram matches DesiredNumberOfBuckets</span>
<a name="l02327"></a>02327 <span class="comment"> **     Exceptions: none</span>
<a name="l02328"></a>02328 <span class="comment"> **     History: Thu Aug  3 14:17:33 1989, DSJ, Created.</span>
<a name="l02329"></a>02329 <span class="comment"> */</span>
<a name="l02330"></a>02330   <a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Histogram = (<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *) arg1;
<a name="l02331"></a>02331   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> *DesiredNumberOfBuckets = (<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> *) arg2;
<a name="l02332"></a>02332 
<a name="l02333"></a>02333   <span class="keywordflow">return</span> (*DesiredNumberOfBuckets == Histogram-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>);
<a name="l02334"></a>02334 
<a name="l02335"></a>02335 }                                <span class="comment">// NumBucketsMatch</span>
<a name="l02336"></a>02336 
<a name="l02337"></a>02337 
<a name="l02338"></a>02338 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02339"></a><a class="code" href="cluster_8cpp.html#a7f39be063580c1c7c5566faf0398dfb0">02339</a> <span class="keywordtype">int</span> <a class="code" href="cluster_8cpp.html#a7f39be063580c1c7c5566faf0398dfb0">ListEntryMatch</a>(<span class="keywordtype">void</span> *arg1,    <span class="comment">//ListNode</span>
<a name="l02340"></a>02340                    <span class="keywordtype">void</span> *arg2) {  <span class="comment">//Key</span>
<a name="l02341"></a>02341 <span class="comment">/*</span>
<a name="l02342"></a>02342 <span class="comment"> **     Parameters: none</span>
<a name="l02343"></a>02343 <span class="comment"> **     Operation:</span>
<a name="l02344"></a>02344 <span class="comment"> **             This routine is used to search a list for a list node</span>
<a name="l02345"></a>02345 <span class="comment"> **             whose contents match Key.  It is called by the list</span>
<a name="l02346"></a>02346 <span class="comment"> **             delete_d routine.</span>
<a name="l02347"></a>02347 <span class="comment"> **     Return: TRUE if ListNode matches Key</span>
<a name="l02348"></a>02348 <span class="comment"> **     Exceptions: none</span>
<a name="l02349"></a>02349 <span class="comment"> **     History: Thu Aug  3 14:23:58 1989, DSJ, Created.</span>
<a name="l02350"></a>02350 <span class="comment"> */</span>
<a name="l02351"></a>02351   <span class="keywordflow">return</span> (arg1 == arg2);
<a name="l02352"></a>02352 
<a name="l02353"></a>02353 }                                <span class="comment">// ListEntryMatch</span>
<a name="l02354"></a>02354 
<a name="l02355"></a>02355 
<a name="l02356"></a>02356 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02357"></a><a class="code" href="cluster_8cpp.html#a02e72bde5b9d967258769d4a75f07e46">02357</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a02e72bde5b9d967258769d4a75f07e46">AdjustBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets, <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> NewSampleCount) {
<a name="l02358"></a>02358 <span class="comment">/*</span>
<a name="l02359"></a>02359 <span class="comment"> **     Parameters:</span>
<a name="l02360"></a>02360 <span class="comment"> **             Buckets         histogram data structure to adjust</span>
<a name="l02361"></a>02361 <span class="comment"> **             NewSampleCount  new sample count to adjust to</span>
<a name="l02362"></a>02362 <span class="comment"> **     Operation:</span>
<a name="l02363"></a>02363 <span class="comment"> **             This routine multiplies each ExpectedCount histogram entry</span>
<a name="l02364"></a>02364 <span class="comment"> **             by NewSampleCount/OldSampleCount so that the histogram</span>
<a name="l02365"></a>02365 <span class="comment"> **             is now adjusted to the new sample count.</span>
<a name="l02366"></a>02366 <span class="comment"> **     Return: none</span>
<a name="l02367"></a>02367 <span class="comment"> **     Exceptions: none</span>
<a name="l02368"></a>02368 <span class="comment"> **     History: Thu Aug  3 14:31:14 1989, DSJ, Created.</span>
<a name="l02369"></a>02369 <span class="comment"> */</span>
<a name="l02370"></a>02370   <span class="keywordtype">int</span> i;
<a name="l02371"></a>02371   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> AdjustFactor;
<a name="l02372"></a>02372 
<a name="l02373"></a>02373   AdjustFactor = (((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) NewSampleCount) /
<a name="l02374"></a>02374     ((<a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>) Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a8e352450eb27c8a017a037f71796b402">SampleCount</a>));
<a name="l02375"></a>02375 
<a name="l02376"></a>02376   <span class="keywordflow">for</span> (i = 0; i &lt; Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>; i++) {
<a name="l02377"></a>02377     Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a4002c4c85553bc88efee6395fe803026">ExpectedCount</a>[i] *= AdjustFactor;
<a name="l02378"></a>02378   }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380   Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a8e352450eb27c8a017a037f71796b402">SampleCount</a> = NewSampleCount;
<a name="l02381"></a>02381 
<a name="l02382"></a>02382 }                                <span class="comment">// AdjustBuckets</span>
<a name="l02383"></a>02383 
<a name="l02384"></a>02384 
<a name="l02385"></a>02385 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02386"></a><a class="code" href="cluster_8cpp.html#a0f9ec282a0fa768a4b5bd0d5efaca7d2">02386</a> <span class="keywordtype">void</span> <a class="code" href="cluster_8cpp.html#a0f9ec282a0fa768a4b5bd0d5efaca7d2">InitBuckets</a>(<a class="code" href="struct_b_u_c_k_e_t_s.html">BUCKETS</a> *Buckets) {
<a name="l02387"></a>02387 <span class="comment">/*</span>
<a name="l02388"></a>02388 <span class="comment"> **     Parameters:</span>
<a name="l02389"></a>02389 <span class="comment"> **             Buckets         histogram data structure to init</span>
<a name="l02390"></a>02390 <span class="comment"> **     Operation:</span>
<a name="l02391"></a>02391 <span class="comment"> **             This routine sets the bucket counts in the specified histogram</span>
<a name="l02392"></a>02392 <span class="comment"> **             to zero.</span>
<a name="l02393"></a>02393 <span class="comment"> **     Return: none</span>
<a name="l02394"></a>02394 <span class="comment"> **     Exceptions: none</span>
<a name="l02395"></a>02395 <span class="comment"> **     History: Thu Aug  3 14:31:14 1989, DSJ, Created.</span>
<a name="l02396"></a>02396 <span class="comment"> */</span>
<a name="l02397"></a>02397   <span class="keywordtype">int</span> i;
<a name="l02398"></a>02398 
<a name="l02399"></a>02399   <span class="keywordflow">for</span> (i = 0; i &lt; Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a291d5393aba4a5f429ce30913ca6b96a">NumberOfBuckets</a>; i++) {
<a name="l02400"></a>02400     Buckets-&gt;<a class="code" href="struct_b_u_c_k_e_t_s.html#a0b281b83beb3b9c450eeec5c9f4ec763">Count</a>[i] = 0;
<a name="l02401"></a>02401   }
<a name="l02402"></a>02402 
<a name="l02403"></a>02403 }                                <span class="comment">// InitBuckets</span>
<a name="l02404"></a>02404 
<a name="l02405"></a>02405 
<a name="l02406"></a>02406 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02407"></a><a class="code" href="cluster_8cpp.html#ad39bd07ace019e3862769098fae02f93">02407</a> <span class="keywordtype">int</span> <a class="code" href="cluster_8cpp.html#ad39bd07ace019e3862769098fae02f93">AlphaMatch</a>(<span class="keywordtype">void</span> *arg1,    <span class="comment">//CHISTRUCT                             *ChiStruct,</span>
<a name="l02408"></a>02408                <span class="keywordtype">void</span> *arg2) {  <span class="comment">//CHISTRUCT                             *SearchKey)</span>
<a name="l02409"></a>02409 <span class="comment">/*</span>
<a name="l02410"></a>02410 <span class="comment"> **     Parameters:</span>
<a name="l02411"></a>02411 <span class="comment"> **             ChiStruct       chi-squared struct being tested for a match</span>
<a name="l02412"></a>02412 <span class="comment"> **             SearchKey       chi-squared struct that is the search key</span>
<a name="l02413"></a>02413 <span class="comment"> **     Operation:</span>
<a name="l02414"></a>02414 <span class="comment"> **             This routine is used to search a list of structures which</span>
<a name="l02415"></a>02415 <span class="comment"> **             hold pre-computed chi-squared values for a chi-squared</span>
<a name="l02416"></a>02416 <span class="comment"> **             value whose corresponding alpha field matches the alpha</span>
<a name="l02417"></a>02417 <span class="comment"> **             field of SearchKey.</span>
<a name="l02418"></a>02418 <span class="comment"> **             It is called by the list search routines.</span>
<a name="l02419"></a>02419 <span class="comment"> **     Return: TRUE if ChiStruct&#39;s Alpha matches SearchKey&#39;s Alpha</span>
<a name="l02420"></a>02420 <span class="comment"> **     Exceptions: none</span>
<a name="l02421"></a>02421 <span class="comment"> **     History: Thu Aug  3 14:17:33 1989, DSJ, Created.</span>
<a name="l02422"></a>02422 <span class="comment"> */</span>
<a name="l02423"></a>02423   <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *ChiStruct = (<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) arg1;
<a name="l02424"></a>02424   <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *SearchKey = (<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) arg2;
<a name="l02425"></a>02425 
<a name="l02426"></a>02426   <span class="keywordflow">return</span> (ChiStruct-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">Alpha</a> == SearchKey-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">Alpha</a>);
<a name="l02427"></a>02427 
<a name="l02428"></a>02428 }                                <span class="comment">// AlphaMatch</span>
<a name="l02429"></a>02429 
<a name="l02430"></a>02430 
<a name="l02431"></a>02431 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02432"></a><a class="code" href="cluster_8cpp.html#ac16f25cf71bcb2632f695f55fb9a5980">02432</a> <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *<a class="code" href="cluster_8cpp.html#ac16f25cf71bcb2632f695f55fb9a5980">NewChiStruct</a>(<a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> DegreesOfFreedom, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Alpha) {
<a name="l02433"></a>02433 <span class="comment">/*</span>
<a name="l02434"></a>02434 <span class="comment"> **     Parameters:</span>
<a name="l02435"></a>02435 <span class="comment"> **             DegreesOfFreedom        degrees of freedom for new chi value</span>
<a name="l02436"></a>02436 <span class="comment"> **             Alpha                   confidence level for new chi value</span>
<a name="l02437"></a>02437 <span class="comment"> **     Operation:</span>
<a name="l02438"></a>02438 <span class="comment"> **             This routine allocates a new data structure which is used</span>
<a name="l02439"></a>02439 <span class="comment"> **             to hold a chi-squared value along with its associated</span>
<a name="l02440"></a>02440 <span class="comment"> **             number of degrees of freedom and alpha value.</span>
<a name="l02441"></a>02441 <span class="comment"> **     Return: none</span>
<a name="l02442"></a>02442 <span class="comment"> **     Exceptions: none</span>
<a name="l02443"></a>02443 <span class="comment"> **     History: Fri Aug  4 11:04:59 1989, DSJ, Created.</span>
<a name="l02444"></a>02444 <span class="comment"> */</span>
<a name="l02445"></a>02445   <a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *<a class="code" href="cluster_8cpp.html#ac16f25cf71bcb2632f695f55fb9a5980">NewChiStruct</a>;
<a name="l02446"></a>02446 
<a name="l02447"></a>02447   NewChiStruct = (<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a>));
<a name="l02448"></a>02448   NewChiStruct-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a15a3b870d88bb0fcedd7accc60d195c7">DegreesOfFreedom</a> = <a class="code" href="cluster_8cpp.html#acfe8f1657aa1e2a4de798d80ab637756">DegreesOfFreedom</a>;
<a name="l02449"></a>02449   NewChiStruct-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">Alpha</a> = Alpha;
<a name="l02450"></a>02450   <span class="keywordflow">return</span> (NewChiStruct);
<a name="l02451"></a>02451 
<a name="l02452"></a>02452 }                                <span class="comment">// NewChiStruct</span>
<a name="l02453"></a>02453 
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02456"></a>02456 <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a>
<a name="l02457"></a><a class="code" href="cluster_8cpp.html#a8098e057438e6f07276dd005f28ef13c">02457</a> <a class="code" href="cluster_8cpp.html#a8098e057438e6f07276dd005f28ef13c">Solve</a> (<a class="code" href="cluster_8cpp.html#a170fa76dec6514a98bb069c4b9652f2d">SOLVEFUNC</a> Function,
<a name="l02458"></a>02458 <span class="keywordtype">void</span> *FunctionParams, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> InitialGuess, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Accuracy)
<a name="l02459"></a>02459 <span class="comment">/*</span>
<a name="l02460"></a>02460 <span class="comment"> **     Parameters:</span>
<a name="l02461"></a>02461 <span class="comment"> **             Function        function whose zero is to be found</span>
<a name="l02462"></a>02462 <span class="comment"> **             FunctionParams  arbitrary data to pass to function</span>
<a name="l02463"></a>02463 <span class="comment"> **             InitialGuess    point to start solution search at</span>
<a name="l02464"></a>02464 <span class="comment"> **             Accuracy        maximum allowed error</span>
<a name="l02465"></a>02465 <span class="comment"> **     Operation:</span>
<a name="l02466"></a>02466 <span class="comment"> **             This routine attempts to find an x value at which Function</span>
<a name="l02467"></a>02467 <span class="comment"> **             goes to zero (i.e. a root of the function ).  It will only</span>
<a name="l02468"></a>02468 <span class="comment"> **             work correctly if a solution actually exists and there</span>
<a name="l02469"></a>02469 <span class="comment"> **             are no extrema between the solution and the InitialGuess.</span>
<a name="l02470"></a>02470 <span class="comment"> **             The algorithms used are extremely primitive.</span>
<a name="l02471"></a>02471 <span class="comment"> **     Return: Solution of function ( x for which f(x) = 0 ).</span>
<a name="l02472"></a>02472 <span class="comment"> **     Exceptions: none</span>
<a name="l02473"></a>02473 <span class="comment"> **     History: Fri Aug  4 11:08:59 1989, DSJ, Created.</span>
<a name="l02474"></a>02474 <span class="comment"> */</span>
<a name="l02475"></a>02475 <span class="preprocessor">#define INITIALDELTA    0.1</span>
<a name="l02476"></a>02476 <span class="preprocessor"></span><span class="preprocessor">#define  DELTARATIO     0.1</span>
<a name="l02477"></a>02477 <span class="preprocessor"></span>{
<a name="l02478"></a>02478   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> x;
<a name="l02479"></a>02479   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>;
<a name="l02480"></a>02480   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Slope;
<a name="l02481"></a>02481   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Delta;
<a name="l02482"></a>02482   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> NewDelta;
<a name="l02483"></a>02483   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> xDelta;
<a name="l02484"></a>02484   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> LastPosX, LastNegX;
<a name="l02485"></a>02485 
<a name="l02486"></a>02486   x = InitialGuess;
<a name="l02487"></a>02487   Delta = <a class="code" href="cluster_8cpp.html#a3ac44273f534b72f12afd0d6560bbbed">INITIALDELTA</a>;
<a name="l02488"></a>02488   LastPosX = <a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>;
<a name="l02489"></a>02489   LastNegX = -<a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>;
<a name="l02490"></a>02490   f = (*Function) ((<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) FunctionParams, x);
<a name="l02491"></a>02491   <span class="keywordflow">while</span> (<a class="code" href="cluster_8cpp.html#a060002a5aeab470cb24c8343daa1db08">Abs</a> (LastPosX - LastNegX) &gt; Accuracy) {
<a name="l02492"></a>02492     <span class="comment">// keep track of outer bounds of current estimate</span>
<a name="l02493"></a>02493     <span class="keywordflow">if</span> (f &lt; 0)
<a name="l02494"></a>02494       LastNegX = x;
<a name="l02495"></a>02495     <span class="keywordflow">else</span>
<a name="l02496"></a>02496       LastPosX = x;
<a name="l02497"></a>02497 
<a name="l02498"></a>02498     <span class="comment">// compute the approx. slope of f(x) at the current point</span>
<a name="l02499"></a>02499     Slope =
<a name="l02500"></a>02500       ((*Function) ((<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) FunctionParams, x + Delta) - <a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>) / Delta;
<a name="l02501"></a>02501 
<a name="l02502"></a>02502     <span class="comment">// compute the next solution guess */</span>
<a name="l02503"></a>02503     xDelta = f / Slope;
<a name="l02504"></a>02504     x -= xDelta;
<a name="l02505"></a>02505 
<a name="l02506"></a>02506     <span class="comment">// reduce the delta used for computing slope to be a fraction of</span>
<a name="l02507"></a>02507     <span class="comment">//the amount moved to get to the new guess</span>
<a name="l02508"></a>02508     NewDelta = <a class="code" href="cluster_8cpp.html#a060002a5aeab470cb24c8343daa1db08">Abs</a> (xDelta) * <a class="code" href="cluster_8cpp.html#a4a4390b86d05eddc0eb81787727debf8">DELTARATIO</a>;
<a name="l02509"></a>02509     <span class="keywordflow">if</span> (NewDelta &lt; Delta)
<a name="l02510"></a>02510       Delta = NewDelta;
<a name="l02511"></a>02511 
<a name="l02512"></a>02512     <span class="comment">// compute the value of the function at the new guess</span>
<a name="l02513"></a>02513     f = (*Function) ((<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *) FunctionParams, x);
<a name="l02514"></a>02514   }
<a name="l02515"></a>02515   <span class="keywordflow">return</span> (x);
<a name="l02516"></a>02516 
<a name="l02517"></a>02517 }                                <span class="comment">// Solve</span>
<a name="l02518"></a>02518 
<a name="l02519"></a>02519 
<a name="l02520"></a>02520 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02521"></a><a class="code" href="cluster_8cpp.html#a444724ad6aa7b59e010c1089af12b0b0">02521</a> <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> <a class="code" href="cluster_8cpp.html#a444724ad6aa7b59e010c1089af12b0b0">ChiArea</a>(<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html">CHISTRUCT</a> *ChiParams, <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> x) {
<a name="l02522"></a>02522 <span class="comment">/*</span>
<a name="l02523"></a>02523 <span class="comment"> **     Parameters:</span>
<a name="l02524"></a>02524 <span class="comment"> **             ChiParams       contains degrees of freedom and alpha</span>
<a name="l02525"></a>02525 <span class="comment"> **             x               value of chi-squared to evaluate</span>
<a name="l02526"></a>02526 <span class="comment"> **     Operation:</span>
<a name="l02527"></a>02527 <span class="comment"> **             This routine computes the area under a chi density curve</span>
<a name="l02528"></a>02528 <span class="comment"> **             from 0 to x, minus the desired area under the curve.  The</span>
<a name="l02529"></a>02529 <span class="comment"> **             number of degrees of freedom of the chi curve is specified</span>
<a name="l02530"></a>02530 <span class="comment"> **             in the ChiParams structure.  The desired area is also</span>
<a name="l02531"></a>02531 <span class="comment"> **             specified in the ChiParams structure as Alpha ( or 1 minus</span>
<a name="l02532"></a>02532 <span class="comment"> **             the desired area ).  This routine is intended to be passed</span>
<a name="l02533"></a>02533 <span class="comment"> **             to the Solve() function to find the value of chi-squared</span>
<a name="l02534"></a>02534 <span class="comment"> **             which will yield a desired area under the right tail of</span>
<a name="l02535"></a>02535 <span class="comment"> **             the chi density curve.  The function will only work for</span>
<a name="l02536"></a>02536 <span class="comment"> **             even degrees of freedom.  The equations are based on</span>
<a name="l02537"></a>02537 <span class="comment"> **             integrating the chi density curve in parts to obtain</span>
<a name="l02538"></a>02538 <span class="comment"> **             a series that can be used to compute the area under the</span>
<a name="l02539"></a>02539 <span class="comment"> **             curve.</span>
<a name="l02540"></a>02540 <span class="comment"> **     Return: Error between actual and desired area under the chi curve.</span>
<a name="l02541"></a>02541 <span class="comment"> **     Exceptions: none</span>
<a name="l02542"></a>02542 <span class="comment"> **     History: Fri Aug  4 12:48:41 1989, DSJ, Created.</span>
<a name="l02543"></a>02543 <span class="comment"> */</span>
<a name="l02544"></a>02544   <span class="keywordtype">int</span> i, N;
<a name="l02545"></a>02545   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> SeriesTotal;
<a name="l02546"></a>02546   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> Denominator;
<a name="l02547"></a>02547   <a class="code" href="host_8h.html#aa8336782d864ba03efadb73a51260961">FLOAT64</a> PowerOfx;
<a name="l02548"></a>02548 
<a name="l02549"></a>02549   N = ChiParams-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a15a3b870d88bb0fcedd7accc60d195c7">DegreesOfFreedom</a> / 2 - 1;
<a name="l02550"></a>02550   SeriesTotal = 1;
<a name="l02551"></a>02551   Denominator = 1;
<a name="l02552"></a>02552   PowerOfx = 1;
<a name="l02553"></a>02553   <span class="keywordflow">for</span> (i = 1; i &lt;= N; i++) {
<a name="l02554"></a>02554     Denominator *= 2 * i;
<a name="l02555"></a>02555     PowerOfx *= x;
<a name="l02556"></a>02556     SeriesTotal += PowerOfx / Denominator;
<a name="l02557"></a>02557   }
<a name="l02558"></a>02558   <span class="keywordflow">return</span> ((SeriesTotal * exp (-0.5 * x)) - ChiParams-&gt;<a class="code" href="struct_c_h_i_s_t_r_u_c_t.html#a58a4707e32861b244d471e6d152fe43a">Alpha</a>);
<a name="l02559"></a>02559 
<a name="l02560"></a>02560 }                                <span class="comment">// ChiArea</span>
<a name="l02561"></a>02561 
<a name="l02562"></a>02562 
<a name="l02563"></a>02563 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l02564"></a>02564 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a>
<a name="l02565"></a><a class="code" href="cluster_8cpp.html#a39583ff2f6db38f0c2e26f7ad87f2c0c">02565</a> <a class="code" href="cluster_8cpp.html#a39583ff2f6db38f0c2e26f7ad87f2c0c">MultipleCharSamples</a> (<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> * Clusterer,
<a name="l02566"></a>02566 <a class="code" href="structsample.html">CLUSTER</a> * Cluster, <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> MaxIllegal)
<a name="l02567"></a>02567 <span class="comment">/*</span>
<a name="l02568"></a>02568 <span class="comment"> **     Parameters:</span>
<a name="l02569"></a>02569 <span class="comment"> **             Clusterer       data structure holding cluster tree</span>
<a name="l02570"></a>02570 <span class="comment"> **             Cluster         cluster containing samples to be tested</span>
<a name="l02571"></a>02571 <span class="comment"> **             MaxIllegal      max percentage of samples allowed to have</span>
<a name="l02572"></a>02572 <span class="comment"> **                             more than 1 feature in the cluster</span>
<a name="l02573"></a>02573 <span class="comment"> **     Operation:</span>
<a name="l02574"></a>02574 <span class="comment"> **             This routine looks at all samples in the specified cluster.</span>
<a name="l02575"></a>02575 <span class="comment"> **             It computes a running estimate of the percentage of the</span>
<a name="l02576"></a>02576 <span class="comment"> **             charaters which have more than 1 sample in the cluster.</span>
<a name="l02577"></a>02577 <span class="comment"> **             When this percentage exceeds MaxIllegal, TRUE is returned.</span>
<a name="l02578"></a>02578 <span class="comment"> **             Otherwise FALSE is returned.  The CharID</span>
<a name="l02579"></a>02579 <span class="comment"> **             fields must contain integers which identify the training</span>
<a name="l02580"></a>02580 <span class="comment"> **             characters which were used to generate the sample.  One</span>
<a name="l02581"></a>02581 <span class="comment"> **             integer is used for each sample.  The NumChar field in</span>
<a name="l02582"></a>02582 <span class="comment"> **             the Clusterer must contain the number of characters in the</span>
<a name="l02583"></a>02583 <span class="comment"> **             training set.  All CharID fields must be between 0 and</span>
<a name="l02584"></a>02584 <span class="comment"> **             NumChar-1.  The main function of this routine is to help</span>
<a name="l02585"></a>02585 <span class="comment"> **             identify clusters which need to be split further, i.e. if</span>
<a name="l02586"></a>02586 <span class="comment"> **             numerous training characters have 2 or more features which are</span>
<a name="l02587"></a>02587 <span class="comment"> **             contained in the same cluster, then the cluster should be</span>
<a name="l02588"></a>02588 <span class="comment"> **             split.</span>
<a name="l02589"></a>02589 <span class="comment"> **     Return: TRUE if the cluster should be split, FALSE otherwise.</span>
<a name="l02590"></a>02590 <span class="comment"> **     Exceptions: none</span>
<a name="l02591"></a>02591 <span class="comment"> **     History: Wed Aug 30 11:13:05 1989, DSJ, Created.</span>
<a name="l02592"></a>02592 <span class="comment"> **             2/22/90, DSJ, Added MaxIllegal control rather than always</span>
<a name="l02593"></a>02593 <span class="comment"> **                             splitting illegal clusters.</span>
<a name="l02594"></a>02594 <span class="comment"> */</span>
<a name="l02595"></a>02595 <span class="preprocessor">#define ILLEGAL_CHAR    2</span>
<a name="l02596"></a>02596 <span class="preprocessor"></span>{
<a name="l02597"></a>02597   <span class="keyword">static</span> <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> *CharFlags = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02598"></a>02598   <span class="keyword">static</span> <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> NumFlags = 0;
<a name="l02599"></a>02599   <span class="keywordtype">int</span> i;
<a name="l02600"></a>02600   <a class="code" href="structlist__rec.html">LIST</a> SearchState;
<a name="l02601"></a>02601   <a class="code" href="structsample.html">SAMPLE</a> *Sample;
<a name="l02602"></a>02602   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> CharID;
<a name="l02603"></a>02603   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> NumCharInCluster;
<a name="l02604"></a>02604   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> NumIllegalInCluster;
<a name="l02605"></a>02605   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> PercentIllegal;
<a name="l02606"></a>02606 
<a name="l02607"></a>02607   <span class="comment">// initial estimate assumes that no illegal chars exist in the cluster</span>
<a name="l02608"></a>02608   NumCharInCluster = Cluster-&gt;<a class="code" href="structsample.html#a71cac0608666e1abfdfb3ab40e26b249">SampleCount</a>;
<a name="l02609"></a>02609   NumIllegalInCluster = 0;
<a name="l02610"></a>02610 
<a name="l02611"></a>02611   <span class="keywordflow">if</span> (Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a> &gt; NumFlags) {
<a name="l02612"></a>02612     <span class="keywordflow">if</span> (CharFlags != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02613"></a>02613       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(CharFlags);
<a name="l02614"></a>02614     NumFlags = Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a>;
<a name="l02615"></a>02615     CharFlags = (<a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (NumFlags * <span class="keyword">sizeof</span> (<a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a>));
<a name="l02616"></a>02616   }
<a name="l02617"></a>02617 
<a name="l02618"></a>02618   <span class="keywordflow">for</span> (i = 0; i &lt; NumFlags; i++)
<a name="l02619"></a>02619     CharFlags[i] = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02620"></a>02620 
<a name="l02621"></a>02621   <span class="comment">// find each sample in the cluster and check if we have seen it before</span>
<a name="l02622"></a>02622   <a class="code" href="cluster_8h.html#af125589eadf8dca87cf904ebcb77c896">InitSampleSearch</a>(SearchState, Cluster);
<a name="l02623"></a>02623   <span class="keywordflow">while</span> ((Sample = <a class="code" href="cluster_8cpp.html#abf5d9e3b151ac51b27bd9dc797ac261c">NextSample</a> (&amp;SearchState)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02624"></a>02624     CharID = Sample-&gt;<a class="code" href="structsample.html#a564df9059b85a37e9f4e69843eec3e20">CharID</a>;
<a name="l02625"></a>02625     <span class="keywordflow">if</span> (CharFlags[CharID] == <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l02626"></a>02626       CharFlags[CharID] = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02627"></a>02627     }
<a name="l02628"></a>02628     <span class="keywordflow">else</span> {
<a name="l02629"></a>02629       <span class="keywordflow">if</span> (CharFlags[CharID] == <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l02630"></a>02630         NumIllegalInCluster++;
<a name="l02631"></a>02631         CharFlags[CharID] = <a class="code" href="cluster_8cpp.html#a9d9bc16d6dee64280de6063de97939c1">ILLEGAL_CHAR</a>;
<a name="l02632"></a>02632       }
<a name="l02633"></a>02633       NumCharInCluster--;
<a name="l02634"></a>02634       PercentIllegal = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>) NumIllegalInCluster / NumCharInCluster;
<a name="l02635"></a>02635       <span class="keywordflow">if</span> (PercentIllegal &gt; MaxIllegal) {
<a name="l02636"></a>02636         <a class="code" href="oldlist_8cpp.html#a338e68bdadcbdf51db4c7268c4529409">destroy</a>(SearchState);
<a name="l02637"></a>02637         <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02638"></a>02638       }
<a name="l02639"></a>02639     }
<a name="l02640"></a>02640   }
<a name="l02641"></a>02641   <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02642"></a>02642 
<a name="l02643"></a>02643 }                                <span class="comment">// MultipleCharSamples</span>
<a name="l02644"></a>02644 
<a name="l02645"></a>02645 <span class="comment">// Compute the inverse of a matrix using LU decomposition with partial pivoting.</span>
<a name="l02646"></a>02646 <span class="comment">// The return value is the sum of norms of the off-diagonal terms of the</span>
<a name="l02647"></a>02647 <span class="comment">// product of a and inv. (A measure of the error.)</span>
<a name="l02648"></a><a class="code" href="cluster_8cpp.html#a40c47f6785ad5d50a9b113761e16ab9d">02648</a> <span class="keywordtype">double</span> <a class="code" href="cluster_8cpp.html#a40c47f6785ad5d50a9b113761e16ab9d">InvertMatrix</a>(<span class="keyword">const</span> <span class="keywordtype">float</span>* input, <span class="keywordtype">int</span> size, <span class="keywordtype">float</span>* inv) {
<a name="l02649"></a>02649   <span class="comment">// Allocate memory for the 2D arrays.</span>
<a name="l02650"></a>02650   <a class="code" href="class_g_e_n_e_r_i_c__2_d___a_r_r_a_y.html">GENERIC_2D_ARRAY&lt;double&gt;</a> U(size, size, 0.0);
<a name="l02651"></a>02651   <a class="code" href="class_g_e_n_e_r_i_c__2_d___a_r_r_a_y.html">GENERIC_2D_ARRAY&lt;double&gt;</a> U_inv(size, size, 0.0);
<a name="l02652"></a>02652   <a class="code" href="class_g_e_n_e_r_i_c__2_d___a_r_r_a_y.html">GENERIC_2D_ARRAY&lt;double&gt;</a> L(size, size, 0.0);
<a name="l02653"></a>02653 
<a name="l02654"></a>02654   <span class="comment">// Initialize the working matrices. U starts as input, L as I and U_inv as O.</span>
<a name="l02655"></a>02655   <span class="keywordtype">int</span> row;
<a name="l02656"></a>02656   <span class="keywordtype">int</span> col;
<a name="l02657"></a>02657   <span class="keywordflow">for</span> (row = 0; row &lt; size; row++) {
<a name="l02658"></a>02658     <span class="keywordflow">for</span> (col = 0; col &lt; size; col++) {
<a name="l02659"></a>02659       U[row][col] = input[row*size + col];
<a name="l02660"></a>02660       L[row][col] = row == col ? 1.0 : 0.0;
<a name="l02661"></a>02661       U_inv[row][col] = 0.0;
<a name="l02662"></a>02662     }
<a name="l02663"></a>02663   }
<a name="l02664"></a>02664 
<a name="l02665"></a>02665   <span class="comment">// Compute forward matrix by inversion by LU decomposition of input.</span>
<a name="l02666"></a>02666   <span class="keywordflow">for</span> (col = 0; col &lt; size; ++col) {
<a name="l02667"></a>02667     <span class="comment">// Find best pivot</span>
<a name="l02668"></a>02668     <span class="keywordtype">int</span> best_row = 0;
<a name="l02669"></a>02669     <span class="keywordtype">double</span> best_pivot = -1.0;
<a name="l02670"></a>02670     <span class="keywordflow">for</span> (row = col; row &lt; size; ++row) {
<a name="l02671"></a>02671       <span class="keywordflow">if</span> (<a class="code" href="cluster_8cpp.html#a060002a5aeab470cb24c8343daa1db08">Abs</a>(U[row][col]) &gt; best_pivot) {
<a name="l02672"></a>02672         best_pivot = <a class="code" href="cluster_8cpp.html#a060002a5aeab470cb24c8343daa1db08">Abs</a>(U[row][col]);
<a name="l02673"></a>02673         best_row = row;
<a name="l02674"></a>02674       }
<a name="l02675"></a>02675     }
<a name="l02676"></a>02676     <span class="comment">// Exchange pivot rows.</span>
<a name="l02677"></a>02677     <span class="keywordflow">if</span> (best_row != col) {
<a name="l02678"></a>02678       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; size; ++k) {
<a name="l02679"></a>02679         <span class="keywordtype">double</span> tmp = U[best_row][k];
<a name="l02680"></a>02680         U[best_row][k] = U[col][k];
<a name="l02681"></a>02681         U[col][k] = tmp;
<a name="l02682"></a>02682         tmp = L[best_row][k];
<a name="l02683"></a>02683         L[best_row][k] = L[col][k];
<a name="l02684"></a>02684         L[col][k] = tmp;
<a name="l02685"></a>02685       }
<a name="l02686"></a>02686     }
<a name="l02687"></a>02687     <span class="comment">// Now do the pivot itself.</span>
<a name="l02688"></a>02688     <span class="keywordflow">for</span> (row = col + 1; row &lt; size; ++row) {
<a name="l02689"></a>02689       <span class="keywordtype">double</span> ratio = -U[row][col] / U[col][col];
<a name="l02690"></a>02690       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = col; j &lt; size; ++j) {
<a name="l02691"></a>02691         U[row][j] += U[col][j] * ratio;
<a name="l02692"></a>02692       }
<a name="l02693"></a>02693       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; size; ++k) {
<a name="l02694"></a>02694         L[row][k] += L[col][k] * ratio;
<a name="l02695"></a>02695       }
<a name="l02696"></a>02696     }
<a name="l02697"></a>02697   }
<a name="l02698"></a>02698   <span class="comment">// Next invert U.</span>
<a name="l02699"></a>02699   <span class="keywordflow">for</span> (col = 0; col &lt; size; ++col) {
<a name="l02700"></a>02700     U_inv[col][col] = 1.0 / U[col][col];
<a name="l02701"></a>02701     <span class="keywordflow">for</span> (row = col - 1; row &gt;= 0; --row) {
<a name="l02702"></a>02702       <span class="keywordtype">double</span> total = 0.0;
<a name="l02703"></a>02703       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = col; k &gt; row; --k) {
<a name="l02704"></a>02704         total += U[row][k] * U_inv[k][col];
<a name="l02705"></a>02705       }
<a name="l02706"></a>02706       U_inv[row][col] = -total / U[row][row];
<a name="l02707"></a>02707     }
<a name="l02708"></a>02708   }
<a name="l02709"></a>02709   <span class="comment">// Now the answer is U_inv.L.</span>
<a name="l02710"></a>02710   <span class="keywordflow">for</span> (row = 0; row &lt; size; row++) {
<a name="l02711"></a>02711     <span class="keywordflow">for</span> (col = 0; col &lt; size; col++) {
<a name="l02712"></a>02712       <span class="keywordtype">double</span> sum = 0.0;
<a name="l02713"></a>02713       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = row; k &lt; size; ++k) {
<a name="l02714"></a>02714         sum += U_inv[row][k] * L[k][col];
<a name="l02715"></a>02715       }
<a name="l02716"></a>02716       inv[row*size + col] = sum;
<a name="l02717"></a>02717     }
<a name="l02718"></a>02718   }
<a name="l02719"></a>02719   <span class="comment">// Check matrix product.</span>
<a name="l02720"></a>02720   <span class="keywordtype">double</span> error_sum = 0.0;
<a name="l02721"></a>02721   <span class="keywordflow">for</span> (row = 0; row &lt; size; row++) {
<a name="l02722"></a>02722     <span class="keywordflow">for</span> (col = 0; col &lt; size; col++) {
<a name="l02723"></a>02723       <span class="keywordtype">double</span> sum = 0.0;
<a name="l02724"></a>02724       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; size; ++k) {
<a name="l02725"></a>02725         sum += input[row*size + k] * inv[k *size + col];
<a name="l02726"></a>02726       }
<a name="l02727"></a>02727       <span class="keywordflow">if</span> (row != col) {
<a name="l02728"></a>02728         error_sum += <a class="code" href="cluster_8cpp.html#a060002a5aeab470cb24c8343daa1db08">Abs</a>(sum);
<a name="l02729"></a>02729       }
<a name="l02730"></a>02730     }
<a name="l02731"></a>02731   }
<a name="l02732"></a>02732   <span class="keywordflow">return</span> error_sum;
<a name="l02733"></a>02733 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="cluster_8cpp.html">cluster.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Fri Mar 30 2012 17:39:10 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
