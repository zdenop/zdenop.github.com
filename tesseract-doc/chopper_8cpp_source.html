<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/wordrec/chopper.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('chopper_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/wordrec/chopper.cpp</div>  </div>
</div>
<div class="contents">
<a href="chopper_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*-C-*-</span>
<a name="l00002"></a>00002 <span class="comment"> ********************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * File:        chopper.c  (Formerly chopper.c)</span>
<a name="l00005"></a>00005 <span class="comment"> * Description:</span>
<a name="l00006"></a>00006 <span class="comment"> * Author:       Mark Seaman, OCR Technology</span>
<a name="l00007"></a>00007 <span class="comment"> * Created:      Fri Oct 16 14:37:00 1987</span>
<a name="l00008"></a>00008 <span class="comment"> * Modified:     Tue Jul 30 16:18:52 1991 (Mark Seaman) marks@hpgrlt</span>
<a name="l00009"></a>00009 <span class="comment"> * Language:     C</span>
<a name="l00010"></a>00010 <span class="comment"> * Package:      N/A</span>
<a name="l00011"></a>00011 <span class="comment"> * Status:       Reusable Software Component</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * (c) Copyright 1987, Hewlett-Packard Company.</span>
<a name="l00014"></a>00014 <span class="comment"> ** Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00015"></a>00015 <span class="comment"> ** you may not use this file except in compliance with the License.</span>
<a name="l00016"></a>00016 <span class="comment"> ** You may obtain a copy of the License at</span>
<a name="l00017"></a>00017 <span class="comment"> ** http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00018"></a>00018 <span class="comment"> ** Unless required by applicable law or agreed to in writing, software</span>
<a name="l00019"></a>00019 <span class="comment"> ** distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00020"></a>00020 <span class="comment"> ** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00021"></a>00021 <span class="comment"> ** See the License for the specific language governing permissions and</span>
<a name="l00022"></a>00022 <span class="comment"> ** limitations under the License.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> **************************************************************************/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">/*----------------------------------------------------------------------</span>
<a name="l00027"></a>00027 <span class="comment">          I n c l u d e s</span>
<a name="l00028"></a>00028 <span class="comment">----------------------------------------------------------------------*/</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="chopper_8h.html">chopper.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;assert.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="associate_8h.html">associate.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="callcpp_8h.html">callcpp.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="const_8h.html">const.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="findseam_8h.html">findseam.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="freelist_8h.html">freelist.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="makechop_8h.html">makechop.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="render_8h.html">render.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="pageres_8h.html">pageres.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="permute_8h.html">permute.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="seam_8h.html">seam.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="stopper_8h.html">stopper.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="structures_8h.html">structures.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="unicharset_8h.html">unicharset.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="wordclass_8h.html">wordclass.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="wordrec_8h.html">wordrec.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// Include automatically generated configuration file if running autoconf.</span>
<a name="l00053"></a>00053 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="config__auto_8h.html">config_auto.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 <span class="comment">/*----------------------------------------------------------------------</span>
<a name="l00058"></a>00058 <span class="comment">          F u n c t i o n s</span>
<a name="l00059"></a>00059 <span class="comment">----------------------------------------------------------------------*/</span>
<a name="l00065"></a><a class="code" href="chopper_8h.html#a0a3b9f61e193c679c40344dad4267e3d">00065</a> <span class="keywordtype">void</span> <a class="code" href="chopper_8cpp.html#a0a3b9f61e193c679c40344dad4267e3d">preserve_outline</a>(<a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *start) {
<a name="l00066"></a>00066   <a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *srcpt;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="keywordflow">if</span> (start == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00069"></a>00069     <span class="keywordflow">return</span>;
<a name="l00070"></a>00070   srcpt = start;
<a name="l00071"></a>00071   <span class="keywordflow">do</span> {
<a name="l00072"></a>00072     srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a7f92d543e033519df214c028e8737991">flags</a>[1] = 1;
<a name="l00073"></a>00073     srcpt = srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a196f7786194752f89e364a586d24884d">next</a>;
<a name="l00074"></a>00074   }
<a name="l00075"></a>00075   <span class="keywordflow">while</span> (srcpt != start);
<a name="l00076"></a>00076   srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a7f92d543e033519df214c028e8737991">flags</a>[1] = 2;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">/**************************************************************************/</span>
<a name="l00081"></a><a class="code" href="chopper_8h.html#af2a51913c75408354ffd6e5344c30389">00081</a> <span class="keywordtype">void</span> <a class="code" href="chopper_8cpp.html#af2a51913c75408354ffd6e5344c30389">preserve_outline_tree</a>(<a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *srcline) {
<a name="l00082"></a>00082   <a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *outline;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keywordflow">for</span> (outline = srcline; outline != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; outline = outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0fb224d43ea53a791f0957fa92793bef">next</a>) {
<a name="l00085"></a>00085     <a class="code" href="chopper_8cpp.html#a0a3b9f61e193c679c40344dad4267e3d">preserve_outline</a> (outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0ab1e26b1dae548f0bd3c096c6183b18">loop</a>);
<a name="l00086"></a>00086   }
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00095"></a><a class="code" href="chopper_8h.html#aca09efda43c5297643be6ba8706ceb83">00095</a> <a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *<a class="code" href="chopper_8cpp.html#aca09efda43c5297643be6ba8706ceb83">restore_outline</a>(<a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *start) {
<a name="l00096"></a>00096   <a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *srcpt;
<a name="l00097"></a>00097   <a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *real_start;
<a name="l00098"></a>00098   <a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *deadpt;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   <span class="keywordflow">if</span> (start == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00101"></a>00101     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00102"></a>00102   srcpt = start;
<a name="l00103"></a>00103   <span class="keywordflow">do</span> {
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a7f92d543e033519df214c028e8737991">flags</a>[1] == 2)
<a name="l00105"></a>00105       <span class="keywordflow">break</span>;
<a name="l00106"></a>00106     srcpt = srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a196f7786194752f89e364a586d24884d">next</a>;
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108   <span class="keywordflow">while</span> (srcpt != start);
<a name="l00109"></a>00109   real_start = srcpt;
<a name="l00110"></a>00110   <span class="keywordflow">do</span> {
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a7f92d543e033519df214c028e8737991">flags</a>[1] == 0) {
<a name="l00112"></a>00112       deadpt = srcpt;
<a name="l00113"></a>00113       srcpt = srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a196f7786194752f89e364a586d24884d">next</a>;
<a name="l00114"></a>00114       srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a> = deadpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a>;
<a name="l00115"></a>00115       deadpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a>-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a196f7786194752f89e364a586d24884d">next</a> = srcpt;
<a name="l00116"></a>00116       deadpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a>-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a6da204ff253a65e00daae7753b82c9f7">vec</a>.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a> = srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#adee462d390e637a8393ba373c8d2a1bb">pos</a>.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a> - deadpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a>-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#adee462d390e637a8393ba373c8d2a1bb">pos</a>.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a>;
<a name="l00117"></a>00117       deadpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a>-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a6da204ff253a65e00daae7753b82c9f7">vec</a>.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a> = srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#adee462d390e637a8393ba373c8d2a1bb">pos</a>.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a> - deadpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a8326da8daf597bcdc5a05064a37cbbb1">prev</a>-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#adee462d390e637a8393ba373c8d2a1bb">pos</a>.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a>;
<a name="l00118"></a>00118       <span class="keyword">delete</span> deadpt;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="keywordflow">else</span>
<a name="l00121"></a>00121       srcpt = srcpt-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a196f7786194752f89e364a586d24884d">next</a>;
<a name="l00122"></a>00122   }
<a name="l00123"></a>00123   <span class="keywordflow">while</span> (srcpt != real_start);
<a name="l00124"></a>00124   <span class="keywordflow">return</span> real_start;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="comment">/******************************************************************************/</span>
<a name="l00129"></a><a class="code" href="chopper_8h.html#a426bc9c96107b36d173f86d8a74f9e8c">00129</a> <span class="keywordtype">void</span> <a class="code" href="chopper_8cpp.html#a426bc9c96107b36d173f86d8a74f9e8c">restore_outline_tree</a>(<a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *srcline) {
<a name="l00130"></a>00130   <a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *outline;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="keywordflow">for</span> (outline = srcline; outline != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; outline = outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0fb224d43ea53a791f0957fa92793bef">next</a>) {
<a name="l00133"></a>00133     outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0ab1e26b1dae548f0bd3c096c6183b18">loop</a> = <a class="code" href="chopper_8cpp.html#aca09efda43c5297643be6ba8706ceb83">restore_outline</a> (outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0ab1e26b1dae548f0bd3c096c6183b18">loop</a>);
<a name="l00134"></a>00134     outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a6eddfefc04de79fe19712d90925de2fb">start</a> = outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0ab1e26b1dae548f0bd3c096c6183b18">loop</a>-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#adee462d390e637a8393ba373c8d2a1bb">pos</a>;
<a name="l00135"></a>00135   }
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00145"></a>00145 <span class="keyword">namespace </span>tesseract {
<a name="l00146"></a><a class="code" href="classtesseract_1_1_wordrec.html#a488dbf71180ee93aec63ad825be08444">00146</a> <a class="code" href="structseam__record.html">SEAM</a> *<a class="code" href="classtesseract_1_1_wordrec.html#a488dbf71180ee93aec63ad825be08444">Wordrec::attempt_blob_chop</a>(<a class="code" href="struct_t_w_e_r_d.html">TWERD</a> *word, <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob, <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> blob_number,
<a name="l00147"></a>00147                                  <span class="keywordtype">bool</span> italic_blob, <a class="code" href="structarray__record.html">SEAMS</a> seam_list) {
<a name="l00148"></a>00148   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *next_blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00149"></a>00149   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *other_blob;
<a name="l00150"></a>00150   <a class="code" href="structseam__record.html">SEAM</a> *seam;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a34abe5c1b41feff68500d1b83a1f891d">repair_unchopped_blobs</a>)
<a name="l00153"></a>00153     <a class="code" href="chopper_8cpp.html#af2a51913c75408354ffd6e5344c30389">preserve_outline_tree</a> (blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a>);
<a name="l00154"></a>00154   other_blob = <span class="keyword">new</span> <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>;       <span class="comment">/* Make new blob */</span>
<a name="l00155"></a>00155   other_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a> = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00156"></a>00156   other_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00157"></a>00157   blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a> = other_blob;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   seam = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00160"></a>00160   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a22717c4d299d3a52683ad90114b20200">prioritize_division</a>) {
<a name="l00161"></a>00161     <a class="code" href="struct_t_p_o_i_n_t.html">TPOINT</a> location;
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (<a class="code" href="blobs_8cpp.html#aa87284f5696fb5dd745dafa85539d760">divisible_blob</a>(blob, italic_blob, &amp;location)) {
<a name="l00163"></a>00163       seam = <a class="code" href="seam_8cpp.html#ad7bc7a3af5617ff4762369a6aa879ed3">new_seam</a>(0.0<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>, location, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165   }
<a name="l00166"></a>00166   <span class="keywordflow">if</span> (seam == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00167"></a>00167     seam = <a class="code" href="classtesseract_1_1_wordrec.html#adeb84d8b94a6c87354fc452461de3b39">pick_good_seam</a>(blob);
<a name="l00168"></a>00168   <span class="keywordflow">if</span> (seam == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; word-&gt;<a class="code" href="struct_t_w_e_r_d.html#a408678da3281eb77874487aceb44b95c">latin_script</a>) {
<a name="l00169"></a>00169     <span class="comment">// If the blob can simply be divided into outlines, then do that.</span>
<a name="l00170"></a>00170     <a class="code" href="struct_t_p_o_i_n_t.html">TPOINT</a> location;
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (<a class="code" href="blobs_8cpp.html#aa87284f5696fb5dd745dafa85539d760">divisible_blob</a>(blob, italic_blob, &amp;location)) {
<a name="l00172"></a>00172       seam = <a class="code" href="seam_8cpp.html#ad7bc7a3af5617ff4762369a6aa879ed3">new_seam</a>(0.0<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>, location, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>) {
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (seam != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00177"></a>00177       <a class="code" href="seam_8cpp.html#a2168b2b29d8981405d068256c2b61e3b">print_seam</a> (<span class="stringliteral">&quot;Good seam picked=&quot;</span>, seam);
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     <span class="keywordflow">else</span>
<a name="l00180"></a>00180       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;\n** no seam picked *** \n&quot;</span>);
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182   <span class="keywordflow">if</span> (seam) {
<a name="l00183"></a>00183     <a class="code" href="makechop_8cpp.html#a0ead1c1a4df9b2c0861e9da84f4c3079">apply_seam</a>(blob, other_blob, italic_blob, seam);
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="keywordflow">if</span> ((seam == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00187"></a>00187     (blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00188"></a>00188     (other_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00189"></a>00189     <a class="code" href="chopper_8cpp.html#a8e8e9f6cb587b621054e6ff626a46a23">total_containment</a> (blob, other_blob) ||
<a name="l00190"></a>00190     <a class="code" href="chopper_8cpp.html#adde6889c67dfb8661a9911b56bc05c96">check_blob</a> (other_blob) ||
<a name="l00191"></a>00191     !(<a class="code" href="chopper_8cpp.html#a5b0b5e54a6dabe1f874383318ad2b172">check_seam_order</a> (blob, seam) &amp;&amp;
<a name="l00192"></a>00192     <a class="code" href="chopper_8cpp.html#a5b0b5e54a6dabe1f874383318ad2b172">check_seam_order</a> (other_blob, seam)) ||
<a name="l00193"></a>00193     <a class="code" href="chopper_8cpp.html#a0f48320009f85ee2503203c12f7f18f3">any_shared_split_points</a> (seam_list, seam) ||
<a name="l00194"></a>00194     !<a class="code" href="seam_8cpp.html#ad5c40a87abe7dd3af10a13614f321be4">test_insert_seam</a>(seam_list, blob_number, blob, word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>)) {
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a> = next_blob;
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (seam) {
<a name="l00198"></a>00198       <a class="code" href="makechop_8cpp.html#aa6a78540c9d1b2be89f28016c2aa408f">undo_seam</a>(blob, other_blob, seam);
<a name="l00199"></a>00199       <a class="code" href="seam_8cpp.html#abe1c472bf676a613f555cee9d29f7c3d">delete_seam</a>(seam);
<a name="l00200"></a>00200 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>) {
<a name="l00202"></a>00202         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a> &gt;2)
<a name="l00203"></a>00203           <a class="code" href="render_8cpp.html#a2b56bf58c648ddd5efa02b1be0438659">display_blob</a>(blob, <a class="code" href="callcpp_8h.html#a17bc059e437838f094a5a25c2d5ab88fad3163c1fcda01965b692ec2c3122b743">Red</a>);
<a name="l00204"></a>00204         <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;\n** seam being removed ** \n&quot;</span>);
<a name="l00205"></a>00205       }
<a name="l00206"></a>00206 <span class="preprocessor">#endif</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
<a name="l00208"></a>00208       <span class="keyword">delete</span> other_blob;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a34abe5c1b41feff68500d1b83a1f891d">repair_unchopped_blobs</a>)
<a name="l00212"></a>00212       <a class="code" href="chopper_8cpp.html#a426bc9c96107b36d173f86d8a74f9e8c">restore_outline_tree</a> (blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a>);
<a name="l00213"></a>00213     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215   <span class="keywordflow">return</span> (seam);
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="classtesseract_1_1_wordrec.html#ab39c4eff1c3255a37a38f5f32956e6c2">00219</a> <a class="code" href="structseam__record.html">SEAM</a> *<a class="code" href="classtesseract_1_1_wordrec.html#ab39c4eff1c3255a37a38f5f32956e6c2">Wordrec::chop_numbered_blob</a>(<a class="code" href="struct_t_w_e_r_d.html">TWERD</a> *word, <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> blob_number,
<a name="l00220"></a>00220                                   <span class="keywordtype">bool</span> italic_blob, <a class="code" href="structarray__record.html">SEAMS</a> seam_list) {
<a name="l00221"></a>00221   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob;
<a name="l00222"></a>00222   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> x;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   blob = word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00225"></a>00225   <span class="keywordflow">for</span> (x = 0; x &lt; blob_number; x++)
<a name="l00226"></a>00226     blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <span class="keywordflow">return</span> <a class="code" href="classtesseract_1_1_wordrec.html#a488dbf71180ee93aec63ad825be08444">attempt_blob_chop</a>(word, blob, blob_number,
<a name="l00229"></a>00229                            italic_blob, seam_list);
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="classtesseract_1_1_wordrec.html#a60f3ee36bfbef64013dd7b199248cf0e">00233</a> <a class="code" href="structseam__record.html">SEAM</a> *<a class="code" href="classtesseract_1_1_wordrec.html#a60f3ee36bfbef64013dd7b199248cf0e">Wordrec::chop_overlapping_blob</a>(<span class="keyword">const</span> <a class="code" href="class_generic_vector.html">GenericVector&lt;TBOX&gt;</a>&amp; boxes,
<a name="l00234"></a>00234                                      <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word_res, <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> *blob_number,
<a name="l00235"></a>00235                                      <span class="keywordtype">bool</span> italic_blob, <a class="code" href="structarray__record.html">SEAMS</a> seam_list) {
<a name="l00236"></a>00236   <a class="code" href="struct_t_w_e_r_d.html">TWERD</a> *word = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>;
<a name="l00237"></a>00237   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   *blob_number = 0;
<a name="l00240"></a>00240   blob = word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00241"></a>00241   <span class="keywordflow">while</span> (blob != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00242"></a>00242     <a class="code" href="struct_t_p_o_i_n_t.html">TPOINT</a> topleft, botright;
<a name="l00243"></a>00243     topleft.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a> = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>();
<a name="l00244"></a>00244     topleft.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a> = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l00245"></a>00245     botright.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a> = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l00246"></a>00246     botright.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a> = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <a class="code" href="struct_t_p_o_i_n_t.html">TPOINT</a> original_topleft, original_botright;
<a name="l00249"></a>00249     word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>.<a class="code" href="class_d_e_n_o_r_m.html#a7f208ca46e4fc576432c16bf16a504f0">DenormTransform</a>(topleft, &amp;original_topleft);
<a name="l00250"></a>00250     word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>.<a class="code" href="class_d_e_n_o_r_m.html#a7f208ca46e4fc576432c16bf16a504f0">DenormTransform</a>(botright, &amp;original_botright);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <a class="code" href="class_t_b_o_x.html">TBOX</a> original_box = <a class="code" href="class_t_b_o_x.html">TBOX</a>(original_topleft.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a>, original_botright.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a>,
<a name="l00253"></a>00253                              original_botright.<a class="code" href="struct_t_p_o_i_n_t.html#aa9c98655c3a2a0437821e5a3d3418b0f">x</a>, original_topleft.<a class="code" href="struct_t_p_o_i_n_t.html#a6d62f015b74612e43975e439a096039c">y</a>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keywordtype">bool</span> almost_equal_box = <span class="keyword">false</span>;
<a name="l00256"></a>00256     <span class="keywordtype">int</span> num_overlap = 0;
<a name="l00257"></a>00257     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; boxes.<a class="code" href="class_generic_vector.html#a111b51dd0bf1324cfb69ef70703d8e70">size</a>(); i++) {
<a name="l00258"></a>00258       <span class="keywordflow">if</span> (original_box.<a class="code" href="class_t_b_o_x.html#a9e8d88530048135be86afb906ff9dd74">overlap_fraction</a>(boxes[i]) &gt; 0.125)
<a name="l00259"></a>00259         num_overlap++;
<a name="l00260"></a>00260       <span class="keywordflow">if</span> (original_box.<a class="code" href="class_t_b_o_x.html#a0f7a028a3ad0355f38e17db45c737384">almost_equal</a>(boxes[i], 3))
<a name="l00261"></a>00261         almost_equal_box = <span class="keyword">true</span>;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <a class="code" href="struct_t_p_o_i_n_t.html">TPOINT</a> location;
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (<a class="code" href="blobs_8cpp.html#aa87284f5696fb5dd745dafa85539d760">divisible_blob</a>(blob, italic_blob, &amp;location) ||
<a name="l00266"></a>00266         (!almost_equal_box &amp;&amp; num_overlap &gt; 1)) {
<a name="l00267"></a>00267       <a class="code" href="structseam__record.html">SEAM</a> *seam = <a class="code" href="classtesseract_1_1_wordrec.html#a488dbf71180ee93aec63ad825be08444">attempt_blob_chop</a>(word, blob, *blob_number,
<a name="l00268"></a>00268                                      italic_blob, seam_list);
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (seam != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00270"></a>00270         <span class="keywordflow">return</span> seam;
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     *blob_number = *blob_number + 1;
<a name="l00274"></a>00274     blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00275"></a>00275   }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   *blob_number = -1;
<a name="l00278"></a>00278   <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 }  <span class="comment">// namespace tesseract</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00289"></a><a class="code" href="chopper_8h.html#a0f48320009f85ee2503203c12f7f18f3">00289</a> <span class="keywordtype">int</span> <a class="code" href="chopper_8cpp.html#a0f48320009f85ee2503203c12f7f18f3">any_shared_split_points</a>(<a class="code" href="structarray__record.html">SEAMS</a> seam_list, <a class="code" href="structseam__record.html">SEAM</a> *seam) {
<a name="l00290"></a>00290   <span class="keywordtype">int</span> length;
<a name="l00291"></a>00291   <span class="keywordtype">int</span> index;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   length = <a class="code" href="tessarray_8h.html#a89ee8010120771c8612dc7058b327f84">array_count</a> (seam_list);
<a name="l00294"></a>00294   <span class="keywordflow">for</span> (index = 0; index &lt; length; index++)
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (<a class="code" href="seam_8cpp.html#a1fcf833e097b1c5963a9374433f56497">shared_split_points</a> ((<a class="code" href="structseam__record.html">SEAM</a> *) <a class="code" href="tessarray_8h.html#a290cd2ea119e279ad48b57fbe5ca1aad">array_value</a> (seam_list, index), seam))
<a name="l00296"></a>00296       <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00297"></a>00297   <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00306"></a><a class="code" href="chopper_8h.html#adde6889c67dfb8661a9911b56bc05c96">00306</a> <span class="keywordtype">int</span> <a class="code" href="chopper_8cpp.html#adde6889c67dfb8661a9911b56bc05c96">check_blob</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob) {
<a name="l00307"></a>00307   <a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *outline;
<a name="l00308"></a>00308   <a class="code" href="struct_e_d_g_e_p_t.html">EDGEPT</a> *edgept;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="keywordflow">for</span> (outline = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a>; outline != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; outline = outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0fb224d43ea53a791f0957fa92793bef">next</a>) {
<a name="l00311"></a>00311     edgept = outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0ab1e26b1dae548f0bd3c096c6183b18">loop</a>;
<a name="l00312"></a>00312     <span class="keywordflow">do</span> {
<a name="l00313"></a>00313       <span class="keywordflow">if</span> (edgept == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00314"></a>00314         <span class="keywordflow">break</span>;
<a name="l00315"></a>00315       edgept = edgept-&gt;<a class="code" href="struct_e_d_g_e_p_t.html#a196f7786194752f89e364a586d24884d">next</a>;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317     <span class="keywordflow">while</span> (edgept != outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0ab1e26b1dae548f0bd3c096c6183b18">loop</a>);
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (edgept == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00319"></a>00319       <span class="keywordflow">return</span> 1;
<a name="l00320"></a>00320   }
<a name="l00321"></a>00321   <span class="keywordflow">return</span> 0;
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="keyword">namespace </span>tesseract {
<a name="l00332"></a><a class="code" href="classtesseract_1_1_wordrec.html#acdc368cd46083bdc4c321dd0a42533a0">00332</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_wordrec.html#acdc368cd46083bdc4c321dd0a42533a0">Wordrec::improve_one_blob</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word_res,
<a name="l00333"></a>00333                                <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *char_choices,
<a name="l00334"></a>00334                                <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> *blob_number,
<a name="l00335"></a>00335                                <a class="code" href="structarray__record.html">SEAMS</a> *seam_list,
<a name="l00336"></a>00336                                <a class="code" href="class_generic_vector.html">DANGERR</a> *fixpt,
<a name="l00337"></a>00337                                <span class="keywordtype">bool</span> split_next_to_fragment,
<a name="l00338"></a>00338                                <a class="code" href="struct_blamer_bundle.html">BlamerBundle</a> *blamer_bundle) {
<a name="l00339"></a>00339   <a class="code" href="struct_t_w_e_r_d.html">TWERD</a>* word = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>;
<a name="l00340"></a>00340   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob;
<a name="l00341"></a>00341   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> x = 0;
<a name="l00342"></a>00342   <span class="keywordtype">float</span> rating_ceiling = <a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>;
<a name="l00343"></a>00343   BLOB_CHOICE_LIST *answer;
<a name="l00344"></a>00344   BLOB_CHOICE_IT answer_it;
<a name="l00345"></a>00345   <a class="code" href="structseam__record.html">SEAM</a> *seam;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="keywordflow">do</span> {
<a name="l00348"></a>00348     *blob_number = <a class="code" href="classtesseract_1_1_wordrec.html#a8fd3e86b711ba9d54c7eb500eb99c1c4">select_blob_to_split</a>(*char_choices, rating_ceiling,
<a name="l00349"></a>00349                                         split_next_to_fragment);
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>)
<a name="l00351"></a>00351       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;blob_number = %d\n&quot;</span>, *blob_number);
<a name="l00352"></a>00352     <span class="keywordflow">if</span> (*blob_number == -1)
<a name="l00353"></a>00353       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     <span class="comment">// TODO(rays) it may eventually help to allow italic_blob to be true,</span>
<a name="l00356"></a>00356     seam = <a class="code" href="classtesseract_1_1_wordrec.html#ab39c4eff1c3255a37a38f5f32956e6c2">chop_numbered_blob</a>(word, *blob_number, <span class="keyword">false</span>, *seam_list);
<a name="l00357"></a>00357     <span class="keywordflow">if</span> (seam != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00358"></a>00358       <span class="keywordflow">break</span>;
<a name="l00359"></a>00359     <span class="comment">/* Must split null blobs */</span>
<a name="l00360"></a>00360     answer = char_choices-&gt;<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(*blob_number);
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (answer == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00362"></a>00362       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00363"></a>00363     answer_it.set_to_list(answer);
<a name="l00364"></a>00364     rating_ceiling = answer_it.data()-&gt;rating();  <span class="comment">// try a different blob</span>
<a name="l00365"></a>00365   } <span class="keywordflow">while</span> (<span class="keyword">true</span>);
<a name="l00366"></a>00366   <span class="comment">/* Split OK */</span>
<a name="l00367"></a>00367   <span class="keywordflow">for</span> (blob = word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>; x &lt; *blob_number; x++) {
<a name="l00368"></a>00368     blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371   *seam_list =
<a name="l00372"></a>00372     <a class="code" href="seam_8cpp.html#abb7a3f834120eb2357b71b09405a2ec6">insert_seam</a> (*seam_list, *blob_number, seam, blob, word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="keyword">delete</span> char_choices-&gt;<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(*blob_number);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   answer = <a class="code" href="classtesseract_1_1_wordrec.html#a7127d481d5ea12e3253fb3719fd2170c">classify_blob</a>(blob, word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>, <span class="stringliteral">&quot;improve 1:&quot;</span>, <a class="code" href="callcpp_8h.html#a17bc059e437838f094a5a25c2d5ab88fad3163c1fcda01965b692ec2c3122b743">Red</a>,
<a name="l00377"></a>00377                          blamer_bundle);
<a name="l00378"></a>00378   char_choices-&gt;<a class="code" href="class_generic_vector.html#a57ca5259541548a97bcfd4d0925a27ff">insert</a>(answer, *blob_number);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   answer = <a class="code" href="classtesseract_1_1_wordrec.html#a7127d481d5ea12e3253fb3719fd2170c">classify_blob</a>(blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>, word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>, <span class="stringliteral">&quot;improve 2:&quot;</span>, <a class="code" href="callcpp_8h.html#a17bc059e437838f094a5a25c2d5ab88fabf28513245738599d13e3ce36bd16c82">Yellow</a>,
<a name="l00381"></a>00381                          blamer_bundle);
<a name="l00382"></a>00382   char_choices-&gt;<a class="code" href="class_generic_vector.html#a067b7833ee66238b7b5e230404525fcb">set</a>(answer, *blob_number + 1);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00394"></a><a class="code" href="classtesseract_1_1_wordrec.html#a30984c34a31ca6ef5ee363fc5ebfeff4">00394</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_wordrec.html#a30984c34a31ca6ef5ee363fc5ebfeff4">Wordrec::modify_blob_choice</a>(BLOB_CHOICE_LIST *answer,
<a name="l00395"></a>00395                         <span class="keywordtype">int</span> chop_index) {
<a name="l00396"></a>00396   <span class="keywordtype">char</span> chop_index_string[2];
<a name="l00397"></a>00397   <span class="keywordflow">if</span> (chop_index &lt;= 9) {
<a name="l00398"></a>00398     snprintf(chop_index_string, <span class="keyword">sizeof</span>(chop_index_string), <span class="stringliteral">&quot;%d&quot;</span>, chop_index);
<a name="l00399"></a>00399   } <span class="keywordflow">else</span> {
<a name="l00400"></a>00400     chop_index_string[0] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span><span class="keyword">&gt;</span>(<span class="charliteral">&#39;A&#39;</span> - 10 + chop_index);
<a name="l00401"></a>00401     chop_index_string[1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00402"></a>00402   }
<a name="l00403"></a>00403   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_id = <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(chop_index_string);
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (unichar_id == INVALID_UNICHAR_ID) {
<a name="l00405"></a>00405     <span class="comment">// If the word is very long, we might exhaust the possibilities.</span>
<a name="l00406"></a>00406     unichar_id = 1;
<a name="l00407"></a>00407   }
<a name="l00408"></a>00408   BLOB_CHOICE_IT answer_it(answer);
<a name="l00409"></a>00409   <a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html">BLOB_CHOICE</a> *modified_blob =
<a name="l00410"></a>00410       <span class="keyword">new</span> <a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html">BLOB_CHOICE</a>(unichar_id,
<a name="l00411"></a>00411                       answer_it.data()-&gt;rating(),
<a name="l00412"></a>00412                       answer_it.data()-&gt;certainty(),
<a name="l00413"></a>00413                       answer_it.data()-&gt;fontinfo_id(),
<a name="l00414"></a>00414                       answer_it.data()-&gt;fontinfo_id2(),
<a name="l00415"></a>00415                       answer_it.data()-&gt;script_id(),
<a name="l00416"></a>00416                       answer_it.data()-&gt;min_xheight(),
<a name="l00417"></a>00417                       answer_it.data()-&gt;max_xheight(),
<a name="l00418"></a>00418                       answer_it.data()-&gt;adapted());
<a name="l00419"></a>00419   answer-&gt;clear();
<a name="l00420"></a>00420   answer_it.set_to_list(answer);
<a name="l00421"></a>00421   answer_it.add_after_then_move(modified_blob);
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00432"></a><a class="code" href="classtesseract_1_1_wordrec.html#a3649b7ab00c4d5947904af99716c6b20">00432</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_wordrec.html#a3649b7ab00c4d5947904af99716c6b20">Wordrec::chop_one_blob</a>(<a class="code" href="struct_t_w_e_r_d.html">TWERD</a> *word,
<a name="l00433"></a>00433                             <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *char_choices,
<a name="l00434"></a>00434                             <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> *blob_number,
<a name="l00435"></a>00435                             <a class="code" href="structarray__record.html">SEAMS</a> *seam_list,
<a name="l00436"></a>00436                             <span class="keywordtype">int</span> *right_chop_index) {
<a name="l00437"></a>00437   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob;
<a name="l00438"></a>00438   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> x = 0;
<a name="l00439"></a>00439   <span class="keywordtype">float</span> rating_ceiling = <a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>;
<a name="l00440"></a>00440   BLOB_CHOICE_LIST *answer;
<a name="l00441"></a>00441   BLOB_CHOICE_IT answer_it;
<a name="l00442"></a>00442   <a class="code" href="structseam__record.html">SEAM</a> *seam;
<a name="l00443"></a>00443   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_id = 0;
<a name="l00444"></a>00444   <span class="keywordtype">int</span> left_chop_index = 0;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446   <span class="keywordflow">do</span> {
<a name="l00447"></a>00447     *blob_number = <a class="code" href="classtesseract_1_1_wordrec.html#a8fd3e86b711ba9d54c7eb500eb99c1c4">select_blob_to_split</a>(*char_choices, rating_ceiling, <span class="keyword">false</span>);
<a name="l00448"></a>00448     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>)
<a name="l00449"></a>00449       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;blob_number = %d\n&quot;</span>, *blob_number);
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (*blob_number == -1)
<a name="l00451"></a>00451       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00452"></a>00452     seam = <a class="code" href="classtesseract_1_1_wordrec.html#ab39c4eff1c3255a37a38f5f32956e6c2">chop_numbered_blob</a>(word, *blob_number, <span class="keyword">true</span>, *seam_list);
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (seam != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00454"></a>00454       <span class="keywordflow">break</span>;
<a name="l00455"></a>00455     <span class="comment">/* Must split null blobs */</span>
<a name="l00456"></a>00456     answer = char_choices-&gt;<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(*blob_number);
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (answer == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00458"></a>00458       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00459"></a>00459     answer_it.set_to_list(answer);
<a name="l00460"></a>00460     rating_ceiling = answer_it.data()-&gt;rating();  <span class="comment">// try a different blob</span>
<a name="l00461"></a>00461   } <span class="keywordflow">while</span> (<span class="keyword">true</span>);
<a name="l00462"></a>00462   <span class="comment">/* Split OK */</span>
<a name="l00463"></a>00463   <span class="keywordflow">for</span> (blob = word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>; x &lt; *blob_number; x++) {
<a name="l00464"></a>00464     blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>) {
<a name="l00467"></a>00467     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Chop made blob1:&quot;</span>);
<a name="l00468"></a>00468     blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a2e753aa9943276301d68e9f9cad99620">print</a>();
<a name="l00469"></a>00469     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;and blob2:&quot;</span>);
<a name="l00470"></a>00470     blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a2e753aa9943276301d68e9f9cad99620">print</a>();
<a name="l00471"></a>00471   }
<a name="l00472"></a>00472   *seam_list = <a class="code" href="seam_8cpp.html#abb7a3f834120eb2357b71b09405a2ec6">insert_seam</a>(*seam_list, *blob_number, seam, blob, word-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474   answer = char_choices-&gt;<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(*blob_number);
<a name="l00475"></a>00475   answer_it.set_to_list(answer);
<a name="l00476"></a>00476   unichar_id = answer_it.data()-&gt;unichar_id();
<a name="l00477"></a>00477   <span class="keywordtype">float</span> rating = answer_it.data()-&gt;rating() / exp(1.0);
<a name="l00478"></a>00478   left_chop_index = atoi(<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(unichar_id));
<a name="l00479"></a>00479 
<a name="l00480"></a>00480   <span class="keyword">delete</span> char_choices-&gt;<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(*blob_number);
<a name="l00481"></a>00481   <span class="comment">// combine confidence w/ serial #</span>
<a name="l00482"></a>00482   answer = <a class="code" href="classtesseract_1_1_wordrec.html#ae15505acaad8195b1b96de4a393bfc3e">fake_classify_blob</a>(0, rating, -rating);
<a name="l00483"></a>00483   <a class="code" href="classtesseract_1_1_wordrec.html#a30984c34a31ca6ef5ee363fc5ebfeff4">modify_blob_choice</a>(answer, left_chop_index);
<a name="l00484"></a>00484   char_choices-&gt;<a class="code" href="class_generic_vector.html#a57ca5259541548a97bcfd4d0925a27ff">insert</a>(answer, *blob_number);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   answer = <a class="code" href="classtesseract_1_1_wordrec.html#ae15505acaad8195b1b96de4a393bfc3e">fake_classify_blob</a>(0, rating - 0.125<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>, -rating);
<a name="l00487"></a>00487   <a class="code" href="classtesseract_1_1_wordrec.html#a30984c34a31ca6ef5ee363fc5ebfeff4">modify_blob_choice</a>(answer, ++*right_chop_index);
<a name="l00488"></a>00488   char_choices-&gt;<a class="code" href="class_generic_vector.html#a067b7833ee66238b7b5e230404525fcb">set</a>(answer, *blob_number + 1);
<a name="l00489"></a>00489   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 
<a name="l00493"></a><a class="code" href="classtesseract_1_1_wordrec.html#adb4cc59f6e9cca86fbba44ad483ab0b1">00493</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_wordrec.html#adb4cc59f6e9cca86fbba44ad483ab0b1">Wordrec::chop_one_blob2</a>(<span class="keyword">const</span> <a class="code" href="class_generic_vector.html">GenericVector&lt;TBOX&gt;</a>&amp; boxes,
<a name="l00494"></a>00494                              <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word_res,
<a name="l00495"></a>00495                              <a class="code" href="structarray__record.html">SEAMS</a> *seam_list) {
<a name="l00496"></a>00496   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> blob_number;
<a name="l00497"></a>00497   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> x = 0;
<a name="l00498"></a>00498   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob;
<a name="l00499"></a>00499   <a class="code" href="structseam__record.html">SEAM</a> *seam;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   seam = <a class="code" href="classtesseract_1_1_wordrec.html#a60f3ee36bfbef64013dd7b199248cf0e">chop_overlapping_blob</a>(boxes, word_res, &amp;blob_number,
<a name="l00502"></a>00502                                <span class="keyword">true</span>, *seam_list);
<a name="l00503"></a>00503   <span class="keywordflow">if</span> (seam == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00504"></a>00504     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <span class="comment">/* Split OK */</span>
<a name="l00507"></a>00507   <span class="keywordflow">for</span> (blob = word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>; x &lt; blob_number; x++) {
<a name="l00508"></a>00508     blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00509"></a>00509   }
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>) {
<a name="l00511"></a>00511     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Chop made blob1:&quot;</span>);
<a name="l00512"></a>00512     blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a2e753aa9943276301d68e9f9cad99620">print</a>();
<a name="l00513"></a>00513     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;and blob2:&quot;</span>);
<a name="l00514"></a>00514     blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a2e753aa9943276301d68e9f9cad99620">print</a>();
<a name="l00515"></a>00515   }
<a name="l00516"></a>00516   *seam_list = <a class="code" href="seam_8cpp.html#abb7a3f834120eb2357b71b09405a2ec6">insert_seam</a>(*seam_list, blob_number, seam, blob,
<a name="l00517"></a>00517                            word_res-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>);
<a name="l00518"></a>00518   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 }  <span class="comment">// namespace tesseract</span>
<a name="l00521"></a>00521 
<a name="l00530"></a><a class="code" href="chopper_8h.html#a5b0b5e54a6dabe1f874383318ad2b172">00530</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="chopper_8cpp.html#a5b0b5e54a6dabe1f874383318ad2b172">check_seam_order</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob, <a class="code" href="structseam__record.html">SEAM</a> *seam) {
<a name="l00531"></a>00531   <a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *outline;
<a name="l00532"></a>00532   <a class="code" href="struct_t_e_s_s_l_i_n_e.html">TESSLINE</a> *last_outline;
<a name="l00533"></a>00533   <a class="code" href="host_8h.html#a2ba4d271e85baf0d333318985cb3bced">inT8</a> found_em[3];
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <span class="keywordflow">if</span> (seam-&gt;<a class="code" href="structseam__record.html#a4161a1874921a7854bdd3d7a9f930729">split1</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || seam-&gt;<a class="code" href="structseam__record.html#a4161a1874921a7854bdd3d7a9f930729">split1</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || blob == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00536"></a>00536     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538   found_em[0] = found_em[1] = found_em[2] = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   <span class="keywordflow">for</span> (outline = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a3c9282cad4102157d214bcc6311cda07">outlines</a>; outline; outline = outline-&gt;<a class="code" href="struct_t_e_s_s_l_i_n_e.html#a0fb224d43ea53a791f0957fa92793bef">next</a>) {
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (!found_em[0] &amp;&amp;
<a name="l00542"></a>00542       ((seam-&gt;<a class="code" href="structseam__record.html#a4161a1874921a7854bdd3d7a9f930729">split1</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00543"></a>00543     <a class="code" href="makechop_8h.html#a215ea46db3a9b6343a2186a48aaa3487">is_split_outline</a> (outline, seam-&gt;<a class="code" href="structseam__record.html#a4161a1874921a7854bdd3d7a9f930729">split1</a>))) {
<a name="l00544"></a>00544       found_em[0] = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (!found_em[1] &amp;&amp;
<a name="l00547"></a>00547       ((seam-&gt;<a class="code" href="structseam__record.html#a75d831b3365583331780636979fbb321">split2</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00548"></a>00548     <a class="code" href="makechop_8h.html#a215ea46db3a9b6343a2186a48aaa3487">is_split_outline</a> (outline, seam-&gt;<a class="code" href="structseam__record.html#a75d831b3365583331780636979fbb321">split2</a>))) {
<a name="l00549"></a>00549       found_em[1] = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (!found_em[2] &amp;&amp;
<a name="l00552"></a>00552       ((seam-&gt;<a class="code" href="structseam__record.html#ad3878ea3c362e24fcdd063ed81f9ac5a">split3</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00553"></a>00553     <a class="code" href="makechop_8h.html#a215ea46db3a9b6343a2186a48aaa3487">is_split_outline</a> (outline, seam-&gt;<a class="code" href="structseam__record.html#ad3878ea3c362e24fcdd063ed81f9ac5a">split3</a>))) {
<a name="l00554"></a>00554       found_em[2] = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     last_outline = outline;
<a name="l00557"></a>00557   }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="keywordflow">if</span> (!found_em[0] || !found_em[1] || !found_em[2])
<a name="l00560"></a>00560     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00561"></a>00561   <span class="keywordflow">else</span>
<a name="l00562"></a>00562     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="keyword">namespace </span>tesseract {
<a name="l00574"></a><a class="code" href="classtesseract_1_1_wordrec.html#ae9a055f84d35a4f9752f6c838afa11b0">00574</a> <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *<a class="code" href="classtesseract_1_1_wordrec.html#ae9a055f84d35a4f9752f6c838afa11b0">Wordrec::chop_word_main</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word) {
<a name="l00575"></a>00575   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob;
<a name="l00576"></a>00576   <span class="keywordtype">int</span> index;
<a name="l00577"></a>00577   <span class="keywordtype">int</span> did_chopping;
<a name="l00578"></a>00578   <a class="code" href="struct_s_t_a_t_e.html">STATE</a> state;
<a name="l00579"></a>00579   BLOB_CHOICE_LIST *match_result;
<a name="l00580"></a>00580   <a class="code" href="class_m_a_t_r_i_x.html">MATRIX</a> *ratings = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00581"></a>00581   <a class="code" href="class_generic_vector.html">DANGERR</a> fixpt;                 <span class="comment">/*dangerous ambig */</span>
<a name="l00582"></a>00582   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> bit_count;               <span class="comment">//no of bits</span>
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *char_choices = <span class="keyword">new</span> <a class="code" href="ratngs_8h.html#a78a6d74d56415802d31e350314b23e65">BLOB_CHOICE_LIST_VECTOR</a>();
<a name="l00585"></a>00585   <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *best_char_choices = <span class="keyword">new</span> <a class="code" href="ratngs_8h.html#a78a6d74d56415802d31e350314b23e65">BLOB_CHOICE_LIST_VECTOR</a>();
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   did_chopping = 0;
<a name="l00588"></a>00588   <span class="keywordflow">for</span> (blob = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>, index = 0;
<a name="l00589"></a>00589        blob != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>, index++) {
<a name="l00590"></a>00590     match_result = <a class="code" href="classtesseract_1_1_wordrec.html#a7127d481d5ea12e3253fb3719fd2170c">classify_blob</a>(blob, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>, <span class="stringliteral">&quot;chop_word:&quot;</span>, <a class="code" href="callcpp_8h.html#a17bc059e437838f094a5a25c2d5ab88fad0784a3f969fe736e8b271a5a161d106">Green</a>,
<a name="l00591"></a>00591                                  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>);
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (match_result == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00593"></a>00593       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;Null classifier output!\n&quot;</span>);
<a name="l00594"></a>00594     *char_choices += match_result;
<a name="l00595"></a>00595   }
<a name="l00596"></a>00596   bit_count = index - 1;
<a name="l00597"></a>00597   <a class="code" href="states_8cpp.html#a4d7464b9adab39859eca306e1a41ba7e">set_n_ones</a>(&amp;state, char_choices-&gt;<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() - 1);
<a name="l00598"></a>00598   <span class="keywordtype">bool</span> acceptable = <span class="keyword">false</span>;
<a name="l00599"></a>00599   <span class="keywordtype">bool</span> replaced = <span class="keyword">false</span>;
<a name="l00600"></a>00600   <span class="keywordtype">bool</span> best_choice_updated =
<a name="l00601"></a>00601     <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#ab9c442c6c541ea1be7a0a132aea3af51">permute_characters</a>(*char_choices, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00602"></a>00602                                  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab4d02a7548dab0a4522f02ed90e48100">raw_choice</a>);
<a name="l00603"></a>00603   <span class="keywordflow">if</span> (best_choice_updated &amp;&amp;
<a name="l00604"></a>00604       <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().AcceptableChoice(char_choices, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>, &amp;fixpt,
<a name="l00605"></a>00605                                  <a class="code" href="stopper_8h.html#a1902ef46a46c64df98f9a99f6368e4f6a84325e771bcf9b3b1187d3e91455ca26">CHOPPER_CALLER</a>, &amp;replaced)) {
<a name="l00606"></a>00606     acceptable = <span class="keyword">true</span>;
<a name="l00607"></a>00607   }
<a name="l00608"></a>00608   <span class="keywordflow">if</span> (replaced)
<a name="l00609"></a>00609     <a class="code" href="classtesseract_1_1_wordrec.html#a63db9b85fa1350dfccfd4d6e548290d4">update_blob_classifications</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>, *char_choices);
<a name="l00610"></a>00610   <a class="code" href="classtesseract_1_1_wordrec.html#a6e9f488de12a12cd99ae4c2c55c87bc6">CopyCharChoices</a>(*char_choices, best_char_choices);
<a name="l00611"></a>00611   <span class="keywordflow">if</span> (!acceptable) {  <span class="comment">// do more work to find a better choice</span>
<a name="l00612"></a>00612     did_chopping = 1;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="keywordtype">bool</span> best_choice_acceptable = <span class="keyword">false</span>;
<a name="l00615"></a>00615     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#adcf4728e9f36b1c55a024165a31ca2e4">chop_enable</a>)
<a name="l00616"></a>00616       <a class="code" href="classtesseract_1_1_wordrec.html#ad1164fd07a17960ed06585f0c8aadcdc">improve_by_chopping</a>(word,
<a name="l00617"></a>00617                           char_choices,
<a name="l00618"></a>00618                           &amp;state,
<a name="l00619"></a>00619                           best_char_choices,
<a name="l00620"></a>00620                           &amp;fixpt,
<a name="l00621"></a>00621                           &amp;best_choice_acceptable);
<a name="l00622"></a>00622     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>)
<a name="l00623"></a>00623       <a class="code" href="seam_8cpp.html#abb1ad769b4318ae71f1a36294d29f5af">print_seams</a> (<span class="stringliteral">&quot;Final seam list:&quot;</span>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00626"></a>00626         !<a class="code" href="classtesseract_1_1_wordrec.html#ac05db9a605bcb460b6b1abdaf03ee6c4">ChoiceIsCorrect</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00627"></a>00627                          word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#acdff6c1914bf9d06c9461cba0cee1c34">truth_text</a>)) {
<a name="l00628"></a>00628       <a class="code" href="classtesseract_1_1_wordrec.html#a2ed3fab8407177af31d446a794617149">set_chopper_blame</a>(word);
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="comment">// The force_word_assoc is almost redundant to enable_assoc.  However,</span>
<a name="l00632"></a>00632     <span class="comment">// it is not conditioned on the dict behavior.  For CJK, we need to force</span>
<a name="l00633"></a>00633     <span class="comment">// the associator to be invoked.  When we figure out the exact behavior</span>
<a name="l00634"></a>00634     <span class="comment">// of dict on CJK, we can remove the flag if it turns out to be redundant.</span>
<a name="l00635"></a>00635     <span class="keywordflow">if</span> ((<a class="code" href="classtesseract_1_1_wordrec.html#aba19336c1e635f22b3c27024afd07fed">wordrec_enable_assoc</a> &amp;&amp; !best_choice_acceptable) || <a class="code" href="classtesseract_1_1_wordrec.html#a447f3fa5c50ca545e0a49887ee669ff8">force_word_assoc</a>) {
<a name="l00636"></a>00636       ratings = <a class="code" href="classtesseract_1_1_wordrec.html#a3581245a7778654f6fd22c4b3721cf06">word_associator</a>(<span class="keyword">false</span>, word, &amp;state, best_char_choices,
<a name="l00637"></a>00637                                 &amp;fixpt, &amp;state);
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639   }
<a name="l00640"></a>00640   best_char_choices = <a class="code" href="classtesseract_1_1_wordrec.html#a540decbb88b2e701402b80fd7395d03e">rebuild_current_state</a>(word, &amp;state, best_char_choices,
<a name="l00641"></a>00641                                             ratings);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <span class="comment">// If after running only the chopper best_choice is incorrect and no blame</span>
<a name="l00644"></a>00644   <span class="comment">// has been yet set, blame the classifier if best_choice is classifier&#39;s</span>
<a name="l00645"></a>00645   <span class="comment">// top choice and is a dictionary word (i.e. language model could not have</span>
<a name="l00646"></a>00646   <span class="comment">// helped). Otherwise blame the tradeoff between the classifier and</span>
<a name="l00647"></a>00647   <span class="comment">// the old language model (permuters).</span>
<a name="l00648"></a>00648   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00649"></a>00649       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#a2c84b31d55ab290a9247201cdb46752c">incorrect_result_reason</a> == <a class="code" href="pageres_8h.html#a8faf52e106c04bfdc9898ffa90b821e1a4f5ff200b61e6226eb6d74aec188e769">IRR_CORRECT</a> &amp;&amp;
<a name="l00650"></a>00650       ratings == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;  <span class="comment">// only the chopper was run</span>
<a name="l00651"></a>00651       !<a class="code" href="classtesseract_1_1_wordrec.html#ac05db9a605bcb460b6b1abdaf03ee6c4">ChoiceIsCorrect</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00652"></a>00652                        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#acdff6c1914bf9d06c9461cba0cee1c34">truth_text</a>)) {
<a name="l00653"></a>00653     <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00654"></a>00654         <a class="code" href="classtesseract_1_1_dict.html#af873650961191c2a844eed47c0829421" title="Check all the DAWGs to see if this word is in any of them.">Dict::valid_word_permuter</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a161ac137df2d063a6421728e6aa08fcb">permuter</a>(), <span class="keyword">false</span>)) {
<a name="l00655"></a>00655       <span class="comment">// Find out whether best choice is a top choice.</span>
<a name="l00656"></a>00656       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#a16968ea622a20067f95506256929ed4b">best_choice_is_dict_and_top_choice</a> = <span class="keyword">true</span>;
<a name="l00657"></a>00657       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a7be59abe97b052dd3aaa324aea8c4a6c">length</a>(); ++i) {
<a name="l00658"></a>00658         BLOB_CHOICE_IT blob_choice_it(best_char_choices-&gt;<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(i));
<a name="l00659"></a>00659         <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(!blob_choice_it.empty());
<a name="l00660"></a>00660         <a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html">BLOB_CHOICE</a> *first_choice = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00661"></a>00661         <span class="keywordflow">for</span> (blob_choice_it.mark_cycle_pt(); !blob_choice_it.cycled_list();
<a name="l00662"></a>00662              blob_choice_it.forward()) {  <span class="comment">// find first non-fragment choice</span>
<a name="l00663"></a>00663           <span class="keywordflow">if</span> (!(<a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().getUnicharset().get_fragment(
<a name="l00664"></a>00664                 blob_choice_it.data()-&gt;unichar_id()))) {
<a name="l00665"></a>00665             first_choice = blob_choice_it.data();
<a name="l00666"></a>00666             <span class="keywordflow">break</span>;
<a name="l00667"></a>00667           }
<a name="l00668"></a>00668         }
<a name="l00669"></a>00669         <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(first_choice != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00670"></a>00670         <span class="keywordflow">if</span> (first_choice-&gt;unichar_id() != word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a6b917b2e6157f7956ff53ca230425ed3">unichar_id</a>(i)) {
<a name="l00671"></a>00671           word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#a16968ea622a20067f95506256929ed4b">best_choice_is_dict_and_top_choice</a> = <span class="keyword">false</span>;
<a name="l00672"></a>00672           <span class="keywordflow">break</span>;
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674       }
<a name="l00675"></a>00675     }
<a name="l00676"></a>00676     <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> debug;
<a name="l00677"></a>00677     <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#a16968ea622a20067f95506256929ed4b">best_choice_is_dict_and_top_choice</a>) {
<a name="l00678"></a>00678       debug = <span class="stringliteral">&quot;Best choice is: incorrect, top choice, dictionary word&quot;</span>;
<a name="l00679"></a>00679       debug += <span class="stringliteral">&quot; with permuter &quot;</span>;
<a name="l00680"></a>00680       debug += word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a4a50ea8f60def206dca0053556e2df5f">permuter_name</a>();
<a name="l00681"></a>00681     } <span class="keywordflow">else</span> {
<a name="l00682"></a>00682       debug = <span class="stringliteral">&quot;Classifier/Old LM tradeoff is to blame&quot;</span>;
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#a51b9a55eb8acc439f5ade8e97c92da8f">SetBlame</a>(
<a name="l00685"></a>00685         word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>-&gt;<a class="code" href="struct_blamer_bundle.html#a16968ea622a20067f95506256929ed4b">best_choice_is_dict_and_top_choice</a> ?
<a name="l00686"></a>00686             <a class="code" href="pageres_8h.html#a8faf52e106c04bfdc9898ffa90b821e1a9b70b64836694fc6dc4a7a6035b2dad8">IRR_CLASSIFIER</a> : <a class="code" href="pageres_8h.html#a8faf52e106c04bfdc9898ffa90b821e1aec8f086813191f1f038ad3a6e6aa1d04">IRR_CLASS_OLD_LM_TRADEOFF</a>,
<a name="l00687"></a>00687         debug, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>, <a class="code" href="classtesseract_1_1_wordrec.html#a76e95cb7cbfe636ab00ec46150b5524d">wordrec_debug_blamer</a>);
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690   <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; this-&gt;fill_lattice_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00691"></a>00691     <span class="keywordflow">if</span> (ratings == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00692"></a>00692       ratings = <a class="code" href="classtesseract_1_1_wordrec.html#a3581245a7778654f6fd22c4b3721cf06">word_associator</a>(<span class="keyword">true</span>, word, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694     <a class="code" href="classtesseract_1_1_wordrec.html#a57cb744b40e142b6cb03de0e8998dafc">CallFillLattice</a>(*ratings, <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().getBestChoices(),
<a name="l00695"></a>00695                     *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a053a2aeeddc26a93a41a04fa08dd688a">uch_set</a>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>);
<a name="l00696"></a>00696   }
<a name="l00697"></a>00697   <span class="keywordflow">if</span> (ratings != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00698"></a>00698     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a15e6789d11062602e044c699bbd9b3aa">wordrec_debug_level</a> &gt; 0) {
<a name="l00699"></a>00699       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Final Ratings Matrix:\n&quot;</span>);
<a name="l00700"></a>00700       ratings-&gt;<a class="code" href="class_m_a_t_r_i_x.html#ae0f2489acb8b15666cb306f82ad2c6de">print</a>(<a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().getUnicharset());
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     ratings-&gt;<a class="code" href="class_g_e_n_e_r_i_c__2_d___a_r_r_a_y.html#a165f54b8c3cbafeaecac991f315be843">delete_matrix_pointers</a>();
<a name="l00703"></a>00703     <span class="keyword">delete</span> ratings;
<a name="l00704"></a>00704   }
<a name="l00705"></a>00705   <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a9ac3719475ad0a39d464307e1bd74ae3">FilterWordChoices</a>();
<a name="l00706"></a>00706   <span class="comment">// TODO(antonova, eger): check that FilterWordChoices() does not filter</span>
<a name="l00707"></a>00707   <span class="comment">// out anything useful for word bigram or phrase search.</span>
<a name="l00708"></a>00708   <span class="comment">// TODO(antonova, eger): when implementing word bigram and phrase search</span>
<a name="l00709"></a>00709   <span class="comment">// we will need to think carefully about how to replace a word with its</span>
<a name="l00710"></a>00710   <span class="comment">// alternative choice.</span>
<a name="l00711"></a>00711   <span class="comment">// In particular it might be required to save the segmentation state</span>
<a name="l00712"></a>00712   <span class="comment">// associated with the word, so that best_char_choices could be updated</span>
<a name="l00713"></a>00713   <span class="comment">// by rebuild_current_state() correctly.</span>
<a name="l00714"></a>00714   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#acb91792cc7855324b0a6f495defe3218">save_alt_choices</a>) <a class="code" href="classtesseract_1_1_wordrec.html#a3e07fc3051cf28bed0511983b8f8b69d">SaveAltChoices</a>(<a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().getBestChoices(), word);
<a name="l00715"></a>00715   char_choices-&gt;<a class="code" href="class_generic_vector.html#a98f62dccd75224a60437c2761bd215cd">delete_data_pointers</a>();
<a name="l00716"></a>00716   <span class="keyword">delete</span> char_choices;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="keywordflow">return</span> best_char_choices;
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 
<a name="l00732"></a><a class="code" href="classtesseract_1_1_wordrec.html#ad1164fd07a17960ed06585f0c8aadcdc">00732</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_wordrec.html#ad1164fd07a17960ed06585f0c8aadcdc">Wordrec::improve_by_chopping</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word,
<a name="l00733"></a>00733                                   <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *char_choices,
<a name="l00734"></a>00734                                   <a class="code" href="struct_s_t_a_t_e.html">STATE</a> *best_state,
<a name="l00735"></a>00735                                   <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *best_char_choices,
<a name="l00736"></a>00736                                   <a class="code" href="class_generic_vector.html">DANGERR</a> *fixpt,
<a name="l00737"></a>00737                                   <span class="keywordtype">bool</span> *best_choice_acceptable) {
<a name="l00738"></a>00738   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> blob_number;
<a name="l00739"></a>00739   <span class="keywordtype">float</span> old_best;
<a name="l00740"></a>00740   <span class="keywordtype">int</span> fixpt_valid = 1;
<a name="l00741"></a>00741   <span class="keywordtype">bool</span> updated_best_choice = <span class="keyword">false</span>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="keywordflow">while</span> (1) {  <span class="comment">// improvement loop</span>
<a name="l00744"></a>00744     <span class="keywordflow">if</span> (!fixpt_valid) fixpt-&gt;<a class="code" href="class_generic_vector.html#a9cdbff49b186574b83e43afba606fdd9">clear</a>();
<a name="l00745"></a>00745     old_best = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a52ea24dcb5ff15ad8aee3fd774622216">rating</a>();
<a name="l00746"></a>00746     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#acdc368cd46083bdc4c321dd0a42533a0">improve_one_blob</a>(word, char_choices,
<a name="l00747"></a>00747                          &amp;blob_number, &amp;word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>,
<a name="l00748"></a>00748                          fixpt, (<a class="code" href="classtesseract_1_1_wordrec.html#a62f9bd7c796160d6fad61ba616e67ead">fragments_guide_chopper</a> &amp;&amp;
<a name="l00749"></a>00749                                  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a8947564d0c2d01763958e633999e3c50">fragment_mark</a>()),
<a name="l00750"></a>00750                                  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>)) {
<a name="l00751"></a>00751       <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#aa5ce917212da08cba99df7966c9e84cc">LogNewSplit</a>(blob_number);
<a name="l00752"></a>00752       updated_best_choice =
<a name="l00753"></a>00753         <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#ab9c442c6c541ea1be7a0a132aea3af51">permute_characters</a>(*char_choices, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00754"></a>00754                                      word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab4d02a7548dab0a4522f02ed90e48100">raw_choice</a>);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       <span class="keywordflow">if</span> (old_best &gt; word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a52ea24dcb5ff15ad8aee3fd774622216">rating</a>()) {
<a name="l00757"></a>00757         <a class="code" href="states_8cpp.html#a4d7464b9adab39859eca306e1a41ba7e">set_n_ones</a>(best_state, char_choices-&gt;<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() - 1);
<a name="l00758"></a>00758         fixpt_valid = 1;
<a name="l00759"></a>00759       }
<a name="l00760"></a>00760       <span class="keywordflow">else</span> {
<a name="l00761"></a>00761         <a class="code" href="states_8cpp.html#a5104caef86ae4abd56bbb88b463492f6">insert_new_chunk</a>(best_state, blob_number, char_choices-&gt;<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() - 2);
<a name="l00762"></a>00762         fixpt_valid = 0;
<a name="l00763"></a>00763       }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>)
<a name="l00766"></a>00766         <a class="code" href="states_8cpp.html#acb25e4d3e4da45c03f24fa3fcada7a98">print_state</a>(<span class="stringliteral">&quot;best state = &quot;</span>,
<a name="l00767"></a>00767           best_state, <a class="code" href="blobs_8cpp.html#aa8048f4c65af2775452ad5d4dfbca053">count_blobs</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>) - 1);
<a name="l00768"></a>00768     } <span class="keywordflow">else</span> {
<a name="l00769"></a>00769       <span class="keywordflow">break</span>;
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <span class="comment">// Check if we should break from the loop.</span>
<a name="l00773"></a>00773     <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;
<a name="l00774"></a>00774     <span class="keywordtype">bool</span> replaced = <span class="keyword">false</span>;
<a name="l00775"></a>00775     <span class="keywordflow">if</span> ((updated_best_choice &amp;&amp;
<a name="l00776"></a>00776          (*best_choice_acceptable =
<a name="l00777"></a>00777           <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().AcceptableChoice(char_choices, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00778"></a>00778                                      fixpt, <a class="code" href="stopper_8h.html#a1902ef46a46c64df98f9a99f6368e4f6a84325e771bcf9b3b1187d3e91455ca26">CHOPPER_CALLER</a>, &amp;replaced))) ||
<a name="l00779"></a>00779         char_choices-&gt;<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() &gt;= <a class="code" href="states_8h.html#a2f47d18aa9ea116103da072b110cf09d">MAX_NUM_CHUNKS</a>) {
<a name="l00780"></a>00780       done = <span class="keyword">true</span>;
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (replaced) <a class="code" href="classtesseract_1_1_wordrec.html#a63db9b85fa1350dfccfd4d6e548290d4">update_blob_classifications</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>,
<a name="l00783"></a>00783                                               *char_choices);
<a name="l00784"></a>00784     <span class="keywordflow">if</span> (updated_best_choice) <a class="code" href="classtesseract_1_1_wordrec.html#a6e9f488de12a12cd99ae4c2c55c87bc6">CopyCharChoices</a>(*char_choices, best_char_choices);
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (done) <span class="keywordflow">break</span>;
<a name="l00786"></a>00786   }
<a name="l00787"></a>00787   <span class="keywordflow">if</span> (!fixpt_valid) fixpt-&gt;<a class="code" href="class_generic_vector.html#a9cdbff49b186574b83e43afba606fdd9">clear</a>();
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <span class="comment">/**********************************************************************</span>
<a name="l00792"></a>00792 <span class="comment"> * select_blob_to_split</span>
<a name="l00793"></a>00793 <span class="comment"> *</span>
<a name="l00794"></a>00794 <span class="comment"> * These are the results of the last classification.  Find a likely</span>
<a name="l00795"></a>00795 <span class="comment"> * place to apply splits.</span>
<a name="l00796"></a>00796 <span class="comment"> **********************************************************************/</span>
<a name="l00797"></a><a class="code" href="classtesseract_1_1_wordrec.html#a8fd3e86b711ba9d54c7eb500eb99c1c4">00797</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="classtesseract_1_1_wordrec.html#a8fd3e86b711ba9d54c7eb500eb99c1c4">Wordrec::select_blob_to_split</a>(<span class="keyword">const</span> <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> &amp;char_choices,
<a name="l00798"></a>00798                                     <span class="keywordtype">float</span> rating_ceiling,
<a name="l00799"></a>00799                                     <span class="keywordtype">bool</span> split_next_to_fragment) {
<a name="l00800"></a>00800   BLOB_CHOICE_IT blob_choice_it;
<a name="l00801"></a>00801   <a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html">BLOB_CHOICE</a> *blob_choice;
<a name="l00802"></a>00802   BLOB_CHOICE_IT temp_it;
<a name="l00803"></a>00803   <span class="keywordtype">int</span> x;
<a name="l00804"></a>00804   <span class="keywordtype">float</span> worst = -<a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>;
<a name="l00805"></a>00805   <span class="keywordtype">int</span> worst_index = -1;
<a name="l00806"></a>00806   <span class="keywordtype">float</span> worst_near_fragment = -<a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>;
<a name="l00807"></a>00807   <span class="keywordtype">int</span> worst_index_near_fragment = -1;
<a name="l00808"></a>00808   <span class="keyword">const</span> <a class="code" href="class_c_h_a_r___f_r_a_g_m_e_n_t.html">CHAR_FRAGMENT</a> **fragments = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>) {
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (rating_ceiling &lt; <a class="code" href="host_8h.html#a9adcee815220ec9db98062213806ed04">MAX_FLOAT32</a>)
<a name="l00812"></a>00812       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;rating_ceiling = %8.4f\n&quot;</span>, rating_ceiling);
<a name="l00813"></a>00813     <span class="keywordflow">else</span>
<a name="l00814"></a>00814       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;rating_ceiling = No Limit\n&quot;</span>);
<a name="l00815"></a>00815   }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817   <span class="keywordflow">if</span> (split_next_to_fragment &amp;&amp; char_choices.<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() &gt; 0) {
<a name="l00818"></a>00818     fragments = <span class="keyword">new</span> <span class="keyword">const</span> <a class="code" href="class_c_h_a_r___f_r_a_g_m_e_n_t.html">CHAR_FRAGMENT</a> *[char_choices.<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>()];
<a name="l00819"></a>00819     <span class="keywordflow">if</span> (char_choices.<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(0) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00820"></a>00820       temp_it.set_to_list(char_choices.<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(0));
<a name="l00821"></a>00821       fragments[0] = <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a635ce00ba9aa24247563d26ae26da631">getUnicharset</a>().<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#af08440927e3b87f99bd3a3fbd8e126dc">get_fragment</a>(
<a name="l00822"></a>00822           temp_it.data()-&gt;unichar_id());
<a name="l00823"></a>00823     } <span class="keywordflow">else</span> {
<a name="l00824"></a>00824       fragments[0] = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826   }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   <span class="keywordflow">for</span> (x = 0; x &lt; char_choices.<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>(); ++x) {
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (char_choices.<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(x) == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00830"></a>00830       <span class="keywordflow">if</span> (fragments != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00831"></a>00831         <span class="keyword">delete</span>[] fragments;
<a name="l00832"></a>00832       }
<a name="l00833"></a>00833       <span class="keywordflow">return</span> x;
<a name="l00834"></a>00834     } <span class="keywordflow">else</span> {
<a name="l00835"></a>00835       blob_choice_it.set_to_list(char_choices.<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(x));
<a name="l00836"></a>00836       blob_choice = blob_choice_it.data();
<a name="l00837"></a>00837       <span class="comment">// Populate fragments for the following position.</span>
<a name="l00838"></a>00838       <span class="keywordflow">if</span> (split_next_to_fragment &amp;&amp; x+1 &lt; char_choices.<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>()) {
<a name="l00839"></a>00839         <span class="keywordflow">if</span> (char_choices.<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(x+1) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00840"></a>00840           temp_it.set_to_list(char_choices.<a class="code" href="class_generic_vector.html#a33070cfea2a16a20c6b30bbcfecd8ecc">get</a>(x+1));
<a name="l00841"></a>00841           fragments[x+1] = <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a635ce00ba9aa24247563d26ae26da631">getUnicharset</a>().<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#af08440927e3b87f99bd3a3fbd8e126dc">get_fragment</a>(
<a name="l00842"></a>00842               temp_it.data()-&gt;unichar_id());
<a name="l00843"></a>00843         } <span class="keywordflow">else</span> {
<a name="l00844"></a>00844           fragments[x+1] = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846       }
<a name="l00847"></a>00847       <span class="keywordflow">if</span> (blob_choice-&gt;<a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html#a7fbd2d505bf5b55beee424096fb1e9bc">rating</a>() &lt; rating_ceiling &amp;&amp;
<a name="l00848"></a>00848           blob_choice-&gt;<a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html#af53d45b718c562ea7209b583c77ac14e">certainty</a>() &lt; <a class="code" href="classtesseract_1_1_wordrec.html#a57ae3e0529a624fd3677f96d5b43fcc8">tessedit_certainty_threshold</a>) {
<a name="l00849"></a>00849         <span class="comment">// Update worst and worst_index.</span>
<a name="l00850"></a>00850         <span class="keywordflow">if</span> (blob_choice-&gt;<a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html#a7fbd2d505bf5b55beee424096fb1e9bc">rating</a>() &gt; worst) {
<a name="l00851"></a>00851           worst_index = x;
<a name="l00852"></a>00852           worst = blob_choice-&gt;<a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html#a7fbd2d505bf5b55beee424096fb1e9bc">rating</a>();
<a name="l00853"></a>00853         }
<a name="l00854"></a>00854         <span class="keywordflow">if</span> (split_next_to_fragment) {
<a name="l00855"></a>00855           <span class="comment">// Update worst_near_fragment and worst_index_near_fragment.</span>
<a name="l00856"></a>00856           <span class="keywordtype">bool</span> expand_following_fragment =
<a name="l00857"></a>00857             (x + 1 &lt; char_choices.<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() &amp;&amp;
<a name="l00858"></a>00858              fragments[x+1] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; !fragments[x+1]-&gt;<a class="code" href="class_c_h_a_r___f_r_a_g_m_e_n_t.html#a42707cfcbf1e9a38ec0333d3202f8d80">is_beginning</a>());
<a name="l00859"></a>00859           <span class="keywordtype">bool</span> expand_preceding_fragment =
<a name="l00860"></a>00860             (x &gt; 0 &amp;&amp; fragments[x-1] != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; !fragments[x-1]-&gt;<a class="code" href="class_c_h_a_r___f_r_a_g_m_e_n_t.html#af222b3b2c71de6199f75e3a7a64aa660">is_ending</a>());
<a name="l00861"></a>00861           <span class="keywordflow">if</span> ((expand_following_fragment || expand_preceding_fragment) &amp;&amp;
<a name="l00862"></a>00862               blob_choice-&gt;<a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html#a7fbd2d505bf5b55beee424096fb1e9bc">rating</a>() &gt; worst_near_fragment) {
<a name="l00863"></a>00863             worst_index_near_fragment = x;
<a name="l00864"></a>00864             worst_near_fragment = blob_choice-&gt;<a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html#a7fbd2d505bf5b55beee424096fb1e9bc">rating</a>();
<a name="l00865"></a>00865             <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>) {
<a name="l00866"></a>00866               <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;worst_index_near_fragment=%d&quot;</span>
<a name="l00867"></a>00867                       <span class="stringliteral">&quot; expand_following_fragment=%d&quot;</span>
<a name="l00868"></a>00868                       <span class="stringliteral">&quot; expand_preceding_fragment=%d\n&quot;</span>,
<a name="l00869"></a>00869                       worst_index_near_fragment,
<a name="l00870"></a>00870                       expand_following_fragment,
<a name="l00871"></a>00871                       expand_preceding_fragment);
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873           }
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875       }
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877   }
<a name="l00878"></a>00878   <span class="keywordflow">if</span> (fragments != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00879"></a>00879     <span class="keyword">delete</span>[] fragments;
<a name="l00880"></a>00880   }
<a name="l00881"></a>00881   <span class="comment">// TODO(daria): maybe a threshold of badness for</span>
<a name="l00882"></a>00882   <span class="comment">// worst_near_fragment would be useful.</span>
<a name="l00883"></a>00883   <span class="keywordflow">return</span> worst_index_near_fragment != -1 ?
<a name="l00884"></a>00884     worst_index_near_fragment : worst_index;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="comment">/**********************************************************************</span>
<a name="l00888"></a>00888 <span class="comment"> * set_chopper_blame</span>
<a name="l00889"></a>00889 <span class="comment"> *</span>
<a name="l00890"></a>00890 <span class="comment"> * Check whether chops were made at all the character bounding box boundaries</span>
<a name="l00891"></a>00891 <span class="comment"> * in word-&gt;truth_word. If not - blame the chopper for an incorrect answer.</span>
<a name="l00892"></a>00892 <span class="comment"> **********************************************************************/</span>
<a name="l00893"></a><a class="code" href="classtesseract_1_1_wordrec.html#a2ed3fab8407177af31d446a794617149">00893</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_wordrec.html#a2ed3fab8407177af31d446a794617149">Wordrec::set_chopper_blame</a>(<a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word) {
<a name="l00894"></a>00894   <a class="code" href="struct_blamer_bundle.html">BlamerBundle</a> *blamer_bundle = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>;
<a name="l00895"></a>00895   assert(blamer_bundle != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00896"></a>00896   <span class="keywordflow">if</span> (blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a4399018ec9ce9b68051566d2be9aaaba">NoTruth</a>() || !(blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#ad7dc9029fe6de5f5554046773cb15854">truth_has_char_boxes</a>) ||
<a name="l00897"></a>00897       word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00898"></a>00898     <span class="keywordflow">return</span>;
<a name="l00899"></a>00899   }
<a name="l00900"></a>00900   <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> debug;
<a name="l00901"></a>00901   <span class="keywordtype">bool</span> missing_chop = <span class="keyword">false</span>;
<a name="l00902"></a>00902   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> * curr_blob = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00903"></a>00903   <span class="keywordtype">int</span> b = 0;
<a name="l00904"></a>00904   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> truth_x;
<a name="l00905"></a>00905   <span class="keywordflow">while</span> (b &lt; blamer_bundle-&gt;truth_word.length() &amp;&amp; curr_blob != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00906"></a>00906     truth_x = blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a0fac62f7f13e3e684c5ef433bfcf3158">norm_truth_word</a>.<a class="code" href="classtesseract_1_1_box_word.html#a022cfe52a644e9e800595f014b1fbcf5">BlobBox</a>(b).<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>();
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>() &lt;
<a name="l00908"></a>00908         (truth_x - blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a4df5a4ea5a4ba6f973b3c987c95a8a39">norm_box_tolerance</a>)) {
<a name="l00909"></a>00909       curr_blob = curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00910"></a>00910       <span class="keywordflow">continue</span>;  <span class="comment">// encountered an extra chop, keep looking</span>
<a name="l00911"></a>00911     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>() &gt;
<a name="l00912"></a>00912                 (truth_x + blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a4df5a4ea5a4ba6f973b3c987c95a8a39">norm_box_tolerance</a>)) {
<a name="l00913"></a>00913       missing_chop = <span class="keyword">true</span>;
<a name="l00914"></a>00914       <span class="keywordflow">break</span>;
<a name="l00915"></a>00915     } <span class="keywordflow">else</span> {
<a name="l00916"></a>00916       curr_blob = curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00917"></a>00917       ++b;
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919   }
<a name="l00920"></a>00920   <span class="keywordflow">if</span> (missing_chop || b &lt; blamer_bundle-&gt;norm_truth_word.length()) {
<a name="l00921"></a>00921     <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> debug;
<a name="l00922"></a>00922     <span class="keywordtype">char</span> debug_buffer[256];
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (missing_chop) {
<a name="l00924"></a>00924       sprintf(debug_buffer, <span class="stringliteral">&quot;Detected missing chop (tolerance=%d) at &quot;</span>,
<a name="l00925"></a>00925               blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a4df5a4ea5a4ba6f973b3c987c95a8a39">norm_box_tolerance</a>);
<a name="l00926"></a>00926       debug += debug_buffer;
<a name="l00927"></a>00927       curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a0344effa1c2a22bddf8005fe579cf601">append_debug</a>(&amp;debug);
<a name="l00928"></a>00928       debug.<a class="code" href="class_s_t_r_i_n_g.html#a779cd637dd42d58d5500a3a657077e84">add_str_int</a>(<span class="stringliteral">&quot;\nNo chop for truth at x=&quot;</span>, truth_x);
<a name="l00929"></a>00929     } <span class="keywordflow">else</span> {
<a name="l00930"></a>00930       debug.<a class="code" href="class_s_t_r_i_n_g.html#a779cd637dd42d58d5500a3a657077e84">add_str_int</a>(<span class="stringliteral">&quot;Missing chops for last &quot;</span>,
<a name="l00931"></a>00931                         blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a0fac62f7f13e3e684c5ef433bfcf3158">norm_truth_word</a>.<a class="code" href="classtesseract_1_1_box_word.html#afe001fe8fb7f2d3725b2ac2f542e9878">length</a>()-b);
<a name="l00932"></a>00932       debug += <span class="stringliteral">&quot; truth box(es)&quot;</span>;
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934     debug += <span class="stringliteral">&quot;\nMaximally chopped word boxes:\n&quot;</span>;
<a name="l00935"></a>00935     <span class="keywordflow">for</span> (curr_blob = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>; curr_blob != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00936"></a>00936         curr_blob = curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>) {
<a name="l00937"></a>00937       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;tbox = curr_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>();
<a name="l00938"></a>00938       sprintf(debug_buffer, <span class="stringliteral">&quot;(%d,%d)-&gt;(%d,%d)\n&quot;</span>,
<a name="l00939"></a>00939               tbox.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), tbox.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(), tbox.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), tbox.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>());
<a name="l00940"></a>00940       debug += debug_buffer;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942     debug += <span class="stringliteral">&quot;Truth  bounding  boxes:\n&quot;</span>;
<a name="l00943"></a>00943     <span class="keywordflow">for</span> (b = 0; b &lt; blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a0fac62f7f13e3e684c5ef433bfcf3158">norm_truth_word</a>.<a class="code" href="classtesseract_1_1_box_word.html#afe001fe8fb7f2d3725b2ac2f542e9878">length</a>(); ++b) {
<a name="l00944"></a>00944       <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;tbox = blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a0fac62f7f13e3e684c5ef433bfcf3158">norm_truth_word</a>.<a class="code" href="classtesseract_1_1_box_word.html#a022cfe52a644e9e800595f014b1fbcf5">BlobBox</a>(b);
<a name="l00945"></a>00945       sprintf(debug_buffer, <span class="stringliteral">&quot;(%d,%d)-&gt;(%d,%d)\n&quot;</span>,
<a name="l00946"></a>00946               tbox.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), tbox.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(), tbox.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), tbox.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>());
<a name="l00947"></a>00947       debug += debug_buffer;
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     blamer_bundle-&gt;<a class="code" href="struct_blamer_bundle.html#a51b9a55eb8acc439f5ade8e97c92da8f">SetBlame</a>(<a class="code" href="pageres_8h.html#a8faf52e106c04bfdc9898ffa90b821e1a4c27b1a4f36ac4410ec500e4c7a1561c">IRR_CHOPPER</a>, debug, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00950"></a>00950                             <a class="code" href="classtesseract_1_1_wordrec.html#a76e95cb7cbfe636ab00ec46150b5524d">wordrec_debug_blamer</a>);
<a name="l00951"></a>00951   }
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 <span class="comment">/**********************************************************************</span>
<a name="l00955"></a>00955 <span class="comment"> * word_associator</span>
<a name="l00956"></a>00956 <span class="comment"> *</span>
<a name="l00957"></a>00957 <span class="comment"> * Reassociate and classify the blobs in a word.  Continue this process</span>
<a name="l00958"></a>00958 <span class="comment"> * until a good answer is found or all the possibilities have been tried.</span>
<a name="l00959"></a>00959 <span class="comment"> **********************************************************************/</span>
<a name="l00960"></a><a class="code" href="classtesseract_1_1_wordrec.html#a3581245a7778654f6fd22c4b3721cf06">00960</a> <a class="code" href="class_m_a_t_r_i_x.html">MATRIX</a> *<a class="code" href="classtesseract_1_1_wordrec.html#a3581245a7778654f6fd22c4b3721cf06">Wordrec::word_associator</a>(<span class="keywordtype">bool</span> only_create_ratings_matrix,
<a name="l00961"></a>00961                                  <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word,
<a name="l00962"></a>00962                                  <a class="code" href="struct_s_t_a_t_e.html">STATE</a> *state,
<a name="l00963"></a>00963                                  <a class="code" href="class_generic_vector.html">BLOB_CHOICE_LIST_VECTOR</a> *best_char_choices,
<a name="l00964"></a>00964                                  <a class="code" href="class_generic_vector.html">DANGERR</a> *fixpt,
<a name="l00965"></a>00965                                  <a class="code" href="struct_s_t_a_t_e.html">STATE</a> *best_state) {
<a name="l00966"></a>00966   <a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html">CHUNKS_RECORD</a> chunks_record;
<a name="l00967"></a>00967   <a class="code" href="associate_8h.html#a72105980380289d1263c5a5058472a7e">BLOB_WEIGHTS</a> blob_weights;
<a name="l00968"></a>00968   <span class="keywordtype">int</span> x;
<a name="l00969"></a>00969   <span class="keywordtype">int</span> num_chunks;
<a name="l00970"></a>00970   BLOB_CHOICE_IT blob_choice_it;
<a name="l00971"></a>00971 
<a name="l00972"></a>00972   num_chunks = <a class="code" href="tessarray_8h.html#a89ee8010120771c8612dc7058b327f84">array_count</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>) + 1;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* blobs = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00975"></a>00975   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a0b28a4ba4a1c931ed994847db83e0ef5">ratings</a> = <a class="code" href="classtesseract_1_1_wordrec.html#a9f070b021f06de480fda80a61a772d47">record_piece_ratings</a>(blobs);
<a name="l00976"></a>00976   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a953645d7dbb5789cf5feb918df3e914e">chunks</a> = blobs;
<a name="l00977"></a>00977   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#aa3826aaf2a5a7a76b000859ace1f8602">word_res</a> = word;
<a name="l00978"></a>00978   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#aca32a87e5f9e4d04777ca3551b65b27c">splits</a> = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>;
<a name="l00979"></a>00979   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a3ac3e771d771818dff8eed190d11d50f">chunk_widths</a> = <a class="code" href="blobs_8cpp.html#ac62acb187b8e5401eb56032b3eebef09">blobs_widths</a>(blobs);
<a name="l00980"></a>00980   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a1e5c641f46ccb7f464def3678de715d3">char_widths</a> = <a class="code" href="blobs_8cpp.html#ac62acb187b8e5401eb56032b3eebef09">blobs_widths</a>(blobs);
<a name="l00981"></a>00981   <span class="comment">/* Save chunk weights */</span>
<a name="l00982"></a>00982   <span class="keywordflow">for</span> (x = 0; x &lt; num_chunks; x++) {
<a name="l00983"></a>00983     BLOB_CHOICE_LIST* choices = <a class="code" href="classtesseract_1_1_wordrec.html#aab16c53ccf9c888874c2e7ae65b6ed04">get_piece_rating</a>(chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a0b28a4ba4a1c931ed994847db83e0ef5">ratings</a>, blobs,
<a name="l00984"></a>00984                                                  chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#aa3826aaf2a5a7a76b000859ace1f8602">word_res</a>-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>,
<a name="l00985"></a>00985                                                  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>, x, x,
<a name="l00986"></a>00986                                                  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>);
<a name="l00987"></a>00987     blob_choice_it.set_to_list(choices);
<a name="l00988"></a>00988     <span class="comment">//This is done by Jetsoft. Divide by zero is possible.</span>
<a name="l00989"></a>00989     <span class="keywordflow">if</span> (blob_choice_it.data()-&gt;certainty() == 0) {
<a name="l00990"></a>00990       blob_weights[x]=0;
<a name="l00991"></a>00991     } <span class="keywordflow">else</span> {
<a name="l00992"></a>00992       blob_weights[x] =
<a name="l00993"></a>00993         -(<a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a>) (10 * blob_choice_it.data()-&gt;rating() /
<a name="l00994"></a>00994                   blob_choice_it.data()-&gt;certainty());
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996   }
<a name="l00997"></a>00997   chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#afa46370f180659bdd3be60d7d4ed21ed">weights</a> = blob_weights;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#a3f1c04cfbc1650eae6fc981984717248">chop_debug</a>)
<a name="l01000"></a>01000     chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a0b28a4ba4a1c931ed994847db83e0ef5">ratings</a>-&gt;<a class="code" href="class_m_a_t_r_i_x.html#ae0f2489acb8b15666cb306f82ad2c6de">print</a>(<a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().getUnicharset());
<a name="l01001"></a>01001 
<a name="l01002"></a>01002   <span class="keywordflow">if</span> (!only_create_ratings_matrix) {
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_wordrec.html#ae9c39326c0ed2eaf67c30939714616ba">enable_new_segsearch</a>) {
<a name="l01004"></a>01004       <a class="code" href="classtesseract_1_1_wordrec.html#aea3997058b7c1683957d275d17bc20d6">SegSearch</a>(&amp;chunks_record, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l01005"></a>01005                 best_char_choices, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab4d02a7548dab0a4522f02ed90e48100">raw_choice</a>,
<a name="l01006"></a>01006                 state, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a267e5d5e9fe67117e47223c5d336b8ba">blamer_bundle</a>);
<a name="l01007"></a>01007     } <span class="keywordflow">else</span> {
<a name="l01008"></a>01008       <a class="code" href="classtesseract_1_1_wordrec.html#ad717bb181d1b89496be0b042347d9753">best_first_search</a>(&amp;chunks_record, best_char_choices, word,
<a name="l01009"></a>01009                         state, fixpt, best_state);
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011   }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013   <a class="code" href="blobs_8h.html#a08481bc89b6e24355aaa1a3785eb5840">free_widths</a>(chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a3ac3e771d771818dff8eed190d11d50f">chunk_widths</a>);
<a name="l01014"></a>01014   <a class="code" href="blobs_8h.html#a08481bc89b6e24355aaa1a3785eb5840">free_widths</a>(chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a1e5c641f46ccb7f464def3678de715d3">char_widths</a>);
<a name="l01015"></a>01015   <span class="keywordflow">return</span> chunks_record.<a class="code" href="struct_c_h_u_n_k_s___r_e_c_o_r_d.html#a0b28a4ba4a1c931ed994847db83e0ef5">ratings</a>;
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 }  <span class="comment">// namespace tesseract</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 
<a name="l01020"></a>01020 <span class="comment">/**********************************************************************</span>
<a name="l01021"></a>01021 <span class="comment"> * total_containment</span>
<a name="l01022"></a>01022 <span class="comment"> *</span>
<a name="l01023"></a>01023 <span class="comment"> * Check to see if one of these outlines is totally contained within</span>
<a name="l01024"></a>01024 <span class="comment"> * the bounding box of the other.</span>
<a name="l01025"></a>01025 <span class="comment"> **********************************************************************/</span>
<a name="l01026"></a><a class="code" href="chopper_8h.html#a8e8e9f6cb587b621054e6ff626a46a23">01026</a> <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="chopper_8cpp.html#a8e8e9f6cb587b621054e6ff626a46a23">total_containment</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob1, <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob2) {
<a name="l01027"></a>01027   <a class="code" href="class_t_b_o_x.html">TBOX</a> box1 = blob1-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>();
<a name="l01028"></a>01028   <a class="code" href="class_t_b_o_x.html">TBOX</a> box2 = blob2-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>();
<a name="l01029"></a>01029   <span class="keywordflow">return</span> box1.<a class="code" href="class_t_b_o_x.html#a5d4e2c5f91b791e94d4c94e513180632">contains</a>(box2) || box2.<a class="code" href="class_t_b_o_x.html#a5d4e2c5f91b791e94d4c94e513180632">contains</a>(box1);
<a name="l01030"></a>01030 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="chopper_8cpp.html">chopper.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Wed Mar 28 2012 22:38:40 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
