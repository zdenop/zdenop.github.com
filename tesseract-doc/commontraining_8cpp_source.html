<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/training/commontraining.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('commontraining_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/training/commontraining.cpp</div>  </div>
</div>
<div class="contents">
<a href="commontraining_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright 2008 Google Inc. All Rights Reserved.</span>
<a name="l00002"></a>00002 <span class="comment">// Author: scharron@google.com (Samuel Charron)</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00005"></a>00005 <span class="comment">// you may not use this file except in compliance with the License.</span>
<a name="l00006"></a>00006 <span class="comment">// You may obtain a copy of the License at</span>
<a name="l00007"></a>00007 <span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00008"></a>00008 <span class="comment">// Unless required by applicable law or agreed to in writing, software</span>
<a name="l00009"></a>00009 <span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00010"></a>00010 <span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00011"></a>00011 <span class="comment">// See the License for the specific language governing permissions and</span>
<a name="l00012"></a>00012 <span class="comment">// limitations under the License.</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="commontraining_8h.html">commontraining.h</a>&quot;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#ifndef USE_STD_NAMESPACE</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#include &quot;base/init_google.h&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;base/commandlineflags.h&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#endif</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#include &quot;allheaders.h&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="ccutil_8h.html">ccutil.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="classify_8h.html">classify.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="oldlist_8h.html">oldlist.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="mf_8h.html">mf.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="clusttool_8h.html">clusttool.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="cluster_8h.html">cluster.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="tessopt_8h.html">tessopt.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="efio_8h.html">efio.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="emalloc_8h.html">emalloc.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="featdefs_8h.html">featdefs.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="fontinfo_8h.html">fontinfo.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="intfeaturespace_8h.html">intfeaturespace.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="mastertrainer_8h.html">mastertrainer.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="tessdatamanager_8h.html">tessdatamanager.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="tprintf_8h.html">tprintf.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="freelist_8h.html">freelist.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="params_8h.html">params.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="shapetable_8h.html">shapetable.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="unicity__table_8h.html">unicity_table.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">using</span> <a class="code" href="classtesseract_1_1_c_c_util.html">tesseract::CCUtil</a>;
<a name="l00045"></a>00045 <span class="keyword">using</span> <a class="code" href="structtesseract_1_1_font_info.html">tesseract::FontInfo</a>;
<a name="l00046"></a>00046 <span class="keyword">using</span> <a class="code" href="classtesseract_1_1_int_feature_space.html">tesseract::IntFeatureSpace</a>;
<a name="l00047"></a>00047 <span class="keyword">using</span> <a class="code" href="classtesseract_1_1_param_utils.html">tesseract::ParamUtils</a>;
<a name="l00048"></a>00048 <span class="keyword">using</span> <a class="code" href="classtesseract_1_1_shape_table.html">tesseract::ShapeTable</a>;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">// Global Variables.</span>
<a name="l00051"></a>00051 <span class="comment">// global variable to hold configuration parameters to control clustering</span>
<a name="l00052"></a>00052 <span class="comment">// -M 0.625   -B 0.05   -I 1.0   -C 1e-6.</span>
<a name="l00053"></a><a class="code" href="commontraining_8h.html#a1630a3dc82a9a7cef07bb6153df9eb9c">00053</a> <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a> = { <a class="code" href="cluster_8h.html#a2bf647f23b4a059a559e4d991437c9eaa39d32ff639641ca169c9729c58614459">elliptical</a>, 0.625, 0.05, 1.0, 1e-6, 0 };
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <a class="code" href="commontraining_8h.html#ad748a6074d71dbad0eefb8e9f5a92bb0">INT_PARAM_FLAG</a>(debug_level, 0, <span class="stringliteral">&quot;Level of Trainer debugging&quot;</span>);
<a name="l00056"></a>00056 <a class="code" href="commontraining_8h.html#ad748a6074d71dbad0eefb8e9f5a92bb0">INT_PARAM_FLAG</a>(load_images, 0, <span class="stringliteral">&quot;Load images with tr files&quot;</span>);
<a name="l00057"></a>00057 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(configfile, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;File to load more configs from&quot;</span>);
<a name="l00058"></a>00058 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(D, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Directory to write output files to&quot;</span>);
<a name="l00059"></a>00059 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(F, <span class="stringliteral">&quot;font_properties&quot;</span>, <span class="stringliteral">&quot;File listing font properties&quot;</span>);
<a name="l00060"></a>00060 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(X, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;File listing font xheights&quot;</span>);
<a name="l00061"></a>00061 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(U, <span class="stringliteral">&quot;unicharset&quot;</span>, <span class="stringliteral">&quot;File to load unicharset from&quot;</span>);
<a name="l00062"></a>00062 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(O, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;File to write unicharset to&quot;</span>);
<a name="l00063"></a>00063 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(input_trainer, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;File to load trainer from&quot;</span>);
<a name="l00064"></a>00064 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(output_trainer, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;File to write trainer to&quot;</span>);
<a name="l00065"></a>00065 <a class="code" href="commontraining_8h.html#ae27a3cb8977a05a660ea49ebece9f518">STRING_PARAM_FLAG</a>(test_ch, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;UTF8 test character string&quot;</span>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">// The usage strings are different as the DEFINE_* flags are available on</span>
<a name="l00068"></a>00068 <span class="comment">// the command line, but the *_VAR flags are set through a config file with</span>
<a name="l00069"></a>00069 <span class="comment">// some of them available through special command-line args.</span>
<a name="l00070"></a>00070 <span class="preprocessor">#ifndef USE_STD_NAMESPACE</span>
<a name="l00071"></a><a class="code" href="commontraining_8cpp.html#ac1e8179d7ded1e0ae4170780e168b5cc">00071</a> <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="commontraining_8cpp.html#ac1e8179d7ded1e0ae4170780e168b5cc">kUsage</a> = <span class="stringliteral">&quot;[flags] [ .tr files ... ]\n&quot;</span>;
<a name="l00072"></a>00072 <span class="preprocessor">#else</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="commontraining_8cpp.html#ac1e8179d7ded1e0ae4170780e168b5cc">kUsage</a> = <span class="stringliteral">&quot;[-c configfile]\n&quot;</span>
<a name="l00074"></a>00074     <span class="stringliteral">&quot;\t[-D Directory]\n&quot;</span>
<a name="l00075"></a>00075     <span class="stringliteral">&quot;\t[-M MinSamples] [-B MaxBad] [-I Independence] [-C Confidence]\n&quot;</span>
<a name="l00076"></a>00076     <span class="stringliteral">&quot;\t[-U InputUnicharset]\n&quot;</span>
<a name="l00077"></a>00077     <span class="stringliteral">&quot;\t[-O OutputUnicharset]\n&quot;</span>
<a name="l00078"></a>00078     <span class="stringliteral">&quot;\t[-F FontInfoFile]\n&quot;</span>
<a name="l00079"></a>00079     <span class="stringliteral">&quot;\t[-X InputXHeightsFile]\n&quot;</span>
<a name="l00080"></a>00080     <span class="stringliteral">&quot;\t[-S InputShapeTable]\n&quot;</span>
<a name="l00081"></a>00081     <span class="stringliteral">&quot;\t[ .tr files ... ]\n&quot;</span>;
<a name="l00082"></a>00082 <span class="preprocessor">#endif</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00084"></a><a class="code" href="commontraining_8h.html#a7bbe652f7a8f769dd65d6442a8f004a9">00084</a> <a class="code" href="struct_f_e_a_t_u_r_e___d_e_f_s___s_t_r_u_c_t.html">FEATURE_DEFS_STRUCT</a> <a class="code" href="commontraining_8cpp.html#a7bbe652f7a8f769dd65d6442a8f004a9">feature_defs</a>;
<a name="l00085"></a><a class="code" href="commontraining_8cpp.html#acbe955bd3fe0e5af5ace2d4bb3c1fbe7">00085</a> <a class="code" href="classtesseract_1_1_c_c_util.html">CCUtil</a> <a class="code" href="commontraining_8cpp.html#acbe955bd3fe0e5af5ace2d4bb3c1fbe7">ccutil</a>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00088"></a><a class="code" href="commontraining_8h.html#a5177d61ebf73a60571198cb6eaa753ac">00088</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a5177d61ebf73a60571198cb6eaa753ac">ParseArguments</a>(<span class="keywordtype">int</span>* argc, <span class="keywordtype">char</span> ***argv) {
<a name="l00089"></a>00089 <span class="comment">/*</span>
<a name="l00090"></a>00090 <span class="comment"> **     Parameters:</span>
<a name="l00091"></a>00091 <span class="comment"> **             argc    number of command line arguments to parse</span>
<a name="l00092"></a>00092 <span class="comment"> **             argv    command line arguments</span>
<a name="l00093"></a>00093 <span class="comment"> **     Globals:</span>
<a name="l00094"></a>00094 <span class="comment"> **             ShowSignificantProtos   flag controlling proto display</span>
<a name="l00095"></a>00095 <span class="comment"> **             ShowInsignificantProtos flag controlling proto display</span>
<a name="l00096"></a>00096 <span class="comment"> **             Config                  current clustering parameters</span>
<a name="l00097"></a>00097 <span class="comment"> **             tessoptarg, tessoptind          defined by tessopt sys call</span>
<a name="l00098"></a>00098 <span class="comment"> **             Argc, Argv              global copies of argc and argv</span>
<a name="l00099"></a>00099 <span class="comment"> **     Operation:</span>
<a name="l00100"></a>00100 <span class="comment"> **             This routine parses the command line arguments that were</span>
<a name="l00101"></a>00101 <span class="comment"> **             passed to the program.  The legal arguments are shown in the usage</span>
<a name="l00102"></a>00102 <span class="comment"> **             message below:</span>
<a name="l00103"></a>00103 <span class="comment"></span>
<a name="l00104"></a>00104 <span class="comment"> **     Return: none</span>
<a name="l00105"></a>00105 <span class="comment"> **     Exceptions: Illegal options terminate the program.</span>
<a name="l00106"></a>00106 <span class="comment"> **     History: 7/24/89, DSJ, Created.</span>
<a name="l00107"></a>00107 <span class="comment"> */</span>
<a name="l00108"></a>00108 <span class="preprocessor">#ifndef USE_STD_NAMESPACE</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>  InitGoogle(<a class="code" href="commontraining_8cpp.html#ac1e8179d7ded1e0ae4170780e168b5cc">kUsage</a>, argc, argv, <span class="keyword">true</span>);
<a name="l00110"></a>00110   <a class="code" href="tessopt_8cpp.html#aef382bc42a86adef688f3b7901cc9593">tessoptind</a> = 1;
<a name="l00111"></a>00111 <span class="preprocessor">#else</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>  <span class="keywordtype">int</span>    Option;
<a name="l00113"></a>00113   <span class="keywordtype">int</span>    ParametersRead;
<a name="l00114"></a>00114   <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a>  Error;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   Error = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00117"></a>00117   <span class="keywordflow">while</span> ((Option = <a class="code" href="tessopt_8cpp.html#a810b696d632429d99dd1a92fbcfed32d">tessopt</a>(*argc, *argv, <span class="stringliteral">&quot;F:O:U:D:C:I:M:B:S:X:c:&quot;</span>)) != EOF) {
<a name="l00118"></a>00118     <span class="keywordflow">switch</span> (Option) {
<a name="l00119"></a>00119       <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:
<a name="l00120"></a>00120         ParametersRead = sscanf(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>, <span class="stringliteral">&quot;%lf&quot;</span>, &amp;(Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a>) );
<a name="l00121"></a>00121         <span class="keywordflow">if</span> ( ParametersRead != 1 ) Error = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00122"></a>00122         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a> &gt; 1 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a> = 1;
<a name="l00123"></a>00123         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a> &lt; 0 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a4758d8ddf0644e204132b779a786b6fb">Confidence</a> = 0;
<a name="l00124"></a>00124         <span class="keywordflow">break</span>;
<a name="l00125"></a>00125       <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:
<a name="l00126"></a>00126         ParametersRead = sscanf(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>, <span class="stringliteral">&quot;%f&quot;</span>, &amp;(Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a77c7d2361e92592098a3287cabc26a6d">Independence</a>) );
<a name="l00127"></a>00127         <span class="keywordflow">if</span> ( ParametersRead != 1 ) Error = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00128"></a>00128         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a77c7d2361e92592098a3287cabc26a6d">Independence</a> &gt; 1 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a77c7d2361e92592098a3287cabc26a6d">Independence</a> = 1;
<a name="l00129"></a>00129         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a77c7d2361e92592098a3287cabc26a6d">Independence</a> &lt; 0 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a77c7d2361e92592098a3287cabc26a6d">Independence</a> = 0;
<a name="l00130"></a>00130         <span class="keywordflow">break</span>;
<a name="l00131"></a>00131       <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:
<a name="l00132"></a>00132         ParametersRead = sscanf(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>, <span class="stringliteral">&quot;%f&quot;</span>, &amp;(Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a>) );
<a name="l00133"></a>00133         <span class="keywordflow">if</span> ( ParametersRead != 1 ) Error = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00134"></a>00134         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a> &gt; 1 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a> = 1;
<a name="l00135"></a>00135         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a> &lt; 0 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a> = 0;
<a name="l00136"></a>00136         <span class="keywordflow">break</span>;
<a name="l00137"></a>00137       <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:
<a name="l00138"></a>00138         ParametersRead = sscanf(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>, <span class="stringliteral">&quot;%f&quot;</span>, &amp;(Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#aaf0758a0e763d9525d6d7781db8ade14">MaxIllegal</a>) );
<a name="l00139"></a>00139         <span class="keywordflow">if</span> ( ParametersRead != 1 ) Error = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00140"></a>00140         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#aaf0758a0e763d9525d6d7781db8ade14">MaxIllegal</a> &gt; 1 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#aaf0758a0e763d9525d6d7781db8ade14">MaxIllegal</a> = 1;
<a name="l00141"></a>00141         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#aaf0758a0e763d9525d6d7781db8ade14">MaxIllegal</a> &lt; 0 ) Config.<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#aaf0758a0e763d9525d6d7781db8ade14">MaxIllegal</a> = 0;
<a name="l00142"></a>00142         <span class="keywordflow">break</span>;
<a name="l00143"></a>00143       <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l00144"></a>00144         FLAGS_configfile.set_value(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>);
<a name="l00145"></a>00145         <span class="keywordflow">break</span>;
<a name="l00146"></a>00146       <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
<a name="l00147"></a>00147         FLAGS_D.set_value(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>);
<a name="l00148"></a>00148         <span class="keywordflow">break</span>;
<a name="l00149"></a>00149       <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:
<a name="l00150"></a>00150         FLAGS_U.set_value(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>);
<a name="l00151"></a>00151         <span class="keywordflow">break</span>;
<a name="l00152"></a>00152       <span class="keywordflow">case</span> <span class="charliteral">&#39;O&#39;</span>:
<a name="l00153"></a>00153         FLAGS_O.set_value(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>);
<a name="l00154"></a>00154         <span class="keywordflow">break</span>;
<a name="l00155"></a>00155       <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:
<a name="l00156"></a>00156         FLAGS_F.set_value(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>);
<a name="l00157"></a>00157         <span class="keywordflow">break</span>;
<a name="l00158"></a>00158       <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:
<a name="l00159"></a>00159         FLAGS_X.set_value(<a class="code" href="tessopt_8cpp.html#ae2c7e7835346e9460d1534ecc3ba3f2f">tessoptarg</a>);
<a name="l00160"></a>00160         <span class="keywordflow">break</span>;
<a name="l00161"></a>00161       <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:
<a name="l00162"></a>00162         Error = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00163"></a>00163         <span class="keywordflow">break</span>;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (Error) {
<a name="l00166"></a>00166       fprintf(stderr, <span class="stringliteral">&quot;Usage: %s %s\n&quot;</span>, (*argv)[0], <a class="code" href="commontraining_8cpp.html#ac1e8179d7ded1e0ae4170780e168b5cc">kUsage</a>);
<a name="l00167"></a>00167       exit(2);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169   }
<a name="l00170"></a>00170 <span class="preprocessor">#endif</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>  <span class="comment">// Set additional parameters from config file if specified.</span>
<a name="l00172"></a>00172   <span class="keywordflow">if</span> (!FLAGS_configfile.empty()) {
<a name="l00173"></a>00173     <a class="code" href="classtesseract_1_1_param_utils.html#a0709ab180ade22613925bc317ddf34b7">tesseract::ParamUtils::ReadParamsFile</a>(
<a name="l00174"></a>00174         FLAGS_configfile.c_str(),
<a name="l00175"></a>00175         <a class="code" href="namespacetesseract.html#a0fc9989588ecf8f236da49b58f96a6c5a713c7bc13788ed69eb16dd9e5f309d12">tesseract::SET_PARAM_CONSTRAINT_NON_INIT_ONLY</a>,
<a name="l00176"></a>00176         ccutil.<a class="code" href="classtesseract_1_1_c_c_util.html#ac993425386ae1f73762107299ee8a114">params</a>());
<a name="l00177"></a>00177   }
<a name="l00178"></a>00178 }  <span class="comment">// ParseArguments</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keyword">namespace </span>tesseract {
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="comment">// Helper loads shape table from the given file.</span>
<a name="l00183"></a><a class="code" href="namespacetesseract.html#a1f150258bf03e986518efd91fb077322">00183</a> <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>* <a class="code" href="namespacetesseract.html#a1f150258bf03e986518efd91fb077322">LoadShapeTable</a>(<span class="keyword">const</span> <a class="code" href="class_s_t_r_i_n_g.html">STRING</a>&amp; file_prefix) {
<a name="l00184"></a>00184   <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>* shape_table = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00185"></a>00185   <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> shape_table_file = file_prefix;
<a name="l00186"></a>00186   shape_table_file += kShapeTableFileSuffix;
<a name="l00187"></a>00187   FILE* shape_fp = fopen(shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00188"></a>00188   <span class="keywordflow">if</span> (shape_fp != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00189"></a>00189     shape_table = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>;
<a name="l00190"></a>00190     <span class="keywordflow">if</span> (!shape_table-&gt;<a class="code" href="classtesseract_1_1_shape_table.html#adfba8cbf1c85a12b6b826d332614072f">DeSerialize</a>(<span class="keyword">false</span>, shape_fp)) {
<a name="l00191"></a>00191       <span class="keyword">delete</span> shape_table;
<a name="l00192"></a>00192       shape_table = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00193"></a>00193       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Error: Failed to read shape table %s\n&quot;</span>,
<a name="l00194"></a>00194               shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00195"></a>00195     } <span class="keywordflow">else</span> {
<a name="l00196"></a>00196       <span class="keywordtype">int</span> num_shapes = shape_table-&gt;<a class="code" href="classtesseract_1_1_shape_table.html#a924919daeadb48539e3d68c65013c173">NumShapes</a>();
<a name="l00197"></a>00197       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Read shape table %s of %d shapes\n&quot;</span>,
<a name="l00198"></a>00198               shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), num_shapes);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200     fclose(shape_fp);
<a name="l00201"></a>00201   } <span class="keywordflow">else</span> {
<a name="l00202"></a>00202     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Warning: No shape table file present: %s\n&quot;</span>,
<a name="l00203"></a>00203             shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205   <span class="keywordflow">return</span> shape_table;
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">// Helper to write the shape_table.</span>
<a name="l00209"></a><a class="code" href="namespacetesseract.html#af6657e7cdbf17875a06df792c22cd28b">00209</a> <span class="keywordtype">void</span> <a class="code" href="namespacetesseract.html#af6657e7cdbf17875a06df792c22cd28b">WriteShapeTable</a>(<span class="keyword">const</span> <a class="code" href="class_s_t_r_i_n_g.html">STRING</a>&amp; file_prefix, <span class="keyword">const</span> <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>&amp; shape_table) {
<a name="l00210"></a>00210   <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> shape_table_file = file_prefix;
<a name="l00211"></a>00211   shape_table_file += kShapeTableFileSuffix;
<a name="l00212"></a>00212   FILE* fp = fopen(shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), <span class="stringliteral">&quot;wb&quot;</span>);
<a name="l00213"></a>00213   <span class="keywordflow">if</span> (fp != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (!shape_table.<a class="code" href="classtesseract_1_1_shape_table.html#afba3bb1970bb5e5fe626d3259955a8d3">Serialize</a>(fp)) {
<a name="l00215"></a>00215       fprintf(stderr, <span class="stringliteral">&quot;Error writing shape table: %s\n&quot;</span>,
<a name="l00216"></a>00216               shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218     fclose(fp);
<a name="l00219"></a>00219   } <span class="keywordflow">else</span> {
<a name="l00220"></a>00220     fprintf(stderr, <span class="stringliteral">&quot;Error creating shape table: %s\n&quot;</span>,
<a name="l00221"></a>00221             shape_table_file.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">// Creates a MasterTraininer and loads the training data into it:</span>
<a name="l00226"></a>00226 <span class="comment">// Initializes feature_defs and IntegerFX.</span>
<a name="l00227"></a>00227 <span class="comment">// Loads the shape_table if shape_table != NULL.</span>
<a name="l00228"></a>00228 <span class="comment">// Loads initial unicharset from -U command-line option.</span>
<a name="l00229"></a>00229 <span class="comment">// If FLAGS_input_trainer is set, loads the majority of data from there, else:</span>
<a name="l00230"></a>00230 <span class="comment">//   Loads font info from -F option.</span>
<a name="l00231"></a>00231 <span class="comment">//   Loads xheights from -X option.</span>
<a name="l00232"></a>00232 <span class="comment">//   Loads samples from .tr files in remaining command-line args.</span>
<a name="l00233"></a>00233 <span class="comment">//   Deletes outliers and computes canonical samples.</span>
<a name="l00234"></a>00234 <span class="comment">//   If FLAGS_output_trainer is set, saves the trainer for future use.</span>
<a name="l00235"></a>00235 <span class="comment">// Computes canonical and cloud features.</span>
<a name="l00236"></a>00236 <span class="comment">// If shape_table is not NULL, but failed to load, make a fake flat one,</span>
<a name="l00237"></a>00237 <span class="comment">// as shape clustering was not run.</span>
<a name="l00238"></a><a class="code" href="namespacetesseract.html#a2af3b74c1139cfc070d17e947f212b58">00238</a> <a class="code" href="classtesseract_1_1_master_trainer.html">MasterTrainer</a>* <a class="code" href="namespacetesseract.html#a2af3b74c1139cfc070d17e947f212b58">LoadTrainingData</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> * argv,
<a name="l00239"></a>00239                                 <span class="keywordtype">bool</span> replication,
<a name="l00240"></a>00240                                 <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>** shape_table,
<a name="l00241"></a>00241                                 <a class="code" href="class_s_t_r_i_n_g.html">STRING</a>* file_prefix) {
<a name="l00242"></a>00242   <a class="code" href="featdefs_8cpp.html#a6e4c84ab01e39577e4a74d9ab1eff68b">InitFeatureDefs</a>(&amp;feature_defs);
<a name="l00243"></a>00243   <a class="code" href="intfx_8cpp.html#a1281b17b87e56c99d53fe6bb1f7c2d55">InitIntegerFX</a>();
<a name="l00244"></a>00244   *file_prefix = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00245"></a>00245   <span class="keywordflow">if</span> (!FLAGS_D.empty()) {
<a name="l00246"></a>00246     *file_prefix += FLAGS_D.c_str();
<a name="l00247"></a>00247     *file_prefix += <span class="stringliteral">&quot;/&quot;</span>;
<a name="l00248"></a>00248   }
<a name="l00249"></a>00249   <span class="comment">// If we are shape clustering (NULL shape_table) or we successfully load</span>
<a name="l00250"></a>00250   <span class="comment">// a shape_table written by a previous shape clustering, then</span>
<a name="l00251"></a>00251   <span class="comment">// shape_analysis will be true, meaning that the MasterTrainer will replace</span>
<a name="l00252"></a>00252   <span class="comment">// some members of the unicharset with their fragments.</span>
<a name="l00253"></a>00253   <span class="keywordtype">bool</span> shape_analysis = <span class="keyword">false</span>;
<a name="l00254"></a>00254   <span class="keywordflow">if</span> (shape_table != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00255"></a>00255     *shape_table = <a class="code" href="namespacetesseract.html#a1f150258bf03e986518efd91fb077322">LoadShapeTable</a>(*file_prefix);
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (*shape_table != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00257"></a>00257       shape_analysis = <span class="keyword">true</span>;
<a name="l00258"></a>00258   } <span class="keywordflow">else</span> {
<a name="l00259"></a>00259     shape_analysis = <span class="keyword">true</span>;
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261   <a class="code" href="classtesseract_1_1_master_trainer.html">MasterTrainer</a>* trainer = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_master_trainer.html">MasterTrainer</a>(<a class="code" href="namespacetesseract.html#ad3e7916f0120e26e7b4e0f830784194aa81bec0cd85211e03befb611fa7003180">NM_CHAR_ANISOTROPIC</a>,
<a name="l00262"></a>00262                                              shape_analysis,
<a name="l00263"></a>00263                                              replication,
<a name="l00264"></a>00264                                              FLAGS_debug_level);
<a name="l00265"></a>00265   <span class="keywordflow">if</span> (FLAGS_input_trainer.empty()) {
<a name="l00266"></a>00266     trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a1d16b8d08ef1f8725dc2007b4a2e347e">LoadUnicharset</a>(FLAGS_U.c_str());
<a name="l00267"></a>00267     <span class="comment">// Get basic font information from font_properties.</span>
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (!FLAGS_F.empty()) {
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (!trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a10cf3bb89a6f869eefdf3d07b0be0be8">LoadFontInfo</a>(FLAGS_F.c_str())) {
<a name="l00270"></a>00270         <span class="keyword">delete</span> trainer;
<a name="l00271"></a>00271         <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00272"></a>00272       }
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (!FLAGS_X.empty()) {
<a name="l00275"></a>00275       <span class="keywordflow">if</span> (!trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a93a301eb098f4f8a4f7f93fa871d1fff">LoadXHeights</a>(FLAGS_X.c_str())) {
<a name="l00276"></a>00276         <span class="keyword">delete</span> trainer;
<a name="l00277"></a>00277         <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00278"></a>00278       }
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280     <a class="code" href="classtesseract_1_1_int_feature_space.html">IntFeatureSpace</a> fs;
<a name="l00281"></a>00281     fs.<a class="code" href="classtesseract_1_1_int_feature_space.html#a94b0e8e0953196dfad06f647f6e29e30">Init</a>(<a class="code" href="intfeaturespace_8h.html#a550dc4140b4554a9486c01d053542b07">kBoostXYBuckets</a>, <a class="code" href="intfeaturespace_8h.html#a550dc4140b4554a9486c01d053542b07">kBoostXYBuckets</a>, <a class="code" href="intfeaturespace_8h.html#a72ebc24f4eb671e8121fb54d9b6b5208">kBoostDirBuckets</a>);
<a name="l00282"></a>00282     trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a8c936d1a0d9a20ab57984f0d5e32bb6b">SetFeatureSpace</a>(fs);
<a name="l00283"></a>00283     <span class="keyword">const</span> <span class="keywordtype">char</span>* page_name;
<a name="l00284"></a>00284     <span class="comment">// Load training data from .tr files on the command line.</span>
<a name="l00285"></a>00285     <span class="keywordflow">while</span> ((page_name = <a class="code" href="commontraining_8cpp.html#acc69f64ead8e1c64560ef259e5d87b5b">GetNextFilename</a>(argc, argv)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00286"></a>00286       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Reading %s ...\n&quot;</span>, page_name);
<a name="l00287"></a>00287       FILE* fp = <a class="code" href="efio_8cpp.html#a1a07e904724c29e89b04235a34ded950">Efopen</a>(page_name, <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00288"></a>00288       trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#ab92b0458c19c0847f8a7d0bc548679e5">ReadTrainingSamples</a>(fp, feature_defs, <span class="keyword">false</span>);
<a name="l00289"></a>00289       fclose(fp);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       <span class="comment">// If there is a file with [lang].[fontname].exp[num].fontinfo present,</span>
<a name="l00292"></a>00292       <span class="comment">// read font spacing information in to fontinfo_table.</span>
<a name="l00293"></a>00293       <span class="keywordtype">int</span> pagename_len = strlen(page_name);
<a name="l00294"></a>00294       <span class="keywordtype">char</span> *fontinfo_file_name = <span class="keyword">new</span> <span class="keywordtype">char</span>[pagename_len + 7];
<a name="l00295"></a>00295       strncpy(fontinfo_file_name, page_name, pagename_len - 2);  <span class="comment">// remove &quot;tr&quot;</span>
<a name="l00296"></a>00296       strcpy(fontinfo_file_name + pagename_len - 2, <span class="stringliteral">&quot;fontinfo&quot;</span>);  <span class="comment">// +&quot;fontinfo&quot;</span>
<a name="l00297"></a>00297       trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#ae12810d98f7d82157a1e8a18548d2f42">AddSpacingInfo</a>(fontinfo_file_name);
<a name="l00298"></a>00298       <span class="keyword">delete</span>[] fontinfo_file_name;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300       <span class="comment">// Load the images into memory if required by the classifier.</span>
<a name="l00301"></a>00301       <span class="keywordflow">if</span> (FLAGS_load_images) {
<a name="l00302"></a>00302         <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> image_name = page_name;
<a name="l00303"></a>00303         <span class="comment">// Chop off the tr and replace with tif. Extension must be tif!</span>
<a name="l00304"></a>00304         image_name.<a class="code" href="class_s_t_r_i_n_g.html#a0d5a6c456f8e3ef4b4a5077031573df8">truncate_at</a>(image_name.<a class="code" href="class_s_t_r_i_n_g.html#a168505a533eda60219c93e25adf4cdc5">length</a>() - 2);
<a name="l00305"></a>00305         image_name += <span class="stringliteral">&quot;tif&quot;</span>;
<a name="l00306"></a>00306         trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a27f473749fbeb6c5c6dfb92e1afac3ab">LoadPageImages</a>(image_name.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00307"></a>00307       }
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a22e405da9437d15500ed6796a0195143">PostLoadCleanup</a>();
<a name="l00310"></a>00310     <span class="comment">// Write the master trainer if required.</span>
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (!FLAGS_output_trainer.empty()) {
<a name="l00312"></a>00312       FILE* fp = fopen(FLAGS_output_trainer.c_str(), <span class="stringliteral">&quot;wb&quot;</span>);
<a name="l00313"></a>00313       <span class="keywordflow">if</span> (fp == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00314"></a>00314         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Can&#39;t create saved trainer data!\n&quot;</span>);
<a name="l00315"></a>00315       } <span class="keywordflow">else</span> {
<a name="l00316"></a>00316         trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a174b7c3318dcc892b7976d59275c4b49">Serialize</a>(fp);
<a name="l00317"></a>00317         fclose(fp);
<a name="l00318"></a>00318       }
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320   } <span class="keywordflow">else</span> {
<a name="l00321"></a>00321     <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;
<a name="l00322"></a>00322     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Loading master trainer from file:%s\n&quot;</span>,
<a name="l00323"></a>00323             FLAGS_input_trainer.c_str());
<a name="l00324"></a>00324     FILE* fp = fopen(FLAGS_input_trainer.c_str(), <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (fp == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00326"></a>00326       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Can&#39;t read file %s to initialize master trainer\n&quot;</span>,
<a name="l00327"></a>00327               FLAGS_input_trainer.c_str());
<a name="l00328"></a>00328     } <span class="keywordflow">else</span> {
<a name="l00329"></a>00329       success = trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a9832f32287c7e682097c0c780270057a">DeSerialize</a>(<span class="keyword">false</span>, fp);
<a name="l00330"></a>00330       fclose(fp);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (!success) {
<a name="l00333"></a>00333       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Deserialize of master trainer failed!\n&quot;</span>);
<a name="l00334"></a>00334       <span class="keyword">delete</span> trainer;
<a name="l00335"></a>00335       <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337   }
<a name="l00338"></a>00338   trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#a5708ffeae4662b9f2b09b2ef76ba9d20">PreTrainingSetup</a>();
<a name="l00339"></a>00339   <span class="keywordflow">if</span> (!FLAGS_O.empty() &amp;&amp;
<a name="l00340"></a>00340       !trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#ae89c92b73a62da4562e7f16ced0f759f">unicharset</a>().<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a1f82a51ad2d63d499a625b97ec806811">save_to_file</a>(FLAGS_O.c_str())) {
<a name="l00341"></a>00341     fprintf(stderr, <span class="stringliteral">&quot;Failed to save unicharset to file %s\n&quot;</span>, FLAGS_O.c_str());
<a name="l00342"></a>00342     <span class="keyword">delete</span> trainer;
<a name="l00343"></a>00343     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00344"></a>00344   }
<a name="l00345"></a>00345   <span class="keywordflow">if</span> (shape_table != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00346"></a>00346     <span class="comment">// If we previously failed to load a shapetable, then shape clustering</span>
<a name="l00347"></a>00347     <span class="comment">// wasn&#39;t run so make a flat one now.</span>
<a name="l00348"></a>00348     <span class="keywordflow">if</span> (*shape_table == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00349"></a>00349       *shape_table = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>;
<a name="l00350"></a>00350       trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#ab67fe21e2a92afb482594041cbf95735">SetupFlatShapeTable</a>(*shape_table);
<a name="l00351"></a>00351       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Flat shape table summary: %s\n&quot;</span>,
<a name="l00352"></a>00352               (*shape_table)-&gt;SummaryStr().string());
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354     (*shape_table)-&gt;set_unicharset(trainer-&gt;<a class="code" href="classtesseract_1_1_master_trainer.html#ae89c92b73a62da4562e7f16ced0f759f">unicharset</a>());
<a name="l00355"></a>00355   }
<a name="l00356"></a>00356   <span class="keywordflow">return</span> trainer;
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 }  <span class="comment">// namespace tesseract.</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00362"></a><a class="code" href="commontraining_8h.html#acc69f64ead8e1c64560ef259e5d87b5b">00362</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="commontraining_8cpp.html#acc69f64ead8e1c64560ef259e5d87b5b">GetNextFilename</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> * argv) {
<a name="l00363"></a>00363   <span class="comment">/*</span>
<a name="l00364"></a>00364 <span class="comment">   **   Parameters: none</span>
<a name="l00365"></a>00365 <span class="comment">   **   Globals:</span>
<a name="l00366"></a>00366 <span class="comment">   **           tessoptind                      defined by tessopt sys call</span>
<a name="l00367"></a>00367 <span class="comment">   **   Operation:</span>
<a name="l00368"></a>00368 <span class="comment">   **           This routine returns the next command line argument.  If</span>
<a name="l00369"></a>00369 <span class="comment">   **           there are no remaining command line arguments, it returns</span>
<a name="l00370"></a>00370 <span class="comment">   **           NULL.  This routine should only be called after all option</span>
<a name="l00371"></a>00371 <span class="comment">   **           arguments have been parsed and removed with ParseArguments.</span>
<a name="l00372"></a>00372 <span class="comment">   **   Return: Next command line argument or NULL.</span>
<a name="l00373"></a>00373 <span class="comment">   **   Exceptions: none</span>
<a name="l00374"></a>00374 <span class="comment">   **   History: Fri Aug 18 09:34:12 1989, DSJ, Created.</span>
<a name="l00375"></a>00375 <span class="comment">   */</span>
<a name="l00376"></a>00376   <span class="keywordflow">if</span> (<a class="code" href="tessopt_8cpp.html#aef382bc42a86adef688f3b7901cc9593">tessoptind</a> &lt; argc)
<a name="l00377"></a>00377     <span class="keywordflow">return</span> argv[<a class="code" href="tessopt_8cpp.html#aef382bc42a86adef688f3b7901cc9593">tessoptind</a>++];
<a name="l00378"></a>00378   <span class="keywordflow">else</span>
<a name="l00379"></a>00379     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00380"></a>00380 }       <span class="comment">/* GetNextFilename */</span>
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00385"></a><a class="code" href="commontraining_8h.html#a7acd4f2950ab3bd42ed87dc7b081be83">00385</a> <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> <a class="code" href="commontraining_8cpp.html#a7acd4f2950ab3bd42ed87dc7b081be83">FindList</a> (
<a name="l00386"></a>00386     <a class="code" href="structlist__rec.html">LIST</a>        List,
<a name="l00387"></a>00387     <span class="keywordtype">char</span>        *Label)
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/*</span>
<a name="l00390"></a>00390 <span class="comment"> **     Parameters:</span>
<a name="l00391"></a>00391 <span class="comment"> **             List            list to search</span>
<a name="l00392"></a>00392 <span class="comment"> **             Label           label to search for</span>
<a name="l00393"></a>00393 <span class="comment"> **     Globals: none</span>
<a name="l00394"></a>00394 <span class="comment"> **     Operation:</span>
<a name="l00395"></a>00395 <span class="comment"> **             This routine searches thru a list of labeled lists to find</span>
<a name="l00396"></a>00396 <span class="comment"> **             a list with the specified label.  If a matching labeled list</span>
<a name="l00397"></a>00397 <span class="comment"> **             cannot be found, NULL is returned.</span>
<a name="l00398"></a>00398 <span class="comment"> **     Return: Labeled list with the specified Label or NULL.</span>
<a name="l00399"></a>00399 <span class="comment"> **     Exceptions: none</span>
<a name="l00400"></a>00400 <span class="comment"> **     History: Fri Aug 18 15:57:41 1989, DSJ, Created.</span>
<a name="l00401"></a>00401 <span class="comment"> */</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404   <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a>   LabeledList;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a> (List)
<a name="l00407"></a>00407   {
<a name="l00408"></a>00408     LabeledList = (<a class="code" href="commontraining_8h.html#af49d04c90ffcf9376c7a1e1db99182cb">LABELEDLIST</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (List);
<a name="l00409"></a>00409     <span class="keywordflow">if</span> (strcmp (LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#ad4701118c2e75f005c1f7e4c53abb35d">Label</a>, Label) == 0)
<a name="l00410"></a>00410       <span class="keywordflow">return</span> (LabeledList);
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412   <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 }       <span class="comment">/* FindList */</span>
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00417"></a><a class="code" href="commontraining_8h.html#a83417b534a3cb0ea9e43eba33e37f1bc">00417</a> <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> <a class="code" href="commontraining_8cpp.html#a83417b534a3cb0ea9e43eba33e37f1bc">NewLabeledList</a> (
<a name="l00418"></a>00418     <span class="keyword">const</span> <span class="keywordtype">char</span>  *Label)
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 <span class="comment">/*</span>
<a name="l00421"></a>00421 <span class="comment"> **     Parameters:</span>
<a name="l00422"></a>00422 <span class="comment"> **             Label   label for new list</span>
<a name="l00423"></a>00423 <span class="comment"> **     Globals: none</span>
<a name="l00424"></a>00424 <span class="comment"> **     Operation:</span>
<a name="l00425"></a>00425 <span class="comment"> **             This routine allocates a new, empty labeled list and gives</span>
<a name="l00426"></a>00426 <span class="comment"> **             it the specified label.</span>
<a name="l00427"></a>00427 <span class="comment"> **     Return: New, empty labeled list.</span>
<a name="l00428"></a>00428 <span class="comment"> **     Exceptions: none</span>
<a name="l00429"></a>00429 <span class="comment"> **     History: Fri Aug 18 16:08:46 1989, DSJ, Created.</span>
<a name="l00430"></a>00430 <span class="comment"> */</span>
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 {
<a name="l00433"></a>00433   <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a>   LabeledList;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   LabeledList = (<a class="code" href="commontraining_8h.html#af49d04c90ffcf9376c7a1e1db99182cb">LABELEDLIST</a>) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLISTNODE</a>));
<a name="l00436"></a>00436   LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#ad4701118c2e75f005c1f7e4c53abb35d">Label</a> = (<span class="keywordtype">char</span>*)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (strlen (Label)+1);
<a name="l00437"></a>00437   strcpy (LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#ad4701118c2e75f005c1f7e4c53abb35d">Label</a>, Label);
<a name="l00438"></a>00438   LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a> = <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>;
<a name="l00439"></a>00439   LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#aab481329945e65c4aeee79b145e4de51">SampleCount</a> = 0;
<a name="l00440"></a>00440   LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#af23335c4319e0c5f010380d9de8f5a6d">font_sample_count</a> = 0;
<a name="l00441"></a>00441   <span class="keywordflow">return</span> (LabeledList);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 }       <span class="comment">/* NewLabeledList */</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00446"></a>00446 <span class="comment">// TODO(rays) This is now used only by cntraining. Convert cntraining to use</span>
<a name="l00447"></a>00447 <span class="comment">// the new method or get rid of it entirely.</span>
<a name="l00448"></a><a class="code" href="commontraining_8h.html#a858311d0ef1820c6e83cc15ecc0e0e28">00448</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a858311d0ef1820c6e83cc15ecc0e0e28">ReadTrainingSamples</a>(<span class="keyword">const</span> <a class="code" href="struct_f_e_a_t_u_r_e___d_e_f_s___s_t_r_u_c_t.html">FEATURE_DEFS_STRUCT</a>&amp; feature_defs,
<a name="l00449"></a>00449                          <span class="keyword">const</span> <span class="keywordtype">char</span> *feature_name, <span class="keywordtype">int</span> max_samples,
<a name="l00450"></a>00450                          <a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html">UNICHARSET</a>* unicharset,
<a name="l00451"></a>00451                          FILE* file, <a class="code" href="structlist__rec.html">LIST</a>* training_samples) {
<a name="l00452"></a>00452 <span class="comment">/*</span>
<a name="l00453"></a>00453 <span class="comment">**  Parameters:</span>
<a name="l00454"></a>00454 <span class="comment">**    file    open text file to read samples from</span>
<a name="l00455"></a>00455 <span class="comment">**  Globals: none</span>
<a name="l00456"></a>00456 <span class="comment">**  Operation:</span>
<a name="l00457"></a>00457 <span class="comment">**    This routine reads training samples from a file and</span>
<a name="l00458"></a>00458 <span class="comment">**    places them into a data structure which organizes the</span>
<a name="l00459"></a>00459 <span class="comment">**    samples by FontName and CharName.  It then returns this</span>
<a name="l00460"></a>00460 <span class="comment">**    data structure.</span>
<a name="l00461"></a>00461 <span class="comment">**  Return: none</span>
<a name="l00462"></a>00462 <span class="comment">**  Exceptions: none</span>
<a name="l00463"></a>00463 <span class="comment">**  History: Fri Aug 18 13:11:39 1989, DSJ, Created.</span>
<a name="l00464"></a>00464 <span class="comment">**       Tue May 17 1998 simplifications to structure, illiminated</span>
<a name="l00465"></a>00465 <span class="comment">**        font, and feature specification levels of structure.</span>
<a name="l00466"></a>00466 <span class="comment">*/</span>
<a name="l00467"></a>00467   <span class="keywordtype">char</span>    buffer[2048];
<a name="l00468"></a>00468   <span class="keywordtype">char</span>    unichar[<a class="code" href="unichar_8h.html#a902bc40c9d89802bc063afe30ce9e708">UNICHAR_LEN</a> + 1];
<a name="l00469"></a>00469   <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> char_sample;
<a name="l00470"></a>00470   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> feature_samples;
<a name="l00471"></a>00471   <a class="code" href="struct_c_h_a_r___d_e_s_c___s_t_r_u_c_t.html">CHAR_DESC</a> char_desc;
<a name="l00472"></a>00472   <span class="keywordtype">int</span>   i;
<a name="l00473"></a>00473   <span class="keywordtype">int</span> feature_type = <a class="code" href="featdefs_8cpp.html#a46a09d60beb44b9c9156346595f352ee">ShortNameToFeatureType</a>(feature_defs, feature_name);
<a name="l00474"></a>00474   <span class="comment">// Zero out the font_sample_count for all the classes.</span>
<a name="l00475"></a>00475   <a class="code" href="structlist__rec.html">LIST</a> it = *training_samples;
<a name="l00476"></a>00476   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(it) {
<a name="l00477"></a>00477     char_sample = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a><span class="keyword">&gt;</span>(<a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a>(it));
<a name="l00478"></a>00478     char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#af23335c4319e0c5f010380d9de8f5a6d">font_sample_count</a> = 0;
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">while</span> (fgets(buffer, 2048, file) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (buffer[0] == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00483"></a>00483       <span class="keywordflow">continue</span>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     sscanf(buffer, <span class="stringliteral">&quot;%*s %s&quot;</span>, unichar);
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (unicharset != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; !unicharset-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a9f8861ffb917e7341c821928da5865f0">contains_unichar</a>(unichar)) {
<a name="l00487"></a>00487       unicharset-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ab5198816dde686850da3530a1f8261fe">unichar_insert</a>(unichar);
<a name="l00488"></a>00488       <span class="keywordflow">if</span> (unicharset-&gt;<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>() &gt; <a class="code" href="matchdefs_8h.html#adcc52d7d059a8ca452172df64faa231c">MAX_NUM_CLASSES</a>) {
<a name="l00489"></a>00489         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Error: Size of unicharset in training is &quot;</span>
<a name="l00490"></a>00490                 <span class="stringliteral">&quot;greater than MAX_NUM_CLASSES\n&quot;</span>);
<a name="l00491"></a>00491         exit(1);
<a name="l00492"></a>00492       }
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494     char_sample = <a class="code" href="commontraining_8cpp.html#a7acd4f2950ab3bd42ed87dc7b081be83">FindList</a>(*training_samples, unichar);
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (char_sample == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00496"></a>00496       char_sample = <a class="code" href="commontraining_8cpp.html#a83417b534a3cb0ea9e43eba33e37f1bc">NewLabeledList</a>(unichar);
<a name="l00497"></a>00497       *training_samples = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a>(*training_samples, char_sample);
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499     char_desc = <a class="code" href="featdefs_8cpp.html#ae1558f5d4119a9e651a85e10887be9f3">ReadCharDescription</a>(feature_defs, file);
<a name="l00500"></a>00500     feature_samples = char_desc-&gt;<a class="code" href="struct_c_h_a_r___d_e_s_c___s_t_r_u_c_t.html#ae04ec3a6b5e474d83930ff3e57a42acb">FeatureSets</a>[feature_type];
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#af23335c4319e0c5f010380d9de8f5a6d">font_sample_count</a> &lt; max_samples || max_samples &lt;= 0) {
<a name="l00502"></a>00502       char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a> = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a>(char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a>, feature_samples);
<a name="l00503"></a>00503       char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#aab481329945e65c4aeee79b145e4de51">SampleCount</a>++;
<a name="l00504"></a>00504       char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#af23335c4319e0c5f010380d9de8f5a6d">font_sample_count</a>++;
<a name="l00505"></a>00505     } <span class="keywordflow">else</span> {
<a name="l00506"></a>00506       <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(feature_samples);
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508     <span class="keywordflow">for</span> (i = 0; i &lt; char_desc-&gt;<a class="code" href="struct_c_h_a_r___d_e_s_c___s_t_r_u_c_t.html#a44c9d1024eb43636b98d19c92f4e4b0f">NumFeatureSets</a>; i++) {
<a name="l00509"></a>00509       <span class="keywordflow">if</span> (feature_type != i)
<a name="l00510"></a>00510         <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(char_desc-&gt;<a class="code" href="struct_c_h_a_r___d_e_s_c___s_t_r_u_c_t.html#ae04ec3a6b5e474d83930ff3e57a42acb">FeatureSets</a>[i]);
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512     free(char_desc);
<a name="l00513"></a>00513   }
<a name="l00514"></a>00514 }  <span class="comment">// ReadTrainingSamples</span>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00518"></a><a class="code" href="commontraining_8h.html#a2eb4d580c0984a25fea59c6ec1196cec">00518</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a2eb4d580c0984a25fea59c6ec1196cec">FreeTrainingSamples</a>(<a class="code" href="structlist__rec.html">LIST</a> CharList) {
<a name="l00519"></a>00519 <span class="comment">/*</span>
<a name="l00520"></a>00520 <span class="comment"> **     Parameters:</span>
<a name="l00521"></a>00521 <span class="comment"> **             FontList        list of all fonts in document</span>
<a name="l00522"></a>00522 <span class="comment"> **     Globals: none</span>
<a name="l00523"></a>00523 <span class="comment"> **     Operation:</span>
<a name="l00524"></a>00524 <span class="comment"> **             This routine deallocates all of the space allocated to</span>
<a name="l00525"></a>00525 <span class="comment"> **             the specified list of training samples.</span>
<a name="l00526"></a>00526 <span class="comment"> **     Return: none</span>
<a name="l00527"></a>00527 <span class="comment"> **     Exceptions: none</span>
<a name="l00528"></a>00528 <span class="comment"> **     History: Fri Aug 18 17:44:27 1989, DSJ, Created.</span>
<a name="l00529"></a>00529 <span class="comment"> */</span>
<a name="l00530"></a>00530   <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> char_sample;
<a name="l00531"></a>00531   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> FeatureSet;
<a name="l00532"></a>00532   <a class="code" href="structlist__rec.html">LIST</a> FeatureList;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(CharList) {  <span class="comment">/* iterate thru all of the fonts */</span>
<a name="l00536"></a>00536     char_sample = (<a class="code" href="commontraining_8h.html#af49d04c90ffcf9376c7a1e1db99182cb">LABELEDLIST</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a>(CharList);
<a name="l00537"></a>00537     FeatureList = char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a>;
<a name="l00538"></a>00538     <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(FeatureList) {  <span class="comment">/* iterate thru all of the classes */</span>
<a name="l00539"></a>00539       FeatureSet = (<a class="code" href="ocrfeatures_8h.html#ac0c2f756ba2c7f34a21efbe13a49ac39">FEATURE_SET</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a>(FeatureList);
<a name="l00540"></a>00540       <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(FeatureSet);
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542     <a class="code" href="commontraining_8cpp.html#a499ee1a13b378e272171053afca0de80">FreeLabeledList</a>(char_sample);
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544   <a class="code" href="oldlist_8cpp.html#a338e68bdadcbdf51db4c7268c4529409">destroy</a>(CharList);
<a name="l00545"></a>00545 }  <span class="comment">/* FreeTrainingSamples */</span>
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00548"></a><a class="code" href="commontraining_8h.html#a499ee1a13b378e272171053afca0de80">00548</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a499ee1a13b378e272171053afca0de80">FreeLabeledList</a>(<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> LabeledList) {
<a name="l00549"></a>00549 <span class="comment">/*</span>
<a name="l00550"></a>00550 <span class="comment"> **     Parameters:</span>
<a name="l00551"></a>00551 <span class="comment"> **             LabeledList     labeled list to be freed</span>
<a name="l00552"></a>00552 <span class="comment"> **     Globals: none</span>
<a name="l00553"></a>00553 <span class="comment"> **     Operation:</span>
<a name="l00554"></a>00554 <span class="comment"> **             This routine deallocates all of the memory consumed by</span>
<a name="l00555"></a>00555 <span class="comment"> **             a labeled list.  It does not free any memory which may be</span>
<a name="l00556"></a>00556 <span class="comment"> **             consumed by the items in the list.</span>
<a name="l00557"></a>00557 <span class="comment"> **     Return: none</span>
<a name="l00558"></a>00558 <span class="comment"> **     Exceptions: none</span>
<a name="l00559"></a>00559 <span class="comment"> **     History: Fri Aug 18 17:52:45 1989, DSJ, Created.</span>
<a name="l00560"></a>00560 <span class="comment"> */</span>
<a name="l00561"></a>00561   <a class="code" href="oldlist_8cpp.html#a338e68bdadcbdf51db4c7268c4529409">destroy</a>(LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a>);
<a name="l00562"></a>00562   free(LabeledList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#ad4701118c2e75f005c1f7e4c53abb35d">Label</a>);
<a name="l00563"></a>00563   free(LabeledList);
<a name="l00564"></a>00564 }  <span class="comment">/* FreeLabeledList */</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00567"></a><a class="code" href="commontraining_8h.html#acde409fe3d92475e3cf2c6cc82e5bb63">00567</a> <a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *<a class="code" href="commontraining_8cpp.html#aeec0a66901e2f5ba2fba6c5023a6734e">SetUpForClustering</a>(<span class="keyword">const</span> <a class="code" href="struct_f_e_a_t_u_r_e___d_e_f_s___s_t_r_u_c_t.html">FEATURE_DEFS_STRUCT</a> &amp;FeatureDefs,
<a name="l00568"></a>00568                               <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> char_sample,
<a name="l00569"></a>00569                               <span class="keyword">const</span> <span class="keywordtype">char</span>* program_feature_type) {
<a name="l00570"></a>00570 <span class="comment">/*</span>
<a name="l00571"></a>00571 <span class="comment"> **     Parameters:</span>
<a name="l00572"></a>00572 <span class="comment"> **             char_sample: LABELEDLIST that holds all the feature information for a</span>
<a name="l00573"></a>00573 <span class="comment"> **             given character.</span>
<a name="l00574"></a>00574 <span class="comment"> **     Globals:</span>
<a name="l00575"></a>00575 <span class="comment"> **             None</span>
<a name="l00576"></a>00576 <span class="comment"> **     Operation:</span>
<a name="l00577"></a>00577 <span class="comment"> **             This routine reads samples from a LABELEDLIST and enters</span>
<a name="l00578"></a>00578 <span class="comment"> **             those samples into a clusterer data structure.  This</span>
<a name="l00579"></a>00579 <span class="comment"> **             data structure is then returned to the caller.</span>
<a name="l00580"></a>00580 <span class="comment"> **     Return:</span>
<a name="l00581"></a>00581 <span class="comment"> **             Pointer to new clusterer data structure.</span>
<a name="l00582"></a>00582 <span class="comment"> **     Exceptions:</span>
<a name="l00583"></a>00583 <span class="comment"> **             None</span>
<a name="l00584"></a>00584 <span class="comment"> **     History:</span>
<a name="l00585"></a>00585 <span class="comment"> **             8/16/89, DSJ, Created.</span>
<a name="l00586"></a>00586 <span class="comment"> */</span>
<a name="l00587"></a>00587   <a class="code" href="host_8h.html#acb2dfad543247740dab87d31bb49dfff">uinT16</a> N;
<a name="l00588"></a>00588   <span class="keywordtype">int</span> i, j;
<a name="l00589"></a>00589   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *Sample = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00590"></a>00590   <a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer;
<a name="l00591"></a>00591   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> CharID;
<a name="l00592"></a>00592   <a class="code" href="structlist__rec.html">LIST</a> FeatureList = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00593"></a>00593   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> FeatureSet = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="keywordtype">int</span> desc_index = <a class="code" href="featdefs_8cpp.html#a46a09d60beb44b9c9156346595f352ee">ShortNameToFeatureType</a>(FeatureDefs, program_feature_type);
<a name="l00596"></a>00596   N = FeatureDefs.<a class="code" href="struct_f_e_a_t_u_r_e___d_e_f_s___s_t_r_u_c_t.html#ab09a6d77d42a8a2b5882bbc27ee4f23c">FeatureDesc</a>[desc_index]-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___d_e_s_c___s_t_r_u_c_t.html#a0edbab02900ae01549f742582236eb6d">NumParams</a>;
<a name="l00597"></a>00597   Clusterer = <a class="code" href="cluster_8cpp.html#a93e53684b74358b68adf48b2ee32b042">MakeClusterer</a>(N, FeatureDefs.<a class="code" href="struct_f_e_a_t_u_r_e___d_e_f_s___s_t_r_u_c_t.html#ab09a6d77d42a8a2b5882bbc27ee4f23c">FeatureDesc</a>[desc_index]-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___d_e_s_c___s_t_r_u_c_t.html#acc46f9f5b3cded3ca8e7de3e94407c58">ParamDesc</a>);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   FeatureList = char_sample-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a>;
<a name="l00600"></a>00600   CharID = 0;
<a name="l00601"></a>00601   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(FeatureList) {
<a name="l00602"></a>00602     FeatureSet = (<a class="code" href="ocrfeatures_8h.html#ac0c2f756ba2c7f34a21efbe13a49ac39">FEATURE_SET</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a>(FeatureList);
<a name="l00603"></a>00603     <span class="keywordflow">for</span> (i = 0; i &lt; FeatureSet-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a929fdddbb7cb689f66b59e06d51aee46">MaxNumFeatures</a>; i++) {
<a name="l00604"></a>00604       <span class="keywordflow">if</span> (Sample == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00605"></a>00605         Sample = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00606"></a>00606       <span class="keywordflow">for</span> (j = 0; j &lt; N; j++)
<a name="l00607"></a>00607         Sample[j] = FeatureSet-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a4664d6a22a9d12f4011de4d877664c45">Features</a>[i]-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[j];
<a name="l00608"></a>00608       <a class="code" href="cluster_8cpp.html#ab3cc5ee277d4a2cf4000668b1ffbcf4a">MakeSample</a> (Clusterer, Sample, CharID);
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610     CharID++;
<a name="l00611"></a>00611   }
<a name="l00612"></a>00612   <span class="keywordflow">if</span> ( Sample != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) free( Sample );
<a name="l00613"></a>00613   <span class="keywordflow">return</span>( Clusterer );
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 }       <span class="comment">/* SetUpForClustering */</span>
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="comment">/*------------------------------------------------------------------------*/</span>
<a name="l00618"></a><a class="code" href="commontraining_8h.html#a9bd7631e2f9e44b661bf1c4edae4d270">00618</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a9bd7631e2f9e44b661bf1c4edae4d270">MergeInsignificantProtos</a>(<a class="code" href="structlist__rec.html">LIST</a> ProtoList, <span class="keyword">const</span> <span class="keywordtype">char</span>* label,
<a name="l00619"></a>00619                               <a class="code" href="struct_c_l_u_s_t_e_r_e_r.html">CLUSTERER</a> *Clusterer, <a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html">CLUSTERCONFIG</a> *Config) {
<a name="l00620"></a>00620   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>     *Prototype;
<a name="l00621"></a>00621   <span class="keywordtype">bool</span> debug = strcmp(FLAGS_test_ch.c_str(), label) == 0;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623   <a class="code" href="structlist__rec.html">LIST</a> pProtoList = ProtoList;
<a name="l00624"></a>00624   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(pProtoList) {
<a name="l00625"></a>00625     Prototype = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (pProtoList);
<a name="l00626"></a>00626     <span class="keywordflow">if</span> (Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> || Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a8e04c7f378d30c248bc6e55703ac69a6">Merged</a>)
<a name="l00627"></a>00627       <span class="keywordflow">continue</span>;
<a name="l00628"></a>00628     <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> best_dist = 0.125;
<a name="l00629"></a>00629     <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>* best_match = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00630"></a>00630     <span class="comment">// Find the nearest alive prototype.</span>
<a name="l00631"></a>00631     <a class="code" href="structlist__rec.html">LIST</a> list_it = ProtoList;
<a name="l00632"></a>00632     <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(list_it) {
<a name="l00633"></a>00633       <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>* test_p = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (list_it);
<a name="l00634"></a>00634       <span class="keywordflow">if</span> (test_p != Prototype &amp;&amp; !test_p-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a8e04c7f378d30c248bc6e55703ac69a6">Merged</a>) {
<a name="l00635"></a>00635         <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> dist = <a class="code" href="kdtree_8cpp.html#abc92dabbfb9cb69dd9a8375f20c68da1">ComputeDistance</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>,
<a name="l00636"></a>00636                                        Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>,
<a name="l00637"></a>00637                                        Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>, test_p-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>);
<a name="l00638"></a>00638         <span class="keywordflow">if</span> (dist &lt; best_dist) {
<a name="l00639"></a>00639           best_match = test_p;
<a name="l00640"></a>00640           best_dist = dist;
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642       }
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (best_match != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; !best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a>) {
<a name="l00645"></a>00645       <span class="keywordflow">if</span> (debug)
<a name="l00646"></a>00646         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Merging red clusters (%d+%d) at %g,%g and %g,%g\n&quot;</span>,
<a name="l00647"></a>00647                 best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a>, Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a>,
<a name="l00648"></a>00648                 best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[0], best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[1],
<a name="l00649"></a>00649                 Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[0], Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[1]);
<a name="l00650"></a>00650       best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a> = <a class="code" href="cluster_8cpp.html#a13004a2cbbcf26c3d95fd207274823c9">MergeClusters</a>(Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#ac78a1d40ce4bac0a156a21e2d987f394">SampleSize</a>,
<a name="l00651"></a>00651                                              Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#af44850047e9f5b3648871d7517c04316">ParamDesc</a>,
<a name="l00652"></a>00652                                              best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a>,
<a name="l00653"></a>00653                                              Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a>,
<a name="l00654"></a>00654                                              best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>,
<a name="l00655"></a>00655                                              best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>, Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>);
<a name="l00656"></a>00656       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a> = 0;
<a name="l00657"></a>00657       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a8e04c7f378d30c248bc6e55703ac69a6">Merged</a> = 1;
<a name="l00658"></a>00658     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (best_match != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00659"></a>00659       <span class="keywordflow">if</span> (debug)
<a name="l00660"></a>00660         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Red proto at %g,%g matched a green one at %g,%g\n&quot;</span>,
<a name="l00661"></a>00661                 Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[0], Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[1],
<a name="l00662"></a>00662                 best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[0], best_match-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[1]);
<a name="l00663"></a>00663       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a8e04c7f378d30c248bc6e55703ac69a6">Merged</a> = 1;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665   }
<a name="l00666"></a>00666   <span class="comment">// Mark significant those that now have enough samples.</span>
<a name="l00667"></a>00667   <span class="keywordtype">int</span> min_samples = (<a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a>) (Config-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_c_o_n_f_i_g.html#a30f3f6f54aa8e9371a0398f04bca0de3">MinSamples</a> * Clusterer-&gt;<a class="code" href="struct_c_l_u_s_t_e_r_e_r.html#aa4a7b4654dcb4918ac9a282d976b72d9">NumChar</a>);
<a name="l00668"></a>00668   pProtoList = ProtoList;
<a name="l00669"></a>00669   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(pProtoList) {
<a name="l00670"></a>00670     Prototype = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (pProtoList);
<a name="l00671"></a>00671     <span class="comment">// Process insignificant protos that do not match a green one</span>
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (!Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> &amp;&amp; Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a> &gt;= min_samples &amp;&amp;
<a name="l00673"></a>00673         !Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a8e04c7f378d30c248bc6e55703ac69a6">Merged</a>) {
<a name="l00674"></a>00674       <span class="keywordflow">if</span> (debug)
<a name="l00675"></a>00675         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Red proto at %g,%g becoming green\n&quot;</span>,
<a name="l00676"></a>00676                 Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[0], Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[1]);
<a name="l00677"></a>00677       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> = <span class="keyword">true</span>;
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679   }
<a name="l00680"></a>00680 }       <span class="comment">/* MergeInsignificantProtos */</span>
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="comment">/*-----------------------------------------------------------------------------*/</span>
<a name="l00683"></a><a class="code" href="commontraining_8h.html#a561b5ddf89562dbf46af5ef6ce1e058e">00683</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a561b5ddf89562dbf46af5ef6ce1e058e">CleanUpUnusedData</a>(
<a name="l00684"></a>00684     <a class="code" href="structlist__rec.html">LIST</a> ProtoList)
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>* Prototype;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(ProtoList)
<a name="l00689"></a>00689   {
<a name="l00690"></a>00690     Prototype = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (ProtoList);
<a name="l00691"></a>00691     <span class="keywordflow">if</span>(Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00692"></a>00692     {
<a name="l00693"></a>00693       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>);
<a name="l00694"></a>00694       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696     <span class="keywordflow">if</span>(Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00697"></a>00697     {
<a name="l00698"></a>00698       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>);
<a name="l00699"></a>00699       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701     <span class="keywordflow">if</span>(Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703       <a class="code" href="freelist_8cpp.html#ab462a857e5edf360ae4881bcc92a0bcf">memfree</a>(Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>);
<a name="l00704"></a>00704       Prototype-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706   }
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">/*------------------------------------------------------------------------*/</span>
<a name="l00710"></a><a class="code" href="commontraining_8h.html#aad49ec475f2a0dc40c789df41d101c94">00710</a> <a class="code" href="structlist__rec.html">LIST</a> <a class="code" href="commontraining_8cpp.html#aad49ec475f2a0dc40c789df41d101c94">RemoveInsignificantProtos</a>(
<a name="l00711"></a>00711     <a class="code" href="structlist__rec.html">LIST</a> ProtoList,
<a name="l00712"></a>00712     <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> KeepSigProtos,
<a name="l00713"></a>00713     <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> KeepInsigProtos,
<a name="l00714"></a>00714     <span class="keywordtype">int</span> N)
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 {
<a name="l00717"></a>00717   <a class="code" href="structlist__rec.html">LIST</a> NewProtoList = <a class="code" href="oldlist_8h.html#ae212530ca629c67513698e988c705a5a">NIL_LIST</a>;
<a name="l00718"></a>00718   <a class="code" href="structlist__rec.html">LIST</a> pProtoList;
<a name="l00719"></a>00719   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>* Proto;
<a name="l00720"></a>00720   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>* NewProto;
<a name="l00721"></a>00721   <span class="keywordtype">int</span> i;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   pProtoList = ProtoList;
<a name="l00724"></a>00724   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(pProtoList)
<a name="l00725"></a>00725   {
<a name="l00726"></a>00726     Proto = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (pProtoList);
<a name="l00727"></a>00727     <span class="keywordflow">if</span> ((Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> &amp;&amp; KeepSigProtos) ||
<a name="l00728"></a>00728         (!Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> &amp;&amp; KeepInsigProtos))
<a name="l00729"></a>00729     {
<a name="l00730"></a>00730       NewProto = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>));
<a name="l00731"></a>00731 
<a name="l00732"></a>00732       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00733"></a>00733       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a>;
<a name="l00734"></a>00734       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a> = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aad81f08b6e171698866b445c0b3d4b35">Style</a>;
<a name="l00735"></a>00735       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a> = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a2ba6bfd64f308a26cdd0a75c52e002f5">NumSamples</a>;
<a name="l00736"></a>00736       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aff59384612de343b799b92a5d80282b7">Cluster</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00737"></a>00737       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#ae53408c33cdd473a9ed1f028e8172b0b">Distrib</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739       <span class="keywordflow">for</span> (i=0; i &lt; N; i++)
<a name="l00740"></a>00740         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i] = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af9c4f61cdbf39f6494b4691799bd4fa6">Mean</a>[i];
<a name="l00741"></a>00741       if (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00742"></a>00742       {
<a name="l00743"></a>00743         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00744"></a>00744         <span class="keywordflow">for</span> (i=0; i &lt; N; i++)
<a name="l00745"></a>00745           NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l00746"></a>00746       }
<a name="l00747"></a>00747       <span class="keywordflow">else</span>
<a name="l00748"></a>00748         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a35cf2e2dd8cc8b0e9476ad49f36abd24">Variance</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00749"></a>00749       <span class="comment">//---------------------------------------------</span>
<a name="l00750"></a>00750       <span class="keywordflow">if</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00751"></a>00751       {
<a name="l00752"></a>00752         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00753"></a>00753         <span class="keywordflow">for</span> (i=0; i &lt; N; i++)
<a name="l00754"></a>00754           NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l00755"></a>00755       }
<a name="l00756"></a>00756       <span class="keywordflow">else</span>
<a name="l00757"></a>00757         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a0b016afed9c049598aa41feb3770fc15">Magnitude</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00758"></a>00758       <span class="comment">//------------------------------------------------</span>
<a name="l00759"></a>00759       <span class="keywordflow">if</span> (Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00760"></a>00760       {
<a name="l00761"></a>00761         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = (<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a>(N * <span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a>));
<a name="l00762"></a>00762         <span class="keywordflow">for</span> (i=0; i &lt; N; i++)
<a name="l00763"></a>00763           NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i] = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a>[i];
<a name="l00764"></a>00764       }
<a name="l00765"></a>00765       <span class="keywordflow">else</span>
<a name="l00766"></a>00766         NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#af202ff952380614068536ea0b504285e">Weight</a>.<a class="code" href="union_f_l_o_a_t_u_n_i_o_n.html#a4b36c5b636aac27041dd340386f3801f">Elliptical</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a> = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a40a4a7e28d83ad5ad3c64e54734104be">TotalMagnitude</a>;
<a name="l00769"></a>00769       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aefd3ba15fc4dd0029aa9cda07092382b">LogMagnitude</a> = Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#aefd3ba15fc4dd0029aa9cda07092382b">LogMagnitude</a>;
<a name="l00770"></a>00770       NewProtoList = <a class="code" href="oldlist_8cpp.html#a1019c2e1108695bb4f33f83e02ee62ad">push_last</a>(NewProtoList, NewProto);
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772   }
<a name="l00773"></a>00773   <a class="code" href="cluster_8cpp.html#a7e5357920f0bded023b15d29ddf15ebf">FreeProtoList</a>(&amp;ProtoList);
<a name="l00774"></a>00774   <span class="keywordflow">return</span> (NewProtoList);
<a name="l00775"></a>00775 }       <span class="comment">/* RemoveInsignificantProtos */</span>
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00778"></a><a class="code" href="commontraining_8h.html#aa89103a9b87cd5fe196c69787aacca2f">00778</a> <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS</a> <a class="code" href="commontraining_8cpp.html#aa89103a9b87cd5fe196c69787aacca2f">FindClass</a> (
<a name="l00779"></a>00779     <a class="code" href="structlist__rec.html">LIST</a>        List,
<a name="l00780"></a>00780     <span class="keyword">const</span> <span class="keywordtype">char</span>  *Label)
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782   <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS</a>   MergeClass;
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a> (List)
<a name="l00785"></a>00785   {
<a name="l00786"></a>00786     MergeClass = (<a class="code" href="commontraining_8h.html#a04868818ab7f00c7b35f7f978dca7852">MERGE_CLASS</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (List);
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (strcmp (MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a748285b0d7014218f0b335dcb0513168">Label</a>, Label) == 0)
<a name="l00788"></a>00788       <span class="keywordflow">return</span> (MergeClass);
<a name="l00789"></a>00789   }
<a name="l00790"></a>00790   <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 }       <span class="comment">/* FindClass */</span>
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00795"></a><a class="code" href="commontraining_8h.html#ad07aa0e45caed9a49158afcd82d9e825">00795</a> <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS</a> <a class="code" href="commontraining_8cpp.html#ad07aa0e45caed9a49158afcd82d9e825">NewLabeledClass</a> (
<a name="l00796"></a>00796     <span class="keyword">const</span> <span class="keywordtype">char</span>  *Label)
<a name="l00797"></a>00797 {
<a name="l00798"></a>00798   <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS</a>   MergeClass;
<a name="l00799"></a>00799 
<a name="l00800"></a>00800   MergeClass = <span class="keyword">new</span> <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS_NODE</a>;
<a name="l00801"></a>00801   MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a748285b0d7014218f0b335dcb0513168">Label</a> = (<span class="keywordtype">char</span>*)<a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (strlen (Label)+1);
<a name="l00802"></a>00802   strcpy (MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a748285b0d7014218f0b335dcb0513168">Label</a>, Label);
<a name="l00803"></a>00803   MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a> = <a class="code" href="protos_8cpp.html#ae1b779964924a618a307d8d6f0ec6dff">NewClass</a> (<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>, <a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>);
<a name="l00804"></a>00804   <span class="keywordflow">return</span> (MergeClass);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 }       <span class="comment">/* NewLabeledClass */</span>
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 <span class="comment">/*-----------------------------------------------------------------------------*/</span>
<a name="l00809"></a><a class="code" href="commontraining_8h.html#adfc1458331a5648a286484c1f6324510">00809</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a0f90ef232622ab0d996654dd91a278e2">FreeLabeledClassList</a> (
<a name="l00810"></a>00810     <a class="code" href="structlist__rec.html">LIST</a>        ClassList)
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="comment">/*</span>
<a name="l00813"></a>00813 <span class="comment"> **     Parameters:</span>
<a name="l00814"></a>00814 <span class="comment"> **             FontList        list of all fonts in document</span>
<a name="l00815"></a>00815 <span class="comment"> **     Globals: none</span>
<a name="l00816"></a>00816 <span class="comment"> **     Operation:</span>
<a name="l00817"></a>00817 <span class="comment"> **             This routine deallocates all of the space allocated to</span>
<a name="l00818"></a>00818 <span class="comment"> **             the specified list of training samples.</span>
<a name="l00819"></a>00819 <span class="comment"> **     Return: none</span>
<a name="l00820"></a>00820 <span class="comment"> **     Exceptions: none</span>
<a name="l00821"></a>00821 <span class="comment"> **     History: Fri Aug 18 17:44:27 1989, DSJ, Created.</span>
<a name="l00822"></a>00822 <span class="comment"> */</span>
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 {
<a name="l00825"></a>00825   <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS</a>   MergeClass;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a> (ClassList)           <span class="comment">/* iterate thru all of the fonts */</span>
<a name="l00828"></a>00828   {
<a name="l00829"></a>00829     MergeClass = (<a class="code" href="commontraining_8h.html#a04868818ab7f00c7b35f7f978dca7852">MERGE_CLASS</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (ClassList);
<a name="l00830"></a>00830     free (MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a748285b0d7014218f0b335dcb0513168">Label</a>);
<a name="l00831"></a>00831     <a class="code" href="protos_8cpp.html#a751a34c0eb8b7dcba1439287dd3eb3d5">FreeClass</a>(MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a>);
<a name="l00832"></a>00832     <span class="keyword">delete</span> MergeClass;
<a name="l00833"></a>00833   }
<a name="l00834"></a>00834   <a class="code" href="oldlist_8cpp.html#a338e68bdadcbdf51db4c7268c4529409">destroy</a> (ClassList);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 }       <span class="comment">/* FreeLabeledClassList */</span>
<a name="l00837"></a>00837 
<a name="l00839"></a><a class="code" href="commontraining_8h.html#ae0ede748b48d1f73abdaeac0c2a1a000">00839</a> <a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html">CLASS_STRUCT</a>* <a class="code" href="commontraining_8cpp.html#ae0ede748b48d1f73abdaeac0c2a1a000">SetUpForFloat2Int</a>(<span class="keyword">const</span> <a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html">UNICHARSET</a>&amp; unicharset,
<a name="l00840"></a>00840                                 <a class="code" href="structlist__rec.html">LIST</a> LabeledClassList) {
<a name="l00841"></a>00841   <a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html">MERGE_CLASS</a>   MergeClass;
<a name="l00842"></a>00842   <a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html">CLASS_TYPE</a>            Class;
<a name="l00843"></a>00843   <span class="keywordtype">int</span>                           NumProtos;
<a name="l00844"></a>00844   <span class="keywordtype">int</span>                           NumConfigs;
<a name="l00845"></a>00845   <span class="keywordtype">int</span>                           NumWords;
<a name="l00846"></a>00846   <span class="keywordtype">int</span>                           i, j;
<a name="l00847"></a>00847   <span class="keywordtype">float</span>                 Values[3];
<a name="l00848"></a>00848   <a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html">PROTO</a>                 NewProto;
<a name="l00849"></a>00849   <a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html">PROTO</a>                 OldProto;
<a name="l00850"></a>00850   <a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>            NewConfig;
<a name="l00851"></a>00851   <a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>            OldConfig;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   <span class="comment">//    printf(&quot;Float2Int ...\n&quot;);</span>
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html">CLASS_STRUCT</a>* float_classes = <span class="keyword">new</span> <a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html">CLASS_STRUCT</a>[unicharset.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>()];
<a name="l00856"></a>00856   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(LabeledClassList)
<a name="l00857"></a>00857   {
<a name="l00858"></a>00858     <a class="code" href="class_unicity_table_eq_eq.html">UnicityTableEqEq&lt;int&gt;</a>   font_set;
<a name="l00859"></a>00859     MergeClass = (<a class="code" href="commontraining_8h.html#a04868818ab7f00c7b35f7f978dca7852">MERGE_CLASS</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (LabeledClassList);
<a name="l00860"></a>00860     Class = &amp;float_classes[unicharset.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a748285b0d7014218f0b335dcb0513168">Label</a>)];
<a name="l00861"></a>00861     NumProtos = MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a>-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#aed122893fec98b9ebccee234bbb00292">NumProtos</a>;
<a name="l00862"></a>00862     NumConfigs = MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a>-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#a452c42efe7ec87439ef16f1e51d57f2c">NumConfigs</a>;
<a name="l00863"></a>00863     font_set.<a class="code" href="class_unicity_table.html#a18c8fc9ccbd7c0befdae1ab65bafdb12">move</a>(&amp;MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a>-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#a42fd551c9f2ee48e5873ae7308df64b4">font_set</a>);
<a name="l00864"></a>00864     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#aed122893fec98b9ebccee234bbb00292">NumProtos</a> = NumProtos;
<a name="l00865"></a>00865     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#ae5646d21fd1609343ad276deac642757">MaxNumProtos</a> = NumProtos;
<a name="l00866"></a>00866     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#add1a2c4f7b02eb438c377242495013ef">Prototypes</a> = (<a class="code" href="protos_8h.html#a04b1cd7341d318ccc4e679aec5cfad0e">PROTO</a>) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span>(<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html">PROTO_STRUCT</a>) * NumProtos);
<a name="l00867"></a>00867     <span class="keywordflow">for</span>(i=0; i &lt; NumProtos; i++)
<a name="l00868"></a>00868     {
<a name="l00869"></a>00869       NewProto = <a class="code" href="protos_8h.html#a3def7bc87c3ad9ad793128f0dc5b8fce">ProtoIn</a>(Class, i);
<a name="l00870"></a>00870       OldProto = <a class="code" href="protos_8h.html#a3def7bc87c3ad9ad793128f0dc5b8fce">ProtoIn</a>(MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a>, i);
<a name="l00871"></a>00871       Values[0] = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a54dd1cca86a1fd5c9ead8499cba99784">X</a>;
<a name="l00872"></a>00872       Values[1] = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a8dcd81037c1bc672e97ef7a54306dd93">Y</a>;
<a name="l00873"></a>00873       Values[2] = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a6cc7458f385f9c4673e1ce9a6dc9e80a">Angle</a>;
<a name="l00874"></a>00874       <a class="code" href="commontraining_8cpp.html#a8959d42d4e9ba28a3e128aed3cefb479">Normalize</a>(Values);
<a name="l00875"></a>00875       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a54dd1cca86a1fd5c9ead8499cba99784">X</a> = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a54dd1cca86a1fd5c9ead8499cba99784">X</a>;
<a name="l00876"></a>00876       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a8dcd81037c1bc672e97ef7a54306dd93">Y</a> = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a8dcd81037c1bc672e97ef7a54306dd93">Y</a>;
<a name="l00877"></a>00877       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#aa29d8aaab147327320e2bc94a821aad1">Length</a> = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#aa29d8aaab147327320e2bc94a821aad1">Length</a>;
<a name="l00878"></a>00878       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a6cc7458f385f9c4673e1ce9a6dc9e80a">Angle</a> = OldProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a6cc7458f385f9c4673e1ce9a6dc9e80a">Angle</a>;
<a name="l00879"></a>00879       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#ae3211a725f109fbd40efc6cd154330f7">A</a> = Values[0];
<a name="l00880"></a>00880       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a884630c87acb7606ac02516d1ea4ea9e">B</a> = Values[1];
<a name="l00881"></a>00881       NewProto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a09d1e20c0a8362582127fa3554bb83ae">C</a> = Values[2];
<a name="l00882"></a>00882     }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#a452c42efe7ec87439ef16f1e51d57f2c">NumConfigs</a> = NumConfigs;
<a name="l00885"></a>00885     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#a35830ba1f40d31ef5bb3ad9d4e4596dc">MaxNumConfigs</a> = NumConfigs;
<a name="l00886"></a>00886     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#a42fd551c9f2ee48e5873ae7308df64b4">font_set</a>.<a class="code" href="class_unicity_table.html#a18c8fc9ccbd7c0befdae1ab65bafdb12">move</a>(&amp;font_set);
<a name="l00887"></a>00887     Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#ac5524279d10e5bafe306355d72309b69">Configurations</a> = (<a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>*) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span>(<a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>) * NumConfigs);
<a name="l00888"></a>00888     NumWords = <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(NumProtos);
<a name="l00889"></a>00889     <span class="keywordflow">for</span>(i=0; i &lt; NumConfigs; i++)
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891       NewConfig = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(NumProtos);
<a name="l00892"></a>00892       OldConfig = MergeClass-&gt;<a class="code" href="struct_m_e_r_g_e___c_l_a_s_s___n_o_d_e.html#a1c7b735de8e1caa16763adf0cfc95593">Class</a>-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#ac5524279d10e5bafe306355d72309b69">Configurations</a>[i];
<a name="l00893"></a>00893       <span class="keywordflow">for</span>(j=0; j &lt; NumWords; j++)
<a name="l00894"></a>00894         NewConfig[j] = OldConfig[j];
<a name="l00895"></a>00895       Class-&gt;<a class="code" href="struct_c_l_a_s_s___s_t_r_u_c_t.html#ac5524279d10e5bafe306355d72309b69">Configurations</a>[i] = NewConfig;
<a name="l00896"></a>00896     }
<a name="l00897"></a>00897   }
<a name="l00898"></a>00898   <span class="keywordflow">return</span> float_classes;
<a name="l00899"></a>00899 } <span class="comment">// SetUpForFloat2Int</span>
<a name="l00900"></a>00900 
<a name="l00901"></a>00901 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00902"></a><a class="code" href="commontraining_8h.html#a8959d42d4e9ba28a3e128aed3cefb479">00902</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a8959d42d4e9ba28a3e128aed3cefb479">Normalize</a> (
<a name="l00903"></a>00903     <span class="keywordtype">float</span>  *Values)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905   <span class="keyword">register</span> <span class="keywordtype">float</span> Slope;
<a name="l00906"></a>00906   <span class="keyword">register</span> <span class="keywordtype">float</span> Intercept;
<a name="l00907"></a>00907   <span class="keyword">register</span> <span class="keywordtype">float</span> Normalizer;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   Slope      = tan (Values [2] * 2 * <a class="code" href="const_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a>);
<a name="l00910"></a>00910   Intercept  = Values [1] - Slope * Values [0];
<a name="l00911"></a>00911   Normalizer = 1 / sqrt (Slope * Slope + 1.0);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913   Values [0] = Slope * Normalizer;
<a name="l00914"></a>00914   Values [1] = - Normalizer;
<a name="l00915"></a>00915   Values [2] = Intercept * Normalizer;
<a name="l00916"></a>00916 } <span class="comment">// Normalize</span>
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <span class="comment">/*-------------------------------------------------------------------------*/</span>
<a name="l00919"></a><a class="code" href="commontraining_8h.html#a7a389fb9515f5942d514995b3dfb904c">00919</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a7a389fb9515f5942d514995b3dfb904c">FreeNormProtoList</a> (
<a name="l00920"></a>00920     <a class="code" href="structlist__rec.html">LIST</a>        CharList)
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923   <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a>   char_sample;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a> (CharList)            <span class="comment">/* iterate thru all of the fonts */</span>
<a name="l00926"></a>00926   {
<a name="l00927"></a>00927     char_sample = (<a class="code" href="commontraining_8h.html#af49d04c90ffcf9376c7a1e1db99182cb">LABELEDLIST</a>) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (CharList);
<a name="l00928"></a>00928     <a class="code" href="commontraining_8cpp.html#a499ee1a13b378e272171053afca0de80">FreeLabeledList</a> (char_sample);
<a name="l00929"></a>00929   }
<a name="l00930"></a>00930   <a class="code" href="oldlist_8cpp.html#a338e68bdadcbdf51db4c7268c4529409">destroy</a> (CharList);
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 }       <span class="comment">// FreeNormProtoList</span>
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00935"></a><a class="code" href="commontraining_8h.html#a19e1f0ede9842599275a9d0ffc67ef4a">00935</a> <span class="keywordtype">void</span> <a class="code" href="commontraining_8cpp.html#a19e1f0ede9842599275a9d0ffc67ef4a">AddToNormProtosList</a>(
<a name="l00936"></a>00936     <a class="code" href="structlist__rec.html">LIST</a>* NormProtoList,
<a name="l00937"></a>00937     <a class="code" href="structlist__rec.html">LIST</a> ProtoList,
<a name="l00938"></a>00938     <span class="keywordtype">char</span>* CharName)
<a name="l00939"></a>00939 {
<a name="l00940"></a>00940   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>* Proto;
<a name="l00941"></a>00941   <a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html">LABELEDLIST</a> LabeledProtoList;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   LabeledProtoList = <a class="code" href="commontraining_8cpp.html#a83417b534a3cb0ea9e43eba33e37f1bc">NewLabeledList</a>(CharName);
<a name="l00944"></a>00944   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(ProtoList)
<a name="l00945"></a>00945   {
<a name="l00946"></a>00946     Proto = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> (ProtoList);
<a name="l00947"></a>00947     LabeledProtoList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a> = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a>(LabeledProtoList-&gt;<a class="code" href="struct_l_a_b_e_l_e_d_l_i_s_t_n_o_d_e.html#a848ab6ee611dbc860f80a47ecef2faa7">List</a>, Proto);
<a name="l00948"></a>00948   }
<a name="l00949"></a>00949   *NormProtoList = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a>(*NormProtoList, LabeledProtoList);
<a name="l00950"></a>00950 }
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00953"></a><a class="code" href="commontraining_8h.html#abeba7db95e0009664b96ac0441e7dc16">00953</a> <span class="keywordtype">int</span> <a class="code" href="commontraining_8cpp.html#abeba7db95e0009664b96ac0441e7dc16">NumberOfProtos</a>(
<a name="l00954"></a>00954     <a class="code" href="structlist__rec.html">LIST</a> ProtoList,
<a name="l00955"></a>00955     <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a>       CountSigProtos,
<a name="l00956"></a>00956     <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a>       CountInsigProtos)
<a name="l00957"></a>00957 {
<a name="l00958"></a>00958   <span class="keywordtype">int</span> N = 0;
<a name="l00959"></a>00959   <a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a>     *Proto;
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   <a class="code" href="oldlist_8h.html#a2cf19ba78be6b54f66823d58f34f2a53">iterate</a>(ProtoList)
<a name="l00962"></a>00962   {
<a name="l00963"></a>00963     Proto = (<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html">PROTOTYPE</a> *) <a class="code" href="oldlist_8h.html#a69547be764424f18b0be535400747978">first_node</a> ( ProtoList );
<a name="l00964"></a>00964     <span class="keywordflow">if</span> (( Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> &amp;&amp; CountSigProtos )        ||
<a name="l00965"></a>00965         ( ! Proto-&gt;<a class="code" href="struct_p_r_o_t_o_t_y_p_e.html#a5d94887aaa0acd7e4a0c04c420af5670">Significant</a> &amp;&amp; CountInsigProtos ) )
<a name="l00966"></a>00966       N++;
<a name="l00967"></a>00967   }
<a name="l00968"></a>00968   <span class="keywordflow">return</span>(N);
<a name="l00969"></a>00969 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="commontraining_8cpp.html">commontraining.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Fri Mar 30 2012 17:39:16 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
