<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tesseract: tesseract-ocr/classify/adaptmatch.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tesseract
   &#160;<span id="projectnumber">3.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('adaptmatch_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tesseract-ocr/classify/adaptmatch.cpp</div>  </div>
</div>
<div class="contents">
<a href="adaptmatch_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> ** Filename:    adaptmatch.c</span>
<a name="l00003"></a>00003 <span class="comment"> ** Purpose:     High level adaptive matcher.</span>
<a name="l00004"></a>00004 <span class="comment"> ** Author:      Dan Johnson</span>
<a name="l00005"></a>00005 <span class="comment"> ** History:     Mon Mar 11 10:00:10 1991, DSJ, Created.</span>
<a name="l00006"></a>00006 <span class="comment"> **</span>
<a name="l00007"></a>00007 <span class="comment"> ** (c) Copyright Hewlett-Packard Company, 1988.</span>
<a name="l00008"></a>00008 <span class="comment"> ** Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00009"></a>00009 <span class="comment"> ** you may not use this file except in compliance with the License.</span>
<a name="l00010"></a>00010 <span class="comment"> ** You may obtain a copy of the License at</span>
<a name="l00011"></a>00011 <span class="comment"> ** http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00012"></a>00012 <span class="comment"> ** Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment"> ** distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00014"></a>00014 <span class="comment"> ** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment"> ** See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment"> ** limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment"> ******************************************************************************/</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">/*-----------------------------------------------------------------------------</span>
<a name="l00020"></a>00020 <span class="comment">          Include Files and Type Defines</span>
<a name="l00021"></a>00021 <span class="comment">-----------------------------------------------------------------------------*/</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="ambigs_8h.html">ambigs.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="blobclass_8h.html">blobclass.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="blobs_8h.html">blobs.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="helpers_8h.html">helpers.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="normfeat_8h.html">normfeat.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="mfoutline_8h.html">mfoutline.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="picofeat_8h.html">picofeat.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="float2int_8h.html">float2int.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="outfeat_8h.html">outfeat.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="emalloc_8h.html">emalloc.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="intfx_8h.html">intfx.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="speckle_8h.html">speckle.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="efio_8h.html">efio.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="normmatch_8h.html">normmatch.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="permute_8h.html">permute.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="ndminx_8h.html">ndminx.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="intproto_8h.html">intproto.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="const_8h.html">const.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="werd_8h.html">werd.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="callcpp_8h.html">callcpp.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="pageres_8h.html">pageres.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="params_8h.html">params.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="classify_8h.html">classify.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="shapetable_8h.html">shapetable.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="tessclassifier_8h.html">tessclassifier.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="trainingsample_8h.html">trainingsample.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="unicharset_8h.html">unicharset.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="dict_8h.html">dict.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="featdefs_8h.html">featdefs.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="genericvector_8h.html">genericvector.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#ifdef __UNIX__</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 <span class="comment">// Include automatically generated configuration file if running autoconf.</span>
<a name="l00064"></a>00064 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="config__auto_8h.html">config_auto.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#endif</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a><a class="code" href="adaptmatch_8cpp.html#a788df8e37c3d6f36e3d18a7bb7a603f0">00068</a> <span class="preprocessor">#define ADAPT_TEMPLATE_SUFFIX &quot;.a&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="adaptmatch_8cpp.html#ae731492acc3b2e54043c2dfbf1338be6">00070</a> <span class="preprocessor">#define MAX_MATCHES         10</span>
<a name="l00071"></a><a class="code" href="adaptmatch_8cpp.html#a17b4f36c5132ab55beb280e0cc233228">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define UNLIKELY_NUM_FEAT 200</span>
<a name="l00072"></a><a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define NO_DEBUG      0</span>
<a name="l00073"></a><a class="code" href="adaptmatch_8cpp.html#a1243706f4507cae308afd38f4481e919">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_ADAPTABLE_WERD_SIZE 40</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a><a class="code" href="adaptmatch_8cpp.html#a60c940a7a2c296b84d3cc915267c83c1">00075</a> <span class="preprocessor">#define ADAPTABLE_WERD_ADJUSTMENT    (0.05)</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="adaptmatch_8cpp.html#ac5fe456fd5a30097c95a104b29c45cc3">00077</a> <span class="preprocessor">#define Y_DIM_OFFSET    (Y_SHIFT - BASELINE_Y_SHIFT)</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00079"></a><a class="code" href="adaptmatch_8cpp.html#a93902888a2216c8e4a03ddc10aed7f41">00079</a> <span class="preprocessor">#define WORST_POSSIBLE_RATING (1.0)</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a><a class="code" href="struct_scored_class.html">00081</a> <span class="keyword">struct </span><a class="code" href="struct_scored_class.html">ScoredClass</a> {
<a name="l00082"></a><a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">00082</a>   <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> <a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>;
<a name="l00083"></a><a class="code" href="struct_scored_class.html#ab3db24ffe2690f52d86053ba1f631520">00083</a>   <span class="keywordtype">int</span> <a class="code" href="struct_scored_class.html#ab3db24ffe2690f52d86053ba1f631520">shape_id</a>;
<a name="l00084"></a><a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">00084</a>   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> <a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>;
<a name="l00085"></a><a class="code" href="struct_scored_class.html#a090f44ac2eedadd72c93fb628dfaf167">00085</a>   <span class="keywordtype">bool</span> <a class="code" href="struct_scored_class.html#a090f44ac2eedadd72c93fb628dfaf167">adapted</a>;
<a name="l00086"></a><a class="code" href="struct_scored_class.html#aa8ff624b603b87dd4cc41304e1e72b05">00086</a>   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="struct_scored_class.html#aa8ff624b603b87dd4cc41304e1e72b05">config</a>;
<a name="l00087"></a><a class="code" href="struct_scored_class.html#aef50f14f803115ac96f57bf3d7e519f9">00087</a>   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="struct_scored_class.html#aef50f14f803115ac96f57bf3d7e519f9">fontinfo_id</a>;
<a name="l00088"></a><a class="code" href="struct_scored_class.html#ac30be99b1e1ac98855c624896f9f0389">00088</a>   <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> <a class="code" href="struct_scored_class.html#ac30be99b1e1ac98855c624896f9f0389">fontinfo_id2</a>;
<a name="l00089"></a>00089 };
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">00091</a> <span class="keyword">struct </span><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> {
<a name="l00092"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">00092</a>   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>;
<a name="l00093"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">00093</a>   <span class="keywordtype">int</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>;
<a name="l00094"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#ab6a520c3c59a1f1a3f4d1c27bf5d3000">00094</a>   <span class="keywordtype">bool</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#ab6a520c3c59a1f1a3f4d1c27bf5d3000">HasNonfragment</a>;
<a name="l00095"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">00095</a>   <a class="code" href="struct_scored_class.html">ScoredClass</a> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[<a class="code" href="matchdefs_8h.html#adcc52d7d059a8ca452172df64faa231c">MAX_NUM_CLASSES</a>];
<a name="l00096"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">00096</a>   <a class="code" href="struct_scored_class.html">ScoredClass</a> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>;
<a name="l00097"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">00097</a>   <a class="code" href="intmatcher_8h.html#aad58739a624ab51ab180aac3342c6efc">CLASS_PRUNER_RESULTS</a> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>;
<a name="l00098"></a>00098 
<a name="l00101"></a><a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a450c3b1b225dfa0771edd50732e5d288">00101</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a450c3b1b225dfa0771edd50732e5d288">Initialize</a>() {
<a name="l00102"></a>00102      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a> = <a class="code" href="host_8h.html#aac62d87844689a18b6f5339a89ed6e7f">MAX_INT32</a>;
<a name="l00103"></a>00103      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> = 0;
<a name="l00104"></a>00104      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#ab6a520c3c59a1f1a3f4d1c27bf5d3000">HasNonfragment</a> = <span class="keyword">false</span>;
<a name="l00105"></a>00105      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a> = <a class="code" href="matchdefs_8h.html#a6ce548e51895ce0226ee145753a9c815">NO_CLASS</a>;
<a name="l00106"></a>00106      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#ab3db24ffe2690f52d86053ba1f631520">shape_id</a> = -1;
<a name="l00107"></a>00107      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> = <a class="code" href="adaptmatch_8cpp.html#a93902888a2216c8e4a03ddc10aed7f41">WORST_POSSIBLE_RATING</a>;
<a name="l00108"></a>00108      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#a090f44ac2eedadd72c93fb628dfaf167">adapted</a> = <span class="keyword">false</span>;
<a name="l00109"></a>00109      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa8ff624b603b87dd4cc41304e1e72b05">config</a> = 0;
<a name="l00110"></a>00110      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aef50f14f803115ac96f57bf3d7e519f9">fontinfo_id</a> = kBlankFontinfoId;
<a name="l00111"></a>00111      <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#ac30be99b1e1ac98855c624896f9f0389">fontinfo_id2</a> = kBlankFontinfoId;
<a name="l00112"></a>00112   }
<a name="l00113"></a>00113 };
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="struct_p_r_o_t_o___k_e_y.html">00115</a> <span class="keyword">struct </span><a class="code" href="struct_p_r_o_t_o___k_e_y.html">PROTO_KEY</a> {
<a name="l00116"></a><a class="code" href="struct_p_r_o_t_o___k_e_y.html#a88e8ec3116b1ca5e8c0a57a2236f83ed">00116</a>   <a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">ADAPT_TEMPLATES</a> <a class="code" href="struct_p_r_o_t_o___k_e_y.html#a88e8ec3116b1ca5e8c0a57a2236f83ed">Templates</a>;
<a name="l00117"></a><a class="code" href="struct_p_r_o_t_o___k_e_y.html#a45ade2ad8d07fe98968e6a6795680f0a">00117</a>   <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> <a class="code" href="struct_p_r_o_t_o___k_e_y.html#a45ade2ad8d07fe98968e6a6795680f0a">ClassId</a>;
<a name="l00118"></a><a class="code" href="struct_p_r_o_t_o___k_e_y.html#ab4a673ae9bd6272302ea460d336bc80e">00118</a>   <span class="keywordtype">int</span> <a class="code" href="struct_p_r_o_t_o___k_e_y.html#ab4a673ae9bd6272302ea460d336bc80e">ConfigId</a>;
<a name="l00119"></a>00119 };
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/*-----------------------------------------------------------------------------</span>
<a name="l00122"></a>00122 <span class="comment">          Private Macros</span>
<a name="l00123"></a>00123 <span class="comment">-----------------------------------------------------------------------------*/</span>
<a name="l00124"></a><a class="code" href="adaptmatch_8cpp.html#a212c1ba628a1cd30b51a902c35fb23eb">00124</a> <span class="preprocessor">#define MarginalMatch(Rating)       \</span>
<a name="l00125"></a>00125 <span class="preprocessor">((Rating) &gt; matcher_great_threshold)</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>
<a name="l00127"></a><a class="code" href="adaptmatch_8cpp.html#aca8523f0becfd3cca333fd48d103735d">00127</a> <span class="preprocessor">#define InitIntFX() (FeaturesHaveBeenExtracted = FALSE)</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129 <span class="comment">/*-----------------------------------------------------------------------------</span>
<a name="l00130"></a>00130 <span class="comment">          Private Function Prototypes</span>
<a name="l00131"></a>00131 <span class="comment">-----------------------------------------------------------------------------*/</span>
<a name="l00132"></a>00132 <span class="keywordtype">int</span> <a class="code" href="adaptmatch_8cpp.html#a82aaab0580160422d3587ca9cc533e60">CompareByRating</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *arg1, <span class="keyword">const</span> <span class="keywordtype">void</span> *arg2);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <a class="code" href="struct_scored_class.html">ScoredClass</a> *<a class="code" href="adaptmatch_8cpp.html#a3cedbdc7ad221f31895c55506410fd98">FindScoredUnichar</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *results, <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> <span class="keywordtype">id</span>);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <a class="code" href="struct_scored_class.html">ScoredClass</a> <a class="code" href="adaptmatch_8cpp.html#ab41bdc1f072e458bb14d644c1106b56a">ScoredUnichar</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *results, <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> <span class="keywordtype">id</span>);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="keywordtype">void</span> <a class="code" href="adaptmatch_8cpp.html#af1f03ffe26b93db83b553de0d0be54f1">InitMatcherRatings</a>(<span class="keyword">register</span> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> *Rating);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="keywordtype">int</span> <a class="code" href="adaptmatch_8cpp.html#aeb798d8e9e1be9d25261b8a604910d0d">MakeTempProtoPerm</a>(<span class="keywordtype">void</span> *item1, <span class="keywordtype">void</span> *item2);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="keywordtype">void</span> <a class="code" href="adaptmatch_8cpp.html#af465486d57190cd17155ecc52186dadc">SetAdaptiveThreshold</a>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Threshold);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">/*-----------------------------------------------------------------------------</span>
<a name="l00146"></a>00146 <span class="comment">              Public Code</span>
<a name="l00147"></a>00147 <span class="comment">-----------------------------------------------------------------------------*/</span>
<a name="l00148"></a>00148 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00149"></a>00149 <span class="keyword">namespace </span>tesseract {
<a name="l00178"></a><a class="code" href="classtesseract_1_1_classify.html#a1f058451e32538b4dc2c853b82bc6600">00178</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a1f058451e32538b4dc2c853b82bc6600">Classify::AdaptiveClassifier</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l00179"></a>00179                                   <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l00180"></a>00180                                   BLOB_CHOICE_LIST *Choices,
<a name="l00181"></a>00181                                   <a class="code" href="intmatcher_8h.html#aad58739a624ab51ab180aac3342c6efc">CLASS_PRUNER_RESULTS</a> CPResults) {
<a name="l00182"></a>00182   assert(Choices != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00183"></a>00183   <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results = <span class="keyword">new</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>();
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00186"></a>00186     <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> = <a class="code" href="classtesseract_1_1_classify.html#a28ddc270cb5d2613f5f0f24ad53a5a21">NewAdaptedTemplates</a> (<span class="keyword">true</span>);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a450c3b1b225dfa0771edd50732e5d288">Initialize</a>();
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <a class="code" href="classtesseract_1_1_classify.html#a8575af5f97d4037d4fdd2e21b477dd38">DoAdaptiveMatch</a>(Blob, denorm, Results);
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (CPResults != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00192"></a>00192     memcpy(CPResults, Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>,
<a name="l00193"></a>00193            <span class="keyword">sizeof</span>(CPResults[0]) * Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <a class="code" href="classtesseract_1_1_classify.html#a0e35029ac0c77ad18d35f08c27c99d15">RemoveBadMatches</a>(Results);
<a name="l00196"></a>00196   qsort((<span class="keywordtype">void</span> *)Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>, Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>,
<a name="l00197"></a>00197         <span class="keyword">sizeof</span>(<a class="code" href="struct_scored_class.html">ScoredClass</a>), <a class="code" href="adaptmatch_8cpp.html#a82aaab0580160422d3587ca9cc533e60">CompareByRating</a>);
<a name="l00198"></a>00198   <a class="code" href="classtesseract_1_1_classify.html#af15e83a02b369b820d40c8920b4275e8">RemoveExtraPuncs</a>(Results);
<a name="l00199"></a>00199   <a class="code" href="classtesseract_1_1_classify.html#af1f1f794092ce44dff7c242822b6cf68">ConvertMatchesToChoices</a>(denorm, Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>(), Results, Choices);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a59d2ce9a817ab97d37a459ca2459cf8e">matcher_debug_level</a> &gt;= 1) {
<a name="l00202"></a>00202     <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;AD Matches =  &quot;</span>);
<a name="l00203"></a>00203     <a class="code" href="classtesseract_1_1_classify.html#aad46f714847619694546e9ea2784402c">PrintAdaptiveMatchResults</a>(stdout, Results);
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="keywordflow">if</span> (<a class="code" href="speckle_8cpp.html#a23f46ca3d2ee91db4490641e9268a172">LargeSpeckle</a>(Blob))
<a name="l00207"></a>00207     <a class="code" href="speckle_8cpp.html#a39cee874b396f85d17da4ee6cedf4944">AddLargeSpeckleTo</a>(Choices);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a2420bb00ab392215cbc8b5f72d9cf81a">classify_enable_adaptive_debugger</a>)
<a name="l00211"></a>00211     <a class="code" href="classtesseract_1_1_classify.html#af9a9def4a6b3bb1a2e36bceff2976c2c">DebugAdaptiveClassifier</a>(Blob, denorm, Results);
<a name="l00212"></a>00212 <span class="preprocessor">#endif</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span>
<a name="l00214"></a>00214   NumClassesOutput += Choices-&gt;length();
<a name="l00215"></a>00215   <span class="keywordflow">if</span> (Choices-&gt;length() == 0) {
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_classify.html#a57e449d38b255fe82e61d88ded8b0020">classify_bln_numeric_mode</a>)
<a name="l00217"></a>00217       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a> (<span class="stringliteral">&quot;Empty classification!\n&quot;</span>);  <span class="comment">// Should never normally happen.</span>
<a name="l00218"></a>00218     Choices = <span class="keyword">new</span> BLOB_CHOICE_LIST();
<a name="l00219"></a>00219     BLOB_CHOICE_IT temp_it;
<a name="l00220"></a>00220     temp_it.set_to_list(Choices);
<a name="l00221"></a>00221     temp_it.add_to_end(
<a name="l00222"></a>00222         <span class="keyword">new</span> <a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html">BLOB_CHOICE</a>(0, 50.0<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>, -20.0<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>, -1, -1, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, <span class="keyword">false</span>));
<a name="l00223"></a>00223   }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225   <span class="keyword">delete</span> Results;
<a name="l00226"></a>00226 }                                <span class="comment">/* AdaptiveClassifier */</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">// If *win is NULL, sets it to a new ScrollView() object with title msg.</span>
<a name="l00229"></a>00229 <span class="comment">// Clears the window and draws baselines.</span>
<a name="l00230"></a><a class="code" href="classtesseract_1_1_classify.html#a6e36e01c8147d95bbd64c6609e1b8f45">00230</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a6e36e01c8147d95bbd64c6609e1b8f45">Classify::RefreshDebugWindow</a>(<a class="code" href="class_scroll_view.html">ScrollView</a> **win, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg,
<a name="l00231"></a>00231                                   <span class="keywordtype">int</span> y_offset, <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a> &amp;wbox) {
<a name="l00232"></a>00232 <span class="preprocessor">  #ifndef GRAPHICS_DISABLED</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span>  <span class="keyword">const</span> <span class="keywordtype">int</span> kSampleSpaceWidth = 500;
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (*win == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00235"></a>00235     *win = <span class="keyword">new</span> <a class="code" href="class_scroll_view.html">ScrollView</a>(msg, 100, y_offset, kSampleSpaceWidth * 2, 200,
<a name="l00236"></a>00236                           kSampleSpaceWidth * 2, 200, <span class="keyword">true</span>);
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238   (*win)-&gt;Clear();
<a name="l00239"></a>00239   (*win)-&gt;Pen(64, 64, 64);
<a name="l00240"></a>00240   (*win)-&gt;Line(-kSampleSpaceWidth, <a class="code" href="normalis_8h.html#abe10ce41bf7240ae8a053dea471d6ed5">kBlnBaselineOffset</a>,
<a name="l00241"></a>00241                kSampleSpaceWidth, <a class="code" href="normalis_8h.html#abe10ce41bf7240ae8a053dea471d6ed5">kBlnBaselineOffset</a>);
<a name="l00242"></a>00242   (*win)-&gt;Line(-kSampleSpaceWidth, <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a> + <a class="code" href="normalis_8h.html#abe10ce41bf7240ae8a053dea471d6ed5">kBlnBaselineOffset</a>,
<a name="l00243"></a>00243                kSampleSpaceWidth, <a class="code" href="normalis_8h.html#af974e6755e636c8bc7cbe57e3bcbdd73">kBlnXHeight</a> + <a class="code" href="normalis_8h.html#abe10ce41bf7240ae8a053dea471d6ed5">kBlnBaselineOffset</a>);
<a name="l00244"></a>00244   (*win)-&gt;ZoomToRectangle(wbox.<a class="code" href="class_t_b_o_x.html#a724fabf566586b663577dfa944ffbc61">left</a>(), wbox.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(),
<a name="l00245"></a>00245                           wbox.<a class="code" href="class_t_b_o_x.html#a8703081c1a1c26db3a4dddaca1028e34">right</a>(), wbox.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>());
<a name="l00246"></a>00246 <span class="preprocessor">  #endif  // GRAPHICS_DISABLED</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>}
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="comment">// Learns the given word using its chopped_word, seam_array, denorm,</span>
<a name="l00250"></a>00250 <span class="comment">// box_word, best_state, and correct_text to learn both correctly and</span>
<a name="l00251"></a>00251 <span class="comment">// incorrectly segmented blobs. If filename is not NULL, then LearnBlob</span>
<a name="l00252"></a>00252 <span class="comment">// is called and the data will be written to a file for static training.</span>
<a name="l00253"></a>00253 <span class="comment">// Otherwise AdaptToBlob is called for adaption within a document.</span>
<a name="l00254"></a>00254 <span class="comment">// If rejmap is not NULL, then only chars with a rejmap entry of &#39;1&#39; will</span>
<a name="l00255"></a>00255 <span class="comment">// be learned, otherwise all chars with good correct_text are learned.</span>
<a name="l00256"></a><a class="code" href="classtesseract_1_1_classify.html#abbbd86871758c036d7ba2af682abb45f">00256</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#abbbd86871758c036d7ba2af682abb45f">Classify::LearnWord</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keyword">const</span> <span class="keywordtype">char</span> *rejmap,
<a name="l00257"></a>00257                          <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word) {
<a name="l00258"></a>00258   <span class="keywordtype">int</span> word_len = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae524416d2398009c92a5678105f3cbfb">correct_text</a>.<a class="code" href="class_generic_vector.html#a111b51dd0bf1324cfb69ef70703d8e70">size</a>();
<a name="l00259"></a>00259   <span class="keywordflow">if</span> (word_len == 0) <span class="keywordflow">return</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="keywordtype">float</span>* thresholds = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00262"></a>00262   <span class="keywordflow">if</span> (filename == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00263"></a>00263     <span class="comment">// Adaption mode.</span>
<a name="l00264"></a>00264     <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_classify.html#a7d0ccfd06421346d8cda0f1b76fd8516">EnableLearning</a> || word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a> == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l00265"></a>00265         <span class="comment">// If word-&gt;best_choice is not recorded at the top of accumulator&#39;s</span>
<a name="l00266"></a>00266         <span class="comment">// best choices (which could happen for choices that are</span>
<a name="l00267"></a>00267         <span class="comment">// altered with ReplaceAmbig()) we skip the adaption.</span>
<a name="l00268"></a>00268         !<a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().CurrentBestChoiceIs(*(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>)))
<a name="l00269"></a>00269       <span class="keywordflow">return</span>;  <span class="comment">// Can&#39;t or won&#39;t adapt.</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     NumWordsAdaptedTo++;
<a name="l00272"></a>00272     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1)
<a name="l00273"></a>00273       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;\n\nAdapting to word = %s\n&quot;</span>,
<a name="l00274"></a>00274               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>-&gt;<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a9f084172bbfc8604af49788aad12da36">debug_string</a>().<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00275"></a>00275     thresholds = <span class="keyword">new</span> <span class="keywordtype">float</span>[word_len];
<a name="l00276"></a>00276     <a class="code" href="classtesseract_1_1_classify.html#a57d34f380d093913f3c3e74f7a7a9840">GetAdaptThresholds</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a211ab5c5a13123ee7bdc7459d3363f9d">rebuild_word</a>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>, *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a3d42ac7ec121263e757c9b7160dfd50d">best_choice</a>,
<a name="l00277"></a>00277                        *word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab4d02a7548dab0a4522f02ed90e48100">raw_choice</a>, thresholds);
<a name="l00278"></a>00278   }
<a name="l00279"></a>00279   <span class="keywordtype">int</span> start_blob = 0;
<a name="l00280"></a>00280   <span class="keywordtype">char</span> prev_map_char = <span class="charliteral">&#39;0&#39;</span>;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="preprocessor">  #ifndef GRAPHICS_DISABLED</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a0c8e4bf5e3032c6468b909b6aca7f416">classify_debug_character_fragments</a>) {
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (learn_fragmented_word_debug_win_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00285"></a>00285       <a class="code" href="callcpp_8cpp.html#a51dc37eb580fe7f758275685e5ce0d59">window_wait</a>(learn_fragmented_word_debug_win_);
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     <a class="code" href="classtesseract_1_1_classify.html#a6e36e01c8147d95bbd64c6609e1b8f45">RefreshDebugWindow</a>(&amp;learn_fragments_debug_win_, <span class="stringliteral">&quot;LearnPieces&quot;</span>, 400,
<a name="l00288"></a>00288                        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#a8278c9db39975f181ad074bf343ea402">bounding_box</a>());
<a name="l00289"></a>00289     <a class="code" href="classtesseract_1_1_classify.html#a6e36e01c8147d95bbd64c6609e1b8f45">RefreshDebugWindow</a>(&amp;learn_fragmented_word_debug_win_, <span class="stringliteral">&quot;LearnWord&quot;</span>, 200,
<a name="l00290"></a>00290                        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#a8278c9db39975f181ad074bf343ea402">bounding_box</a>());
<a name="l00291"></a>00291     word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#afe89f2f31b48fa578028f2527b55e144">plot</a>(learn_fragmented_word_debug_win_);
<a name="l00292"></a>00292     <a class="code" href="class_scroll_view.html#a0830a51981a20c8700b5ec49137e46e9">ScrollView::Update</a>();
<a name="l00293"></a>00293   }
<a name="l00294"></a>00294 <span class="preprocessor">  #endif  // GRAPHICS_DISABLED</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span>
<a name="l00296"></a>00296   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ch = 0; ch &lt; word_len; ++ch) {
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a0c8e4bf5e3032c6468b909b6aca7f416">classify_debug_character_fragments</a>) {
<a name="l00298"></a>00298       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;\nLearning %s\n&quot;</span>,  word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae524416d2398009c92a5678105f3cbfb">correct_text</a>[ch].string());
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     <span class="keywordtype">char</span> rej_map_char = rejmap != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? *rejmap++ : <span class="charliteral">&#39;1&#39;</span>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae524416d2398009c92a5678105f3cbfb">correct_text</a>[ch].<a class="code" href="class_generic_vector.html#a690cd403343d371ed7763fdaf3ed71d2">length</a>() &gt; 0 &amp;&amp; rej_map_char == <span class="charliteral">&#39;1&#39;</span>) {
<a name="l00303"></a>00303       <span class="keywordtype">float</span> threshold = thresholds != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? thresholds[ch] : 0.0f;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305       <a class="code" href="classtesseract_1_1_classify.html#a0a6455e61097b98b01d180cd0b2748c9">LearnPieces</a>(filename, start_blob, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch],
<a name="l00306"></a>00306                   threshold, <a class="code" href="namespacetesseract.html#afe12112c1ca56d41c919d0f18dfdf240ab74e41d8efe1a9beae832eb1652096f5">CST_WHOLE</a>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae524416d2398009c92a5678105f3cbfb">correct_text</a>[ch].string(), word);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308       <span class="keywordflow">if</span> (word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch] &gt; 1 &amp;&amp; !<a class="code" href="classtesseract_1_1_classify.html#ab9c25bf0ebc01c57728e19b2bbc980ef">disable_character_fragments</a>) {
<a name="l00309"></a>00309         <span class="comment">// Check that the character breaks into meaningful fragments</span>
<a name="l00310"></a>00310         <span class="comment">// that each match a whole character with at least</span>
<a name="l00311"></a>00311         <span class="comment">// classify_character_fragments_garbage_certainty_threshold</span>
<a name="l00312"></a>00312         <span class="keywordtype">bool</span> garbage = <span class="keyword">false</span>;
<a name="l00313"></a>00313         <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* frag_blob = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00314"></a>00314         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; start_blob; ++i) frag_blob = frag_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00315"></a>00315         <span class="keywordtype">int</span> frag;
<a name="l00316"></a>00316         for (frag = 0; frag &lt; word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch]; ++frag) {
<a name="l00317"></a>00317           <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a342dfc4f244244bd1bc211ea910e2b12">classify_character_fragments_garbage_certainty_threshold</a> &lt; 0) {
<a name="l00318"></a>00318             garbage |= <a class="code" href="classtesseract_1_1_classify.html#ab72f687048a2e1eba44b8ae2cfb07fa9">LooksLikeGarbage</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>, frag_blob);
<a name="l00319"></a>00319           }
<a name="l00320"></a>00320           frag_blob = frag_blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322         <span class="comment">// Learn the fragments.</span>
<a name="l00323"></a>00323         <span class="keywordflow">if</span> (!garbage) {
<a name="l00324"></a>00324           <span class="keywordtype">bool</span> pieces_all_natural = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a96ed4fc2d1583d0e35e088432ab00a21">PiecesAllNatural</a>(start_blob,
<a name="l00325"></a>00325               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch]);
<a name="l00326"></a>00326           <span class="keywordflow">if</span> (pieces_all_natural || !<a class="code" href="classtesseract_1_1_classify.html#a22717c4d299d3a52683ad90114b20200">prioritize_division</a>) {
<a name="l00327"></a>00327             <span class="keywordflow">for</span> (frag = 0; frag &lt; word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch]; ++frag) {
<a name="l00328"></a>00328               <a class="code" href="class_generic_vector.html">GenericVector&lt;STRING&gt;</a> tokens;
<a name="l00329"></a>00329               word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ae524416d2398009c92a5678105f3cbfb">correct_text</a>[ch].split(<span class="charliteral">&#39; &#39;</span>, &amp;tokens);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331               tokens[0] = <a class="code" href="class_c_h_a_r___f_r_a_g_m_e_n_t.html#ab7a7a173907f187f44677d2ad2679e09">CHAR_FRAGMENT::to_string</a>(
<a name="l00332"></a>00332                   tokens[0].<span class="keywordtype">string</span>(), frag, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch],
<a name="l00333"></a>00333                   pieces_all_natural);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335               <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> full_string;
<a name="l00336"></a>00336               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tokens.<a class="code" href="class_generic_vector.html#a111b51dd0bf1324cfb69ef70703d8e70">size</a>(); i++) {
<a name="l00337"></a>00337                 full_string += tokens[i];
<a name="l00338"></a>00338                 <span class="keywordflow">if</span> (i != tokens.<a class="code" href="class_generic_vector.html#a111b51dd0bf1324cfb69ef70703d8e70">size</a>() - 1)
<a name="l00339"></a>00339                   full_string += <span class="charliteral">&#39; &#39;</span>;
<a name="l00340"></a>00340               }
<a name="l00341"></a>00341               <a class="code" href="classtesseract_1_1_classify.html#a0a6455e61097b98b01d180cd0b2748c9">LearnPieces</a>(filename, start_blob + frag, 1,
<a name="l00342"></a>00342                           threshold, <a class="code" href="namespacetesseract.html#afe12112c1ca56d41c919d0f18dfdf240af7f038dab34772b9ddb631d46aa4126a">CST_FRAGMENT</a>, full_string.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), word);
<a name="l00343"></a>00343             }
<a name="l00344"></a>00344           }
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346       }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348       <span class="comment">// TODO(rays): re-enable this part of the code when we switch to the</span>
<a name="l00349"></a>00349       <span class="comment">// new classifier that needs to see examples of garbage.</span>
<a name="l00350"></a>00350       <span class="comment">/*</span>
<a name="l00351"></a>00351 <span class="comment">      char next_map_char = ch + 1 &lt; word_len</span>
<a name="l00352"></a>00352 <span class="comment">                           ? (rejmap != NULL ? *rejmap : &#39;1&#39;)</span>
<a name="l00353"></a>00353 <span class="comment">                           : &#39;0&#39;;</span>
<a name="l00354"></a>00354 <span class="comment">      if (word-&gt;best_state[ch] &gt; 1) {</span>
<a name="l00355"></a>00355 <span class="comment">        // If the next blob is good, make junk with the rightmost fragment.</span>
<a name="l00356"></a>00356 <span class="comment">        if (ch + 1 &lt; word_len &amp;&amp; word-&gt;correct_text[ch + 1].length() &gt; 0 &amp;&amp;</span>
<a name="l00357"></a>00357 <span class="comment">            next_map_char == &#39;1&#39;) {</span>
<a name="l00358"></a>00358 <span class="comment">          LearnPieces(filename, start_blob + word-&gt;best_state[ch] - 1,</span>
<a name="l00359"></a>00359 <span class="comment">                      word-&gt;best_state[ch + 1] + 1,</span>
<a name="l00360"></a>00360 <span class="comment">                      threshold, CST_IMPROPER, INVALID_UNICHAR, word);</span>
<a name="l00361"></a>00361 <span class="comment">        }</span>
<a name="l00362"></a>00362 <span class="comment">        // If the previous blob is good, make junk with the leftmost fragment.</span>
<a name="l00363"></a>00363 <span class="comment">        if (ch &gt; 0 &amp;&amp; word-&gt;correct_text[ch - 1].length() &gt; 0 &amp;&amp;</span>
<a name="l00364"></a>00364 <span class="comment">            prev_map_char == &#39;1&#39;) {</span>
<a name="l00365"></a>00365 <span class="comment">          LearnPieces(filename, start_blob - word-&gt;best_state[ch - 1],</span>
<a name="l00366"></a>00366 <span class="comment">                      word-&gt;best_state[ch - 1] + 1,</span>
<a name="l00367"></a>00367 <span class="comment">                      threshold, CST_IMPROPER, INVALID_UNICHAR, word);</span>
<a name="l00368"></a>00368 <span class="comment">        }</span>
<a name="l00369"></a>00369 <span class="comment">      }</span>
<a name="l00370"></a>00370 <span class="comment">      // If the next blob is good, make a join with it.</span>
<a name="l00371"></a>00371 <span class="comment">      if (ch + 1 &lt; word_len &amp;&amp; word-&gt;correct_text[ch + 1].length() &gt; 0 &amp;&amp;</span>
<a name="l00372"></a>00372 <span class="comment">          next_map_char == &#39;1&#39;) {</span>
<a name="l00373"></a>00373 <span class="comment">        STRING joined_text = word-&gt;correct_text[ch];</span>
<a name="l00374"></a>00374 <span class="comment">        joined_text += word-&gt;correct_text[ch + 1];</span>
<a name="l00375"></a>00375 <span class="comment">        LearnPieces(filename, start_blob,</span>
<a name="l00376"></a>00376 <span class="comment">                    word-&gt;best_state[ch] + word-&gt;best_state[ch + 1],</span>
<a name="l00377"></a>00377 <span class="comment">                    threshold, CST_NGRAM, joined_text.string(), word);</span>
<a name="l00378"></a>00378 <span class="comment">      }</span>
<a name="l00379"></a>00379 <span class="comment">      */</span>
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381     start_blob += word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ab3c9354a32a99c3283f4ac411b5f9b93">best_state</a>[ch];
<a name="l00382"></a>00382     prev_map_char = rej_map_char;
<a name="l00383"></a>00383   }
<a name="l00384"></a>00384   <span class="keyword">delete</span> [] thresholds;
<a name="l00385"></a>00385 }  <span class="comment">// LearnWord.</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="comment">// Builds a blob of length fragments, from the word, starting at start,</span>
<a name="l00388"></a>00388 <span class="comment">// and then learns it, as having the given correct_text.</span>
<a name="l00389"></a>00389 <span class="comment">// If filename is not NULL, then LearnBlob</span>
<a name="l00390"></a>00390 <span class="comment">// is called and the data will be written to a file for static training.</span>
<a name="l00391"></a>00391 <span class="comment">// Otherwise AdaptToBlob is called for adaption within a document.</span>
<a name="l00392"></a>00392 <span class="comment">// threshold is a magic number required by AdaptToChar and generated by</span>
<a name="l00393"></a>00393 <span class="comment">// GetAdaptThresholds.</span>
<a name="l00394"></a>00394 <span class="comment">// Although it can be partly inferred from the string, segmentation is</span>
<a name="l00395"></a>00395 <span class="comment">// provided to explicitly clarify the character segmentation.</span>
<a name="l00396"></a><a class="code" href="classtesseract_1_1_classify.html#a0a6455e61097b98b01d180cd0b2748c9">00396</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a0a6455e61097b98b01d180cd0b2748c9">Classify::LearnPieces</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> length,
<a name="l00397"></a>00397                            <span class="keywordtype">float</span> threshold, <a class="code" href="namespacetesseract.html#afe12112c1ca56d41c919d0f18dfdf240">CharSegmentationType</a> segmentation,
<a name="l00398"></a>00398                            <span class="keyword">const</span> <span class="keywordtype">char</span>* correct_text, <a class="code" href="class_w_e_r_d___r_e_s.html">WERD_RES</a> *word) {
<a name="l00399"></a>00399   <span class="comment">// TODO(daria) Remove/modify this if/when we want</span>
<a name="l00400"></a>00400   <span class="comment">// to train and/or adapt to n-grams.</span>
<a name="l00401"></a>00401   <span class="keywordflow">if</span> (segmentation != <a class="code" href="namespacetesseract.html#afe12112c1ca56d41c919d0f18dfdf240ab74e41d8efe1a9beae832eb1652096f5">CST_WHOLE</a> &amp;&amp;
<a name="l00402"></a>00402       (segmentation != <a class="code" href="namespacetesseract.html#afe12112c1ca56d41c919d0f18dfdf240af7f038dab34772b9ddb631d46aa4126a">CST_FRAGMENT</a> || <a class="code" href="classtesseract_1_1_classify.html#ab9c25bf0ebc01c57728e19b2bbc980ef">disable_character_fragments</a>))
<a name="l00403"></a>00403     <span class="keywordflow">return</span>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="keywordflow">if</span> (length &gt; 1) {
<a name="l00406"></a>00406     <a class="code" href="seam_8cpp.html#a919dc51833c934e6738e5e18d2dd43f6">join_pieces</a>(word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>,
<a name="l00407"></a>00407                 start, start + length - 1);
<a name="l00408"></a>00408   }
<a name="l00409"></a>00409   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* blob = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#aeec31d57df04c8dac1cf3e6990d358a7">blobs</a>;
<a name="l00410"></a>00410   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; start; ++i)
<a name="l00411"></a>00411     blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a88a541f55c8bfd63a9f0c419189499bb">next</a>;
<a name="l00412"></a>00412   <span class="comment">// Rotate the blob if needed for classification.</span>
<a name="l00413"></a>00413   <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>* denorm = &amp;word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a202d9d5d2a462d84012011c689e16605">denorm</a>;
<a name="l00414"></a>00414   <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* rotated_blob = blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a01a7a878b92170eaa04d65435b0ef4cc">ClassifyNormalizeIfNeeded</a>(&amp;denorm);
<a name="l00415"></a>00415   <span class="keywordflow">if</span> (rotated_blob == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00416"></a>00416     rotated_blob = blob;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <span class="preprocessor">  #ifndef GRAPHICS_DISABLED</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>  <span class="comment">// Draw debug windows showing the blob that is being learned if needed.</span>
<a name="l00420"></a>00420   <span class="keywordflow">if</span> (strcmp(<a class="code" href="classtesseract_1_1_classify.html#abdd8831d44ce5ea36f7bbee1ed9c4e8a">classify_learn_debug_str</a>.string(), correct_text) == 0) {
<a name="l00421"></a>00421     <a class="code" href="classtesseract_1_1_classify.html#a6e36e01c8147d95bbd64c6609e1b8f45">RefreshDebugWindow</a>(&amp;learn_debug_win_, <span class="stringliteral">&quot;LearnPieces&quot;</span>, 600,
<a name="l00422"></a>00422                        word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#ad1d449f93bb0150bc7ef0d9b59ed27ba">chopped_word</a>-&gt;<a class="code" href="struct_t_w_e_r_d.html#a8278c9db39975f181ad074bf343ea402">bounding_box</a>());
<a name="l00423"></a>00423     rotated_blob-&gt;plot(learn_debug_win_, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a9d8c87be486dead41d198d6b97a22174">ScrollView::GREEN</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a3147083bcb68eb690858099c736e6857">ScrollView::BROWN</a>);
<a name="l00424"></a>00424     learn_debug_win_-&gt;<a class="code" href="class_scroll_view.html#a0830a51981a20c8700b5ec49137e46e9">Update</a>();
<a name="l00425"></a>00425     <a class="code" href="callcpp_8cpp.html#a51dc37eb580fe7f758275685e5ce0d59">window_wait</a>(learn_debug_win_);
<a name="l00426"></a>00426   }
<a name="l00427"></a>00427   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a0c8e4bf5e3032c6468b909b6aca7f416">classify_debug_character_fragments</a> &amp;&amp; segmentation == <a class="code" href="namespacetesseract.html#afe12112c1ca56d41c919d0f18dfdf240af7f038dab34772b9ddb631d46aa4126a">CST_FRAGMENT</a>) {
<a name="l00428"></a>00428     <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(learn_fragments_debug_win_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);  <span class="comment">// set up in LearnWord</span>
<a name="l00429"></a>00429     blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#aea2abdf5701d97f2aece1a5fbabaf77e">plot</a>(learn_fragments_debug_win_,
<a name="l00430"></a>00430                <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a66e5117e4930fdd9a43bdb674d57a719">ScrollView::BLUE</a>, <a class="code" href="class_scroll_view.html#a100504544a5423a94222149ee9ed0fe8a3147083bcb68eb690858099c736e6857">ScrollView::BROWN</a>);
<a name="l00431"></a>00431     learn_fragments_debug_win_-&gt;<a class="code" href="class_scroll_view.html#a0830a51981a20c8700b5ec49137e46e9">Update</a>();
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433 <span class="preprocessor">  #endif  // GRAPHICS_DISABLED</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span>
<a name="l00435"></a>00435   <span class="keywordflow">if</span> (filename != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00436"></a>00436     <a class="code" href="classtesseract_1_1_classify.html#aa92ef2f6a1f0e726d576a59644c3cc63">classify_norm_method</a>.set_value(<a class="code" href="mfoutline_8h.html#a2a4b69f9a2827dc98bc4cbc233118865afa40ef3af4fea0001b535318130960b2">character</a>);  <span class="comment">// force char norm spc 30/11/93</span>
<a name="l00437"></a>00437     <a class="code" href="classtesseract_1_1_classify.html#a85fcc9966cddbc38adf1014dd0cd778c">tess_bn_matching</a>.set_value(<span class="keyword">false</span>);    <span class="comment">// turn it off</span>
<a name="l00438"></a>00438     <a class="code" href="classtesseract_1_1_classify.html#a746dbbd1c99e99f3d213077cceedf80e">tess_cn_matching</a>.set_value(<span class="keyword">false</span>);
<a name="l00439"></a>00439     <a class="code" href="blobclass_8cpp.html#aa38d9ea697967c87442bc9a97a64f7e5">LearnBlob</a>(<a class="code" href="classtesseract_1_1_classify.html#a6ebcfd2968c704f99efd40075ecdb138">feature_defs_</a>, filename, rotated_blob, *denorm,
<a name="l00440"></a>00440               correct_text);
<a name="l00441"></a>00441   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a9f8861ffb917e7341c821928da5865f0">contains_unichar</a>(correct_text)) {
<a name="l00442"></a>00442     <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> class_id = <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ae786fa834962ef4d6dbf8300c6c5d456">unichar_to_id</a>(correct_text);
<a name="l00443"></a>00443     <span class="keywordtype">int</span> font_id = word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a37a6c598c67dcbcce6af7fbd6e2c595f">fontinfo</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>
<a name="l00444"></a>00444                 ? <a class="code" href="classtesseract_1_1_classify.html#ae6dea981b2f591921d798ea83b0fa455">fontinfo_table_</a>.<a class="code" href="class_unicity_table.html#a4820bb7a54cf6ecda86856161c6d5a2f">get_id</a>(*word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#a37a6c598c67dcbcce6af7fbd6e2c595f">fontinfo</a>)
<a name="l00445"></a>00445                 : 0;
<a name="l00446"></a>00446     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1)
<a name="l00447"></a>00447       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Adapting to char = %s, thr= %g font_id= %d\n&quot;</span>,
<a name="l00448"></a>00448               <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(class_id), threshold, font_id);
<a name="l00449"></a>00449     <span class="comment">// If filename is not NULL we are doing recognition</span>
<a name="l00450"></a>00450     <span class="comment">// (as opposed to training), so we must have already set word fonts.</span>
<a name="l00451"></a>00451     <a class="code" href="classtesseract_1_1_classify.html#a53629ef3f5562677ae096bbce864e5ab">AdaptToChar</a>(rotated_blob, *denorm, class_id, font_id, threshold);
<a name="l00452"></a>00452   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a0f934f0b39cb869d2a4973269fb696cf">classify_debug_level</a> &gt;= 1) {
<a name="l00453"></a>00453     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Can&#39;t adapt to %s not in unicharset\n&quot;</span>, correct_text);
<a name="l00454"></a>00454   }
<a name="l00455"></a>00455   <span class="keywordflow">if</span> (rotated_blob != blob) {
<a name="l00456"></a>00456     <span class="keyword">delete</span> rotated_blob;
<a name="l00457"></a>00457     <span class="keyword">delete</span> denorm;
<a name="l00458"></a>00458   }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <a class="code" href="seam_8cpp.html#ac76b2d230d4c44cb0346f516b8a7134a">break_pieces</a>(blob, word-&gt;<a class="code" href="class_w_e_r_d___r_e_s.html#adefe2273d7f4b36fcbe7ae420bfd077a">seam_array</a>, start, start + length - 1);
<a name="l00461"></a>00461 }  <span class="comment">// LearnPieces.</span>
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00478"></a><a class="code" href="classtesseract_1_1_classify.html#ae5e4880c5acc91b77308fbd6ab706b13">00478</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#ae5e4880c5acc91b77308fbd6ab706b13">Classify::EndAdaptiveClassifier</a>() {
<a name="l00479"></a>00479   <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> Filename;
<a name="l00480"></a>00480   FILE *File;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="preprocessor">  #ifndef SECURE_NAMES</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00484"></a>00484       <a class="code" href="classtesseract_1_1_classify.html#adaa9bf9e188634ffa99c83204be2129f">classify_enable_adaptive_matcher</a> &amp;&amp; <a class="code" href="classtesseract_1_1_classify.html#a27fe54e49f64e61f40b4e50e8ff4084c">classify_save_adapted_templates</a>) {
<a name="l00485"></a>00485     Filename = <a class="code" href="classtesseract_1_1_c_c_util.html#a5eea0d996032e28207d801a1ee92d388">imagefile</a> + <a class="code" href="adaptmatch_8cpp.html#a788df8e37c3d6f36e3d18a7bb7a603f0">ADAPT_TEMPLATE_SUFFIX</a>;
<a name="l00486"></a>00486     File = fopen (Filename.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), <span class="stringliteral">&quot;wb&quot;</span>);
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (File == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00488"></a>00488       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Unable to save adapted templates to %s!\n&quot;</span>, Filename.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00489"></a>00489     <span class="keywordflow">else</span> {
<a name="l00490"></a>00490       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;\nSaving adapted templates to %s ...&quot;</span>, Filename.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00491"></a>00491       fflush(stdout);
<a name="l00492"></a>00492       <a class="code" href="classtesseract_1_1_classify.html#a1718afe45a09c6631f11ae224e6d5db6">WriteAdaptedTemplates</a>(File, <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00493"></a>00493       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00494"></a>00494       fclose(File);
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496   }
<a name="l00497"></a>00497 <span class="preprocessor">  #endif</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>
<a name="l00499"></a>00499   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00500"></a>00500     <a class="code" href="adaptive_8cpp.html#accee3ce0fad02a088149b714621dc21d">free_adapted_templates</a>(<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00501"></a>00501     <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00505"></a>00505     <a class="code" href="intproto_8cpp.html#aed61c96f41cad7c9871e809124987ca8">free_int_templates</a>(<a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>);
<a name="l00506"></a>00506     <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00507"></a>00507   }
<a name="l00508"></a>00508   <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#ace7f6baf4e425e1d50aac0d1383eb023">EndDangerousAmbigs</a>();
<a name="l00509"></a>00509   <a class="code" href="classtesseract_1_1_classify.html#ab6e270cecf7e7c62e1319e7889caf716">FreeNormProtos</a>();
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00511"></a>00511     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(<a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>);
<a name="l00512"></a>00512     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(<a class="code" href="classtesseract_1_1_classify.html#a3306f7dc2f0df8c08a9933493262a2c9">PrunedProtos</a>);
<a name="l00513"></a>00513     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(<a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a>);
<a name="l00514"></a>00514     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(<a class="code" href="classtesseract_1_1_classify.html#a04608dab39f896c0358b42c228a7ef32">AllProtosOff</a>);
<a name="l00515"></a>00515     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(<a class="code" href="classtesseract_1_1_classify.html#a974e5b3b4ee8b184a3af4ba782750dd7">AllConfigsOff</a>);
<a name="l00516"></a>00516     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(<a class="code" href="classtesseract_1_1_classify.html#a26b1c76382f418bf5a78bad15b23b8ad">TempProtoMask</a>);
<a name="l00517"></a>00517     <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00518"></a>00518     <a class="code" href="classtesseract_1_1_classify.html#a3306f7dc2f0df8c08a9933493262a2c9">PrunedProtos</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00519"></a>00519     <a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00520"></a>00520     <a class="code" href="classtesseract_1_1_classify.html#a04608dab39f896c0358b42c228a7ef32">AllProtosOff</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00521"></a>00521     <a class="code" href="classtesseract_1_1_classify.html#a974e5b3b4ee8b184a3af4ba782750dd7">AllConfigsOff</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00522"></a>00522     <a class="code" href="classtesseract_1_1_classify.html#a26b1c76382f418bf5a78bad15b23b8ad">TempProtoMask</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00523"></a>00523   }
<a name="l00524"></a>00524   <span class="keyword">delete</span> <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a>;
<a name="l00525"></a>00525   <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00526"></a>00526 }                                <span class="comment">/* EndAdaptiveClassifier */</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00547"></a><a class="code" href="classtesseract_1_1_classify.html#a2f9389a2d855d2a59e7892d3ba884887">00547</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a2f9389a2d855d2a59e7892d3ba884887">Classify::InitAdaptiveClassifier</a>(<span class="keywordtype">bool</span> load_pre_trained_templates) {
<a name="l00548"></a>00548   <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_classify.html#adaa9bf9e188634ffa99c83204be2129f">classify_enable_adaptive_matcher</a>)
<a name="l00549"></a>00549     <span class="keywordflow">return</span>;
<a name="l00550"></a>00550   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00551"></a>00551     <a class="code" href="classtesseract_1_1_classify.html#ae5e4880c5acc91b77308fbd6ab706b13">EndAdaptiveClassifier</a>();  <span class="comment">// Don&#39;t leak with multiple inits.</span>
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="comment">// If there is no language_data_path_prefix, the classifier will be</span>
<a name="l00554"></a>00554   <span class="comment">// adaptive only.</span>
<a name="l00555"></a>00555   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a259fbb37f1e940892938c71496c4d6ba">language_data_path_prefix</a>.<a class="code" href="class_s_t_r_i_n_g.html#a168505a533eda60219c93e25adf4cdc5">length</a>() &gt; 0 &amp;&amp;
<a name="l00556"></a>00556       load_pre_trained_templates) {
<a name="l00557"></a>00557     <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a303e0f9733b2a55796b0178ba184f6b2">SeekToStart</a>(<a class="code" href="namespacetesseract.html#a5f278974ef80900b460194614d4f1899adfd87e838c95bfbdab3d08399e36b362">TESSDATA_INTTEMP</a>));
<a name="l00558"></a>00558     <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a> =
<a name="l00559"></a>00559       <a class="code" href="classtesseract_1_1_classify.html#a98459996e5e6ab1dc1de71411fd32b89">ReadIntTemplates</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#ad5be8f7fcf884390b22f02788330d82f">GetDataFilePtr</a>());
<a name="l00560"></a>00560     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a4c1d7ef19d7917740f1034980d0876fc">DebugLevel</a>() &gt; 0) <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Loaded inttemp\n&quot;</span>);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a303e0f9733b2a55796b0178ba184f6b2">SeekToStart</a>(<a class="code" href="namespacetesseract.html#a5f278974ef80900b460194614d4f1899ae3c25bcbffa5055814464c04388a8035">TESSDATA_SHAPE_TABLE</a>)) {
<a name="l00563"></a>00563       <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> = <span class="keyword">new</span> <a class="code" href="classtesseract_1_1_shape_table.html">ShapeTable</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>);
<a name="l00564"></a>00564       <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a>-&gt;<a class="code" href="classtesseract_1_1_shape_table.html#adfba8cbf1c85a12b6b826d332614072f">DeSerialize</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a47ec55378864d4e0a97793c08aea75c0">swap</a>(),
<a name="l00565"></a>00565                                      <a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#ad5be8f7fcf884390b22f02788330d82f">GetDataFilePtr</a>())) {
<a name="l00566"></a>00566         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Error loading shape table!\n&quot;</span>);
<a name="l00567"></a>00567         <span class="keyword">delete</span> <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a>;
<a name="l00568"></a>00568         <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00569"></a>00569       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a4c1d7ef19d7917740f1034980d0876fc">DebugLevel</a>() &gt; 0) {
<a name="l00570"></a>00570         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Successfully loaded shape table!\n&quot;</span>);
<a name="l00571"></a>00571       }
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a303e0f9733b2a55796b0178ba184f6b2">SeekToStart</a>(<a class="code" href="namespacetesseract.html#a5f278974ef80900b460194614d4f1899afe6ffc645055800e632965abcbc9c501">TESSDATA_PFFMTABLE</a>));
<a name="l00575"></a>00575     <a class="code" href="classtesseract_1_1_classify.html#a49a37c1ce02f5e114f0d57e49871b802">ReadNewCutoffs</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#ad5be8f7fcf884390b22f02788330d82f">GetDataFilePtr</a>(),
<a name="l00576"></a>00576                    <a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a47ec55378864d4e0a97793c08aea75c0">swap</a>(),
<a name="l00577"></a>00577                    <a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a89a94291dc1a6bb20fd28c04bfc0c1c4">GetEndOffset</a>(<a class="code" href="namespacetesseract.html#a5f278974ef80900b460194614d4f1899afe6ffc645055800e632965abcbc9c501">TESSDATA_PFFMTABLE</a>),
<a name="l00578"></a>00578                    CharNormCutoffs);
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a4c1d7ef19d7917740f1034980d0876fc">DebugLevel</a>() &gt; 0) <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Loaded pffmtable\n&quot;</span>);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a303e0f9733b2a55796b0178ba184f6b2">SeekToStart</a>(<a class="code" href="namespacetesseract.html#a5f278974ef80900b460194614d4f1899a54f23d768a3b4d9d8cfd2513f5101d66">TESSDATA_NORMPROTO</a>));
<a name="l00582"></a>00582     <a class="code" href="classtesseract_1_1_classify.html#ad4c94be5d5738afb4115a12cad2e3efa">NormProtos</a> =
<a name="l00583"></a>00583       <a class="code" href="classtesseract_1_1_classify.html#aabd742c09ff530922005e015a9e8bc2b">ReadNormProtos</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#ad5be8f7fcf884390b22f02788330d82f">GetDataFilePtr</a>(),
<a name="l00584"></a>00584                      <a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a89a94291dc1a6bb20fd28c04bfc0c1c4">GetEndOffset</a>(<a class="code" href="namespacetesseract.html#a5f278974ef80900b460194614d4f1899a54f23d768a3b4d9d8cfd2513f5101d66">TESSDATA_NORMPROTO</a>));
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a4a585cb38d5b19b5caedb7aded4a679a">tessdata_manager</a>.<a class="code" href="classtesseract_1_1_tessdata_manager.html#a4c1d7ef19d7917740f1034980d0876fc">DebugLevel</a>() &gt; 0) <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Loaded normproto\n&quot;</span>);
<a name="l00586"></a>00586   }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#ac248b864f3f5effc9225c6f68d4b9e5b">Init</a>(&amp;<a class="code" href="classtesseract_1_1_classify.html#a0f934f0b39cb869d2a4973269fb696cf">classify_debug_level</a>, <a class="code" href="classtesseract_1_1_classify.html#acab8de2f560b04b48191f60099e4244b">classify_integer_matcher_multiplier</a>);
<a name="l00589"></a>00589   <a class="code" href="intfx_8cpp.html#a1281b17b87e56c99d53fe6bb1f7c2d55">InitIntegerFX</a>();
<a name="l00590"></a>00590 
<a name="l00591"></a>00591   <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a> = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>);
<a name="l00592"></a>00592   <a class="code" href="classtesseract_1_1_classify.html#a3306f7dc2f0df8c08a9933493262a2c9">PrunedProtos</a> = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>);
<a name="l00593"></a>00593   <a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a> = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>);
<a name="l00594"></a>00594   <a class="code" href="classtesseract_1_1_classify.html#a04608dab39f896c0358b42c228a7ef32">AllProtosOff</a> = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>);
<a name="l00595"></a>00595   <a class="code" href="classtesseract_1_1_classify.html#a974e5b3b4ee8b184a3af4ba782750dd7">AllConfigsOff</a> = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>);
<a name="l00596"></a>00596   <a class="code" href="classtesseract_1_1_classify.html#a26b1c76382f418bf5a78bad15b23b8ad">TempProtoMask</a> = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>);
<a name="l00597"></a>00597   <a class="code" href="bitvec_8h.html#a137dcf6c3453d2a2b5cbfa7d369c754f">set_all_bits</a>(<a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>, <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>));
<a name="l00598"></a>00598   <a class="code" href="bitvec_8h.html#a137dcf6c3453d2a2b5cbfa7d369c754f">set_all_bits</a>(<a class="code" href="classtesseract_1_1_classify.html#a3306f7dc2f0df8c08a9933493262a2c9">PrunedProtos</a>, <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>));
<a name="l00599"></a>00599   <a class="code" href="bitvec_8h.html#a137dcf6c3453d2a2b5cbfa7d369c754f">set_all_bits</a>(<a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a>, <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(<a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>));
<a name="l00600"></a>00600   <a class="code" href="bitvec_8h.html#a33e25946d45a1e004a961dc46cb5226a">zero_all_bits</a>(<a class="code" href="classtesseract_1_1_classify.html#a04608dab39f896c0358b42c228a7ef32">AllProtosOff</a>, <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>));
<a name="l00601"></a>00601   <a class="code" href="bitvec_8h.html#a33e25946d45a1e004a961dc46cb5226a">zero_all_bits</a>(<a class="code" href="classtesseract_1_1_classify.html#a974e5b3b4ee8b184a3af4ba782750dd7">AllConfigsOff</a>, <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(<a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>));
<a name="l00602"></a>00602 
<a name="l00603"></a>00603   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="matchdefs_8h.html#adcc52d7d059a8ca452172df64faa231c">MAX_NUM_CLASSES</a>; i++) {
<a name="l00604"></a>00604      BaselineCutoffs[i] = 0;
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a52c6bf81f09a61859f999707e37c47f0">classify_use_pre_adapted_templates</a>) {
<a name="l00608"></a>00608     FILE *File;
<a name="l00609"></a>00609     <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> Filename;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     Filename = <a class="code" href="classtesseract_1_1_c_c_util.html#a5eea0d996032e28207d801a1ee92d388">imagefile</a>;
<a name="l00612"></a>00612     Filename += <a class="code" href="adaptmatch_8cpp.html#a788df8e37c3d6f36e3d18a7bb7a603f0">ADAPT_TEMPLATE_SUFFIX</a>;
<a name="l00613"></a>00613     File = fopen(Filename.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>(), <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (File == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00615"></a>00615       <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> = <a class="code" href="classtesseract_1_1_classify.html#a28ddc270cb5d2613f5f0f24ad53a5a21">NewAdaptedTemplates</a>(<span class="keyword">true</span>);
<a name="l00616"></a>00616     } <span class="keywordflow">else</span> {
<a name="l00617"></a>00617 <span class="preprocessor">      #ifndef SECURE_NAMES</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>      <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;\nReading pre-adapted templates from %s ...\n&quot;</span>,
<a name="l00619"></a>00619               Filename.<a class="code" href="class_s_t_r_i_n_g.html#a32beee43ecab1bed8bebc3466896ad6e">string</a>());
<a name="l00620"></a>00620       fflush(stdout);
<a name="l00621"></a>00621 <span class="preprocessor">      #endif</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span>      <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> = <a class="code" href="classtesseract_1_1_classify.html#aa74ebd96d85efc39d71c37985e50c8aa">ReadAdaptedTemplates</a>(File);
<a name="l00623"></a>00623       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00624"></a>00624       fclose(File);
<a name="l00625"></a>00625       <a class="code" href="classtesseract_1_1_classify.html#a15d6951abc586793270de0825bdb7dd7">PrintAdaptedTemplates</a>(stdout, <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>-&gt;<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a4735b2443aa7452909969d8d07e1877a">NumClasses</a>; i++) {
<a name="l00628"></a>00628         BaselineCutoffs[i] = CharNormCutoffs[i];
<a name="l00629"></a>00629       }
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631   } <span class="keywordflow">else</span> {
<a name="l00632"></a>00632     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00633"></a>00633       <a class="code" href="adaptive_8cpp.html#accee3ce0fad02a088149b714621dc21d">free_adapted_templates</a>(<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00634"></a>00634     <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> = <a class="code" href="classtesseract_1_1_classify.html#a28ddc270cb5d2613f5f0f24ad53a5a21">NewAdaptedTemplates</a>(<span class="keyword">true</span>);
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636 }                                <span class="comment">/* InitAdaptiveClassifier */</span>
<a name="l00637"></a>00637 
<a name="l00638"></a><a class="code" href="classtesseract_1_1_classify.html#a350f6cb6e7ce9f53ae468908a91c6148">00638</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a350f6cb6e7ce9f53ae468908a91c6148">Classify::ResetAdaptiveClassifierInternal</a>() {
<a name="l00639"></a>00639   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt; 0) {
<a name="l00640"></a>00640     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Resetting adaptive classifier (NumAdaptationsFailed=%d)\n&quot;</span>,
<a name="l00641"></a>00641             NumAdaptationsFailed);
<a name="l00642"></a>00642   }
<a name="l00643"></a>00643   <a class="code" href="adaptive_8cpp.html#accee3ce0fad02a088149b714621dc21d">free_adapted_templates</a>(<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00644"></a>00644   <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a> = <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00645"></a>00645   NumAdaptationsFailed = 0;
<a name="l00646"></a>00646 }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00661"></a><a class="code" href="classtesseract_1_1_classify.html#a8c350afec3f633660d20eb98226a40d1">00661</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a8c350afec3f633660d20eb98226a40d1">Classify::PrintAdaptiveStatistics</a>(FILE *File) {
<a name="l00662"></a>00662 <span class="preprocessor">  #ifndef SECURE_NAMES</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>
<a name="l00664"></a>00664   fprintf (File, <span class="stringliteral">&quot;\nADAPTIVE MATCHER STATISTICS:\n&quot;</span>);
<a name="l00665"></a>00665   fprintf (File, <span class="stringliteral">&quot;\tNum blobs classified = %d\n&quot;</span>, AdaptiveMatcherCalls);
<a name="l00666"></a>00666   fprintf (File, <span class="stringliteral">&quot;\tNum classes output   = %d (Avg = %4.2f)\n&quot;</span>,
<a name="l00667"></a>00667     NumClassesOutput,
<a name="l00668"></a>00668     ((AdaptiveMatcherCalls == 0) ? (0.0) :
<a name="l00669"></a>00669   ((<span class="keywordtype">float</span>) NumClassesOutput / AdaptiveMatcherCalls)));
<a name="l00670"></a>00670   fprintf (File, <span class="stringliteral">&quot;\t\tBaseline Classifier: %4d calls (%4.2f classes/call)\n&quot;</span>,
<a name="l00671"></a>00671     BaselineClassifierCalls,
<a name="l00672"></a>00672     ((BaselineClassifierCalls == 0) ? (0.0) :
<a name="l00673"></a>00673   ((<span class="keywordtype">float</span>) NumBaselineClassesTried / BaselineClassifierCalls)));
<a name="l00674"></a>00674   fprintf (File, <span class="stringliteral">&quot;\t\tCharNorm Classifier: %4d calls (%4.2f classes/call)\n&quot;</span>,
<a name="l00675"></a>00675     CharNormClassifierCalls,
<a name="l00676"></a>00676     ((CharNormClassifierCalls == 0) ? (0.0) :
<a name="l00677"></a>00677   ((<span class="keywordtype">float</span>) NumCharNormClassesTried / CharNormClassifierCalls)));
<a name="l00678"></a>00678   fprintf (File, <span class="stringliteral">&quot;\t\tAmbig    Classifier: %4d calls (%4.2f classes/call)\n&quot;</span>,
<a name="l00679"></a>00679     AmbigClassifierCalls,
<a name="l00680"></a>00680     ((AmbigClassifierCalls == 0) ? (0.0) :
<a name="l00681"></a>00681   ((<span class="keywordtype">float</span>) NumAmbigClassesTried / AmbigClassifierCalls)));
<a name="l00682"></a>00682 
<a name="l00683"></a>00683   fprintf (File, <span class="stringliteral">&quot;\nADAPTIVE LEARNER STATISTICS:\n&quot;</span>);
<a name="l00684"></a>00684   fprintf (File, <span class="stringliteral">&quot;\tNumber of words adapted to: %d\n&quot;</span>, NumWordsAdaptedTo);
<a name="l00685"></a>00685   fprintf (File, <span class="stringliteral">&quot;\tNumber of chars adapted to: %d\n&quot;</span>, NumCharsAdaptedTo);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <a class="code" href="classtesseract_1_1_classify.html#a15d6951abc586793270de0825bdb7dd7">PrintAdaptedTemplates</a>(File, <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00688"></a>00688 <span class="preprocessor">  #endif</span>
<a name="l00689"></a>00689 <span class="preprocessor"></span>}                                <span class="comment">/* PrintAdaptiveStatistics */</span>
<a name="l00690"></a>00690 
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00712"></a><a class="code" href="classtesseract_1_1_classify.html#ae66827073cdeea6a59dd16fd7cf5d297">00712</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#ae66827073cdeea6a59dd16fd7cf5d297">Classify::SettupPass1</a>() {
<a name="l00713"></a>00713   <a class="code" href="classtesseract_1_1_classify.html#a7d0ccfd06421346d8cda0f1b76fd8516">EnableLearning</a> = <a class="code" href="classtesseract_1_1_classify.html#a7691700e9742ecdc10e0f8ee75682991">classify_enable_learning</a>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#aec7160ce69f6f7d478110b95b729d523" title="Sets up stopper variables in preparation for the first pass.">SettupStopperPass1</a>();
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 }                                <span class="comment">/* SettupPass1 */</span>
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 
<a name="l00720"></a>00720 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00732"></a><a class="code" href="classtesseract_1_1_classify.html#a5ad207ab75e8a69c35c225313268788b">00732</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a5ad207ab75e8a69c35c225313268788b">Classify::SettupPass2</a>() {
<a name="l00733"></a>00733   <a class="code" href="classtesseract_1_1_classify.html#a7d0ccfd06421346d8cda0f1b76fd8516">EnableLearning</a> = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00734"></a>00734   <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a29f0c2e6c8a7b5fb44bb39ce47ceef84" title="Sets up stopper variables in preparation for the second pass.">SettupStopperPass2</a>();
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 }                                <span class="comment">/* SettupPass2 */</span>
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00760"></a><a class="code" href="classtesseract_1_1_classify.html#aee9e5bd336bf1a37a7a1f3b712eb045d">00760</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#aee9e5bd336bf1a37a7a1f3b712eb045d">Classify::InitAdaptedClass</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l00761"></a>00761                                 <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l00762"></a>00762                                 <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId,
<a name="l00763"></a>00763                                 <span class="keywordtype">int</span> FontinfoId,
<a name="l00764"></a>00764                                 <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> Class,
<a name="l00765"></a>00765                                 <a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">ADAPT_TEMPLATES</a> Templates) {
<a name="l00766"></a>00766   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> Features;
<a name="l00767"></a>00767   <span class="keywordtype">int</span> Fid, Pid;
<a name="l00768"></a>00768   <a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html">FEATURE</a> Feature;
<a name="l00769"></a>00769   <span class="keywordtype">int</span> NumFeatures;
<a name="l00770"></a>00770   <a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html">TEMP_PROTO</a> TempProto;
<a name="l00771"></a>00771   <a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html">PROTO</a> Proto;
<a name="l00772"></a>00772   <a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html">INT_CLASS</a> IClass;
<a name="l00773"></a>00773   <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <a class="code" href="classtesseract_1_1_classify.html#aa92ef2f6a1f0e726d576a59644c3cc63">classify_norm_method</a>.set_value(<a class="code" href="mfoutline_8h.html#a2a4b69f9a2827dc98bc4cbc233118865a83297de004f4e58b9be2108c6cd08a23">baseline</a>);
<a name="l00776"></a>00776   Features = <a class="code" href="classtesseract_1_1_classify.html#af1ef43f77139dc879d27a510adcb4bb3">ExtractOutlineFeatures</a>(Blob);
<a name="l00777"></a>00777   NumFeatures = Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a154a6ca419f3f16fccf11b7217351570">NumFeatures</a>;
<a name="l00778"></a>00778   <span class="keywordflow">if</span> (NumFeatures &gt; <a class="code" href="adaptmatch_8cpp.html#a17b4f36c5132ab55beb280e0cc233228">UNLIKELY_NUM_FEAT</a> || NumFeatures &lt;= 0) {
<a name="l00779"></a>00779     <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(Features);
<a name="l00780"></a>00780     <span class="keywordflow">return</span>;
<a name="l00781"></a>00781   }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783   Config = <a class="code" href="adaptive_8cpp.html#af29bddcf8cc7f50548382c9594716559">NewTempConfig</a>(NumFeatures - 1, FontinfoId);
<a name="l00784"></a>00784   <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a>(Class, 0) = <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786   <span class="comment">/* this is a kludge to construct cutoffs for adapted templates */</span>
<a name="l00787"></a>00787   <span class="keywordflow">if</span> (Templates == <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>)
<a name="l00788"></a>00788     BaselineCutoffs[ClassId] = CharNormCutoffs[ClassId];
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   IClass = <a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a> (Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>, ClassId);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792   <span class="keywordflow">for</span> (Fid = 0; Fid &lt; Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a154a6ca419f3f16fccf11b7217351570">NumFeatures</a>; Fid++) {
<a name="l00793"></a>00793     Pid = <a class="code" href="intproto_8cpp.html#a4c27266652a51cf8aaa866d299f57301">AddIntProto</a> (IClass);
<a name="l00794"></a>00794     assert (Pid != <a class="code" href="matchdefs_8h.html#a4d2ae3978d57e3b05f984a0fedc51812">NO_PROTO</a>);
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     Feature = Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a4664d6a22a9d12f4011de4d877664c45">Features</a>[Fid];
<a name="l00797"></a>00797     TempProto = <a class="code" href="adaptive_8cpp.html#a5dec565ee3ad1656d02860db322e4448">NewTempProto</a> ();
<a name="l00798"></a>00798     Proto = &amp;(TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#acf720eb61d4a91e84d949a6f772ea7c5">Proto</a>);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="comment">/* compute proto params - NOTE that Y_DIM_OFFSET must be used because</span>
<a name="l00801"></a>00801 <span class="comment">       ConvertProto assumes that the Y dimension varies from -0.5 to 0.5</span>
<a name="l00802"></a>00802 <span class="comment">       instead of the -0.25 to 0.75 used in baseline normalization */</span>
<a name="l00803"></a>00803     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a6cc7458f385f9c4673e1ce9a6dc9e80a">Angle</a> = Feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="outfeat_8h.html#ab73697b859e4921472c6cf1de43267a1a0bb02f3ddb0f407e51cbf8967c3d78cb">OutlineFeatDir</a>];
<a name="l00804"></a>00804     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a54dd1cca86a1fd5c9ead8499cba99784">X</a> = Feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="outfeat_8h.html#ab73697b859e4921472c6cf1de43267a1ab72d959dbf0e92bfdb6f3ebf9d0b35e6">OutlineFeatX</a>];
<a name="l00805"></a>00805     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a8dcd81037c1bc672e97ef7a54306dd93">Y</a> = Feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="outfeat_8h.html#ab73697b859e4921472c6cf1de43267a1ae64bdd03ed6e7dd59482f7e2d8054379">OutlineFeatY</a>] - <a class="code" href="adaptmatch_8cpp.html#ac5fe456fd5a30097c95a104b29c45cc3">Y_DIM_OFFSET</a>;
<a name="l00806"></a>00806     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#aa29d8aaab147327320e2bc94a821aad1">Length</a> = Feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="outfeat_8h.html#ab73697b859e4921472c6cf1de43267a1afc77106ded4ebd69ae6c596a2536e741">OutlineFeatLength</a>];
<a name="l00807"></a>00807     <a class="code" href="protos_8cpp.html#ac0d58978bbcf0c732ae94fb554bccd3b">FillABC</a>(Proto);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#a93992200ebfddd13e25d0e9122af9b5b">ProtoId</a> = Pid;
<a name="l00810"></a>00810     <a class="code" href="bitvec_8h.html#ab02d606cf8dca49ccadb00248bdbafe9">SET_BIT</a> (Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a2ea5edb90b556766fce2105dcdfe3141">Protos</a>, Pid);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     <a class="code" href="classtesseract_1_1_classify.html#af27d604585502bd447d52bf5daf15d0d">ConvertProto</a>(Proto, Pid, IClass);
<a name="l00813"></a>00813     <a class="code" href="intproto_8cpp.html#aec09adc2735bb4caaf226df7124e4ed7">AddProtoToProtoPruner</a>(Proto, Pid, IClass,
<a name="l00814"></a>00814                           <a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 2);
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a879b5ee2f46335fe784fd4c266f8a37c">TempProtos</a> = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a> (Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a879b5ee2f46335fe784fd4c266f8a37c">TempProtos</a>, TempProto);
<a name="l00817"></a>00817   }
<a name="l00818"></a>00818   <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(Features);
<a name="l00819"></a>00819 
<a name="l00820"></a>00820   <a class="code" href="intproto_8cpp.html#a569488473772d42004fec43399e6d5a9">AddIntConfig</a>(IClass);
<a name="l00821"></a>00821   <a class="code" href="intproto_8cpp.html#a57b07752bea2110e2503cf78747228c5">ConvertConfig</a> (<a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>, 0, IClass);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1) {
<a name="l00824"></a>00824     <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Added new class &#39;%s&#39; with class id %d and %d protos.\n&quot;</span>,
<a name="l00825"></a>00825              <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(ClassId), ClassId, NumFeatures);
<a name="l00826"></a>00826     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt; 1)
<a name="l00827"></a>00827       <a class="code" href="classtesseract_1_1_classify.html#aaa7b4a01a6f9bd1f088982a4011274e5">DisplayAdaptedChar</a>(Blob, denorm, IClass);
<a name="l00828"></a>00828   }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830   <span class="keywordflow">if</span> (<a class="code" href="adaptive_8h.html#a1d2aa2b696e73525cb57373fcc5a83ae">IsEmptyAdaptedClass</a>(Class))
<a name="l00831"></a>00831     (Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#aa644a299b7046916ce731566866df325">NumNonEmptyClasses</a>)++;
<a name="l00832"></a>00832 }                                <span class="comment">/* InitAdaptedClass */</span>
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00856"></a><a class="code" href="classtesseract_1_1_classify.html#a1f21b989c93ff1d297b5bde442fc430c">00856</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a1f21b989c93ff1d297b5bde442fc430c">Classify::GetAdaptiveFeatures</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l00857"></a>00857                                   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures,
<a name="l00858"></a>00858                                   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> *FloatFeatures) {
<a name="l00859"></a>00859   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> Features;
<a name="l00860"></a>00860   <span class="keywordtype">int</span> NumFeatures;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862   <a class="code" href="classtesseract_1_1_classify.html#aa92ef2f6a1f0e726d576a59644c3cc63">classify_norm_method</a>.set_value(<a class="code" href="mfoutline_8h.html#a2a4b69f9a2827dc98bc4cbc233118865a83297de004f4e58b9be2108c6cd08a23">baseline</a>);
<a name="l00863"></a>00863   Features = <a class="code" href="classtesseract_1_1_classify.html#ad6d1f9f29655ffe18fab3832b113e00b">ExtractPicoFeatures</a>(Blob);
<a name="l00864"></a>00864 
<a name="l00865"></a>00865   NumFeatures = Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a154a6ca419f3f16fccf11b7217351570">NumFeatures</a>;
<a name="l00866"></a>00866   <span class="keywordflow">if</span> (NumFeatures &gt; <a class="code" href="adaptmatch_8cpp.html#a17b4f36c5132ab55beb280e0cc233228">UNLIKELY_NUM_FEAT</a>) {
<a name="l00867"></a>00867     <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(Features);
<a name="l00868"></a>00868     <span class="keywordflow">return</span> 0;
<a name="l00869"></a>00869   }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871   <a class="code" href="classtesseract_1_1_classify.html#ae1f3fc88bf28a4a169273bcf2515610e">ComputeIntFeatures</a>(Features, IntFeatures);
<a name="l00872"></a>00872   *FloatFeatures = Features;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="keywordflow">return</span> NumFeatures;
<a name="l00875"></a>00875 }                                <span class="comment">/* GetAdaptiveFeatures */</span>
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 
<a name="l00878"></a>00878 <span class="comment">/*-----------------------------------------------------------------------------</span>
<a name="l00879"></a>00879 <span class="comment">              Private Code</span>
<a name="l00880"></a>00880 <span class="comment">-----------------------------------------------------------------------------*/</span>
<a name="l00881"></a>00881 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00896"></a><a class="code" href="classtesseract_1_1_classify.html#ac1f369f9a59739a588a4d84f60bac6c1">00896</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#ac1f369f9a59739a588a4d84f60bac6c1">Classify::AdaptableWord</a>(<a class="code" href="struct_t_w_e_r_d.html">TWERD</a> *Word,
<a name="l00897"></a>00897                             <span class="keyword">const</span> <a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html">WERD_CHOICE</a> &amp;BestChoiceWord,
<a name="l00898"></a>00898                             <span class="keyword">const</span> <a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html">WERD_CHOICE</a> &amp;RawChoiceWord) {
<a name="l00899"></a>00899   <span class="keywordtype">int</span> BestChoiceLength = BestChoiceWord.<a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html#a7be59abe97b052dd3aaa324aea8c4a6c">length</a>();
<a name="l00900"></a>00900   <span class="keywordtype">float</span> adaptable_score =
<a name="l00901"></a>00901     <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a1fa994ce1b5b86d436eb2ab3f2ffbe1b">segment_penalty_dict_case_ok</a> + <a class="code" href="adaptmatch_8cpp.html#a60c940a7a2c296b84d3cc915267c83c1">ADAPTABLE_WERD_ADJUSTMENT</a>;
<a name="l00902"></a>00902   <span class="keywordflow">return</span>   <span class="comment">// rules that apply in general - simplest to compute first</span>
<a name="l00903"></a>00903       BestChoiceLength &gt; 0 &amp;&amp;
<a name="l00904"></a>00904       BestChoiceLength == Word-&gt;<a class="code" href="struct_t_w_e_r_d.html#adfdef9868e61650e076775011382ec70">NumBlobs</a>() &amp;&amp;
<a name="l00905"></a>00905       BestChoiceLength &lt;= <a class="code" href="adaptmatch_8cpp.html#a1243706f4507cae308afd38f4481e919">MAX_ADAPTABLE_WERD_SIZE</a> &amp;&amp;
<a name="l00906"></a>00906       <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a5de1b4b567459f520ce3b82b68c2c618" title="Returns the adjustment factor for the best choice for the current word.">CurrentBestChoiceAdjustFactor</a>() &lt;= adaptable_score &amp;&amp;
<a name="l00907"></a>00907       <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a1f4a0951c1960208fab7c511c90e5477">AlternativeChoicesWorseThan</a>(adaptable_score) &amp;&amp;
<a name="l00908"></a>00908       <a class="code" href="classtesseract_1_1_classify.html#a83e4207353a1bb07adfaa6a82a74c9ce">getDict</a>().<a class="code" href="classtesseract_1_1_dict.html#a2a0b6b5be811b039c04dd0cc09436f25" title="Returns true if WordChoice is the same as the current best choice.">CurrentBestChoiceIs</a>(BestChoiceWord);
<a name="l00909"></a>00909 }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l00928"></a><a class="code" href="classtesseract_1_1_classify.html#a53629ef3f5562677ae096bbce864e5ab">00928</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a53629ef3f5562677ae096bbce864e5ab">Classify::AdaptToChar</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l00929"></a>00929                            <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l00930"></a>00930                            <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId,
<a name="l00931"></a>00931                            <span class="keywordtype">int</span> FontinfoId,
<a name="l00932"></a>00932                            <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Threshold) {
<a name="l00933"></a>00933   <span class="keywordtype">int</span> NumFeatures;
<a name="l00934"></a>00934   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures;
<a name="l00935"></a>00935   <a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html">INT_RESULT_STRUCT</a> IntResult;
<a name="l00936"></a>00936   <a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html">INT_CLASS</a> IClass;
<a name="l00937"></a>00937   <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> Class;
<a name="l00938"></a>00938   <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> TempConfig;
<a name="l00939"></a>00939   <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> FloatFeatures;
<a name="l00940"></a>00940   <span class="keywordtype">int</span> NewTempConfigId;
<a name="l00941"></a>00941 
<a name="l00942"></a>00942   <a class="code" href="classtesseract_1_1_classify.html#a62ffff7932680b25784bfca5079ce347">ResetFeaturesHaveBeenExtracted</a>();
<a name="l00943"></a>00943   NumCharsAdaptedTo++;
<a name="l00944"></a>00944   <span class="keywordflow">if</span> (!<a class="code" href="intproto_8h.html#a6edc7e9d060a50cd3617bb509a061eb5">LegalClassId</a> (ClassId))
<a name="l00945"></a>00945     <span class="keywordflow">return</span>;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947   Class = <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a0256081fa31eb38b52b19788ca62e327">Class</a>[ClassId];
<a name="l00948"></a>00948   assert(Class != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00949"></a>00949   <span class="keywordflow">if</span> (<a class="code" href="adaptive_8h.html#a1d2aa2b696e73525cb57373fcc5a83ae">IsEmptyAdaptedClass</a>(Class)) {
<a name="l00950"></a>00950     <a class="code" href="classtesseract_1_1_classify.html#aee9e5bd336bf1a37a7a1f3b712eb045d">InitAdaptedClass</a>(Blob, denorm, ClassId, FontinfoId, Class,
<a name="l00951"></a>00951                      <a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>);
<a name="l00952"></a>00952   }
<a name="l00953"></a>00953   <span class="keywordflow">else</span> {
<a name="l00954"></a>00954     IClass = <a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a> (<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>, ClassId);
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     NumFeatures = <a class="code" href="classtesseract_1_1_classify.html#a1f21b989c93ff1d297b5bde442fc430c">GetAdaptiveFeatures</a>(Blob, IntFeatures, &amp;FloatFeatures);
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (NumFeatures &lt;= 0)
<a name="l00958"></a>00958       <span class="keywordflow">return</span>;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#a30a627213fe38d7ae508cf6eaa946b41">SetBaseLineMatch</a>();
<a name="l00961"></a>00961     <span class="comment">// Only match configs with the matching font.</span>
<a name="l00962"></a>00962     <a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a> MatchingFontConfigs = <a class="code" href="bitvec_8cpp.html#a502314dc3ee4b178df067713b324b868">NewBitVector</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>);
<a name="l00963"></a>00963     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cfg = 0; cfg &lt; IClass-&gt;<a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html#abb9c509f11364b949fe9764bc122938c">NumConfigs</a>; ++cfg) {
<a name="l00964"></a>00964       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#afae8a55c28ee68de92ab1b1dd37c6905">GetFontinfoId</a>(Class, cfg) == FontinfoId) {
<a name="l00965"></a>00965         <a class="code" href="bitvec_8h.html#ab02d606cf8dca49ccadb00248bdbafe9">SET_BIT</a>(MatchingFontConfigs, cfg);
<a name="l00966"></a>00966       } <span class="keywordflow">else</span> {
<a name="l00967"></a>00967         <a class="code" href="bitvec_8h.html#a1209b8bb0fa7e6e7323cdb48b4165f0d">reset_bit</a>(MatchingFontConfigs, cfg);
<a name="l00968"></a>00968       }
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#aa695d9a7ae69ab036bc6f2455e50e421">Match</a>(IClass, <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>, MatchingFontConfigs,
<a name="l00971"></a>00971               NumFeatures, IntFeatures,
<a name="l00972"></a>00972               &amp;IntResult, <a class="code" href="classtesseract_1_1_classify.html#af722952ac0ab0339ade3abbbe10f8b6b">classify_adapt_feature_threshold</a>,
<a name="l00973"></a>00973               <a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">NO_DEBUG</a>, <a class="code" href="classtesseract_1_1_classify.html#a08873fa3ea379656484c07f606f8a09c">matcher_debug_separate_windows</a>);
<a name="l00974"></a>00974     <a class="code" href="bitvec_8cpp.html#adc1a7f52bb1fce0746e1e5725ad679f6">FreeBitVector</a>(MatchingFontConfigs);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <a class="code" href="classtesseract_1_1_classify.html#a5a3045639a3db979a8d1eb6dc4343e3b">SetAdaptiveThreshold</a>(Threshold);
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     <span class="keywordflow">if</span> (IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a> &lt;= Threshold) {
<a name="l00979"></a>00979       <span class="keywordflow">if</span> (<a class="code" href="adaptive_8h.html#a45d630ce43777ee1ab16048b0a846813">ConfigIsPermanent</a> (Class, IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>)) {
<a name="l00980"></a>00980         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1)
<a name="l00981"></a>00981           <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Found good match to perm config %d = %4.1f%%.\n&quot;</span>,
<a name="l00982"></a>00982             IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>, (1.0 - IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a>) * 100.0);
<a name="l00983"></a>00983         <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(FloatFeatures);
<a name="l00984"></a>00984         <span class="keywordflow">return</span>;
<a name="l00985"></a>00985       }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       TempConfig = <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a> (Class, IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>);
<a name="l00988"></a>00988       <a class="code" href="adaptive_8h.html#ac59a542b45e0a63d6b99ef48a189e1e0">IncreaseConfidence</a>(TempConfig);
<a name="l00989"></a>00989       <span class="keywordflow">if</span> (TempConfig-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a441b843c3b024cd12b0ab4115a9fd159">NumTimesSeen</a> &gt; Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a88d1300e6657fc7c98af721983018b36">MaxNumTimesSeen</a>) {
<a name="l00990"></a>00990         Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a88d1300e6657fc7c98af721983018b36">MaxNumTimesSeen</a> = TempConfig-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a441b843c3b024cd12b0ab4115a9fd159">NumTimesSeen</a>;
<a name="l00991"></a>00991       }
<a name="l00992"></a>00992       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1)
<a name="l00993"></a>00993         <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Increasing reliability of temp config %d to %d.\n&quot;</span>,
<a name="l00994"></a>00994           IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>, TempConfig-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a441b843c3b024cd12b0ab4115a9fd159">NumTimesSeen</a>);
<a name="l00995"></a>00995 
<a name="l00996"></a>00996       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a786c5f6e2a5cd8aac2ed4dd89af84fea">TempConfigReliable</a>(ClassId, TempConfig)) {
<a name="l00997"></a>00997         <a class="code" href="classtesseract_1_1_classify.html#aefb0cfe284dd67601798f7ae510b787f">MakePermanent</a>(<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>, ClassId, IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>, denorm,
<a name="l00998"></a>00998                       Blob);
<a name="l00999"></a>00999         <a class="code" href="classtesseract_1_1_classify.html#a954c9085f840572567462c9e0ff3551a">UpdateAmbigsGroup</a>(ClassId, denorm, Blob);
<a name="l01000"></a>01000       }
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002     <span class="keywordflow">else</span> {
<a name="l01003"></a>01003       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1) {
<a name="l01004"></a>01004         <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Found poor match to temp config %d = %4.1f%%.\n&quot;</span>,
<a name="l01005"></a>01005           IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>, (1.0 - IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a>) * 100.0);
<a name="l01006"></a>01006         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt; 2)
<a name="l01007"></a>01007           <a class="code" href="classtesseract_1_1_classify.html#aaa7b4a01a6f9bd1f088982a4011274e5">DisplayAdaptedChar</a>(Blob, denorm, IClass);
<a name="l01008"></a>01008       }
<a name="l01009"></a>01009       NewTempConfigId = <a class="code" href="classtesseract_1_1_classify.html#a59900939784eac1e2e6ebfec1f82bb58">MakeNewTemporaryConfig</a>(<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>,
<a name="l01010"></a>01010                                                ClassId,
<a name="l01011"></a>01011                                                FontinfoId,
<a name="l01012"></a>01012                                                NumFeatures,
<a name="l01013"></a>01013                                                IntFeatures,
<a name="l01014"></a>01014                                                FloatFeatures);
<a name="l01015"></a>01015       <span class="keywordflow">if</span> (NewTempConfigId &gt;= 0 &amp;&amp;
<a name="l01016"></a>01016           <a class="code" href="classtesseract_1_1_classify.html#a786c5f6e2a5cd8aac2ed4dd89af84fea">TempConfigReliable</a>(ClassId, <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a>(Class, NewTempConfigId))) {
<a name="l01017"></a>01017         <a class="code" href="classtesseract_1_1_classify.html#aefb0cfe284dd67601798f7ae510b787f">MakePermanent</a>(<a class="code" href="classtesseract_1_1_classify.html#a49c2bec2694a12cb6518001d8193d58d">AdaptedTemplates</a>, ClassId, NewTempConfigId, denorm, Blob);
<a name="l01018"></a>01018         <a class="code" href="classtesseract_1_1_classify.html#a954c9085f840572567462c9e0ff3551a">UpdateAmbigsGroup</a>(ClassId, denorm, Blob);
<a name="l01019"></a>01019       }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01022"></a>01022 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt; 1) {
<a name="l01023"></a>01023         <a class="code" href="classtesseract_1_1_classify.html#aaa7b4a01a6f9bd1f088982a4011274e5">DisplayAdaptedChar</a>(Blob, denorm, IClass);
<a name="l01024"></a>01024       }
<a name="l01025"></a>01025 <span class="preprocessor">#endif</span>
<a name="l01026"></a>01026 <span class="preprocessor"></span>    }
<a name="l01027"></a>01027     <a class="code" href="ocrfeatures_8cpp.html#a72b29c3d875eb9a2241385b1f1388b2d">FreeFeatureSet</a>(FloatFeatures);
<a name="l01028"></a>01028   }
<a name="l01029"></a>01029 }                                <span class="comment">/* AdaptToChar */</span>
<a name="l01030"></a>01030 
<a name="l01031"></a><a class="code" href="classtesseract_1_1_classify.html#aaa7b4a01a6f9bd1f088982a4011274e5">01031</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#aaa7b4a01a6f9bd1f088982a4011274e5">Classify::DisplayAdaptedChar</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a>* blob, <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01032"></a>01032                                   <a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html">INT_CLASS_STRUCT</a>* int_class) {
<a name="l01033"></a>01033 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01034"></a>01034 <span class="preprocessor"></span>  <span class="keywordtype">int</span> bloblength = 0;
<a name="l01035"></a>01035   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> features;
<a name="l01036"></a>01036   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* norm_array = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>()];
<a name="l01037"></a>01037   <span class="keywordtype">int</span> num_features = <a class="code" href="classtesseract_1_1_classify.html#a4bf0e47e0ae00a0cec215a887cef8c65">GetBaselineFeatures</a>(blob, denorm, <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>,
<a name="l01038"></a>01038                                          features,
<a name="l01039"></a>01039                                          norm_array, &amp;bloblength);
<a name="l01040"></a>01040   <span class="keyword">delete</span> [] norm_array;
<a name="l01041"></a>01041   <a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html">INT_RESULT_STRUCT</a> IntResult;
<a name="l01042"></a>01042 
<a name="l01043"></a>01043   <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#aa695d9a7ae69ab036bc6f2455e50e421">Match</a>(int_class, <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>, <a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a>,
<a name="l01044"></a>01044             num_features, features,
<a name="l01045"></a>01045             &amp;IntResult, <a class="code" href="classtesseract_1_1_classify.html#af722952ac0ab0339ade3abbbe10f8b6b">classify_adapt_feature_threshold</a>,
<a name="l01046"></a>01046             <a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">NO_DEBUG</a>, <a class="code" href="classtesseract_1_1_classify.html#a08873fa3ea379656484c07f606f8a09c">matcher_debug_separate_windows</a>);
<a name="l01047"></a>01047   <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Best match to temp config %d = %4.1f%%.\n&quot;</span>,
<a name="l01048"></a>01048     IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>, (1.0 - IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a>) * 100.0);
<a name="l01049"></a>01049   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 2) {
<a name="l01050"></a>01050     <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> ConfigMask;
<a name="l01051"></a>01051     ConfigMask = 1 &lt;&lt; IntResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>;
<a name="l01052"></a>01052     <a class="code" href="classtesseract_1_1_classify.html#a44e1b8840fb841e621b902f3abdd8522">ShowMatchDisplay</a>();
<a name="l01053"></a>01053     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#aa695d9a7ae69ab036bc6f2455e50e421">Match</a>(int_class, <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>, (<a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>)&amp;ConfigMask,
<a name="l01054"></a>01054               num_features, features,
<a name="l01055"></a>01055               &amp;IntResult, <a class="code" href="classtesseract_1_1_classify.html#af722952ac0ab0339ade3abbbe10f8b6b">classify_adapt_feature_threshold</a>,
<a name="l01056"></a>01056               6 | 0x19, <a class="code" href="classtesseract_1_1_classify.html#a08873fa3ea379656484c07f606f8a09c">matcher_debug_separate_windows</a>);
<a name="l01057"></a>01057     <a class="code" href="intproto_8cpp.html#a3827f6daeeb1efd88fa0bf418c83d984">UpdateMatchDisplay</a>();
<a name="l01058"></a>01058   }
<a name="l01059"></a>01059 <span class="preprocessor">#endif</span>
<a name="l01060"></a>01060 <span class="preprocessor"></span>}
<a name="l01061"></a>01061 
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01077"></a><a class="code" href="classtesseract_1_1_classify.html#a7d9076164677e7e5a863a8a5d265b957">01077</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a7d9076164677e7e5a863a8a5d265b957">Classify::AdaptToPunc</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01078"></a>01078                            <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01079"></a>01079                            <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId,
<a name="l01080"></a>01080                            <span class="keywordtype">int</span> FontinfoId,
<a name="l01081"></a>01081                            <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Threshold) {
<a name="l01082"></a>01082   <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results = <span class="keyword">new</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>();
<a name="l01083"></a>01083   <span class="keywordtype">int</span> i;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085   Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a450c3b1b225dfa0771edd50732e5d288">Initialize</a>();
<a name="l01086"></a>01086   <a class="code" href="classtesseract_1_1_classify.html#a0e552819a03cc6f169e18a58b16696a6">CharNormClassifier</a>(Blob, denorm, <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>, Results);
<a name="l01087"></a>01087   <a class="code" href="classtesseract_1_1_classify.html#a0e35029ac0c77ad18d35f08c27c99d15">RemoveBadMatches</a>(Results);
<a name="l01088"></a>01088 
<a name="l01089"></a>01089   <span class="keywordflow">if</span> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> != 1) {
<a name="l01090"></a>01090     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1) {
<a name="l01091"></a>01091       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Rejecting punc = %s (Alternatives = &quot;</span>,
<a name="l01092"></a>01092                <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(ClassId));
<a name="l01093"></a>01093 
<a name="l01094"></a>01094       <span class="keywordflow">for</span> (i = 0; i &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; i++)
<a name="l01095"></a>01095         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>));
<a name="l01096"></a>01096       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l01097"></a>01097     }
<a name="l01098"></a>01098   } <span class="keywordflow">else</span> {
<a name="l01099"></a>01099 <span class="preprocessor">    #ifndef SECURE_NAMES</span>
<a name="l01100"></a>01100 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#af9e34f61db55f7f312f8e1531b2368bc">classify_learning_debug_level</a> &gt;= 1)
<a name="l01101"></a>01101       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;Adapting to punc = %s, thr= %g\n&quot;</span>,
<a name="l01102"></a>01102                <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(ClassId), Threshold);
<a name="l01103"></a>01103 <span class="preprocessor">    #endif</span>
<a name="l01104"></a>01104 <span class="preprocessor"></span>    <a class="code" href="classtesseract_1_1_classify.html#a53629ef3f5562677ae096bbce864e5ab">AdaptToChar</a>(Blob, denorm, ClassId, FontinfoId, Threshold);
<a name="l01105"></a>01105   }
<a name="l01106"></a>01106   <span class="keyword">delete</span> Results;
<a name="l01107"></a>01107 }                                <span class="comment">/* AdaptToPunc */</span>
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01137"></a><a class="code" href="classtesseract_1_1_classify.html#a3681915077046082b4d99532a3f3da61">01137</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a3681915077046082b4d99532a3f3da61">Classify::AddNewResult</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *results,
<a name="l01138"></a>01138                             <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> class_id,
<a name="l01139"></a>01139                             <span class="keywordtype">int</span> shape_id,
<a name="l01140"></a>01140                             <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> rating,
<a name="l01141"></a>01141                             <span class="keywordtype">bool</span> adapted,
<a name="l01142"></a>01142                             <span class="keywordtype">int</span> config,
<a name="l01143"></a>01143                             <span class="keywordtype">int</span> fontinfo_id,
<a name="l01144"></a>01144                             <span class="keywordtype">int</span> fontinfo_id2) {
<a name="l01145"></a>01145   <a class="code" href="struct_scored_class.html">ScoredClass</a> *old_match = <a class="code" href="adaptmatch_8cpp.html#a3cedbdc7ad221f31895c55506410fd98">FindScoredUnichar</a>(results, class_id);
<a name="l01146"></a>01146   <a class="code" href="struct_scored_class.html">ScoredClass</a> match =
<a name="l01147"></a>01147       { class_id,
<a name="l01148"></a>01148         shape_id,
<a name="l01149"></a>01149         rating,
<a name="l01150"></a>01150         adapted,
<a name="l01151"></a>01151         <span class="keyword">static_cast&lt;</span><a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a><span class="keyword">&gt;</span>(config),
<a name="l01152"></a>01152         static_cast&lt;inT16&gt;(fontinfo_id),
<a name="l01153"></a>01153         <span class="keyword">static_cast&lt;</span><a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a><span class="keyword">&gt;</span>(fontinfo_id2) };
<a name="l01154"></a>01154 
<a name="l01155"></a>01155   <span class="keywordflow">if</span> (rating &gt; results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> + <a class="code" href="classtesseract_1_1_classify.html#a10595e84248f68a98f8e73bcdb6ae89a">matcher_bad_match_pad</a> ||
<a name="l01156"></a>01156       (old_match &amp;&amp; rating &gt;= old_match-&gt;<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>))
<a name="l01157"></a>01157     <span class="keywordflow">return</span>;
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#af08440927e3b87f99bd3a3fbd8e126dc">get_fragment</a>(class_id))
<a name="l01160"></a>01160     results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#ab6a520c3c59a1f1a3f4d1c27bf5d3000">HasNonfragment</a> = <span class="keyword">true</span>;
<a name="l01161"></a>01161 
<a name="l01162"></a>01162   if (old_match)
<a name="l01163"></a>01163     old_match-&gt;<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> = rating;
<a name="l01164"></a>01164   <span class="keywordflow">else</span>
<a name="l01165"></a>01165     results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>++] = match;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   <span class="keywordflow">if</span> (rating &lt; results-&gt;best_match.rating &amp;&amp;
<a name="l01168"></a>01168       <span class="comment">// Ensure that fragments do not affect best rating, class and config.</span>
<a name="l01169"></a>01169       <span class="comment">// This is needed so that at least one non-fragmented character is</span>
<a name="l01170"></a>01170       <span class="comment">// always present in the results.</span>
<a name="l01171"></a>01171       <span class="comment">// TODO(daria): verify that this helps accuracy and does not</span>
<a name="l01172"></a>01172       <span class="comment">// hurt performance.</span>
<a name="l01173"></a>01173       !<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#af08440927e3b87f99bd3a3fbd8e126dc">get_fragment</a>(class_id)) {
<a name="l01174"></a>01174     results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a> = match;
<a name="l01175"></a>01175   }
<a name="l01176"></a>01176 }                                <span class="comment">/* AddNewResult */</span>
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01200"></a><a class="code" href="classtesseract_1_1_classify.html#ac7501f294525f6dd7fca4a3512ae0dcf">01200</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#ac7501f294525f6dd7fca4a3512ae0dcf">Classify::AmbigClassifier</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01201"></a>01201                                <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01202"></a>01202                                <a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES</a> Templates,
<a name="l01203"></a>01203                                <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> *Classes,
<a name="l01204"></a>01204                                <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *Ambiguities,
<a name="l01205"></a>01205                                <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l01206"></a>01206   <span class="keywordtype">int</span> NumFeatures;
<a name="l01207"></a>01207   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures;
<a name="l01208"></a>01208   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* CharNormArray = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>()];
<a name="l01209"></a>01209   <a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html">INT_RESULT_STRUCT</a> IntResult;
<a name="l01210"></a>01210   <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   AmbigClassifierCalls++;
<a name="l01213"></a>01213 
<a name="l01214"></a>01214   NumFeatures = <a class="code" href="classtesseract_1_1_classify.html#a1076d5d08686e48d39ef3eb07e711fb6">GetCharNormFeatures</a>(Blob, denorm, Templates, IntFeatures,
<a name="l01215"></a>01215                                     <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, CharNormArray,
<a name="l01216"></a>01216                                     &amp;(Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>), <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01217"></a>01217   <span class="keywordflow">if</span> (NumFeatures &lt;= 0) {
<a name="l01218"></a>01218     <span class="keyword">delete</span> [] CharNormArray;
<a name="l01219"></a>01219     <span class="keywordflow">return</span>;
<a name="l01220"></a>01220   }
<a name="l01221"></a>01221 
<a name="l01222"></a>01222   <span class="keywordtype">bool</span> debug = <a class="code" href="classtesseract_1_1_classify.html#a59d2ce9a817ab97d37a459ca2459cf8e">matcher_debug_level</a> &gt;= 2 || <a class="code" href="classtesseract_1_1_classify.html#a0f934f0b39cb869d2a4973269fb696cf">classify_debug_level</a> &gt; 1;
<a name="l01223"></a>01223   <span class="keywordflow">if</span> (debug)
<a name="l01224"></a>01224     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;AM Matches =  &quot;</span>);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226   <span class="keywordtype">int</span> top = Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01227"></a>01227   <span class="keywordtype">int</span> bottom = Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01228"></a>01228   <span class="keywordflow">while</span> (*Ambiguities &gt;= 0) {
<a name="l01229"></a>01229     ClassId = *Ambiguities;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#adff6fd8fca725fa346db25010b3be21e">SetCharNormMatch</a>(<a class="code" href="classtesseract_1_1_classify.html#acab8de2f560b04b48191f60099e4244b">classify_integer_matcher_multiplier</a>);
<a name="l01232"></a>01232     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#aa695d9a7ae69ab036bc6f2455e50e421">Match</a>(<a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a>(Templates, ClassId),
<a name="l01233"></a>01233               <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>, <a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a>,
<a name="l01234"></a>01234               NumFeatures, IntFeatures,
<a name="l01235"></a>01235               &amp;IntResult,
<a name="l01236"></a>01236               <a class="code" href="classtesseract_1_1_classify.html#af722952ac0ab0339ade3abbbe10f8b6b">classify_adapt_feature_threshold</a>, <a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">NO_DEBUG</a>,
<a name="l01237"></a>01237               <a class="code" href="classtesseract_1_1_classify.html#a08873fa3ea379656484c07f606f8a09c">matcher_debug_separate_windows</a>);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     <a class="code" href="classtesseract_1_1_classify.html#a7d663f1e02d6e7b2d1783fdca6154a4d">ExpandShapesAndApplyCorrections</a>(<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, debug, ClassId, bottom, top, 0,
<a name="l01240"></a>01240                                     Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>, CharNormArray,
<a name="l01241"></a>01241                                     IntResult, Results);
<a name="l01242"></a>01242     Ambiguities++;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244     NumAmbigClassesTried++;
<a name="l01245"></a>01245   }
<a name="l01246"></a>01246   <span class="keyword">delete</span> [] CharNormArray;
<a name="l01247"></a>01247 }                                <span class="comment">/* AmbigClassifier */</span>
<a name="l01248"></a>01248 
<a name="l01249"></a>01249 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01252"></a><a class="code" href="classtesseract_1_1_classify.html#a9df3ff8623acd0ab30286ace7362045c">01252</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a9df3ff8623acd0ab30286ace7362045c">Classify::MasterMatcher</a>(<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES</a> templates,
<a name="l01253"></a>01253                              <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> num_features,
<a name="l01254"></a>01254                              <span class="keyword">const</span> <a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html">INT_FEATURE_STRUCT</a>* features,
<a name="l01255"></a>01255                              <span class="keyword">const</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* norm_factors,
<a name="l01256"></a>01256                              <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a>* classes,
<a name="l01257"></a>01257                              <span class="keywordtype">int</span> debug,
<a name="l01258"></a>01258                              <span class="keywordtype">int</span> num_classes,
<a name="l01259"></a>01259                              <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; blob_box,
<a name="l01260"></a>01260                              <a class="code" href="intmatcher_8h.html#aad58739a624ab51ab180aac3342c6efc">CLASS_PRUNER_RESULTS</a> results,
<a name="l01261"></a>01261                              <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>* final_results) {
<a name="l01262"></a>01262   <span class="keywordtype">int</span> top = blob_box.<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>();
<a name="l01263"></a>01263   <span class="keywordtype">int</span> bottom = blob_box.<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>();
<a name="l01264"></a>01264   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; num_classes; c++) {
<a name="l01265"></a>01265     <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> class_id = results[c].Class;
<a name="l01266"></a>01266     <a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html">INT_RESULT_STRUCT</a>&amp; int_result = results[c].IMResult;
<a name="l01267"></a>01267     <a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a> protos = classes != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? classes[class_id]-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a0dd8b01d8c5cc59c77098cdb268ce1ea">PermProtos</a>
<a name="l01268"></a>01268                                         : <a class="code" href="classtesseract_1_1_classify.html#a08295fdeacbf1d536337f542320e86e2">AllProtosOn</a>;
<a name="l01269"></a>01269     <a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a> configs = classes != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? classes[class_id]-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#ad19f8e0d6520b447871c5d958b367bf4">PermConfigs</a>
<a name="l01270"></a>01270                                          : <a class="code" href="classtesseract_1_1_classify.html#ada1ef7ff613927daa2838ba41eaa055f">AllConfigsOn</a>;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#aa695d9a7ae69ab036bc6f2455e50e421">Match</a>(<a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a>(templates, class_id),
<a name="l01273"></a>01273               protos, configs,
<a name="l01274"></a>01274               num_features, features,
<a name="l01275"></a>01275               &amp;int_result, <a class="code" href="classtesseract_1_1_classify.html#af722952ac0ab0339ade3abbbe10f8b6b">classify_adapt_feature_threshold</a>, debug,
<a name="l01276"></a>01276               <a class="code" href="classtesseract_1_1_classify.html#a08873fa3ea379656484c07f606f8a09c">matcher_debug_separate_windows</a>);
<a name="l01277"></a>01277     <span class="keywordtype">bool</span> debug = <a class="code" href="classtesseract_1_1_classify.html#a59d2ce9a817ab97d37a459ca2459cf8e">matcher_debug_level</a> &gt;= 2 || <a class="code" href="classtesseract_1_1_classify.html#a0f934f0b39cb869d2a4973269fb696cf">classify_debug_level</a> &gt; 1;
<a name="l01278"></a>01278     <a class="code" href="classtesseract_1_1_classify.html#a7d663f1e02d6e7b2d1783fdca6154a4d">ExpandShapesAndApplyCorrections</a>(classes, debug, class_id, bottom, top,
<a name="l01279"></a>01279                                     results[c].Rating,
<a name="l01280"></a>01280                                     final_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>, norm_factors,
<a name="l01281"></a>01281                                     int_result, final_results);
<a name="l01282"></a>01282   }
<a name="l01283"></a>01283 }
<a name="l01284"></a>01284 
<a name="l01285"></a>01285 <span class="comment">// Converts configs to fonts, and if the result is not adapted, and a</span>
<a name="l01286"></a>01286 <span class="comment">// shape_table_ is present, the shape is expanded to include all</span>
<a name="l01287"></a>01287 <span class="comment">// unichar_ids represented, before applying a set of corrections to the</span>
<a name="l01288"></a>01288 <span class="comment">// distance rating in int_result, (see ComputeCorrectedRating.)</span>
<a name="l01289"></a>01289 <span class="comment">// The results are added to the final_results output.</span>
<a name="l01290"></a><a class="code" href="classtesseract_1_1_classify.html#a7d663f1e02d6e7b2d1783fdca6154a4d">01290</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a7d663f1e02d6e7b2d1783fdca6154a4d">Classify::ExpandShapesAndApplyCorrections</a>(
<a name="l01291"></a>01291     <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a>* classes, <span class="keywordtype">bool</span> debug, <span class="keywordtype">int</span> class_id, <span class="keywordtype">int</span> bottom, <span class="keywordtype">int</span> top,
<a name="l01292"></a>01292     <span class="keywordtype">float</span> cp_rating, <span class="keywordtype">int</span> blob_length, <span class="keyword">const</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* cn_factors,
<a name="l01293"></a>01293     <a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html">INT_RESULT_STRUCT</a>&amp; int_result, <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>* final_results) {
<a name="l01294"></a>01294   <span class="comment">// Compute the fontinfo_ids.</span>
<a name="l01295"></a>01295   <span class="keywordtype">int</span> fontinfo_id = kBlankFontinfoId;
<a name="l01296"></a>01296   <span class="keywordtype">int</span> fontinfo_id2 = kBlankFontinfoId;
<a name="l01297"></a>01297   <span class="keywordflow">if</span> (classes != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01298"></a>01298     <span class="comment">// Adapted result.</span>
<a name="l01299"></a>01299     fontinfo_id = <a class="code" href="classtesseract_1_1_classify.html#afae8a55c28ee68de92ab1b1dd37c6905">GetFontinfoId</a>(classes[class_id], int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>);
<a name="l01300"></a>01300     <span class="keywordflow">if</span> (int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#a836e323aea6abcaa3f1a758f569fe0c9">Config2</a> &gt;= 0)
<a name="l01301"></a>01301       fontinfo_id2 = <a class="code" href="classtesseract_1_1_classify.html#afae8a55c28ee68de92ab1b1dd37c6905">GetFontinfoId</a>(classes[class_id], int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#a836e323aea6abcaa3f1a758f569fe0c9">Config2</a>);
<a name="l01302"></a>01302   } <span class="keywordflow">else</span> {
<a name="l01303"></a>01303     <span class="comment">// Pre-trained result.</span>
<a name="l01304"></a>01304     fontinfo_id = <a class="code" href="classtesseract_1_1_classify.html#a1002c7f80352c6ceac4af82ee35e5e06">ClassAndConfigIDToFontOrShapeID</a>(class_id, int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>);
<a name="l01305"></a>01305     <span class="keywordflow">if</span> (int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#a836e323aea6abcaa3f1a758f569fe0c9">Config2</a> &gt;= 0) {
<a name="l01306"></a>01306       fontinfo_id2 = <a class="code" href="classtesseract_1_1_classify.html#a1002c7f80352c6ceac4af82ee35e5e06">ClassAndConfigIDToFontOrShapeID</a>(class_id,
<a name="l01307"></a>01307                                                      int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#a836e323aea6abcaa3f1a758f569fe0c9">Config2</a>);
<a name="l01308"></a>01308     }
<a name="l01309"></a>01309     <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01310"></a>01310       <span class="comment">// Actually fontinfo_id is an index into the shape_table_ and it</span>
<a name="l01311"></a>01311       <span class="comment">// contains a list of unchar_id/font_id pairs.</span>
<a name="l01312"></a>01312       <span class="keywordtype">int</span> shape_id = fontinfo_id;
<a name="l01313"></a>01313       <span class="keyword">const</span> <a class="code" href="classtesseract_1_1_shape.html">Shape</a>&amp; shape = <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a>-&gt;<a class="code" href="classtesseract_1_1_shape_table.html#a9334161c64756c591ff7d4fca22277f5">GetShape</a>(fontinfo_id);
<a name="l01314"></a>01314       <span class="keywordtype">double</span> min_rating = 0.0;
<a name="l01315"></a>01315       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; shape.<a class="code" href="classtesseract_1_1_shape.html#a0fca7f64992c74492787d00240a22913">size</a>(); ++c) {
<a name="l01316"></a>01316         <span class="keywordtype">int</span> unichar_id = shape[c].unichar_id;
<a name="l01317"></a>01317         fontinfo_id = shape[c].font_ids[0];
<a name="l01318"></a>01318         <span class="keywordflow">if</span> (shape[c].font_ids.<a class="code" href="classtesseract_1_1_shape.html#a0fca7f64992c74492787d00240a22913">size</a>() &gt; 1)
<a name="l01319"></a>01319           fontinfo_id2 = shape[c].font_ids[1];
<a name="l01320"></a>01320         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fontinfo_id2 != kBlankFontinfoId)
<a name="l01321"></a>01321           fontinfo_id2 = <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a>-&gt;<a class="code" href="classtesseract_1_1_shape_table.html#a9334161c64756c591ff7d4fca22277f5">GetShape</a>(fontinfo_id2)[0].font_ids[0];
<a name="l01322"></a>01322         <span class="keywordtype">double</span> rating = <a class="code" href="classtesseract_1_1_classify.html#a7c6031863d4dafb400551cc4f151f3b5">ComputeCorrectedRating</a>(debug, unichar_id, cp_rating,
<a name="l01323"></a>01323                                                int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a>,
<a name="l01324"></a>01324                                                int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#a7b679d879f68fc70f4af3d983cea4036">FeatureMisses</a>,
<a name="l01325"></a>01325                                                bottom, top, blob_length,
<a name="l01326"></a>01326                                                cn_factors);
<a name="l01327"></a>01327         <span class="keywordflow">if</span> (c == 0 || rating &lt; min_rating)
<a name="l01328"></a>01328           min_rating = rating;
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa5f5f5b010151daf76255777aebeea18">get_enabled</a>(unichar_id)) {
<a name="l01330"></a>01330           <a class="code" href="classtesseract_1_1_classify.html#a3681915077046082b4d99532a3f3da61">AddNewResult</a>(final_results, unichar_id, shape_id, rating,
<a name="l01331"></a>01331                        classes != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>,
<a name="l01332"></a>01332                        fontinfo_id, fontinfo_id2);
<a name="l01333"></a>01333         }
<a name="l01334"></a>01334       }
<a name="l01335"></a>01335       int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a> = min_rating;
<a name="l01336"></a>01336       <span class="keywordflow">return</span>;
<a name="l01337"></a>01337     }
<a name="l01338"></a>01338   }
<a name="l01339"></a>01339   <span class="keywordtype">double</span> rating = <a class="code" href="classtesseract_1_1_classify.html#a7c6031863d4dafb400551cc4f151f3b5">ComputeCorrectedRating</a>(debug, class_id, cp_rating,
<a name="l01340"></a>01340                                          int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a>,
<a name="l01341"></a>01341                                          int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#a7b679d879f68fc70f4af3d983cea4036">FeatureMisses</a>,
<a name="l01342"></a>01342                                          bottom, top, blob_length,
<a name="l01343"></a>01343                                          cn_factors);
<a name="l01344"></a>01344   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa5f5f5b010151daf76255777aebeea18">get_enabled</a>(class_id)) {
<a name="l01345"></a>01345     <a class="code" href="classtesseract_1_1_classify.html#a3681915077046082b4d99532a3f3da61">AddNewResult</a>(final_results, class_id, -1, rating,
<a name="l01346"></a>01346                  classes != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>,
<a name="l01347"></a>01347                  fontinfo_id, fontinfo_id2);
<a name="l01348"></a>01348   }
<a name="l01349"></a>01349   int_result.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a> = rating;
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 <span class="comment">// Applies a set of corrections to the distance im_rating,</span>
<a name="l01353"></a>01353 <span class="comment">// including the cn_correction, miss penalty and additional penalty</span>
<a name="l01354"></a>01354 <span class="comment">// for non-alnums being vertical misfits. Returns the corrected distance.</span>
<a name="l01355"></a><a class="code" href="classtesseract_1_1_classify.html#a7c6031863d4dafb400551cc4f151f3b5">01355</a> <span class="keywordtype">double</span> <a class="code" href="classtesseract_1_1_classify.html#a7c6031863d4dafb400551cc4f151f3b5">Classify::ComputeCorrectedRating</a>(<span class="keywordtype">bool</span> debug, <span class="keywordtype">int</span> unichar_id,
<a name="l01356"></a>01356                                         <span class="keywordtype">double</span> cp_rating, <span class="keywordtype">double</span> im_rating,
<a name="l01357"></a>01357                                         <span class="keywordtype">int</span> feature_misses,
<a name="l01358"></a>01358                                         <span class="keywordtype">int</span> bottom, <span class="keywordtype">int</span> top,
<a name="l01359"></a>01359                                         <span class="keywordtype">int</span> blob_length,
<a name="l01360"></a>01360                                         <span class="keyword">const</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* cn_factors) {
<a name="l01361"></a>01361   <span class="comment">// Compute class feature corrections.</span>
<a name="l01362"></a>01362   <span class="keywordtype">double</span> cn_corrected = <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#ab943619d1ec5d510c5fd9a2ba7bbb55d">ApplyCNCorrection</a>(im_rating, blob_length,
<a name="l01363"></a>01363                                               cn_factors[unichar_id]);
<a name="l01364"></a>01364   <span class="keywordtype">double</span> miss_penalty = <a class="code" href="classtesseract_1_1_classify.html#a0be36efceb5fcf41dfbc032516af2ace">tessedit_class_miss_scale</a> * feature_misses;
<a name="l01365"></a>01365   <span class="keywordtype">double</span> vertical_penalty = 0.0;
<a name="l01366"></a>01366   <span class="comment">// Penalize non-alnums for being vertical misfits.</span>
<a name="l01367"></a>01367   <span class="keywordflow">if</span> (!<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#ad1dd0929edfb0e9e4905cc2fbeff42c2">get_isalpha</a>(unichar_id) &amp;&amp;
<a name="l01368"></a>01368       !<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a5951dde3ab90c12c309d776570a10725">get_isdigit</a>(unichar_id) &amp;&amp;
<a name="l01369"></a>01369       cn_factors[unichar_id] != 0 &amp;&amp; <a class="code" href="classtesseract_1_1_classify.html#a67a98c273b9c1b7cc951fcb20e376bf3">classify_misfit_junk_penalty</a> &gt; 0.0) {
<a name="l01370"></a>01370     <span class="keywordtype">int</span> min_bottom, max_bottom, min_top, max_top;
<a name="l01371"></a>01371     <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#af2e0d12e80aa3aa985652d73eaf1e95f">get_top_bottom</a>(unichar_id, &amp;min_bottom, &amp;max_bottom,
<a name="l01372"></a>01372                               &amp;min_top, &amp;max_top);
<a name="l01373"></a>01373     <span class="keywordflow">if</span> (debug) {
<a name="l01374"></a>01374       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;top=%d, vs [%d, %d], bottom=%d, vs [%d, %d]\n&quot;</span>,
<a name="l01375"></a>01375               top, min_top, max_top, bottom, min_bottom, max_bottom);
<a name="l01376"></a>01376     }
<a name="l01377"></a>01377     <span class="keywordflow">if</span> (top &lt; min_top || top &gt; max_top ||
<a name="l01378"></a>01378         bottom &lt; min_bottom || bottom &gt; max_bottom) {
<a name="l01379"></a>01379       vertical_penalty = <a class="code" href="classtesseract_1_1_classify.html#a67a98c273b9c1b7cc951fcb20e376bf3">classify_misfit_junk_penalty</a>;
<a name="l01380"></a>01380     }
<a name="l01381"></a>01381   }
<a name="l01382"></a>01382   <span class="keywordtype">double</span> result =cn_corrected + miss_penalty + vertical_penalty;
<a name="l01383"></a>01383   <span class="keywordflow">if</span> (result &gt; <a class="code" href="adaptmatch_8cpp.html#a93902888a2216c8e4a03ddc10aed7f41">WORST_POSSIBLE_RATING</a>)
<a name="l01384"></a>01384     result = <a class="code" href="adaptmatch_8cpp.html#a93902888a2216c8e4a03ddc10aed7f41">WORST_POSSIBLE_RATING</a>;
<a name="l01385"></a>01385   <span class="keywordflow">if</span> (debug) {
<a name="l01386"></a>01386     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;%s: %2.1f(CP%2.1f, IM%2.1f + CN%.2f(%d) + MP%2.1f + VP%2.1f)\n&quot;</span>,
<a name="l01387"></a>01387             <a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#a421c0b6ebcbbe7547490252fb688c961">id_to_unichar</a>(unichar_id),
<a name="l01388"></a>01388             result * 100.0,
<a name="l01389"></a>01389             cp_rating * 100.0,
<a name="l01390"></a>01390             im_rating * 100.0,
<a name="l01391"></a>01391             (cn_corrected - im_rating) * 100.0,
<a name="l01392"></a>01392             cn_factors[unichar_id],
<a name="l01393"></a>01393             miss_penalty * 100.0,
<a name="l01394"></a>01394             vertical_penalty * 100.0);
<a name="l01395"></a>01395   }
<a name="l01396"></a>01396   <span class="keywordflow">return</span> result;
<a name="l01397"></a>01397 }
<a name="l01398"></a>01398 
<a name="l01399"></a>01399 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01418"></a><a class="code" href="classtesseract_1_1_classify.html#ab7022031939236cac2fe6b661e6f657b">01418</a> <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *<a class="code" href="classtesseract_1_1_classify.html#ab7022031939236cac2fe6b661e6f657b">Classify::BaselineClassifier</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01419"></a>01419                                          <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01420"></a>01420                                          <a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">ADAPT_TEMPLATES</a> Templates,
<a name="l01421"></a>01421                                          <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l01422"></a>01422   <span class="keywordtype">int</span> NumFeatures;
<a name="l01423"></a>01423   <span class="keywordtype">int</span> NumClasses;
<a name="l01424"></a>01424   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures;
<a name="l01425"></a>01425   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* CharNormArray = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>()];
<a name="l01426"></a>01426   <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId;
<a name="l01427"></a>01427 
<a name="l01428"></a>01428   BaselineClassifierCalls++;
<a name="l01429"></a>01429 
<a name="l01430"></a>01430   NumFeatures = <a class="code" href="classtesseract_1_1_classify.html#a4bf0e47e0ae00a0cec215a887cef8c65">GetBaselineFeatures</a>(
<a name="l01431"></a>01431       Blob, denorm, Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>, IntFeatures, CharNormArray,
<a name="l01432"></a>01432       &amp;(Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>));
<a name="l01433"></a>01433   <span class="keywordflow">if</span> (NumFeatures &lt;= 0) {
<a name="l01434"></a>01434     <span class="keyword">delete</span> [] CharNormArray;
<a name="l01435"></a>01435     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01436"></a>01436   }
<a name="l01437"></a>01437 
<a name="l01438"></a>01438   NumClasses = <a class="code" href="classtesseract_1_1_classify.html#af60b52006bbea0cc1727d543c3fcd1ad">PruneClasses</a>(Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>, NumFeatures, IntFeatures,
<a name="l01439"></a>01439                             CharNormArray, BaselineCutoffs, Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>);
<a name="l01440"></a>01440 
<a name="l01441"></a>01441   NumBaselineClassesTried += NumClasses;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a59d2ce9a817ab97d37a459ca2459cf8e">matcher_debug_level</a> &gt;= 2 || <a class="code" href="classtesseract_1_1_classify.html#a0f934f0b39cb869d2a4973269fb696cf">classify_debug_level</a> &gt; 1)
<a name="l01444"></a>01444     <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;BL Matches =  &quot;</span>);
<a name="l01445"></a>01445 
<a name="l01446"></a>01446   <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#a30a627213fe38d7ae508cf6eaa946b41">SetBaseLineMatch</a>();
<a name="l01447"></a>01447   <a class="code" href="classtesseract_1_1_classify.html#a9df3ff8623acd0ab30286ace7362045c">MasterMatcher</a>(Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>, NumFeatures, IntFeatures, CharNormArray,
<a name="l01448"></a>01448                 Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a0256081fa31eb38b52b19788ca62e327">Class</a>, <a class="code" href="classtesseract_1_1_classify.html#a3bfadb1d56669868fe7d18e12a7716dc">matcher_debug_flags</a>, NumClasses,
<a name="l01449"></a>01449                 Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>(), Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>, Results);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451   <span class="keyword">delete</span> [] CharNormArray;
<a name="l01452"></a>01452   ClassId = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>;
<a name="l01453"></a>01453   <span class="keywordflow">if</span> (ClassId == <a class="code" href="matchdefs_8h.html#a6ce548e51895ce0226ee145753a9c815">NO_CLASS</a>)
<a name="l01454"></a>01454     <span class="keywordflow">return</span> (<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01455"></a>01455   <span class="comment">/* this is a bug - maybe should return &quot;&quot; */</span>
<a name="l01456"></a>01456 
<a name="l01457"></a>01457   <span class="keywordflow">return</span> Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a0256081fa31eb38b52b19788ca62e327">Class</a>[ClassId]-&gt;
<a name="l01458"></a>01458       <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>[Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa8ff624b603b87dd4cc41304e1e72b05">config</a>].Perm-&gt;Ambigs;
<a name="l01459"></a>01459 }                                <span class="comment">/* BaselineClassifier */</span>
<a name="l01460"></a>01460 
<a name="l01461"></a>01461 
<a name="l01462"></a>01462 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01482"></a><a class="code" href="classtesseract_1_1_classify.html#a0e552819a03cc6f169e18a58b16696a6">01482</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a0e552819a03cc6f169e18a58b16696a6">Classify::CharNormClassifier</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01483"></a>01483                                  <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01484"></a>01484                                  <a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES</a> Templates,
<a name="l01485"></a>01485                                  <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l01486"></a>01486   <span class="keywordtype">int</span> NumFeatures;
<a name="l01487"></a>01487   <span class="keywordtype">int</span> NumClasses;
<a name="l01488"></a>01488   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures;
<a name="l01489"></a>01489 
<a name="l01490"></a>01490   CharNormClassifierCalls++;
<a name="l01491"></a>01491 
<a name="l01492"></a>01492   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* CharNormArray = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>()];
<a name="l01493"></a>01493   <span class="keywordtype">int</span> num_pruner_classes = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>(),
<a name="l01494"></a>01494                                <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>-&gt;<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a4735b2443aa7452909969d8d07e1877a">NumClasses</a>);
<a name="l01495"></a>01495   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* PrunerNormArray = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[num_pruner_classes];
<a name="l01496"></a>01496   NumFeatures = <a class="code" href="classtesseract_1_1_classify.html#a1076d5d08686e48d39ef3eb07e711fb6">GetCharNormFeatures</a>(Blob, denorm, Templates, IntFeatures,
<a name="l01497"></a>01497                                     PrunerNormArray, CharNormArray,
<a name="l01498"></a>01498                                     &amp;(Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>), <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01499"></a>01499   <span class="keywordflow">if</span> (NumFeatures &lt;= 0) {
<a name="l01500"></a>01500     <span class="keyword">delete</span> [] CharNormArray;
<a name="l01501"></a>01501     <span class="keyword">delete</span> [] PrunerNormArray;
<a name="l01502"></a>01502     <span class="keywordflow">return</span> 0;
<a name="l01503"></a>01503   }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505   NumClasses = <a class="code" href="classtesseract_1_1_classify.html#af60b52006bbea0cc1727d543c3fcd1ad">PruneClasses</a>(Templates, NumFeatures, IntFeatures,
<a name="l01506"></a>01506                             PrunerNormArray,
<a name="l01507"></a>01507                             <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? &amp;shapetable_cutoffs_[0]
<a name="l01508"></a>01508                                                  : CharNormCutoffs,
<a name="l01509"></a>01509                             Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>);
<a name="l01510"></a>01510 
<a name="l01511"></a>01511   <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a96f1213af9f43f2ec0ab9e22f32da3b6">tessedit_single_match</a> &amp;&amp; NumClasses &gt; 1)
<a name="l01512"></a>01512     NumClasses = 1;
<a name="l01513"></a>01513   NumCharNormClassesTried += NumClasses;
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#adff6fd8fca725fa346db25010b3be21e">SetCharNormMatch</a>(<a class="code" href="classtesseract_1_1_classify.html#acab8de2f560b04b48191f60099e4244b">classify_integer_matcher_multiplier</a>);
<a name="l01516"></a>01516   <a class="code" href="classtesseract_1_1_classify.html#a9df3ff8623acd0ab30286ace7362045c">MasterMatcher</a>(Templates, NumFeatures, IntFeatures, CharNormArray,
<a name="l01517"></a>01517                 <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="classtesseract_1_1_classify.html#a3bfadb1d56669868fe7d18e12a7716dc">matcher_debug_flags</a>, NumClasses,
<a name="l01518"></a>01518                 Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>(), Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>, Results);
<a name="l01519"></a>01519   <span class="keyword">delete</span> [] CharNormArray;
<a name="l01520"></a>01520   <span class="keyword">delete</span> [] PrunerNormArray;
<a name="l01521"></a>01521   <span class="keywordflow">return</span> NumFeatures;
<a name="l01522"></a>01522 }                                <span class="comment">/* CharNormClassifier */</span>
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 <span class="comment">// As CharNormClassifier, but operates on a TrainingSample and outputs to</span>
<a name="l01525"></a>01525 <span class="comment">// a GenericVector of ShapeRating without conversion to classes.</span>
<a name="l01526"></a><a class="code" href="classtesseract_1_1_classify.html#aa3907b770bdeb45e652e0ab122568cf4">01526</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#aa3907b770bdeb45e652e0ab122568cf4">Classify::CharNormTrainingSample</a>(<span class="keywordtype">bool</span> pruner_only,
<a name="l01527"></a>01527                                      <span class="keyword">const</span> <a class="code" href="classtesseract_1_1_training_sample.html">TrainingSample</a>&amp; <a class="code" href="structsample.html">sample</a>,
<a name="l01528"></a>01528                                      <a class="code" href="class_generic_vector.html">GenericVector&lt;ShapeRating&gt;</a>* results) {
<a name="l01529"></a>01529   results-&gt;<a class="code" href="class_generic_vector.html#a9cdbff49b186574b83e43afba606fdd9">clear</a>();
<a name="l01530"></a>01530   <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>* adapt_results = <span class="keyword">new</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>();
<a name="l01531"></a>01531   adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a450c3b1b225dfa0771edd50732e5d288">Initialize</a>();
<a name="l01532"></a>01532   <span class="comment">// Compute the bounding box of the features.</span>
<a name="l01533"></a>01533   <span class="keywordtype">int</span> num_features = sample.<a class="code" href="classtesseract_1_1_training_sample.html#af3afdc90346e10f5f4497ea7a89882aa">num_features</a>();
<a name="l01534"></a>01534   <a class="code" href="class_t_b_o_x.html">TBOX</a> blob_box;
<a name="l01535"></a>01535   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a> = 0; <a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a> &lt; num_features; ++<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>) {
<a name="l01536"></a>01536     <span class="keyword">const</span> <a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html">INT_FEATURE_STRUCT</a> feature = sample.<a class="code" href="classtesseract_1_1_training_sample.html#a49c3df6faa918fc29a058e6bc434a7c9">features</a>()[<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a>];
<a name="l01537"></a>01537     <a class="code" href="class_t_b_o_x.html">TBOX</a> fbox(feature.<a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html#a6b250df12a9b06b5ed0c1a7c403f0275">X</a>, feature.<a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html#a09931683890fb52d22ec6c75048a2bce">Y</a>, feature.<a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html#a6b250df12a9b06b5ed0c1a7c403f0275">X</a>, feature.<a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html#a09931683890fb52d22ec6c75048a2bce">Y</a>);
<a name="l01538"></a>01538     blob_box += fbox;
<a name="l01539"></a>01539   }
<a name="l01540"></a>01540   <span class="comment">// Compute the char_norm_array from the saved cn_feature.</span>
<a name="l01541"></a>01541   <a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html">FEATURE</a> norm_feature = <a class="code" href="ocrfeatures_8cpp.html#a32a08c42617c8dd6a156c1c8d7fb2cbb">NewFeature</a>(&amp;<a class="code" href="featdefs_8h.html#aeaae0c3ba332fe6addd19ed202a3ecb7">CharNormDesc</a>);
<a name="l01542"></a>01542   norm_feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506a9309b18966f93d05a857e8ee0f81c557">CharNormY</a>] = sample.<a class="code" href="classtesseract_1_1_training_sample.html#afc65601f115f84c17b064c84a61c10c6">cn_feature</a>(<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506a9309b18966f93d05a857e8ee0f81c557">CharNormY</a>);
<a name="l01543"></a>01543   norm_feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506af859d8f455da531fb41201c80187dccf">CharNormLength</a>] = sample.<a class="code" href="classtesseract_1_1_training_sample.html#afc65601f115f84c17b064c84a61c10c6">cn_feature</a>(<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506af859d8f455da531fb41201c80187dccf">CharNormLength</a>);
<a name="l01544"></a>01544   norm_feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506a5a6745d4958b44c8c3481742021428f9">CharNormRx</a>] = sample.<a class="code" href="classtesseract_1_1_training_sample.html#afc65601f115f84c17b064c84a61c10c6">cn_feature</a>(<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506a5a6745d4958b44c8c3481742021428f9">CharNormRx</a>);
<a name="l01545"></a>01545   norm_feature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506ac21a54078a6ec6e1470a21d65feb58d5">CharNormRy</a>] = sample.<a class="code" href="classtesseract_1_1_training_sample.html#afc65601f115f84c17b064c84a61c10c6">cn_feature</a>(<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506ac21a54078a6ec6e1470a21d65feb58d5">CharNormRy</a>);
<a name="l01546"></a>01546   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* char_norm_array = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>()];
<a name="l01547"></a>01547   <span class="keywordtype">int</span> num_pruner_classes = <a class="code" href="ndminx_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(<a class="code" href="classtesseract_1_1_c_c_util.html#a69c5179ac5f10a24f3f97e16ca09460f">unicharset</a>.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#aa3e8073ebaf3e0022654c45f27135032">size</a>(),
<a name="l01548"></a>01548                                <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>-&gt;<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a4735b2443aa7452909969d8d07e1877a">NumClasses</a>);
<a name="l01549"></a>01549   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* pruner_norm_array = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[num_pruner_classes];
<a name="l01550"></a>01550   adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a> =
<a name="l01551"></a>01551       <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="normfeat_8cpp.html#a42d064127b80043f5af5a4e77305d412">ActualOutlineLength</a>(norm_feature) * 20 + 0.5);
<a name="l01552"></a>01552   <a class="code" href="classtesseract_1_1_classify.html#a8f49de2f8da7b066bd8ece0641edcca1">ComputeCharNormArrays</a>(norm_feature, <a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>, char_norm_array,
<a name="l01553"></a>01553                         pruner_norm_array);
<a name="l01554"></a>01554 
<a name="l01555"></a>01555   <span class="keywordtype">int</span> num_classes = <a class="code" href="classtesseract_1_1_classify.html#af60b52006bbea0cc1727d543c3fcd1ad">PruneClasses</a>(<a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>, num_features,
<a name="l01556"></a>01556                                  sample.<a class="code" href="classtesseract_1_1_training_sample.html#a49c3df6faa918fc29a058e6bc434a7c9">features</a>(),
<a name="l01557"></a>01557                                  pruner_norm_array,
<a name="l01558"></a>01558                                  <a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? &amp;shapetable_cutoffs_[0]
<a name="l01559"></a>01559                                                       : CharNormCutoffs,
<a name="l01560"></a>01560                                  adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>);
<a name="l01561"></a>01561   <span class="keyword">delete</span> [] pruner_norm_array;
<a name="l01562"></a>01562   <span class="keywordflow">if</span> (pruner_only) {
<a name="l01563"></a>01563     <span class="comment">// Convert pruner results to output format.</span>
<a name="l01564"></a>01564     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_classes; ++i) {
<a name="l01565"></a>01565       <span class="keywordtype">int</span> class_id = adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>[i].Class;
<a name="l01566"></a>01566       <span class="keywordtype">int</span> shape_id = class_id;
<a name="l01567"></a>01567       <span class="keywordflow">if</span> (<a class="code" href="classtesseract_1_1_classify.html#a471b3e8f03ddc5281c167b37d8ddc5b5">shape_table_</a> != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01568"></a>01568         <span class="comment">// All shapes in a class have the same combination of unichars, so</span>
<a name="l01569"></a>01569         <span class="comment">// it doesn&#39;t really matter which config we give it, as we aren&#39;t</span>
<a name="l01570"></a>01570         <span class="comment">// trying to get the font here.</span>
<a name="l01571"></a>01571         shape_id = <a class="code" href="classtesseract_1_1_classify.html#a1002c7f80352c6ceac4af82ee35e5e06">ClassAndConfigIDToFontOrShapeID</a>(class_id, 0);
<a name="l01572"></a>01572       }
<a name="l01573"></a>01573       results-&gt;<a class="code" href="class_generic_vector.html#a0dc89fe2a365b04a61017f9d78c1a303">push_back</a>(
<a name="l01574"></a>01574           <a class="code" href="structtesseract_1_1_shape_rating.html">ShapeRating</a>(shape_id, 1.0<a class="code" href="imgscale_8cpp.html#a469169df397b589e709dc744f1346831">f</a> - adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>[i].Rating));
<a name="l01575"></a>01575     }
<a name="l01576"></a>01576   } <span class="keywordflow">else</span> {
<a name="l01577"></a>01577     <a class="code" href="classtesseract_1_1_classify.html#a093af2c004819e86bfff80ad88f10c37">im_</a>.<a class="code" href="class_integer_matcher.html#adff6fd8fca725fa346db25010b3be21e">SetCharNormMatch</a>(<a class="code" href="classtesseract_1_1_classify.html#acab8de2f560b04b48191f60099e4244b">classify_integer_matcher_multiplier</a>);
<a name="l01578"></a>01578     <a class="code" href="classtesseract_1_1_classify.html#a9df3ff8623acd0ab30286ace7362045c">MasterMatcher</a>(<a class="code" href="classtesseract_1_1_classify.html#a64383806f917e682c4a644efdd71d530">PreTrainedTemplates</a>, num_features, sample.<a class="code" href="classtesseract_1_1_training_sample.html#a49c3df6faa918fc29a058e6bc434a7c9">features</a>(),
<a name="l01579"></a>01579                   char_norm_array,
<a name="l01580"></a>01580                   <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="classtesseract_1_1_classify.html#a3bfadb1d56669868fe7d18e12a7716dc">matcher_debug_flags</a>, num_classes,
<a name="l01581"></a>01581                   blob_box, adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a66adcc458cd1f9b662e9e2ef5b88b74f">CPResults</a>, adapt_results);
<a name="l01582"></a>01582     <span class="comment">// Convert master matcher results to output format.</span>
<a name="l01583"></a>01583     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; i++) {
<a name="l01584"></a>01584       <a class="code" href="struct_scored_class.html">ScoredClass</a> next = adapt_results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i];
<a name="l01585"></a>01585       results-&gt;<a class="code" href="class_generic_vector.html#a0dc89fe2a365b04a61017f9d78c1a303">push_back</a>(<a class="code" href="structtesseract_1_1_shape_rating.html">ShapeRating</a>(next.<a class="code" href="struct_scored_class.html#ab3db24ffe2690f52d86053ba1f631520">shape_id</a>, 1.0f - next.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>));
<a name="l01586"></a>01586     }
<a name="l01587"></a>01587     results-&gt;<a class="code" href="class_generic_vector.html#a999bbd8ff336c81fe1198ea714c7936d">sort</a>(&amp;<a class="code" href="structtesseract_1_1_shape_rating.html#a2e3c1c3af03514c4dc2faef9b99c1eb1">ShapeRating::SortDescendingRating</a>);
<a name="l01588"></a>01588   }
<a name="l01589"></a>01589   <span class="keyword">delete</span> [] char_norm_array;
<a name="l01590"></a>01590   <span class="keyword">delete</span> adapt_results;
<a name="l01591"></a>01591   <span class="keywordflow">return</span> num_features;
<a name="l01592"></a>01592 }                                <span class="comment">/* CharNormTrainingSample */</span>
<a name="l01593"></a>01593 
<a name="l01594"></a>01594 
<a name="l01595"></a>01595 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01610"></a><a class="code" href="classtesseract_1_1_classify.html#a8a68035cfc5ee866f2d39360072ab77c">01610</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a8a68035cfc5ee866f2d39360072ab77c">Classify::ClassifyAsNoise</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l01611"></a>01611   <span class="keyword">register</span> <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Rating;
<a name="l01612"></a>01612 
<a name="l01613"></a>01613   Rating = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a> / <a class="code" href="classtesseract_1_1_classify.html#a9723b1f4a341f42ddfc68d2f531c7dd3">matcher_avg_noise_size</a>;
<a name="l01614"></a>01614   Rating *= Rating;
<a name="l01615"></a>01615   Rating /= 1.0 + Rating;
<a name="l01616"></a>01616 
<a name="l01617"></a>01617   <a class="code" href="classtesseract_1_1_classify.html#a3681915077046082b4d99532a3f3da61">AddNewResult</a>(Results, <a class="code" href="matchdefs_8h.html#a6ce548e51895ce0226ee145753a9c815">NO_CLASS</a>, -1, Rating, <span class="keyword">false</span>, -1,
<a name="l01618"></a>01618                kBlankFontinfoId, kBlankFontinfoId);
<a name="l01619"></a>01619 }                                <span class="comment">/* ClassifyAsNoise */</span>
<a name="l01620"></a>01620 }  <span class="comment">// namespace tesseract</span>
<a name="l01621"></a>01621 
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01624"></a>01624 <span class="comment">// Return a pointer to the scored unichar in results, or NULL if not present.</span>
<a name="l01625"></a><a class="code" href="adaptmatch_8cpp.html#a3cedbdc7ad221f31895c55506410fd98">01625</a> <a class="code" href="struct_scored_class.html">ScoredClass</a> *<a class="code" href="adaptmatch_8cpp.html#a3cedbdc7ad221f31895c55506410fd98">FindScoredUnichar</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *results, <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> <span class="keywordtype">id</span>) {
<a name="l01626"></a>01626   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; i++) {
<a name="l01627"></a>01627     <span class="keywordflow">if</span> (results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a> == <span class="keywordtype">id</span>)
<a name="l01628"></a>01628       <span class="keywordflow">return</span> &amp;results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i];
<a name="l01629"></a>01629   }
<a name="l01630"></a>01630   <span class="keywordflow">return</span> <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01631"></a>01631 }
<a name="l01632"></a>01632 
<a name="l01633"></a>01633 <span class="comment">// Retrieve the current rating for a unichar id if we have rated it, defaulting</span>
<a name="l01634"></a>01634 <span class="comment">// to WORST_POSSIBLE_RATING.</span>
<a name="l01635"></a><a class="code" href="adaptmatch_8cpp.html#ab41bdc1f072e458bb14d644c1106b56a">01635</a> <a class="code" href="struct_scored_class.html">ScoredClass</a> <a class="code" href="adaptmatch_8cpp.html#ab41bdc1f072e458bb14d644c1106b56a">ScoredUnichar</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *results, <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> <span class="keywordtype">id</span>) {
<a name="l01636"></a>01636   <a class="code" href="struct_scored_class.html">ScoredClass</a> poor_result =
<a name="l01637"></a>01637       {id, -1, <a class="code" href="adaptmatch_8cpp.html#a93902888a2216c8e4a03ddc10aed7f41">WORST_POSSIBLE_RATING</a>, <span class="keyword">false</span>, -1,
<a name="l01638"></a>01638           kBlankFontinfoId, kBlankFontinfoId};
<a name="l01639"></a>01639   <a class="code" href="struct_scored_class.html">ScoredClass</a> *entry = <a class="code" href="adaptmatch_8cpp.html#a3cedbdc7ad221f31895c55506410fd98">FindScoredUnichar</a>(results, <span class="keywordtype">id</span>);
<a name="l01640"></a>01640   <span class="keywordflow">return</span> (entry == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? poor_result : *entry;
<a name="l01641"></a>01641 }
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 <span class="comment">// Compare character classes by rating as for qsort(3).</span>
<a name="l01644"></a>01644 <span class="comment">// For repeatability, use character class id as a tie-breaker.</span>
<a name="l01645"></a><a class="code" href="adaptmatch_8cpp.html#a82aaab0580160422d3587ca9cc533e60">01645</a> <span class="keywordtype">int</span> <a class="code" href="adaptmatch_8cpp.html#a82aaab0580160422d3587ca9cc533e60">CompareByRating</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *arg1,    <span class="comment">// ScoredClass *class1</span>
<a name="l01646"></a>01646                     <span class="keyword">const</span> <span class="keywordtype">void</span> *arg2) {  <span class="comment">// ScoredClass *class2</span>
<a name="l01647"></a>01647   <span class="keyword">const</span> <a class="code" href="struct_scored_class.html">ScoredClass</a> *class1 = (<span class="keyword">const</span> <a class="code" href="struct_scored_class.html">ScoredClass</a> *)arg1;
<a name="l01648"></a>01648   <span class="keyword">const</span> <a class="code" href="struct_scored_class.html">ScoredClass</a> *class2 = (<span class="keyword">const</span> <a class="code" href="struct_scored_class.html">ScoredClass</a> *)arg2;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650   <span class="keywordflow">if</span> (class1-&gt;<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &lt; class2-&gt;<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>)
<a name="l01651"></a>01651     <span class="keywordflow">return</span> -1;
<a name="l01652"></a>01652   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (class1-&gt;<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &gt; class2-&gt;<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>)
<a name="l01653"></a>01653     <span class="keywordflow">return</span> 1;
<a name="l01654"></a>01654 
<a name="l01655"></a>01655   <span class="keywordflow">if</span> (class1-&gt;<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a> &lt; class2-&gt;<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>)
<a name="l01656"></a>01656     <span class="keywordflow">return</span> -1;
<a name="l01657"></a>01657   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (class1-&gt;<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a> &gt; class2-&gt;<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>)
<a name="l01658"></a>01658     <span class="keywordflow">return</span> 1;
<a name="l01659"></a>01659   <span class="keywordflow">return</span> 0;
<a name="l01660"></a>01660 }
<a name="l01661"></a>01661 
<a name="l01662"></a>01662 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01663"></a>01663 <span class="keyword">namespace </span>tesseract {
<a name="l01670"></a><a class="code" href="classtesseract_1_1_classify.html#af1f1f794092ce44dff7c242822b6cf68">01670</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#af1f1f794092ce44dff7c242822b6cf68">Classify::ConvertMatchesToChoices</a>(<span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm, <span class="keyword">const</span> <a class="code" href="class_t_b_o_x.html">TBOX</a>&amp; box,
<a name="l01671"></a>01671                                        <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results,
<a name="l01672"></a>01672                                        BLOB_CHOICE_LIST *Choices) {
<a name="l01673"></a>01673   assert(Choices != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01674"></a>01674   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Rating;
<a name="l01675"></a>01675   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Certainty;
<a name="l01676"></a>01676   BLOB_CHOICE_IT temp_it;
<a name="l01677"></a>01677   <span class="keywordtype">bool</span> contains_nonfrag = <span class="keyword">false</span>;
<a name="l01678"></a>01678   temp_it.set_to_list(Choices);
<a name="l01679"></a>01679   <span class="keywordtype">int</span> choices_length = 0;
<a name="l01680"></a>01680   <span class="comment">// With no shape_table_ maintain the previous MAX_MATCHES as the maximum</span>
<a name="l01681"></a>01681   <span class="comment">// number of returned results, but with a shape_table_ we want to have room</span>
<a name="l01682"></a>01682   <span class="comment">// for at least the biggest shape (which might contain hundreds of Indic</span>
<a name="l01683"></a>01683   <span class="comment">// grapheme fragments) and more, so use double the size of the biggest shape</span>
<a name="l01684"></a>01684   <span class="comment">// if that is more than the default.</span>
<a name="l01685"></a>01685   <span class="keywordtype">int</span> max_matches = <a class="code" href="adaptmatch_8cpp.html#ae731492acc3b2e54043c2dfbf1338be6">MAX_MATCHES</a>;
<a name="l01686"></a>01686   <span class="keywordflow">if</span> (shape_table_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01687"></a>01687     max_matches = shape_table_-&gt;MaxNumUnichars() * 2;
<a name="l01688"></a>01688     <span class="keywordflow">if</span> (max_matches &lt; <a class="code" href="adaptmatch_8cpp.html#ae731492acc3b2e54043c2dfbf1338be6">MAX_MATCHES</a>)
<a name="l01689"></a>01689       max_matches = <a class="code" href="adaptmatch_8cpp.html#ae731492acc3b2e54043c2dfbf1338be6">MAX_MATCHES</a>;
<a name="l01690"></a>01690   }
<a name="l01691"></a>01691 
<a name="l01692"></a>01692   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; i++) {
<a name="l01693"></a>01693     <a class="code" href="struct_scored_class.html">ScoredClass</a> next = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i];
<a name="l01694"></a>01694     <span class="keywordtype">int</span> fontinfo_id = next.<a class="code" href="struct_scored_class.html#aef50f14f803115ac96f57bf3d7e519f9">fontinfo_id</a>;
<a name="l01695"></a>01695     <span class="keywordtype">int</span> fontinfo_id2 = next.<a class="code" href="struct_scored_class.html#ac30be99b1e1ac98855c624896f9f0389">fontinfo_id2</a>;
<a name="l01696"></a>01696     <span class="keywordtype">bool</span> adapted = next.<a class="code" href="struct_scored_class.html#a090f44ac2eedadd72c93fb628dfaf167">adapted</a>;
<a name="l01697"></a>01697     <span class="keywordtype">bool</span> current_is_frag = (unicharset.get_fragment(next.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01698"></a>01698     <span class="keywordflow">if</span> (temp_it.length()+1 == max_matches &amp;&amp;
<a name="l01699"></a>01699         !contains_nonfrag &amp;&amp; current_is_frag) {
<a name="l01700"></a>01700       <span class="keywordflow">continue</span>;  <span class="comment">// look for a non-fragmented character to fill the</span>
<a name="l01701"></a>01701                  <span class="comment">// last spot in Choices if only fragments are present</span>
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703     <span class="comment">// BlobLength can never be legally 0, this means recognition failed.</span>
<a name="l01704"></a>01704     <span class="comment">// But we must return a classification result because some invoking</span>
<a name="l01705"></a>01705     <span class="comment">// functions (chopper/permuter) do not anticipate a null blob choice.</span>
<a name="l01706"></a>01706     <span class="comment">// So we need to assign a poor, but not infinitely bad score.</span>
<a name="l01707"></a>01707     <span class="keywordflow">if</span> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a> == 0) {
<a name="l01708"></a>01708       Certainty = -20;
<a name="l01709"></a>01709       Rating = 100;    <span class="comment">// should be -certainty * real_blob_length</span>
<a name="l01710"></a>01710     } <span class="keywordflow">else</span> {
<a name="l01711"></a>01711       Rating = Certainty = next.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>;
<a name="l01712"></a>01712       Rating *= rating_scale * Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a96c25b6f847b7f8ebc3817ee73f73236">BlobLength</a>;
<a name="l01713"></a>01713       Certainty *= -(getDict().certainty_scale);
<a name="l01714"></a>01714     }
<a name="l01715"></a>01715     <a class="code" href="host_8h.html#a8d41499d38c24d39b221ab0c158fe5a8">inT16</a> min_xheight, max_xheight;
<a name="l01716"></a>01716     denorm.<a class="code" href="class_d_e_n_o_r_m.html#a5b886acd9e1220ff409268e007adffe1">XHeightRange</a>(next.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>, unicharset, box,
<a name="l01717"></a>01717                         &amp;min_xheight, &amp;max_xheight);
<a name="l01718"></a>01718     temp_it.add_to_end(<span class="keyword">new</span> <a class="code" href="class_b_l_o_b___c_h_o_i_c_e.html">BLOB_CHOICE</a>(next.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>, Rating, Certainty,
<a name="l01719"></a>01719                                         fontinfo_id, fontinfo_id2,
<a name="l01720"></a>01720                                         unicharset.get_script(next.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>),
<a name="l01721"></a>01721                                         min_xheight, max_xheight, adapted));
<a name="l01722"></a>01722     contains_nonfrag |= !current_is_frag;  <span class="comment">// update contains_nonfrag</span>
<a name="l01723"></a>01723     choices_length++;
<a name="l01724"></a>01724     <span class="keywordflow">if</span> (choices_length &gt;= max_matches) <span class="keywordflow">break</span>;
<a name="l01725"></a>01725   }
<a name="l01726"></a>01726   Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> = choices_length;
<a name="l01727"></a>01727 }  <span class="comment">// ConvertMatchesToChoices</span>
<a name="l01728"></a>01728 
<a name="l01729"></a>01729 
<a name="l01730"></a>01730 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01731"></a>01731 <span class="preprocessor">#ifndef GRAPHICS_DISABLED</span>
<a name="l01732"></a>01732 <span class="preprocessor"></span>
<a name="l01743"></a><a class="code" href="classtesseract_1_1_classify.html#af9a9def4a6b3bb1a2e36bceff2976c2c">01743</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#af9a9def4a6b3bb1a2e36bceff2976c2c">Classify::DebugAdaptiveClassifier</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01744"></a>01744                                        <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01745"></a>01745                                        <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l01746"></a>01746   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; i++) {
<a name="l01747"></a>01747     <span class="keywordflow">if</span> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>)
<a name="l01748"></a>01748       Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a> = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i];
<a name="l01749"></a>01749   }
<a name="l01750"></a>01750   <span class="keyword">const</span> <span class="keywordtype">char</span> *Prompt =
<a name="l01751"></a>01751     <span class="stringliteral">&quot;Left-click in IntegerMatch Window to continue or right click to debug...&quot;</span>;
<a name="l01752"></a>01752   <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> unichar_id = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>;
<a name="l01753"></a>01753   <span class="keywordtype">int</span> shape_id = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#ab3db24ffe2690f52d86053ba1f631520">shape_id</a>;
<a name="l01754"></a>01754   <span class="keywordtype">bool</span> adaptive_on = <span class="keyword">true</span>;
<a name="l01755"></a>01755   <span class="keywordtype">bool</span> pretrained_on = <span class="keyword">true</span>;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757   <span class="keyword">const</span> <span class="keywordtype">char</span>* debug_mode;
<a name="l01758"></a>01758   <span class="keywordflow">do</span> {
<a name="l01759"></a>01759     <span class="keywordflow">if</span> (!pretrained_on)
<a name="l01760"></a>01760       debug_mode = <span class="stringliteral">&quot;Adaptive Templates Only&quot;</span>;
<a name="l01761"></a>01761     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!adaptive_on)
<a name="l01762"></a>01762       debug_mode = <span class="stringliteral">&quot;PreTrained Templates Only&quot;</span>;
<a name="l01763"></a>01763     <span class="keywordflow">else</span>
<a name="l01764"></a>01764       debug_mode = <span class="stringliteral">&quot;All Templates&quot;</span>;
<a name="l01765"></a>01765     <a class="code" href="intproto_8h.html#a8fd5d70d9cc150151e6cf7071f5c0614">ShowMatchDisplay</a>();
<a name="l01766"></a>01766     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Debugging class %d = %s in mode %s ...&quot;</span>,
<a name="l01767"></a>01767             unichar_id, unicharset.id_to_unichar(unichar_id), debug_mode);
<a name="l01768"></a>01768     <span class="keywordflow">if</span> (shape_id &gt;= 0 &amp;&amp; shape_table_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01769"></a>01769       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot; from shape %s\n&quot;</span>, shape_table_-&gt;DebugStr(shape_id).string());
<a name="l01770"></a>01770     }
<a name="l01771"></a>01771     ShowBestMatchFor(Blob, denorm, unichar_id, shape_id, adaptive_on,
<a name="l01772"></a>01772                      pretrained_on, Results);
<a name="l01773"></a>01773     <a class="code" href="intproto_8cpp.html#a3827f6daeeb1efd88fa0bf418c83d984">UpdateMatchDisplay</a>();
<a name="l01774"></a>01774   } <span class="keywordflow">while</span> ((unichar_id = GetClassToDebug(Prompt, &amp;adaptive_on,
<a name="l01775"></a>01775                                          &amp;pretrained_on, &amp;shape_id)) != 0);
<a name="l01776"></a>01776 }                                <span class="comment">/* DebugAdaptiveClassifier */</span>
<a name="l01777"></a>01777 <span class="preprocessor">#endif</span>
<a name="l01778"></a>01778 <span class="preprocessor"></span>
<a name="l01779"></a>01779 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01803"></a><a class="code" href="classtesseract_1_1_classify.html#a8575af5f97d4037d4fdd2e21b477dd38">01803</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a8575af5f97d4037d4fdd2e21b477dd38">Classify::DoAdaptiveMatch</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01804"></a>01804                                <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01805"></a>01805                                <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l01806"></a>01806   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *Ambiguities;
<a name="l01807"></a>01807 
<a name="l01808"></a>01808   AdaptiveMatcherCalls++;
<a name="l01809"></a>01809   <a class="code" href="adaptmatch_8cpp.html#aca8523f0becfd3cca333fd48d103735d">InitIntFX</a>();
<a name="l01810"></a>01810 
<a name="l01811"></a>01811   <span class="keywordflow">if</span> (AdaptedTemplates-&gt;NumPermClasses &lt; matcher_permanent_classes_min ||
<a name="l01812"></a>01812       tess_cn_matching) {
<a name="l01813"></a>01813     CharNormClassifier(Blob, denorm, PreTrainedTemplates, Results);
<a name="l01814"></a>01814   } <span class="keywordflow">else</span> {
<a name="l01815"></a>01815     Ambiguities = BaselineClassifier(Blob, denorm, AdaptedTemplates, Results);
<a name="l01816"></a>01816     <span class="keywordflow">if</span> ((Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> &gt; 0 &amp;&amp;
<a name="l01817"></a>01817          <a class="code" href="adaptmatch_8cpp.html#a212c1ba628a1cd30b51a902c35fb23eb">MarginalMatch</a> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>) &amp;&amp;
<a name="l01818"></a>01818          !tess_bn_matching) ||
<a name="l01819"></a>01819         Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> == 0) {
<a name="l01820"></a>01820       CharNormClassifier(Blob, denorm, PreTrainedTemplates, Results);
<a name="l01821"></a>01821     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ambiguities &amp;&amp; *Ambiguities &gt;= 0 &amp;&amp; !tess_bn_matching) {
<a name="l01822"></a>01822       AmbigClassifier(Blob, denorm,
<a name="l01823"></a>01823                       PreTrainedTemplates,
<a name="l01824"></a>01824                       AdaptedTemplates-&gt;Class,
<a name="l01825"></a>01825                       Ambiguities,
<a name="l01826"></a>01826                       Results);
<a name="l01827"></a>01827     }
<a name="l01828"></a>01828   }
<a name="l01829"></a>01829 
<a name="l01830"></a>01830   <span class="comment">// Force the blob to be classified as noise</span>
<a name="l01831"></a>01831   <span class="comment">// if the results contain only fragments.</span>
<a name="l01832"></a>01832   <span class="comment">// TODO(daria): verify that this is better than</span>
<a name="l01833"></a>01833   <span class="comment">// just adding a NULL classification.</span>
<a name="l01834"></a>01834   <span class="keywordflow">if</span> (!Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#ab6a520c3c59a1f1a3f4d1c27bf5d3000">HasNonfragment</a> || Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> == 0)
<a name="l01835"></a>01835     ClassifyAsNoise(Results);
<a name="l01836"></a>01836 }   <span class="comment">/* DoAdaptiveMatch */</span>
<a name="l01837"></a>01837 
<a name="l01838"></a>01838 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01864"></a><a class="code" href="classtesseract_1_1_classify.html#a57d34f380d093913f3c3e74f7a7a9840">01864</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a57d34f380d093913f3c3e74f7a7a9840">Classify::GetAdaptThresholds</a>(<a class="code" href="struct_t_w_e_r_d.html">TWERD</a> * Word,
<a name="l01865"></a>01865                                   <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01866"></a>01866                                   <span class="keyword">const</span> <a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html">WERD_CHOICE</a>&amp; BestChoice,
<a name="l01867"></a>01867                                   <span class="keyword">const</span> <a class="code" href="class_w_e_r_d___c_h_o_i_c_e.html">WERD_CHOICE</a>&amp; BestRawChoice,
<a name="l01868"></a>01868                                   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Thresholds[]) {
<a name="l01869"></a>01869   getDict().FindClassifierErrors(matcher_perfect_threshold,
<a name="l01870"></a>01870                                  matcher_good_threshold,
<a name="l01871"></a>01871                                  matcher_rating_margin,
<a name="l01872"></a>01872                                  Thresholds);
<a name="l01873"></a>01873 }                              <span class="comment">/* GetAdaptThresholds */</span>
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01893"></a><a class="code" href="classtesseract_1_1_classify.html#af4c186f6ec1019d17912d2cf36326f1f">01893</a> <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *<a class="code" href="classtesseract_1_1_classify.html#af4c186f6ec1019d17912d2cf36326f1f">Classify::GetAmbiguities</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01894"></a>01894                                      <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01895"></a>01895                                      <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> CorrectClass) {
<a name="l01896"></a>01896   <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results = <span class="keyword">new</span> <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a>();
<a name="l01897"></a>01897   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *Ambiguities;
<a name="l01898"></a>01898   <span class="keywordtype">int</span> i;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900   Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a450c3b1b225dfa0771edd50732e5d288">Initialize</a>();
<a name="l01901"></a>01901 
<a name="l01902"></a>01902   CharNormClassifier(Blob, denorm, PreTrainedTemplates, Results);
<a name="l01903"></a>01903   RemoveBadMatches(Results);
<a name="l01904"></a>01904   qsort((<span class="keywordtype">void</span> *)Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>, Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>,
<a name="l01905"></a>01905         <span class="keyword">sizeof</span>(<a class="code" href="struct_scored_class.html">ScoredClass</a>), <a class="code" href="adaptmatch_8cpp.html#a82aaab0580160422d3587ca9cc533e60">CompareByRating</a>);
<a name="l01906"></a>01906 
<a name="l01907"></a>01907   <span class="comment">/* copy the class id&#39;s into an string of ambiguities - don&#39;t copy if</span>
<a name="l01908"></a>01908 <span class="comment">     the correct class is the only class id matched */</span>
<a name="l01909"></a>01909   Ambiguities = (<a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *) <a class="code" href="emalloc_8cpp.html#a55f2088f1a7b3333bb5c7275ab726bba">Emalloc</a> (<span class="keyword">sizeof</span> (<a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a>) *
<a name="l01910"></a>01910                                         (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> + 1));
<a name="l01911"></a>01911   <span class="keywordflow">if</span> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> &gt; 1 ||
<a name="l01912"></a>01912       (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> == 1 &amp;&amp;
<a name="l01913"></a>01913           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[0].<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a> != CorrectClass)) {
<a name="l01914"></a>01914     <span class="keywordflow">for</span> (i = 0; i &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; i++)
<a name="l01915"></a>01915       Ambiguities[i] = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>;
<a name="l01916"></a>01916     Ambiguities[i] = -1;
<a name="l01917"></a>01917   } <span class="keywordflow">else</span> {
<a name="l01918"></a>01918     Ambiguities[0] = -1;
<a name="l01919"></a>01919   }
<a name="l01920"></a>01920 
<a name="l01921"></a>01921   <span class="keyword">delete</span> Results;
<a name="l01922"></a>01922   <span class="keywordflow">return</span> Ambiguities;
<a name="l01923"></a>01923 }                              <span class="comment">/* GetAmbiguities */</span>
<a name="l01924"></a>01924 
<a name="l01925"></a>01925 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l01952"></a><a class="code" href="classtesseract_1_1_classify.html#a4bf0e47e0ae00a0cec215a887cef8c65">01952</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a4bf0e47e0ae00a0cec215a887cef8c65">Classify::GetBaselineFeatures</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l01953"></a>01953                                   <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l01954"></a>01954                                   <a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES</a> Templates,
<a name="l01955"></a>01955                                   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures,
<a name="l01956"></a>01956                                   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* CharNormArray,
<a name="l01957"></a>01957                                   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> *BlobLength) {
<a name="l01958"></a>01958   <span class="keyword">register</span> <a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html">INT_FEATURE</a> Src, Dest, End;
<a name="l01959"></a>01959 
<a name="l01960"></a>01960   <span class="keywordflow">if</span> (!FeaturesHaveBeenExtracted) {
<a name="l01961"></a>01961     FeaturesOK = <a class="code" href="intfx_8cpp.html#a508a06732c67c00efc9db362bd8b970e">ExtractIntFeat</a>(Blob, denorm, BaselineFeatures,
<a name="l01962"></a>01962                                 CharNormFeatures, &amp;FXInfo, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01963"></a>01963     FeaturesHaveBeenExtracted = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01964"></a>01964   }
<a name="l01965"></a>01965 
<a name="l01966"></a>01966   <span class="keywordflow">if</span> (!FeaturesOK) {
<a name="l01967"></a>01967     *BlobLength = FXInfo.NumBL;
<a name="l01968"></a>01968     <span class="keywordflow">return</span> 0;
<a name="l01969"></a>01969   }
<a name="l01970"></a>01970 
<a name="l01971"></a>01971   <span class="keywordflow">for</span> (Src = BaselineFeatures, End = Src + FXInfo.NumBL, Dest = IntFeatures;
<a name="l01972"></a>01972        Src &lt; End;
<a name="l01973"></a>01973        *Dest++ = *Src++);
<a name="l01974"></a>01974 
<a name="l01975"></a>01975   ClearCharNormArray(CharNormArray);
<a name="l01976"></a>01976   *BlobLength = FXInfo.NumBL;
<a name="l01977"></a>01977   <span class="keywordflow">return</span> FXInfo.NumBL;
<a name="l01978"></a>01978 }                              <span class="comment">/* GetBaselineFeatures */</span>
<a name="l01979"></a>01979 
<a name="l01980"></a><a class="code" href="classtesseract_1_1_classify.html#a62ffff7932680b25784bfca5079ce347">01980</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a62ffff7932680b25784bfca5079ce347">Classify::ResetFeaturesHaveBeenExtracted</a>() {
<a name="l01981"></a>01981   FeaturesHaveBeenExtracted = <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01982"></a>01982 }
<a name="l01983"></a>01983 
<a name="l01984"></a>01984 <span class="comment">// Returns true if the given blob looks too dissimilar to any character</span>
<a name="l01985"></a>01985 <span class="comment">// present in the classifier templates.</span>
<a name="l01986"></a><a class="code" href="classtesseract_1_1_classify.html#ab72f687048a2e1eba44b8ae2cfb07fa9">01986</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_classify.html#ab72f687048a2e1eba44b8ae2cfb07fa9">Classify::LooksLikeGarbage</a>(<span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm, <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *blob) {
<a name="l01987"></a>01987   BLOB_CHOICE_LIST *ratings = <span class="keyword">new</span> BLOB_CHOICE_LIST();
<a name="l01988"></a>01988   AdaptiveClassifier(blob, denorm, ratings, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01989"></a>01989   BLOB_CHOICE_IT ratings_it(ratings);
<a name="l01990"></a>01990   <span class="keyword">const</span> <a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html">UNICHARSET</a> &amp;unicharset = getDict().getUnicharset();
<a name="l01991"></a>01991   <span class="keywordflow">if</span> (classify_debug_character_fragments) {
<a name="l01992"></a>01992     <a class="code" href="ratngs_8cpp.html#a2de5b7d5a020bb9823091dbece4ea36e">print_ratings_list</a>(<span class="stringliteral">&quot;======================\nLooksLikeGarbage() got &quot;</span>,
<a name="l01993"></a>01993                        ratings, unicharset);
<a name="l01994"></a>01994   }
<a name="l01995"></a>01995   <span class="keywordflow">for</span> (ratings_it.mark_cycle_pt(); !ratings_it.cycled_list();
<a name="l01996"></a>01996        ratings_it.forward()) {
<a name="l01997"></a>01997     <span class="keywordflow">if</span> (unicharset.<a class="code" href="class_u_n_i_c_h_a_r_s_e_t.html#af08440927e3b87f99bd3a3fbd8e126dc">get_fragment</a>(ratings_it.data()-&gt;unichar_id()) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01998"></a>01998       <span class="keywordflow">continue</span>;
<a name="l01999"></a>01999     }
<a name="l02000"></a>02000     <span class="keyword">delete</span> ratings;
<a name="l02001"></a>02001     <span class="keywordflow">return</span> (ratings_it.data()-&gt;certainty() &lt;
<a name="l02002"></a>02002             classify_character_fragments_garbage_certainty_threshold);
<a name="l02003"></a>02003   }
<a name="l02004"></a>02004   <span class="keyword">delete</span> ratings;
<a name="l02005"></a>02005   <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// no whole characters in ratings</span>
<a name="l02006"></a>02006 }
<a name="l02007"></a>02007 
<a name="l02008"></a>02008 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02040"></a><a class="code" href="classtesseract_1_1_classify.html#a1076d5d08686e48d39ef3eb07e711fb6">02040</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a1076d5d08686e48d39ef3eb07e711fb6">Classify::GetCharNormFeatures</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l02041"></a>02041                                   <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l02042"></a>02042                                   <a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES</a> Templates,
<a name="l02043"></a>02043                                   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> IntFeatures,
<a name="l02044"></a>02044                                   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* PrunerNormArray,
<a name="l02045"></a>02045                                   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* CharNormArray,
<a name="l02046"></a>02046                                   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> *BlobLength,
<a name="l02047"></a>02047                                   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> *FeatureOutlineArray) {
<a name="l02048"></a>02048   <span class="keyword">register</span> <a class="code" href="struct_i_n_t___f_e_a_t_u_r_e___s_t_r_u_c_t.html">INT_FEATURE</a> Src, Dest, End;
<a name="l02049"></a>02049   <a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html">FEATURE</a> NormFeature;
<a name="l02050"></a>02050   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Baseline, Scale;
<a name="l02051"></a>02051   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> FeatureOutlineIndex[<a class="code" href="baseapi_8h.html#a4f7caedc4bed99355cae19efa51ade51">MAX_NUM_INT_FEATURES</a>];
<a name="l02052"></a>02052 
<a name="l02053"></a>02053   <span class="keywordflow">if</span> (!FeaturesHaveBeenExtracted) {
<a name="l02054"></a>02054     FeaturesOK = <a class="code" href="intfx_8cpp.html#a508a06732c67c00efc9db362bd8b970e">ExtractIntFeat</a>(Blob, denorm, BaselineFeatures,
<a name="l02055"></a>02055                                 CharNormFeatures, &amp;FXInfo,
<a name="l02056"></a>02056                                 FeatureOutlineIndex);
<a name="l02057"></a>02057     FeaturesHaveBeenExtracted = <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02058"></a>02058   }
<a name="l02059"></a>02059 
<a name="l02060"></a>02060   <span class="keywordflow">if</span> (!FeaturesOK) {
<a name="l02061"></a>02061     *BlobLength = FXInfo.NumBL;
<a name="l02062"></a>02062     <span class="keywordflow">return</span> (0);
<a name="l02063"></a>02063   }
<a name="l02064"></a>02064 
<a name="l02065"></a>02065   <span class="keywordflow">for</span> (Src = CharNormFeatures, End = Src + FXInfo.NumCN, Dest = IntFeatures;
<a name="l02066"></a>02066        Src &lt; End;
<a name="l02067"></a>02067        *Dest++ = *Src++);
<a name="l02068"></a>02068   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0;  FeatureOutlineArray &amp;&amp; i &lt; FXInfo.NumCN; ++i) {
<a name="l02069"></a>02069     FeatureOutlineArray[i] = FeatureOutlineIndex[i];
<a name="l02070"></a>02070   }
<a name="l02071"></a>02071 
<a name="l02072"></a>02072   NormFeature = <a class="code" href="ocrfeatures_8cpp.html#a32a08c42617c8dd6a156c1c8d7fb2cbb">NewFeature</a>(&amp;<a class="code" href="featdefs_8h.html#aeaae0c3ba332fe6addd19ed202a3ecb7">CharNormDesc</a>);
<a name="l02073"></a>02073   Baseline = <a class="code" href="baseline_8h.html#a011c4f289bef07581a2aed5570f1918c">BASELINE_OFFSET</a>;
<a name="l02074"></a>02074   Scale = <a class="code" href="mfoutline_8h.html#a91645597f620e8307a65e8ab35d963b8">MF_SCALE_FACTOR</a>;
<a name="l02075"></a>02075   NormFeature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506a9309b18966f93d05a857e8ee0f81c557">CharNormY</a>] = (FXInfo.Ymean - Baseline) * Scale;
<a name="l02076"></a>02076   NormFeature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506af859d8f455da531fb41201c80187dccf">CharNormLength</a>] =
<a name="l02077"></a>02077     FXInfo.Length * Scale / <a class="code" href="normfeat_8h.html#a528f356e3cb082911b33645da06ccf04">LENGTH_COMPRESSION</a>;
<a name="l02078"></a>02078   NormFeature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506a5a6745d4958b44c8c3481742021428f9">CharNormRx</a>] = FXInfo.Rx * Scale;
<a name="l02079"></a>02079   NormFeature-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="normfeat_8h.html#ab5ff0a2380362fa488e17c0c1b858506ac21a54078a6ec6e1470a21d65feb58d5">CharNormRy</a>] = FXInfo.Ry * Scale;
<a name="l02080"></a>02080   ComputeCharNormArrays(NormFeature, Templates, CharNormArray, PrunerNormArray);
<a name="l02081"></a>02081   *BlobLength = FXInfo.NumBL;
<a name="l02082"></a>02082   <span class="keywordflow">return</span> (FXInfo.NumCN);
<a name="l02083"></a>02083 }                              <span class="comment">/* GetCharNormFeatures */</span>
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 <span class="comment">// Computes the char_norm_array for the unicharset and, if not NULL, the</span>
<a name="l02086"></a>02086 <span class="comment">// pruner_array as appropriate according to the existence of the shape_table.</span>
<a name="l02087"></a><a class="code" href="classtesseract_1_1_classify.html#a8f49de2f8da7b066bd8ece0641edcca1">02087</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a8f49de2f8da7b066bd8ece0641edcca1">Classify::ComputeCharNormArrays</a>(<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html">FEATURE_STRUCT</a>* norm_feature,
<a name="l02088"></a>02088                                      <a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES_STRUCT</a>* templates,
<a name="l02089"></a>02089                                      <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* char_norm_array,
<a name="l02090"></a>02090                                      <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>* pruner_array) {
<a name="l02091"></a>02091   ComputeIntCharNormArray(*norm_feature, char_norm_array);
<a name="l02092"></a>02092   <span class="keywordflow">if</span> (pruner_array != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02093"></a>02093     <span class="keywordflow">if</span> (shape_table_ == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02094"></a>02094       ComputeIntCharNormArray(*norm_feature, pruner_array);
<a name="l02095"></a>02095     } <span class="keywordflow">else</span> {
<a name="l02096"></a>02096       memset(pruner_array, <a class="code" href="host_8h.html#a05682ca8de174141447ff05a2289a27c">MAX_UINT8</a>,
<a name="l02097"></a>02097              templates-&gt;<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a4735b2443aa7452909969d8d07e1877a">NumClasses</a> * <span class="keyword">sizeof</span>(pruner_array[0]));
<a name="l02098"></a>02098       <span class="comment">// Each entry in the pruner norm array is the MIN of all the entries of</span>
<a name="l02099"></a>02099       <span class="comment">// the corresponding unichars in the CharNormArray.</span>
<a name="l02100"></a>02100       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; templates-&gt;<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a4735b2443aa7452909969d8d07e1877a">NumClasses</a>; ++id) {
<a name="l02101"></a>02101         <span class="keywordtype">int</span> font_set_id = templates-&gt;<a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a2083307ebe623a6617ff38291a2f3614">Class</a>[id]-&gt;<a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html#af0d8fa528ac2dd07fe4f39ef84a6fd7c">font_set_id</a>;
<a name="l02102"></a>02102         <span class="keyword">const</span> <a class="code" href="structtesseract_1_1_font_set.html">FontSet</a> &amp;fs = fontset_table_.get(font_set_id);
<a name="l02103"></a>02103         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> config = 0; config &lt; fs.<a class="code" href="structtesseract_1_1_font_set.html#a2f474cedd75889b35a8b5f401eab3c01">size</a>; ++config) {
<a name="l02104"></a>02104           <span class="keyword">const</span> <a class="code" href="classtesseract_1_1_shape.html">Shape</a>&amp; shape = shape_table_-&gt;GetShape(fs.<a class="code" href="structtesseract_1_1_font_set.html#a466a7c0f34a22d2b112658de14f6a376">configs</a>[config]);
<a name="l02105"></a>02105           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; shape.<a class="code" href="classtesseract_1_1_shape.html#a0fca7f64992c74492787d00240a22913">size</a>(); ++c) {
<a name="l02106"></a>02106             <span class="keywordflow">if</span> (char_norm_array[shape[c].unichar_id] &lt; pruner_array[<span class="keywordtype">id</span>])
<a name="l02107"></a>02107               pruner_array[id] = char_norm_array[shape[c].unichar_id];
<a name="l02108"></a>02108           }
<a name="l02109"></a>02109         }
<a name="l02110"></a>02110       }
<a name="l02111"></a>02111     }
<a name="l02112"></a>02112   }
<a name="l02113"></a>02113   <a class="code" href="ocrfeatures_8cpp.html#acaf54a6410150ec74f66ec6621f1352f">FreeFeature</a>(norm_feature);
<a name="l02114"></a>02114 }
<a name="l02115"></a>02115 
<a name="l02116"></a>02116 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02131"></a><a class="code" href="classtesseract_1_1_classify.html#a59900939784eac1e2e6ebfec1f82bb58">02131</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a59900939784eac1e2e6ebfec1f82bb58">Classify::MakeNewTemporaryConfig</a>(<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">ADAPT_TEMPLATES</a> Templates,
<a name="l02132"></a>02132                            <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId,
<a name="l02133"></a>02133                            <span class="keywordtype">int</span> FontinfoId,
<a name="l02134"></a>02134                            <span class="keywordtype">int</span> NumFeatures,
<a name="l02135"></a>02135                            <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> Features,
<a name="l02136"></a>02136                            <a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> FloatFeatures) {
<a name="l02137"></a>02137   <a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html">INT_CLASS</a> IClass;
<a name="l02138"></a>02138   <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> Class;
<a name="l02139"></a>02139   <a class="code" href="matchdefs_8h.html#ac80a5d84c2805bfd10ac129d949f8b80">PROTO_ID</a> OldProtos[<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>];
<a name="l02140"></a>02140   <a class="code" href="matchdefs_8h.html#a2223404e7ad809dd36193cc195377f56">FEATURE_ID</a> BadFeatures[<a class="code" href="baseapi_8h.html#a4f7caedc4bed99355cae19efa51ade51">MAX_NUM_INT_FEATURES</a>];
<a name="l02141"></a>02141   <span class="keywordtype">int</span> NumOldProtos;
<a name="l02142"></a>02142   <span class="keywordtype">int</span> NumBadFeatures;
<a name="l02143"></a>02143   <span class="keywordtype">int</span> MaxProtoId, OldMaxProtoId;
<a name="l02144"></a>02144   <span class="keywordtype">int</span> BlobLength = 0;
<a name="l02145"></a>02145   <span class="keywordtype">int</span> MaskSize;
<a name="l02146"></a>02146   <span class="keywordtype">int</span> ConfigId;
<a name="l02147"></a>02147   <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>;
<a name="l02148"></a>02148   <span class="keywordtype">int</span> i;
<a name="l02149"></a>02149   <span class="keywordtype">int</span> debug_level = <a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">NO_DEBUG</a>;
<a name="l02150"></a>02150 
<a name="l02151"></a>02151   <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 3)
<a name="l02152"></a>02152     debug_level =
<a name="l02153"></a>02153         <a class="code" href="intproto_8h.html#aa2ca7d346731ee98e1ef445c0313d0db">PRINT_MATCH_SUMMARY</a> | <a class="code" href="intproto_8h.html#af5131c6984c3afc47e8344ae4a440ccd">PRINT_FEATURE_MATCHES</a> | <a class="code" href="intproto_8h.html#aed2eae56505e79fb4ad49057437bd377">PRINT_PROTO_MATCHES</a>;
<a name="l02154"></a>02154 
<a name="l02155"></a>02155   IClass = <a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a>(Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>, ClassId);
<a name="l02156"></a>02156   Class = Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a0256081fa31eb38b52b19788ca62e327">Class</a>[ClassId];
<a name="l02157"></a>02157 
<a name="l02158"></a>02158   <span class="keywordflow">if</span> (IClass-&gt;<a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html#abb9c509f11364b949fe9764bc122938c">NumConfigs</a> &gt;= <a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>) {
<a name="l02159"></a>02159     ++NumAdaptationsFailed;
<a name="l02160"></a>02160     <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1)
<a name="l02161"></a>02161       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;Cannot make new temporary config: maximum number exceeded.\n&quot;</span>);
<a name="l02162"></a>02162     <span class="keywordflow">return</span> -1;
<a name="l02163"></a>02163   }
<a name="l02164"></a>02164 
<a name="l02165"></a>02165   OldMaxProtoId = IClass-&gt;<a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html#ab81b4bb4bddc50d49d1a66b809d9f629">NumProtos</a> - 1;
<a name="l02166"></a>02166 
<a name="l02167"></a>02167   NumOldProtos = im_.FindGoodProtos(IClass, AllProtosOn, AllConfigsOff,
<a name="l02168"></a>02168                                     BlobLength, NumFeatures, Features,
<a name="l02169"></a>02169                                     OldProtos, classify_adapt_proto_threshold,
<a name="l02170"></a>02170                                     debug_level);
<a name="l02171"></a>02171 
<a name="l02172"></a>02172   MaskSize = <a class="code" href="bitvec_8h.html#a905ff9b6c51cb231dd8baf1713a3c9b8">WordsInVectorOfSize</a>(<a class="code" href="intproto_8h.html#a3e890a5d21d8456ad197510fd7caf277">MAX_NUM_PROTOS</a>);
<a name="l02173"></a>02173   <a class="code" href="bitvec_8h.html#a33e25946d45a1e004a961dc46cb5226a">zero_all_bits</a>(TempProtoMask, MaskSize);
<a name="l02174"></a>02174   <span class="keywordflow">for</span> (i = 0; i &lt; NumOldProtos; i++)
<a name="l02175"></a>02175     <a class="code" href="bitvec_8h.html#ab02d606cf8dca49ccadb00248bdbafe9">SET_BIT</a>(TempProtoMask, OldProtos[i]);
<a name="l02176"></a>02176 
<a name="l02177"></a>02177   NumBadFeatures = im_.FindBadFeatures(IClass, TempProtoMask, AllConfigsOn,
<a name="l02178"></a>02178                                        BlobLength, NumFeatures, Features,
<a name="l02179"></a>02179                                        BadFeatures,
<a name="l02180"></a>02180                                        classify_adapt_feature_threshold,
<a name="l02181"></a>02181                                        debug_level);
<a name="l02182"></a>02182 
<a name="l02183"></a>02183   MaxProtoId = MakeNewTempProtos(FloatFeatures, NumBadFeatures, BadFeatures,
<a name="l02184"></a>02184                                  IClass, Class, TempProtoMask);
<a name="l02185"></a>02185   <span class="keywordflow">if</span> (MaxProtoId == <a class="code" href="matchdefs_8h.html#a4d2ae3978d57e3b05f984a0fedc51812">NO_PROTO</a>) {
<a name="l02186"></a>02186     ++NumAdaptationsFailed;
<a name="l02187"></a>02187     <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1)
<a name="l02188"></a>02188       <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;Cannot make new temp protos: maximum number exceeded.\n&quot;</span>);
<a name="l02189"></a>02189     <span class="keywordflow">return</span> -1;
<a name="l02190"></a>02190   }
<a name="l02191"></a>02191 
<a name="l02192"></a>02192   ConfigId = <a class="code" href="intproto_8cpp.html#a569488473772d42004fec43399e6d5a9">AddIntConfig</a>(IClass);
<a name="l02193"></a>02193   <a class="code" href="intproto_8cpp.html#a57b07752bea2110e2503cf78747228c5">ConvertConfig</a>(TempProtoMask, ConfigId, IClass);
<a name="l02194"></a>02194   Config = <a class="code" href="adaptive_8cpp.html#af29bddcf8cc7f50548382c9594716559">NewTempConfig</a>(MaxProtoId, FontinfoId);
<a name="l02195"></a>02195   <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a>(Class, ConfigId) = <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>;
<a name="l02196"></a>02196   <a class="code" href="bitvec_8h.html#ae535f23da300bdf6ea284fc5e85ca14a">copy_all_bits</a>(TempProtoMask, Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a2ea5edb90b556766fce2105dcdfe3141">Protos</a>, Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#ab21bd28ad8f7448dcdc327ac13dbe553">ProtoVectorSize</a>);
<a name="l02197"></a>02197 
<a name="l02198"></a>02198   <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1)
<a name="l02199"></a>02199     <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a>(<span class="stringliteral">&quot;Making new temp config %d fontinfo id %d&quot;</span>
<a name="l02200"></a>02200             <span class="stringliteral">&quot; using %d old and %d new protos.\n&quot;</span>,
<a name="l02201"></a>02201             ConfigId, Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a76b02dedaede2e6e34653155be6f8c7b">FontinfoId</a>,
<a name="l02202"></a>02202             NumOldProtos, MaxProtoId - OldMaxProtoId);
<a name="l02203"></a>02203 
<a name="l02204"></a>02204   <span class="keywordflow">return</span> ConfigId;
<a name="l02205"></a>02205 }                              <span class="comment">/* MakeNewTemporaryConfig */</span>
<a name="l02206"></a>02206 
<a name="l02207"></a>02207 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02228"></a><a class="code" href="classtesseract_1_1_classify.html#adc0facdf672d23f65612b56b4a5f523a">02228</a> <a class="code" href="matchdefs_8h.html#ac80a5d84c2805bfd10ac129d949f8b80">PROTO_ID</a> <a class="code" href="classtesseract_1_1_classify.html#adc0facdf672d23f65612b56b4a5f523a">Classify::MakeNewTempProtos</a>(<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html">FEATURE_SET</a> Features,
<a name="l02229"></a>02229                                      <span class="keywordtype">int</span> NumBadFeat,
<a name="l02230"></a>02230                                      <a class="code" href="matchdefs_8h.html#a2223404e7ad809dd36193cc195377f56">FEATURE_ID</a> BadFeat[],
<a name="l02231"></a>02231                                      <a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html">INT_CLASS</a> IClass,
<a name="l02232"></a>02232                                      <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> Class,
<a name="l02233"></a>02233                                      <a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a> TempProtoMask) {
<a name="l02234"></a>02234   <a class="code" href="matchdefs_8h.html#a2223404e7ad809dd36193cc195377f56">FEATURE_ID</a> *ProtoStart;
<a name="l02235"></a>02235   <a class="code" href="matchdefs_8h.html#a2223404e7ad809dd36193cc195377f56">FEATURE_ID</a> *ProtoEnd;
<a name="l02236"></a>02236   <a class="code" href="matchdefs_8h.html#a2223404e7ad809dd36193cc195377f56">FEATURE_ID</a> *LastBad;
<a name="l02237"></a>02237   <a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html">TEMP_PROTO</a> TempProto;
<a name="l02238"></a>02238   <a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html">PROTO</a> Proto;
<a name="l02239"></a>02239   <a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html">FEATURE</a> F1, F2;
<a name="l02240"></a>02240   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> X1, X2, Y1, Y2;
<a name="l02241"></a>02241   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> A1, A2, AngleDelta;
<a name="l02242"></a>02242   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> SegmentLength;
<a name="l02243"></a>02243   <a class="code" href="matchdefs_8h.html#ac80a5d84c2805bfd10ac129d949f8b80">PROTO_ID</a> Pid;
<a name="l02244"></a>02244 
<a name="l02245"></a>02245   <span class="keywordflow">for</span> (ProtoStart = BadFeat, LastBad = ProtoStart + NumBadFeat;
<a name="l02246"></a>02246        ProtoStart &lt; LastBad; ProtoStart = ProtoEnd) {
<a name="l02247"></a>02247     F1 = Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a4664d6a22a9d12f4011de4d877664c45">Features</a>[*ProtoStart];
<a name="l02248"></a>02248     X1 = F1-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aacaf28d56154a908256d7b3beb62977e2fc">PicoFeatX</a>];
<a name="l02249"></a>02249     Y1 = F1-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aaca43884de5e2e87be26f9642b50135f98a">PicoFeatY</a>];
<a name="l02250"></a>02250     A1 = F1-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aaca9895f2baa648985ab8ee5586c1563511">PicoFeatDir</a>];
<a name="l02251"></a>02251 
<a name="l02252"></a>02252     <span class="keywordflow">for</span> (ProtoEnd = ProtoStart + 1,
<a name="l02253"></a>02253          SegmentLength = <a class="code" href="picofeat_8h.html#a35f5a174efc9c6197837aaf5544c78f2">GetPicoFeatureLength</a>();
<a name="l02254"></a>02254          ProtoEnd &lt; LastBad;
<a name="l02255"></a>02255          ProtoEnd++, SegmentLength += <a class="code" href="picofeat_8h.html#a35f5a174efc9c6197837aaf5544c78f2">GetPicoFeatureLength</a>()) {
<a name="l02256"></a>02256       F2 = Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a4664d6a22a9d12f4011de4d877664c45">Features</a>[*ProtoEnd];
<a name="l02257"></a>02257       X2 = F2-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aacaf28d56154a908256d7b3beb62977e2fc">PicoFeatX</a>];
<a name="l02258"></a>02258       Y2 = F2-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aaca43884de5e2e87be26f9642b50135f98a">PicoFeatY</a>];
<a name="l02259"></a>02259       A2 = F2-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aaca9895f2baa648985ab8ee5586c1563511">PicoFeatDir</a>];
<a name="l02260"></a>02260 
<a name="l02261"></a>02261       AngleDelta = fabs(A1 - A2);
<a name="l02262"></a>02262       <span class="keywordflow">if</span> (AngleDelta &gt; 0.5)
<a name="l02263"></a>02263         AngleDelta = 1.0 - AngleDelta;
<a name="l02264"></a>02264 
<a name="l02265"></a>02265       <span class="keywordflow">if</span> (AngleDelta &gt; matcher_clustering_max_angle_delta ||
<a name="l02266"></a>02266           fabs(X1 - X2) &gt; SegmentLength ||
<a name="l02267"></a>02267           fabs(Y1 - Y2) &gt; SegmentLength)
<a name="l02268"></a>02268         <span class="keywordflow">break</span>;
<a name="l02269"></a>02269     }
<a name="l02270"></a>02270 
<a name="l02271"></a>02271     F2 = Features-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_e_t___s_t_r_u_c_t.html#a4664d6a22a9d12f4011de4d877664c45">Features</a>[*(ProtoEnd - 1)];
<a name="l02272"></a>02272     X2 = F2-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aacaf28d56154a908256d7b3beb62977e2fc">PicoFeatX</a>];
<a name="l02273"></a>02273     Y2 = F2-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aaca43884de5e2e87be26f9642b50135f98a">PicoFeatY</a>];
<a name="l02274"></a>02274     A2 = F2-&gt;<a class="code" href="struct_f_e_a_t_u_r_e___s_t_r_u_c_t.html#ace52f36cfcba955504f4a24f86a897b4">Params</a>[<a class="code" href="picofeat_8h.html#ac00e1c5d2ac3096e0928e2186aee1aaca9895f2baa648985ab8ee5586c1563511">PicoFeatDir</a>];
<a name="l02275"></a>02275 
<a name="l02276"></a>02276     Pid = <a class="code" href="intproto_8cpp.html#a4c27266652a51cf8aaa866d299f57301">AddIntProto</a>(IClass);
<a name="l02277"></a>02277     <span class="keywordflow">if</span> (Pid == <a class="code" href="matchdefs_8h.html#a4d2ae3978d57e3b05f984a0fedc51812">NO_PROTO</a>)
<a name="l02278"></a>02278       <span class="keywordflow">return</span> (<a class="code" href="matchdefs_8h.html#a4d2ae3978d57e3b05f984a0fedc51812">NO_PROTO</a>);
<a name="l02279"></a>02279 
<a name="l02280"></a>02280     TempProto = <a class="code" href="adaptive_8cpp.html#a5dec565ee3ad1656d02860db322e4448">NewTempProto</a>();
<a name="l02281"></a>02281     Proto = &amp;(TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#acf720eb61d4a91e84d949a6f772ea7c5">Proto</a>);
<a name="l02282"></a>02282 
<a name="l02283"></a>02283     <span class="comment">/* compute proto params - NOTE that Y_DIM_OFFSET must be used because</span>
<a name="l02284"></a>02284 <span class="comment">       ConvertProto assumes that the Y dimension varies from -0.5 to 0.5</span>
<a name="l02285"></a>02285 <span class="comment">       instead of the -0.25 to 0.75 used in baseline normalization */</span>
<a name="l02286"></a>02286     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#aa29d8aaab147327320e2bc94a821aad1">Length</a> = SegmentLength;
<a name="l02287"></a>02287     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a6cc7458f385f9c4673e1ce9a6dc9e80a">Angle</a> = A1;
<a name="l02288"></a>02288     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a54dd1cca86a1fd5c9ead8499cba99784">X</a> = (X1 + X2) / 2.0;
<a name="l02289"></a>02289     Proto-&gt;<a class="code" href="struct_p_r_o_t_o___s_t_r_u_c_t.html#a8dcd81037c1bc672e97ef7a54306dd93">Y</a> = (Y1 + Y2) / 2.0 - <a class="code" href="adaptmatch_8cpp.html#ac5fe456fd5a30097c95a104b29c45cc3">Y_DIM_OFFSET</a>;
<a name="l02290"></a>02290     <a class="code" href="protos_8cpp.html#ac0d58978bbcf0c732ae94fb554bccd3b">FillABC</a>(Proto);
<a name="l02291"></a>02291 
<a name="l02292"></a>02292     TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#a93992200ebfddd13e25d0e9122af9b5b">ProtoId</a> = Pid;
<a name="l02293"></a>02293     <a class="code" href="bitvec_8h.html#ab02d606cf8dca49ccadb00248bdbafe9">SET_BIT</a>(TempProtoMask, Pid);
<a name="l02294"></a>02294 
<a name="l02295"></a>02295     ConvertProto(Proto, Pid, IClass);
<a name="l02296"></a>02296     <a class="code" href="intproto_8cpp.html#aec09adc2735bb4caaf226df7124e4ed7">AddProtoToProtoPruner</a>(Proto, Pid, IClass,
<a name="l02297"></a>02297                           classify_learning_debug_level &gt;= 2);
<a name="l02298"></a>02298 
<a name="l02299"></a>02299     Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a879b5ee2f46335fe784fd4c266f8a37c">TempProtos</a> = <a class="code" href="oldlist_8cpp.html#a9c4294375af81ab4c133b6b5a3679a16">push</a>(Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a879b5ee2f46335fe784fd4c266f8a37c">TempProtos</a>, TempProto);
<a name="l02300"></a>02300   }
<a name="l02301"></a>02301   <span class="keywordflow">return</span> IClass-&gt;<a class="code" href="struct_i_n_t___c_l_a_s_s___s_t_r_u_c_t.html#ab81b4bb4bddc50d49d1a66b809d9f629">NumProtos</a> - 1;
<a name="l02302"></a>02302 }                              <span class="comment">/* MakeNewTempProtos */</span>
<a name="l02303"></a>02303 
<a name="l02304"></a>02304 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02318"></a><a class="code" href="classtesseract_1_1_classify.html#aefb0cfe284dd67601798f7ae510b787f">02318</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#aefb0cfe284dd67601798f7ae510b787f">Classify::MakePermanent</a>(<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">ADAPT_TEMPLATES</a> Templates,
<a name="l02319"></a>02319                              <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId,
<a name="l02320"></a>02320                              <span class="keywordtype">int</span> ConfigId,
<a name="l02321"></a>02321                              <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l02322"></a>02322                              <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob) {
<a name="l02323"></a>02323   <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *Ambigs;
<a name="l02324"></a>02324   <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>;
<a name="l02325"></a>02325   <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> Class;
<a name="l02326"></a>02326   <a class="code" href="struct_p_r_o_t_o___k_e_y.html">PROTO_KEY</a> ProtoKey;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328   Class = Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a0256081fa31eb38b52b19788ca62e327">Class</a>[ClassId];
<a name="l02329"></a>02329   Config = <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a>(Class, ConfigId);
<a name="l02330"></a>02330 
<a name="l02331"></a>02331   <a class="code" href="adaptive_8h.html#a43dd293941046156e425af5080c56228">MakeConfigPermanent</a>(Class, ConfigId);
<a name="l02332"></a>02332   <span class="keywordflow">if</span> (Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#afe5769d3f67549e0938480aab2d2b1cd">NumPermConfigs</a> == 0)
<a name="l02333"></a>02333     Templates-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#ac4e39261d76ebdd092eeb754fe1e15c3">NumPermClasses</a>++;
<a name="l02334"></a>02334   Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#afe5769d3f67549e0938480aab2d2b1cd">NumPermConfigs</a>++;
<a name="l02335"></a>02335 
<a name="l02336"></a>02336   <span class="comment">// Initialize permanent config.</span>
<a name="l02337"></a>02337   Ambigs = GetAmbiguities(Blob, denorm, ClassId);
<a name="l02338"></a>02338   <a class="code" href="struct_p_e_r_m___c_o_n_f_i_g___s_t_r_u_c_t.html">PERM_CONFIG</a> Perm = (<a class="code" href="adaptive_8h.html#a461ee34b392d9264f8ff553d28029c52">PERM_CONFIG</a>) <a class="code" href="memry_8cpp.html#a4f4e6728de23eb0530f9bdc8b3a114d3">alloc_struct</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_p_e_r_m___c_o_n_f_i_g___s_t_r_u_c_t.html">PERM_CONFIG_STRUCT</a>),
<a name="l02339"></a>02339                                                 <span class="stringliteral">&quot;PERM_CONFIG_STRUCT&quot;</span>);
<a name="l02340"></a>02340   Perm-&gt;<a class="code" href="struct_p_e_r_m___c_o_n_f_i_g___s_t_r_u_c_t.html#ad64b24b19468c44594a84a71f5515bf8">Ambigs</a> = Ambigs;
<a name="l02341"></a>02341   Perm-&gt;<a class="code" href="struct_p_e_r_m___c_o_n_f_i_g___s_t_r_u_c_t.html#a81ce1dd96fbaed7c30c47bc6a1d19d92">FontinfoId</a> = Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a76b02dedaede2e6e34653155be6f8c7b">FontinfoId</a>;
<a name="l02342"></a>02342 
<a name="l02343"></a>02343   <span class="comment">// Free memory associated with temporary config (since ADAPTED_CONFIG</span>
<a name="l02344"></a>02344   <span class="comment">// is a union we need to clean up before we record permanent config).</span>
<a name="l02345"></a>02345   ProtoKey.<a class="code" href="struct_p_r_o_t_o___k_e_y.html#a88e8ec3116b1ca5e8c0a57a2236f83ed">Templates</a> = Templates;
<a name="l02346"></a>02346   ProtoKey.<a class="code" href="struct_p_r_o_t_o___k_e_y.html#a45ade2ad8d07fe98968e6a6795680f0a">ClassId</a> = ClassId;
<a name="l02347"></a>02347   ProtoKey.<a class="code" href="struct_p_r_o_t_o___k_e_y.html#ab4a673ae9bd6272302ea460d336bc80e">ConfigId</a> = ConfigId;
<a name="l02348"></a>02348   Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a879b5ee2f46335fe784fd4c266f8a37c">TempProtos</a> = <a class="code" href="oldlist_8cpp.html#a1fa3ecce52a0563f595b8f1428cc1211">delete_d</a>(Class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a879b5ee2f46335fe784fd4c266f8a37c">TempProtos</a>, &amp;ProtoKey, <a class="code" href="adaptmatch_8cpp.html#aeb798d8e9e1be9d25261b8a604910d0d">MakeTempProtoPerm</a>);
<a name="l02349"></a>02349   <a class="code" href="adaptive_8cpp.html#a69bbd5a22930a7f4cc2d85f49b468b67">FreeTempConfig</a>(Config);
<a name="l02350"></a>02350 
<a name="l02351"></a>02351   <span class="comment">// Record permanent config.</span>
<a name="l02352"></a>02352   <a class="code" href="adaptive_8h.html#aea4d5dd0059c222f111f9537af74a325">PermConfigFor</a>(Class, ConfigId) = Perm;
<a name="l02353"></a>02353 
<a name="l02354"></a>02354   <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1) {
<a name="l02355"></a>02355     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Making config %d for %s (ClassId %d) permanent:&quot;</span>
<a name="l02356"></a>02356             <span class="stringliteral">&quot; fontinfo id %d, ambiguities &#39;&quot;</span>,
<a name="l02357"></a>02357             ConfigId, getDict().getUnicharset().debug_str(ClassId).<span class="keywordtype">string</span>(),
<a name="l02358"></a>02358             ClassId, <a class="code" href="adaptive_8h.html#aea4d5dd0059c222f111f9537af74a325">PermConfigFor</a>(Class, ConfigId)-&gt;FontinfoId);
<a name="l02359"></a>02359     <span class="keywordflow">for</span> (<a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> *AmbigsPointer = Ambigs;
<a name="l02360"></a>02360         *AmbigsPointer &gt;= 0; ++AmbigsPointer)
<a name="l02361"></a>02361       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;%s&quot;</span>, unicharset.id_to_unichar(*AmbigsPointer));
<a name="l02362"></a>02362     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;&#39;.\n&quot;</span>);
<a name="l02363"></a>02363   }
<a name="l02364"></a>02364 }                              <span class="comment">/* MakePermanent */</span>
<a name="l02365"></a>02365 }  <span class="comment">// namespace tesseract</span>
<a name="l02366"></a>02366 
<a name="l02367"></a>02367 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02382"></a><a class="code" href="adaptmatch_8cpp.html#aeb798d8e9e1be9d25261b8a604910d0d">02382</a> <span class="keywordtype">int</span> <a class="code" href="adaptmatch_8cpp.html#aeb798d8e9e1be9d25261b8a604910d0d">MakeTempProtoPerm</a>(<span class="keywordtype">void</span> *item1, <span class="keywordtype">void</span> *item2) {
<a name="l02383"></a>02383   <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> Class;
<a name="l02384"></a>02384   <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> <a class="code" href="commontraining_8cpp.html#a1630a3dc82a9a7cef07bb6153df9eb9c">Config</a>;
<a name="l02385"></a>02385   <a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html">TEMP_PROTO</a> TempProto;
<a name="l02386"></a>02386   <a class="code" href="struct_p_r_o_t_o___k_e_y.html">PROTO_KEY</a> *ProtoKey;
<a name="l02387"></a>02387 
<a name="l02388"></a>02388   TempProto = (<a class="code" href="adaptive_8h.html#a03dc56d9af9a82277b248c3b58267c25">TEMP_PROTO</a>) item1;
<a name="l02389"></a>02389   ProtoKey = (<a class="code" href="struct_p_r_o_t_o___k_e_y.html">PROTO_KEY</a> *) item2;
<a name="l02390"></a>02390 
<a name="l02391"></a>02391   Class = ProtoKey-&gt;<a class="code" href="struct_p_r_o_t_o___k_e_y.html#a88e8ec3116b1ca5e8c0a57a2236f83ed">Templates</a>-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a0256081fa31eb38b52b19788ca62e327">Class</a>[ProtoKey-&gt;<a class="code" href="struct_p_r_o_t_o___k_e_y.html#a45ade2ad8d07fe98968e6a6795680f0a">ClassId</a>];
<a name="l02392"></a>02392   Config = <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a>(Class, ProtoKey-&gt;<a class="code" href="struct_p_r_o_t_o___k_e_y.html#ab4a673ae9bd6272302ea460d336bc80e">ConfigId</a>);
<a name="l02393"></a>02393 
<a name="l02394"></a>02394   <span class="keywordflow">if</span> (TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#a93992200ebfddd13e25d0e9122af9b5b">ProtoId</a> &gt; Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a973aee4e62bf2e6f6949b13020c984d8">MaxProtoId</a> ||
<a name="l02395"></a>02395       !<a class="code" href="bitvec_8h.html#a76a50c5a99dea7be5315fe76246036ce">test_bit</a> (Config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a2ea5edb90b556766fce2105dcdfe3141">Protos</a>, TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#a93992200ebfddd13e25d0e9122af9b5b">ProtoId</a>))
<a name="l02396"></a>02396     <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02397"></a>02397 
<a name="l02398"></a>02398   <a class="code" href="adaptive_8h.html#a2fb3ad8812835e60ee6e429be4a7e949">MakeProtoPermanent</a>(Class, TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#a93992200ebfddd13e25d0e9122af9b5b">ProtoId</a>);
<a name="l02399"></a>02399   <a class="code" href="intproto_8cpp.html#a117c6df38172671a3f3fce9cdb4f3299">AddProtoToClassPruner</a>(&amp;(TempProto-&gt;<a class="code" href="struct_t_e_m_p___p_r_o_t_o___s_t_r_u_c_t.html#acf720eb61d4a91e84d949a6f772ea7c5">Proto</a>), ProtoKey-&gt;<a class="code" href="struct_p_r_o_t_o___k_e_y.html#a45ade2ad8d07fe98968e6a6795680f0a">ClassId</a>,
<a name="l02400"></a>02400                          ProtoKey-&gt;<a class="code" href="struct_p_r_o_t_o___k_e_y.html#a88e8ec3116b1ca5e8c0a57a2236f83ed">Templates</a>-&gt;<a class="code" href="struct_a_d_a_p_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html#a592229e83546c1b6840e7862b92a0629">Templates</a>);
<a name="l02401"></a>02401   <a class="code" href="adaptive_8cpp.html#a6dd6f2bb609ab699a22ea1df6a7f67cd">FreeTempProto</a>(TempProto);
<a name="l02402"></a>02402 
<a name="l02403"></a>02403   <span class="keywordflow">return</span> <a class="code" href="host_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02404"></a>02404 }                              <span class="comment">/* MakeTempProtoPerm */</span>
<a name="l02405"></a>02405 
<a name="l02406"></a>02406 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02407"></a>02407 <span class="keyword">namespace </span>tesseract {
<a name="l02419"></a><a class="code" href="classtesseract_1_1_classify.html#aad46f714847619694546e9ea2784402c">02419</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#aad46f714847619694546e9ea2784402c">Classify::PrintAdaptiveMatchResults</a>(FILE *File, <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l02420"></a>02420   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; ++i) {
<a name="l02421"></a>02421     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;%s(%d), shape %d, %.2f  &quot;</span>,
<a name="l02422"></a>02422             unicharset.debug_str(Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>).string(),
<a name="l02423"></a>02423             Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>, Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#ab3db24ffe2690f52d86053ba1f631520">shape_id</a>,
<a name="l02424"></a>02424             Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[i].<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> * 100.0);
<a name="l02425"></a>02425   }
<a name="l02426"></a>02426   <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02427"></a>02427 }                              <span class="comment">/* PrintAdaptiveMatchResults */</span>
<a name="l02428"></a>02428 
<a name="l02429"></a>02429 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02445"></a><a class="code" href="classtesseract_1_1_classify.html#a0e35029ac0c77ad18d35f08c27c99d15">02445</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a0e35029ac0c77ad18d35f08c27c99d15">Classify::RemoveBadMatches</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l02446"></a>02446   <span class="keywordtype">int</span> Next, NextGood;
<a name="l02447"></a>02447   <a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> BadMatchThreshold;
<a name="l02448"></a>02448   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* romans = <span class="stringliteral">&quot;i v x I V X&quot;</span>;
<a name="l02449"></a>02449   BadMatchThreshold = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a7cfeae71a3b1fddd0e2dd1b369c6d15b">best_match</a>.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> + matcher_bad_match_pad;
<a name="l02450"></a>02450 
<a name="l02451"></a>02451   <span class="keywordflow">if</span> (classify_bln_numeric_mode) {
<a name="l02452"></a>02452     <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_id_one = unicharset.contains_unichar(<span class="stringliteral">&quot;1&quot;</span>) ?
<a name="l02453"></a>02453         unicharset.unichar_to_id(<span class="stringliteral">&quot;1&quot;</span>) : -1;
<a name="l02454"></a>02454     <a class="code" href="unichar_8h.html#a8578b19fa1ff5ca75080db1a18ecc32e">UNICHAR_ID</a> unichar_id_zero = unicharset.contains_unichar(<span class="stringliteral">&quot;0&quot;</span>) ?
<a name="l02455"></a>02455         unicharset.unichar_to_id(<span class="stringliteral">&quot;0&quot;</span>) : -1;
<a name="l02456"></a>02456     <a class="code" href="struct_scored_class.html">ScoredClass</a> scored_one = <a class="code" href="adaptmatch_8cpp.html#ab41bdc1f072e458bb14d644c1106b56a">ScoredUnichar</a>(Results, unichar_id_one);
<a name="l02457"></a>02457     <a class="code" href="struct_scored_class.html">ScoredClass</a> scored_zero = <a class="code" href="adaptmatch_8cpp.html#ab41bdc1f072e458bb14d644c1106b56a">ScoredUnichar</a>(Results, unichar_id_zero);
<a name="l02458"></a>02458 
<a name="l02459"></a>02459     <span class="keywordflow">for</span> (Next = NextGood = 0; Next &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; Next++) {
<a name="l02460"></a>02460       <span class="keywordflow">if</span> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[Next].<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &lt;= BadMatchThreshold) {
<a name="l02461"></a>02461         <a class="code" href="struct_scored_class.html">ScoredClass</a> match = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[Next];
<a name="l02462"></a>02462         <span class="keywordflow">if</span> (!unicharset.get_isalpha(match.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>) ||
<a name="l02463"></a>02463             strstr(romans,
<a name="l02464"></a>02464                    unicharset.id_to_unichar(match.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02465"></a>02465           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood++] = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[Next];
<a name="l02466"></a>02466         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unicharset.eq(match.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>, <span class="stringliteral">&quot;l&quot;</span>) &amp;&amp;
<a name="l02467"></a>02467                    scored_one.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &gt;= BadMatchThreshold) {
<a name="l02468"></a>02468           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood] = scored_one;
<a name="l02469"></a>02469           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood].<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> = match.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>;
<a name="l02470"></a>02470           NextGood++;
<a name="l02471"></a>02471         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unicharset.eq(match.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>, <span class="stringliteral">&quot;O&quot;</span>) &amp;&amp;
<a name="l02472"></a>02472                    scored_zero.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &gt;= BadMatchThreshold) {
<a name="l02473"></a>02473           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood] = scored_zero;
<a name="l02474"></a>02474           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood].<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> = match.<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a>;
<a name="l02475"></a>02475           NextGood++;
<a name="l02476"></a>02476         }
<a name="l02477"></a>02477       }
<a name="l02478"></a>02478     }
<a name="l02479"></a>02479   } <span class="keywordflow">else</span> {
<a name="l02480"></a>02480     <span class="keywordflow">for</span> (Next = NextGood = 0; Next &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; Next++) {
<a name="l02481"></a>02481       <span class="keywordflow">if</span> (Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[Next].<a class="code" href="struct_scored_class.html#aa410f972971cfb2df154972833783f72">rating</a> &lt;= BadMatchThreshold)
<a name="l02482"></a>02482         Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood++] = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[Next];
<a name="l02483"></a>02483     }
<a name="l02484"></a>02484   }
<a name="l02485"></a>02485   Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> = NextGood;
<a name="l02486"></a>02486 }                              <span class="comment">/* RemoveBadMatches */</span>
<a name="l02487"></a>02487 
<a name="l02488"></a>02488 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l02504"></a><a class="code" href="classtesseract_1_1_classify.html#af15e83a02b369b820d40c8920b4275e8">02504</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#af15e83a02b369b820d40c8920b4275e8">Classify::RemoveExtraPuncs</a>(<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l02505"></a>02505   <span class="keywordtype">int</span> Next, NextGood;
<a name="l02506"></a>02506   <span class="keywordtype">int</span> punc_count;              <span class="comment">/*no of garbage characters */</span>
<a name="l02507"></a>02507   <span class="keywordtype">int</span> digit_count;
<a name="l02508"></a>02508   <span class="comment">/*garbage characters */</span>
<a name="l02509"></a>02509   <span class="keyword">static</span> <span class="keywordtype">char</span> punc_chars[] = <span class="stringliteral">&quot;. , ; : / ` ~ &#39; - = \\ | \&quot; ! _ ^&quot;</span>;
<a name="l02510"></a>02510   <span class="keyword">static</span> <span class="keywordtype">char</span> digit_chars[] = <span class="stringliteral">&quot;0 1 2 3 4 5 6 7 8 9&quot;</span>;
<a name="l02511"></a>02511 
<a name="l02512"></a>02512   punc_count = 0;
<a name="l02513"></a>02513   digit_count = 0;
<a name="l02514"></a>02514   <span class="keywordflow">for</span> (Next = NextGood = 0; Next &lt; Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a>; Next++) {
<a name="l02515"></a>02515     <a class="code" href="struct_scored_class.html">ScoredClass</a> match = Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[Next];
<a name="l02516"></a>02516     <span class="keywordflow">if</span> (strstr(punc_chars,
<a name="l02517"></a>02517                unicharset.id_to_unichar(match.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02518"></a>02518       <span class="keywordflow">if</span> (punc_count &lt; 2)
<a name="l02519"></a>02519         Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood++] = match;
<a name="l02520"></a>02520       punc_count++;
<a name="l02521"></a>02521     } <span class="keywordflow">else</span> {
<a name="l02522"></a>02522       <span class="keywordflow">if</span> (strstr(digit_chars,
<a name="l02523"></a>02523                  unicharset.id_to_unichar(match.<a class="code" href="struct_scored_class.html#ac067f8f00b90b65e9e8348355a771736">unichar_id</a>)) != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02524"></a>02524         <span class="keywordflow">if</span> (digit_count &lt; 1)
<a name="l02525"></a>02525           Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood++] = match;
<a name="l02526"></a>02526         digit_count++;
<a name="l02527"></a>02527       } <span class="keywordflow">else</span> {
<a name="l02528"></a>02528         Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a6ea8673cf9af04e0f0559ddcea630e61">match</a>[NextGood++] = match;
<a name="l02529"></a>02529       }
<a name="l02530"></a>02530     }
<a name="l02531"></a>02531   }
<a name="l02532"></a>02532   Results-&gt;<a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html#a5b86ffcce686898891300193f1998239">NumMatches</a> = NextGood;
<a name="l02533"></a>02533 }                              <span class="comment">/* RemoveExtraPuncs */</span>
<a name="l02534"></a>02534 
<a name="l02535"></a>02535 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02549"></a><a class="code" href="classtesseract_1_1_classify.html#a5a3045639a3db979a8d1eb6dc4343e3b">02549</a> <span class="keywordtype">void</span> <a class="code" href="adaptmatch_8cpp.html#af465486d57190cd17155ecc52186dadc">Classify::SetAdaptiveThreshold</a>(<a class="code" href="host_8h.html#a6a3da5f1db8d485c0d2f5a7ba526c4a0">FLOAT32</a> Threshold) {
<a name="l02550"></a>02550   Threshold = (Threshold == matcher_good_threshold) ? 0.9: (1.0 - Threshold);
<a name="l02551"></a>02551   classify_adapt_proto_threshold.set_value(
<a name="l02552"></a>02552       ClipToRange&lt;int&gt;(255 * Threshold, 0, 255));
<a name="l02553"></a>02553   classify_adapt_feature_threshold.set_value(
<a name="l02554"></a>02554       ClipToRange&lt;int&gt;(255 * Threshold, 0, 255));
<a name="l02555"></a>02555 }                              <span class="comment">/* SetAdaptiveThreshold */</span>
<a name="l02556"></a>02556 
<a name="l02557"></a>02557 <span class="comment">/*---------------------------------------------------------------------------*/</span>
<a name="l02580"></a><a class="code" href="classtesseract_1_1_classify.html#abf81bc54d31591d9da5f95529583b99d">02580</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#abf81bc54d31591d9da5f95529583b99d">Classify::ShowBestMatchFor</a>(<a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob,
<a name="l02581"></a>02581                                 <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l02582"></a>02582                                 <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ClassId,
<a name="l02583"></a>02583                                 <span class="keywordtype">int</span> shape_id,
<a name="l02584"></a>02584                                 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> AdaptiveOn,
<a name="l02585"></a>02585                                 <a class="code" href="host_8h.html#a7712a7e28433d0ade59219a129549b6f">BOOL8</a> PreTrainedOn,
<a name="l02586"></a>02586                                 <a class="code" href="struct_a_d_a_p_t___r_e_s_u_l_t_s.html">ADAPT_RESULTS</a> *Results) {
<a name="l02587"></a>02587   <span class="keywordtype">int</span> NumCNFeatures = 0, NumBLFeatures = 0;
<a name="l02588"></a>02588   <a class="code" href="baseapi_8h.html#a544a6c7d78d215e9a4da202daecfeb52">INT_FEATURE_ARRAY</a> CNFeatures, BLFeatures;
<a name="l02589"></a>02589   <a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html">INT_RESULT_STRUCT</a> CNResult, BLResult;
<a name="l02590"></a>02590   <a class="code" href="host_8h.html#aba1f582fd0168f3ff9225d8c90fa9eb8">inT32</a> BlobLength;
<a name="l02591"></a>02591   <a class="code" href="host_8h.html#afc8530b39ebe0b6df1e19159d2508d15">uinT32</a> ConfigMask;
<a name="l02592"></a>02592   <span class="keyword">static</span> <span class="keywordtype">int</span> next_config = -1;
<a name="l02593"></a>02593 
<a name="l02594"></a>02594   <span class="keywordflow">if</span> (PreTrainedOn) next_config = -1;
<a name="l02595"></a>02595 
<a name="l02596"></a>02596   CNResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a> = BLResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a> = 2.0;
<a name="l02597"></a>02597 
<a name="l02598"></a>02598   <span class="keywordflow">if</span> (!<a class="code" href="intproto_8h.html#a6edc7e9d060a50cd3617bb509a061eb5">LegalClassId</a> (ClassId)) {
<a name="l02599"></a>02599     <a class="code" href="callcpp_8cpp.html#a21679e7fec2d69db23107348fa13c153">cprintf</a> (<span class="stringliteral">&quot;%d is not a legal class id!!\n&quot;</span>, ClassId);
<a name="l02600"></a>02600     <span class="keywordflow">return</span>;
<a name="l02601"></a>02601   }
<a name="l02602"></a>02602 
<a name="l02603"></a>02603   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a> *CNAdjust = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="matchdefs_8h.html#adcc52d7d059a8ca452172df64faa231c">MAX_NUM_CLASSES</a>];
<a name="l02604"></a>02604   <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a> *BLAdjust = <span class="keyword">new</span> <a class="code" href="host_8h.html#a458fe97f82495945f8071bb3c18d1783">uinT8</a>[<a class="code" href="matchdefs_8h.html#adcc52d7d059a8ca452172df64faa231c">MAX_NUM_CLASSES</a>];
<a name="l02605"></a>02605 
<a name="l02606"></a>02606   <span class="keywordflow">if</span> (shape_table_ == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02607"></a>02607     shape_id = ClassId;
<a name="l02608"></a>02608   <span class="keywordflow">else</span>
<a name="l02609"></a>02609     shape_id = ShapeIDToClassID(shape_id);
<a name="l02610"></a>02610   <span class="keywordflow">if</span> (PreTrainedOn &amp;&amp; shape_id &gt;= 0) {
<a name="l02611"></a>02611     <span class="keywordflow">if</span> (<a class="code" href="intproto_8h.html#a3e7ae3ffbac606326937a4c701aeeaf2">UnusedClassIdIn</a>(PreTrainedTemplates, shape_id)) {
<a name="l02612"></a>02612       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;No built-in templates for class/shape %d\n&quot;</span>, shape_id);
<a name="l02613"></a>02613     } <span class="keywordflow">else</span> {
<a name="l02614"></a>02614       NumCNFeatures = GetCharNormFeatures(Blob, denorm, PreTrainedTemplates,
<a name="l02615"></a>02615                                           CNFeatures, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, CNAdjust,
<a name="l02616"></a>02616                                           &amp;BlobLength, <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02617"></a>02617       <span class="keywordflow">if</span> (NumCNFeatures &lt;= 0) {
<a name="l02618"></a>02618         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Illegal blob (char norm features)!\n&quot;</span>);
<a name="l02619"></a>02619       } <span class="keywordflow">else</span> {
<a name="l02620"></a>02620         im_.SetCharNormMatch(<a class="code" href="intmatcher_8h.html#afe4b8f9ecb4595e800850f646935045b">classify_integer_matcher_multiplier</a>);
<a name="l02621"></a>02621         im_.Match(<a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a>(PreTrainedTemplates, shape_id),
<a name="l02622"></a>02622                   AllProtosOn, AllConfigsOn,
<a name="l02623"></a>02623                   NumCNFeatures, CNFeatures,
<a name="l02624"></a>02624                   &amp;CNResult,
<a name="l02625"></a>02625                   classify_adapt_feature_threshold, <a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">NO_DEBUG</a>,
<a name="l02626"></a>02626                   matcher_debug_separate_windows);
<a name="l02627"></a>02627         ExpandShapesAndApplyCorrections(<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keyword">false</span>, shape_id,
<a name="l02628"></a>02628                                         Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(),
<a name="l02629"></a>02629                                         Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(),
<a name="l02630"></a>02630                                         0, BlobLength, CNAdjust,
<a name="l02631"></a>02631                                         CNResult, Results);
<a name="l02632"></a>02632       }
<a name="l02633"></a>02633     }
<a name="l02634"></a>02634   }
<a name="l02635"></a>02635 
<a name="l02636"></a>02636   <span class="keywordflow">if</span> (AdaptiveOn) {
<a name="l02637"></a>02637     <span class="keywordflow">if</span> (ClassId &lt; 0 || ClassId &gt;= AdaptedTemplates-&gt;Templates-&gt;NumClasses) {
<a name="l02638"></a>02638       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Invalid adapted class id: %d\n&quot;</span>, ClassId);
<a name="l02639"></a>02639     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="intproto_8h.html#a3e7ae3ffbac606326937a4c701aeeaf2">UnusedClassIdIn</a>(AdaptedTemplates-&gt;Templates, ClassId) ||
<a name="l02640"></a>02640                AdaptedTemplates-&gt;Class[ClassId] == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l02641"></a>02641                <a class="code" href="adaptive_8h.html#a1d2aa2b696e73525cb57373fcc5a83ae">IsEmptyAdaptedClass</a>(AdaptedTemplates-&gt;Class[ClassId])) {
<a name="l02642"></a>02642       <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;No AD templates for class %d = %s\n&quot;</span>,
<a name="l02643"></a>02643               ClassId, unicharset.id_to_unichar(ClassId));
<a name="l02644"></a>02644     } <span class="keywordflow">else</span> {
<a name="l02645"></a>02645       NumBLFeatures = GetBaselineFeatures(Blob,
<a name="l02646"></a>02646                                           denorm,
<a name="l02647"></a>02647                                           AdaptedTemplates-&gt;Templates,
<a name="l02648"></a>02648                                           BLFeatures, BLAdjust,
<a name="l02649"></a>02649                                           &amp;BlobLength);
<a name="l02650"></a>02650       <span class="keywordflow">if</span> (NumBLFeatures &lt;= 0)
<a name="l02651"></a>02651         <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Illegal blob (baseline features)!\n&quot;</span>);
<a name="l02652"></a>02652       <span class="keywordflow">else</span> {
<a name="l02653"></a>02653         im_.SetBaseLineMatch();
<a name="l02654"></a>02654         im_.Match(<a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a>(AdaptedTemplates-&gt;Templates, ClassId),
<a name="l02655"></a>02655                   AllProtosOn, AllConfigsOn,
<a name="l02656"></a>02656                   NumBLFeatures, BLFeatures,
<a name="l02657"></a>02657                   &amp;BLResult,
<a name="l02658"></a>02658                   classify_adapt_feature_threshold, <a class="code" href="adaptmatch_8cpp.html#a424f1b989129c5519f4df8f61ad6dcaf">NO_DEBUG</a>,
<a name="l02659"></a>02659                   matcher_debug_separate_windows);
<a name="l02660"></a>02660         ExpandShapesAndApplyCorrections(
<a name="l02661"></a>02661             AdaptedTemplates-&gt;Class, <span class="keyword">false</span>,
<a name="l02662"></a>02662             ClassId, Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(),
<a name="l02663"></a>02663             Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(), 0, BlobLength, CNAdjust,
<a name="l02664"></a>02664             BLResult, Results);
<a name="l02665"></a>02665       }
<a name="l02666"></a>02666     }
<a name="l02667"></a>02667   }
<a name="l02668"></a>02668 
<a name="l02669"></a>02669   <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02670"></a>02670   <span class="keywordflow">if</span> (BLResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a> &lt; CNResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#ac15af84ab870846f8be5b02ede056efb">Rating</a>) {
<a name="l02671"></a>02671     <span class="keywordflow">if</span> (next_config &lt; 0) {
<a name="l02672"></a>02672       ConfigMask = 1 &lt;&lt; BLResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>;
<a name="l02673"></a>02673       next_config = 0;
<a name="l02674"></a>02674     } <span class="keywordflow">else</span> {
<a name="l02675"></a>02675       ConfigMask = 1 &lt;&lt; next_config;
<a name="l02676"></a>02676       ++next_config;
<a name="l02677"></a>02677     }
<a name="l02678"></a>02678     classify_norm_method.set_value(<a class="code" href="mfoutline_8h.html#a2a4b69f9a2827dc98bc4cbc233118865a83297de004f4e58b9be2108c6cd08a23">baseline</a>);
<a name="l02679"></a>02679 
<a name="l02680"></a>02680     im_.SetBaseLineMatch();
<a name="l02681"></a>02681     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Adaptive Class ID: %d\n&quot;</span>, ClassId);
<a name="l02682"></a>02682     im_.Match(<a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a>(AdaptedTemplates-&gt;Templates, ClassId),
<a name="l02683"></a>02683               AllProtosOn, (<a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>) &amp;ConfigMask,
<a name="l02684"></a>02684               NumBLFeatures, BLFeatures,
<a name="l02685"></a>02685               &amp;BLResult,
<a name="l02686"></a>02686               classify_adapt_feature_threshold,
<a name="l02687"></a>02687               matcher_debug_flags,
<a name="l02688"></a>02688               matcher_debug_separate_windows);
<a name="l02689"></a>02689     ExpandShapesAndApplyCorrections(
<a name="l02690"></a>02690         AdaptedTemplates-&gt;Class, <span class="keyword">true</span>,
<a name="l02691"></a>02691         ClassId, Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(),
<a name="l02692"></a>02692         Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(), 0, BlobLength, CNAdjust,
<a name="l02693"></a>02693         BLResult, Results);
<a name="l02694"></a>02694   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape_id &gt;= 0) {
<a name="l02695"></a>02695     ConfigMask = 1 &lt;&lt; CNResult.<a class="code" href="struct_i_n_t___r_e_s_u_l_t___s_t_r_u_c_t.html#af0b37da100132e296cb6d45c3f55c159">Config</a>;
<a name="l02696"></a>02696     classify_norm_method.set_value(<a class="code" href="mfoutline_8h.html#a2a4b69f9a2827dc98bc4cbc233118865afa40ef3af4fea0001b535318130960b2">character</a>);
<a name="l02697"></a>02697 
<a name="l02698"></a>02698     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Static Shape ID: %d\n&quot;</span>, shape_id);
<a name="l02699"></a>02699     im_.SetCharNormMatch(<a class="code" href="intmatcher_8h.html#afe4b8f9ecb4595e800850f646935045b">classify_integer_matcher_multiplier</a>);
<a name="l02700"></a>02700     im_.Match(<a class="code" href="intproto_8h.html#a6a8e29742b045c359e7765a8a1ff4fdc">ClassForClassId</a> (PreTrainedTemplates, shape_id),
<a name="l02701"></a>02701               AllProtosOn, (<a class="code" href="bitvec_8h.html#a584fa1e33e36d105f97bc7e7288fb259">BIT_VECTOR</a>) &amp; ConfigMask,
<a name="l02702"></a>02702               NumCNFeatures, CNFeatures,
<a name="l02703"></a>02703               &amp;CNResult,
<a name="l02704"></a>02704               classify_adapt_feature_threshold,
<a name="l02705"></a>02705               matcher_debug_flags,
<a name="l02706"></a>02706               matcher_debug_separate_windows);
<a name="l02707"></a>02707     ExpandShapesAndApplyCorrections(<a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keyword">true</span>, shape_id,
<a name="l02708"></a>02708                                     Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#a4451d237f1cd18c4982d63fe36a11fc3">bottom</a>(),
<a name="l02709"></a>02709                                     Blob-&gt;<a class="code" href="struct_t_b_l_o_b.html#a8f1f8f110170fe12cf8147d504cd0ea2">bounding_box</a>().<a class="code" href="class_t_b_o_x.html#adf92e9fdac1bdf11c10d1c4d1178791a">top</a>(),
<a name="l02710"></a>02710                                     0, BlobLength, CNAdjust,
<a name="l02711"></a>02711                                     CNResult, Results);
<a name="l02712"></a>02712   }
<a name="l02713"></a>02713 
<a name="l02714"></a>02714   <span class="comment">// Clean up.</span>
<a name="l02715"></a>02715   <span class="keyword">delete</span>[] CNAdjust;
<a name="l02716"></a>02716   <span class="keyword">delete</span>[] BLAdjust;
<a name="l02717"></a>02717 }                              <span class="comment">/* ShowBestMatchFor */</span>
<a name="l02718"></a>02718 
<a name="l02719"></a>02719 <span class="comment">// Returns a string for the classifier class_id: either the corresponding</span>
<a name="l02720"></a>02720 <span class="comment">// unicharset debug_str or the shape_table_ debug str.</span>
<a name="l02721"></a><a class="code" href="classtesseract_1_1_classify.html#a6fc9e3752efb2fe0d74920e082a59bd7">02721</a> <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> <a class="code" href="classtesseract_1_1_classify.html#a6fc9e3752efb2fe0d74920e082a59bd7">Classify::ClassIDToDebugStr</a>(<span class="keyword">const</span> <a class="code" href="struct_i_n_t___t_e_m_p_l_a_t_e_s___s_t_r_u_c_t.html">INT_TEMPLATES_STRUCT</a>* templates,
<a name="l02722"></a>02722                                    <span class="keywordtype">int</span> class_id, <span class="keywordtype">int</span> config_id)<span class="keyword"> const </span>{
<a name="l02723"></a>02723   <a class="code" href="class_s_t_r_i_n_g.html">STRING</a> class_string;
<a name="l02724"></a>02724   <span class="keywordflow">if</span> (templates == PreTrainedTemplates &amp;&amp; shape_table_ != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02725"></a>02725     <span class="keywordtype">int</span> shape_id = ClassAndConfigIDToFontOrShapeID(class_id, config_id);
<a name="l02726"></a>02726     class_string = shape_table_-&gt;DebugStr(shape_id);
<a name="l02727"></a>02727   } <span class="keywordflow">else</span> {
<a name="l02728"></a>02728     class_string = unicharset.debug_str(class_id);
<a name="l02729"></a>02729   }
<a name="l02730"></a>02730   <span class="keywordflow">return</span> class_string;
<a name="l02731"></a>02731 }
<a name="l02732"></a>02732 
<a name="l02733"></a>02733 <span class="comment">// Converts a classifier class_id index to a shape_table_ index</span>
<a name="l02734"></a><a class="code" href="classtesseract_1_1_classify.html#a1002c7f80352c6ceac4af82ee35e5e06">02734</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a1002c7f80352c6ceac4af82ee35e5e06">Classify::ClassAndConfigIDToFontOrShapeID</a>(<span class="keywordtype">int</span> class_id,
<a name="l02735"></a>02735                                               <span class="keywordtype">int</span> int_result_config)<span class="keyword"> const </span>{
<a name="l02736"></a>02736   <span class="keywordtype">int</span> font_set_id = PreTrainedTemplates-&gt;Class[class_id]-&gt;font_set_id;
<a name="l02737"></a>02737   <span class="comment">// Older inttemps have no font_ids.</span>
<a name="l02738"></a>02738   <span class="keywordflow">if</span> (font_set_id &lt; 0)
<a name="l02739"></a>02739     <span class="keywordflow">return</span> kBlankFontinfoId;
<a name="l02740"></a>02740   <span class="keyword">const</span> <a class="code" href="structtesseract_1_1_font_set.html">FontSet</a> &amp;fs = fontset_table_.get(font_set_id);
<a name="l02741"></a>02741   <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(int_result_config &gt;= 0 &amp;&amp; int_result_config &lt; fs.<a class="code" href="structtesseract_1_1_font_set.html#a2f474cedd75889b35a8b5f401eab3c01">size</a>);
<a name="l02742"></a>02742   <span class="keywordflow">return</span> fs.<a class="code" href="structtesseract_1_1_font_set.html#a466a7c0f34a22d2b112658de14f6a376">configs</a>[int_result_config];
<a name="l02743"></a>02743 }
<a name="l02744"></a>02744 
<a name="l02745"></a>02745 <span class="comment">// Converts a shape_table_ index to a classifier class_id index (not a</span>
<a name="l02746"></a>02746 <span class="comment">// unichar-id!). Uses a search, so not fast.</span>
<a name="l02747"></a><a class="code" href="classtesseract_1_1_classify.html#a319cfe59c8e82e697375a351e3c604b3">02747</a> <span class="keywordtype">int</span> <a class="code" href="classtesseract_1_1_classify.html#a319cfe59c8e82e697375a351e3c604b3">Classify::ShapeIDToClassID</a>(<span class="keywordtype">int</span> shape_id)<span class="keyword"> const </span>{
<a name="l02748"></a>02748   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; PreTrainedTemplates-&gt;NumClasses; ++id) {
<a name="l02749"></a>02749     <span class="keywordtype">int</span> font_set_id = PreTrainedTemplates-&gt;Class[id]-&gt;font_set_id;
<a name="l02750"></a>02750     <a class="code" href="errcode_8h.html#a93a603f4063a6b9403d81caa245a583b">ASSERT_HOST</a>(font_set_id &gt;= 0);
<a name="l02751"></a>02751     <span class="keyword">const</span> <a class="code" href="structtesseract_1_1_font_set.html">FontSet</a> &amp;fs = fontset_table_.get(font_set_id);
<a name="l02752"></a>02752     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> config = 0; config &lt; fs.<a class="code" href="structtesseract_1_1_font_set.html#a2f474cedd75889b35a8b5f401eab3c01">size</a>; ++config) {
<a name="l02753"></a>02753       <span class="keywordflow">if</span> (fs.<a class="code" href="structtesseract_1_1_font_set.html#a466a7c0f34a22d2b112658de14f6a376">configs</a>[config] == shape_id)
<a name="l02754"></a>02754         <span class="keywordflow">return</span> id;
<a name="l02755"></a>02755     }
<a name="l02756"></a>02756   }
<a name="l02757"></a>02757   <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Shape %d not found\n&quot;</span>, shape_id);
<a name="l02758"></a>02758   <span class="keywordflow">return</span> -1;
<a name="l02759"></a>02759 }
<a name="l02760"></a>02760 
<a name="l02761"></a>02761 <span class="comment">// Returns true if the given TEMP_CONFIG is good enough to make it</span>
<a name="l02762"></a>02762 <span class="comment">// a permanent config.</span>
<a name="l02763"></a><a class="code" href="classtesseract_1_1_classify.html#a786c5f6e2a5cd8aac2ed4dd89af84fea">02763</a> <span class="keywordtype">bool</span> <a class="code" href="classtesseract_1_1_classify.html#a786c5f6e2a5cd8aac2ed4dd89af84fea">Classify::TempConfigReliable</a>(<a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> class_id,
<a name="l02764"></a>02764                                   <span class="keyword">const</span> <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> &amp;config) {
<a name="l02765"></a>02765   <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1) {
<a name="l02766"></a>02766     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;NumTimesSeen for config of %s is %d\n&quot;</span>,
<a name="l02767"></a>02767             getDict().getUnicharset().debug_str(class_id).<span class="keywordtype">string</span>(),
<a name="l02768"></a>02768             config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a441b843c3b024cd12b0ab4115a9fd159">NumTimesSeen</a>);
<a name="l02769"></a>02769   }
<a name="l02770"></a>02770   <span class="keywordflow">if</span> (config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a441b843c3b024cd12b0ab4115a9fd159">NumTimesSeen</a> &gt;= matcher_sufficient_examples_for_prototyping) {
<a name="l02771"></a>02771     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02772"></a>02772   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html#a441b843c3b024cd12b0ab4115a9fd159">NumTimesSeen</a> &lt; matcher_min_examples_for_prototyping) {
<a name="l02773"></a>02773     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02774"></a>02774   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (use_ambigs_for_adaption) {
<a name="l02775"></a>02775     <span class="comment">// Go through the ambigs vector and see whether we have already seen</span>
<a name="l02776"></a>02776     <span class="comment">// enough times all the characters represented by the ambigs vector.</span>
<a name="l02777"></a>02777     <span class="keyword">const</span> <a class="code" href="class_generic_vector.html">UnicharIdVector</a> *ambigs =
<a name="l02778"></a>02778       getDict().getUnicharAmbigs().AmbigsForAdaption(class_id);
<a name="l02779"></a>02779     <span class="keywordtype">int</span> ambigs_size = (ambigs == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? 0 : ambigs-&gt;<a class="code" href="class_generic_vector.html#a111b51dd0bf1324cfb69ef70703d8e70">size</a>();
<a name="l02780"></a>02780     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ambig = 0; ambig &lt; ambigs_size; ++ambig) {
<a name="l02781"></a>02781       <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> ambig_class = AdaptedTemplates-&gt;Class[(*ambigs)[ambig]];
<a name="l02782"></a>02782       assert(ambig_class != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02783"></a>02783       <span class="keywordflow">if</span> (ambig_class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#afe5769d3f67549e0938480aab2d2b1cd">NumPermConfigs</a> == 0 &amp;&amp;
<a name="l02784"></a>02784           ambig_class-&gt;<a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html#a88d1300e6657fc7c98af721983018b36">MaxNumTimesSeen</a> &lt;
<a name="l02785"></a>02785           matcher_min_examples_for_prototyping) {
<a name="l02786"></a>02786         <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1) {
<a name="l02787"></a>02787           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Ambig %s has not been seen enough times,&quot;</span>
<a name="l02788"></a>02788                   <span class="stringliteral">&quot; not making config for %s permanent\n&quot;</span>,
<a name="l02789"></a>02789                   getDict().getUnicharset().debug_str(
<a name="l02790"></a>02790                       (*ambigs)[ambig]).<span class="keywordtype">string</span>(),
<a name="l02791"></a>02791                   getDict().getUnicharset().debug_str(class_id).<span class="keywordtype">string</span>());
<a name="l02792"></a>02792         }
<a name="l02793"></a>02793         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02794"></a>02794       }
<a name="l02795"></a>02795     }
<a name="l02796"></a>02796   }
<a name="l02797"></a>02797   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02798"></a>02798 }
<a name="l02799"></a>02799 
<a name="l02800"></a><a class="code" href="classtesseract_1_1_classify.html#a954c9085f840572567462c9e0ff3551a">02800</a> <span class="keywordtype">void</span> <a class="code" href="classtesseract_1_1_classify.html#a954c9085f840572567462c9e0ff3551a">Classify::UpdateAmbigsGroup</a>(<a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> class_id, <span class="keyword">const</span> <a class="code" href="class_d_e_n_o_r_m.html">DENORM</a>&amp; denorm,
<a name="l02801"></a>02801                                  <a class="code" href="struct_t_b_l_o_b.html">TBLOB</a> *Blob) {
<a name="l02802"></a>02802   <span class="keyword">const</span> <a class="code" href="class_generic_vector.html">UnicharIdVector</a> *ambigs =
<a name="l02803"></a>02803     getDict().getUnicharAmbigs().ReverseAmbigsForAdaption(class_id);
<a name="l02804"></a>02804   <span class="keywordtype">int</span> ambigs_size = (ambigs == <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? 0 : ambigs-&gt;<a class="code" href="class_generic_vector.html#a111b51dd0bf1324cfb69ef70703d8e70">size</a>();
<a name="l02805"></a>02805   <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1) {
<a name="l02806"></a>02806     <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Running UpdateAmbigsGroup for %s class_id=%d\n&quot;</span>,
<a name="l02807"></a>02807             getDict().getUnicharset().debug_str(class_id).<span class="keywordtype">string</span>(), class_id);
<a name="l02808"></a>02808   }
<a name="l02809"></a>02809   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ambig = 0; ambig &lt; ambigs_size; ++ambig) {
<a name="l02810"></a>02810     <a class="code" href="matchdefs_8h.html#afdabe64d68192a21409dd58c119709f8">CLASS_ID</a> ambig_class_id = (*ambigs)[ambig];
<a name="l02811"></a>02811     <span class="keyword">const</span> <a class="code" href="struct_a_d_a_p_t___c_l_a_s_s___s_t_r_u_c_t.html">ADAPT_CLASS</a> ambigs_class = AdaptedTemplates-&gt;Class[ambig_class_id];
<a name="l02812"></a>02812     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cfg = 0; cfg &lt; <a class="code" href="intproto_8h.html#a5f9a45f938cb06ecc0f9dbdc144155b1">MAX_NUM_CONFIGS</a>; ++cfg) {
<a name="l02813"></a>02813       <span class="keywordflow">if</span> (<a class="code" href="adaptive_8h.html#a45d630ce43777ee1ab16048b0a846813">ConfigIsPermanent</a>(ambigs_class, cfg)) <span class="keywordflow">continue</span>;
<a name="l02814"></a>02814       <span class="keyword">const</span> <a class="code" href="struct_t_e_m_p___c_o_n_f_i_g___s_t_r_u_c_t.html">TEMP_CONFIG</a> config =
<a name="l02815"></a>02815         <a class="code" href="adaptive_8h.html#aebe34b43b3fd192fbde7130fa0c62933">TempConfigFor</a>(AdaptedTemplates-&gt;Class[ambig_class_id], cfg);
<a name="l02816"></a>02816       <span class="keywordflow">if</span> (config != <a class="code" href="host_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; TempConfigReliable(ambig_class_id, config)) {
<a name="l02817"></a>02817         <span class="keywordflow">if</span> (classify_learning_debug_level &gt;= 1) {
<a name="l02818"></a>02818           <a class="code" href="tprintf_8cpp.html#a0c2bcd4462ec67ab0971b34a0f610f55">tprintf</a>(<span class="stringliteral">&quot;Making config %d of %s permanent\n&quot;</span>, cfg,
<a name="l02819"></a>02819                   getDict().getUnicharset().debug_str(
<a name="l02820"></a>02820                       ambig_class_id).<span class="keywordtype">string</span>());
<a name="l02821"></a>02821         }
<a name="l02822"></a>02822         MakePermanent(AdaptedTemplates, ambig_class_id, cfg, denorm, Blob);
<a name="l02823"></a>02823       }
<a name="l02824"></a>02824     }
<a name="l02825"></a>02825   }
<a name="l02826"></a>02826 }
<a name="l02827"></a>02827 
<a name="l02828"></a>02828 }  <span class="comment">// namespace tesseract</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="adaptmatch_8cpp.html">adaptmatch.cpp</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Fri Mar 30 2012 23:21:36 for Tesseract by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
